"use strict";
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
var __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {
    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {
        if (ar || !(i in from)) {
            if (!ar) ar = Array.prototype.slice.call(from, 0, i);
            ar[i] = from[i];
        }
    }
    return to.concat(ar || Array.prototype.slice.call(from));
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.ComboBox = void 0;
var chromicons_1 = require("@lifeomic/chromicons");
var UniqueId_1 = require("../_private/UniqueId");
var framer_motion_1 = require("framer-motion");
var Portal_1 = require("reakit/Portal");
var Rover_1 = require("reakit/Rover");
var Select_1 = require("./Select");
var Text_1 = require("../Text");
var forms_1 = require("../_private/forms");
var Popover_1 = require("reakit/Popover");
var clsx_1 = __importDefault(require("clsx"));
var react_focus_lock_1 = __importDefault(require("react-focus-lock"));
var React = __importStar(require("react"));
var popoverVariants = {
    open: {
        opacity: 1,
        offsetTop: -2,
        transition: {
            duration: 0.25,
            ease: 'easeOut',
        },
    },
    closed: {
        opacity: 0,
        offsetTop: -18,
    },
};
var popoverVariantsReduced = {
    open: {
        opacity: 1,
        transition: {
            duration: 0.2,
            ease: 'easeOut',
        },
    },
    closed: {
        opacity: 0,
    },
};
var listMotionVariants = {
    open: {
        transition: {
            delayChildren: 0.025,
            staggerChildren: 0.045,
            duration: 0.2,
        },
    },
    closed: {},
};
var listMotionVariantsReduced = {
    open: {},
    closed: {},
};
var listItemMotionVariants = {
    open: {
        y: 0,
        opacity: 1,
        transition: {
            y: { stiffness: 1000, velocity: -100 },
        },
    },
    closed: {
        y: -16,
        opacity: 0,
    },
};
var listItemMotionVariantsReduced = {
    open: {
        opacity: 1,
    },
    closed: {
        opacity: 0,
    },
};
var ComboBox = function (_a) {
    var _b;
    var ariaLabel = _a["aria-label"], children = _a.children, className = _a.className, _c = _a.color, color = _c === void 0 ? 'default' : _c, errorMessage = _a.errorMessage, fullWidth = _a.fullWidth, hasError = _a.hasError, helpMessage = _a.helpMessage, id = _a.id, label = _a.label, secondaryLabel = _a.secondaryLabel, onChange = _a.onChange, placeholder = _a.placeholder, placement = _a.placement, popoverAriaLabel = _a.popoverAriaLabel, selectedOptionDisplay = _a.selectedOptionDisplay, value = _a.value, rootProps = __rest(_a, ['aria-label', "children", "className", "color", "errorMessage", "fullWidth", "hasError", "helpMessage", "id", "label", "secondaryLabel", "onChange", "placeholder", "placement", "popoverAriaLabel", "selectedOptionDisplay", "value"]);
    var classes = (0, Select_1.useStyles)({});
    var popover = (0, Popover_1.usePopoverState)({ placement: placement });
    var rover = (0, Rover_1.useRoverState)({ loop: true, orientation: 'vertical' });
    var shouldReduceMotion = (0, framer_motion_1.useReducedMotion)();
    var buttonRef = React.useRef();
    // This width is used to determine the popover width when open,
    // as well as setting the `maxWidth` of the text inside to ensure
    // the element size doesn't shift when the selected option text
    // gets long.
    var _d = React.useState(50), width = _d[0], setWidth = _d[1];
    var _e = React.useState(null), internalSelections = _e[0], setInternalSelections = _e[1];
    // A uniqueId is required to wire up aria-attributes
    var uniqueId = React.useState(function () { return id || name || (0, UniqueId_1.generateUniqueId)('combobox-'); })[0];
    // Update the opened popover width when the window width changes
    // TODO: Review the best way to handle this without breaking
    // eslint-disable-next-line react-hooks/exhaustive-deps
    React.useEffect(function () {
        setWidth(buttonRef.current.getBoundingClientRect().width);
    });
    // Determine which of the child select option values are matches based on
    // the "value" prop.  If a select option value is included in the "value",
    // then we add it to the list of internal select options (which keep
    // track of which options are selected to apply classes)
    React.useEffect(function () {
        var matches = React.Children.toArray(children).filter(function (child) {
            if (!React.isValidElement(child)) {
                return null;
            }
            return value === null || value === void 0 ? void 0 : value.includes(child.props.value);
        });
        if (matches.length === 0) {
            setInternalSelections([]);
            return;
        }
        setInternalSelections(matches.map(function (m) { return m.props; }));
    }, [children, value]);
    var handleOptionSelected = function (optionValue, meta) {
        var isAlreadySelected = internalSelections === null || internalSelections === void 0 ? void 0 : internalSelections.find(function (s) { return s.value === optionValue; });
        if (isAlreadySelected) {
            // Filter out the option the user selected from our list of internal selections
            // (so that it's removed), and then pass the values and meta arrays back
            // to the consumer.
            var filteredSelections = (internalSelections === null || internalSelections === void 0 ? void 0 : internalSelections.filter(function (s) { return s.value !== optionValue; })) || [];
            onChange === null || onChange === void 0 ? void 0 : onChange(__spreadArray([], filteredSelections === null || filteredSelections === void 0 ? void 0 : filteredSelections.map(function (s) { return s.value; }), true), __spreadArray([], filteredSelections === null || filteredSelections === void 0 ? void 0 : filteredSelections.map(function (s) { return s.meta; }), true));
            return;
        }
        // We are adding a selected option, so we collect all of the values
        // and meta arrays, add in our new selection, and return the updated
        // list to the consumer
        var valueOptions = (internalSelections === null || internalSelections === void 0 ? void 0 : internalSelections.map(function (s) { return s.value; })) || [];
        var metaOptions = (internalSelections === null || internalSelections === void 0 ? void 0 : internalSelections.map(function (s) { return s.meta; })) || [];
        onChange === null || onChange === void 0 ? void 0 : onChange(__spreadArray(__spreadArray([], valueOptions, true), [optionValue], false), __spreadArray(__spreadArray([], metaOptions, true), [meta], false));
    };
    if (!label && !ariaLabel && process.env.NODE_ENV === 'development') {
        throw new Error('If a "label" is not provided to ComboBox, please provide "aria-label".');
    }
    return (React.createElement("div", { className: (0, clsx_1.default)(classes.root, className) },
        React.createElement("label", { "aria-hidden": "true", className: (0, clsx_1.default)(classes.label, color === 'inverse' && classes.labelInverse, !label && ariaLabel && classes.srOnly), htmlFor: uniqueId },
            label || ariaLabel,
            secondaryLabel ? (React.createElement("span", { className: (0, clsx_1.default)(classes.labelSecondary, color === 'inverse' && classes.labelInverse) }, secondaryLabel)) : null),
        React.createElement(Popover_1.PopoverDisclosure, __assign({ className: (0, clsx_1.default)(classes.button, classes.comboxBoxOverflow, hasError && classes.buttonError, fullWidth && classes.buttonFullWidth, (_b = {},
                _b[classes.buttonInverse] = color === 'inverse',
                _b)), ref: buttonRef, "aria-describedby": (0, forms_1.buildDescribedBy)({
                hasError: hasError,
                hasHelpMessage: !!helpMessage,
                uniqueId: uniqueId,
            }), id: uniqueId }, popover, rootProps),
            React.createElement(React.Fragment, null,
                (internalSelections === null || internalSelections === void 0 ? void 0 : internalSelections.length) === 0 && (React.createElement(framer_motion_1.motion.div, { initial: { opacity: 0 }, animate: {
                        opacity: 1,
                        transition: { duration: 0.2, ease: 'easeIn' },
                    } },
                    React.createElement(Text_1.Text, { className: (0, clsx_1.default)(classes.buttonText, classes.placeholderText, classes.comboBoxPlaceholder), size: "subbody" }, placeholder))),
                internalSelections &&
                    (internalSelections === null || internalSelections === void 0 ? void 0 : internalSelections.length) > 0 &&
                    !selectedOptionDisplay && (React.createElement(Text_1.Text, { className: (0, clsx_1.default)(classes.buttonText, classes.chipList), size: "subbody", style: fullWidth ? {} : { maxWidth: width - 42 } }, internalSelections === null || internalSelections === void 0 ? void 0 : internalSelections.map(function (selectedOption, index) { return (React.createElement(framer_motion_1.motion.span, { key: index, className: classes.chip, initial: shouldReduceMotion
                        ? { opacity: 0 }
                        : { opacity: 0, y: -8 }, animate: shouldReduceMotion
                        ? { opacity: 1 }
                        : {
                            opacity: 1,
                            transition: { duration: 0.2, ease: 'easeOut' },
                            y: 0,
                        } }, selectedOption.title)); }))),
                internalSelections &&
                    (internalSelections === null || internalSelections === void 0 ? void 0 : internalSelections.length) > 0 &&
                    selectedOptionDisplay && (React.createElement(Text_1.Text, { className: classes.buttonText, size: "subbody" }, selectedOptionDisplay(internalSelections))),
                React.createElement("div", { className: classes.buttonArrowContainer, role: "presentation" },
                    React.createElement(chromicons_1.ChevronDown, { className: (0, clsx_1.default)(classes.arrowIcon, popover.visible && classes.rotate), "aria-hidden": true, role: "img", width: 18, height: 18 })))),
        helpMessage && (React.createElement(forms_1.FormHelpMessage, { className: classes.message, color: color, rootElementId: uniqueId, describedById: (0, forms_1.helpFor)(uniqueId) }, helpMessage)),
        hasError && (React.createElement(forms_1.FormErrorMessage, { className: classes.message, color: color, rootElementId: uniqueId, describedById: (0, forms_1.errorFor)(uniqueId) }, errorMessage)),
        React.createElement(Portal_1.Portal, null,
            React.createElement(react_focus_lock_1.default, null,
                React.createElement(Popover_1.Popover, __assign({ "aria-label": label || ariaLabel || popoverAriaLabel, className: classes.popover }, popover, { style: { width: width }, as: framer_motion_1.motion.div, animate: popover.visible ? 'open' : 'closed', variants: shouldReduceMotion ? popoverVariantsReduced : popoverVariants }),
                    React.createElement(framer_motion_1.motion.ul, { className: classes.ul, variants: shouldReduceMotion
                            ? listMotionVariantsReduced
                            : listMotionVariants, role: "listbox", "aria-multiselectable": true }, React.Children.map(children, function (child) {
                        var _a, _b, _c, _d;
                        if (!React.isValidElement(child)) {
                            return null;
                        }
                        var option = child;
                        return (React.createElement(Rover_1.Rover, __assign({}, rover, { "aria-selected": value === null || value === void 0 ? void 0 : value.includes((_a = option === null || option === void 0 ? void 0 : option.props) === null || _a === void 0 ? void 0 : _a.value), className: classes.option, as: framer_motion_1.motion.li, disabled: (_b = child === null || child === void 0 ? void 0 : child.props) === null || _b === void 0 ? void 0 : _b.disabled, role: "option", value: (_c = option === null || option === void 0 ? void 0 : option.props) === null || _c === void 0 ? void 0 : _c.value, variants: shouldReduceMotion
                                ? listItemMotionVariantsReduced
                                : listItemMotionVariants, onClick: function () {
                                var _a, _b;
                                return handleOptionSelected((_a = option === null || option === void 0 ? void 0 : option.props) === null || _a === void 0 ? void 0 : _a.value, (_b = option === null || option === void 0 ? void 0 : option.props) === null || _b === void 0 ? void 0 : _b.meta);
                            } }), React.cloneElement(option, __assign({ isChecked: value === null || value === void 0 ? void 0 : value.includes((_d = option === null || option === void 0 ? void 0 : option.props) === null || _d === void 0 ? void 0 : _d.value) }, option.props))));
                    })))))));
};
exports.ComboBox = ComboBox;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ29tYm9Cb3guanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvY29tcG9uZW50cy9TZWxlY3QvQ29tYm9Cb3gudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLG1EQUFtRDtBQUNuRCxpREFBd0Q7QUFDeEQsK0NBQXlEO0FBQ3pELHdDQUF1QztBQUN2QyxzQ0FBb0Q7QUFFcEQsbUNBQWtEO0FBQ2xELGdDQUErQjtBQUMvQiwyQ0FNMkI7QUFDM0IsMENBSXdCO0FBQ3hCLDhDQUF3QjtBQUN4QixzRUFBeUM7QUFDekMsMkNBQStCO0FBRS9CLElBQU0sZUFBZSxHQUFHO0lBQ3RCLElBQUksRUFBRTtRQUNKLE9BQU8sRUFBRSxDQUFDO1FBQ1YsU0FBUyxFQUFFLENBQUMsQ0FBQztRQUNiLFVBQVUsRUFBRTtZQUNWLFFBQVEsRUFBRSxJQUFJO1lBQ2QsSUFBSSxFQUFFLFNBQVM7U0FDaEI7S0FDRjtJQUNELE1BQU0sRUFBRTtRQUNOLE9BQU8sRUFBRSxDQUFDO1FBQ1YsU0FBUyxFQUFFLENBQUMsRUFBRTtLQUNmO0NBQ0YsQ0FBQztBQUVGLElBQU0sc0JBQXNCLEdBQUc7SUFDN0IsSUFBSSxFQUFFO1FBQ0osT0FBTyxFQUFFLENBQUM7UUFDVixVQUFVLEVBQUU7WUFDVixRQUFRLEVBQUUsR0FBRztZQUNiLElBQUksRUFBRSxTQUFTO1NBQ2hCO0tBQ0Y7SUFDRCxNQUFNLEVBQUU7UUFDTixPQUFPLEVBQUUsQ0FBQztLQUNYO0NBQ0YsQ0FBQztBQUVGLElBQU0sa0JBQWtCLEdBQUc7SUFDekIsSUFBSSxFQUFFO1FBQ0osVUFBVSxFQUFFO1lBQ1YsYUFBYSxFQUFFLEtBQUs7WUFDcEIsZUFBZSxFQUFFLEtBQUs7WUFDdEIsUUFBUSxFQUFFLEdBQUc7U0FDZDtLQUNGO0lBQ0QsTUFBTSxFQUFFLEVBQUU7Q0FDWCxDQUFDO0FB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UUFBUSxFQUNiLEtBQUssRUFBRSxNQUFBLE1BQU0sYUFBTixNQUFNLHVCQUFOLE1BQU0sQ0FBRSxLQUFLLDBDQUFFLEtBQUssRUFDM0IsUUFBUSxFQUNOLGtCQUFrQjtnQ0FDaEIsQ0FBQyxDQUFDLDZCQUE2QjtnQ0FDL0IsQ0FBQyxDQUFDLHNCQUFzQixFQUU1QixPQUFPLEVBQUU7O2dDQUNQLE9BQUEsb0JBQW9CLENBQ2xCLE1BQUEsTUFBTSxhQUFOLE1BQU0sdUJBQU4sTUFBTSxDQUFFLEtBQUssMENBQUUsS0FBSyxFQUNwQixNQUFBLE1BQU0sYUFBTixNQUFNLHVCQUFOLE1BQU0sQ0FBRSxLQUFLLDBDQUFFLElBQUksQ0FDcEIsQ0FBQTs2QkFBQSxLQUdGLEtBQUssQ0FBQyxZQUFZLENBQW9CLE1BQU0sYUFDM0MsU0FBUyxFQUFFLEtBQUssYUFBTCxLQUFLLHVCQUFMLEtBQUssQ0FBRSxRQUFRLENBQUMsTUFBQSxNQUFNLGFBQU4sTUFBTSx1QkFBTixNQUFNLENBQUUsS0FBSywwQ0FBRSxLQUFLLENBQUMsSUFDN0MsTUFBTSxDQUFDLEtBQUssRUFDZixDQUNJLENBQ1QsQ0FBQztvQkFDSixDQUFDLENBQUMsQ0FDUSxDQUNFLENBQ04sQ0FDTCxDQUNMLENBQ1AsQ0FBQztBQUNKLENBQUMsQ0FBQztBQXhUVyxRQUFBLFFBQVEsWUF3VG5CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2hldnJvbkRvd24gfSBmcm9tICdAbGlmZW9taWMvY2hyb21pY29ucyc7XG5pbXBvcnQgeyBnZW5lcmF0ZVVuaXF1ZUlkIH0gZnJvbSAnLi4vX3ByaXZhdGUvVW5pcXVlSWQnO1xuaW1wb3J0IHsgbW90aW9uLCB1c2VSZWR1Y2VkTW90aW9uIH0gZnJvbSAnZnJhbWVyLW1vdGlvbic7XG5pbXBvcnQgeyBQb3J0YWwgfSBmcm9tICdyZWFraXQvUG9ydGFsJztcbmltcG9ydCB7IFJvdmVyLCB1c2VSb3ZlclN0YXRlIH0gZnJvbSAncmVha2l0L1JvdmVyJztcbmltcG9ydCB7IFNlbGVjdE9wdGlvblByb3BzIH0gZnJvbSAnLi9TZWxlY3RPcHRpb24nO1xuaW1wb3J0IHsgU2VsZWN0UHJvcHMsIHVzZVN0eWxlcyB9IGZyb20gJy4vU2VsZWN0JztcbmltcG9ydCB7IFRleHQgfSBmcm9tICcuLi9UZXh0JztcbmltcG9ydCB7XG4gIGJ1aWxkRGVzY3JpYmVkQnksXG4gIGVycm9yRm9yLFxuICBGb3JtRXJyb3JNZXNzYWdlLFxuICBGb3JtSGVscE1lc3NhZ2UsXG4gIGhlbHBGb3IsXG59IGZyb20gJy4uL19wcml2YXRlL2Zvcm1zJztcbmltcG9ydCB7XG4gIFBvcG92ZXIgYXMgUmVha2l0UG9wb3ZlcixcbiAgUG9wb3ZlckRpc2Nsb3N1cmUsXG4gIHVzZVBvcG92ZXJTdGF0ZSxcbn0gZnJvbSAncmVha2l0L1BvcG92ZXInO1xuaW1wb3J0IGNsc3ggZnJvbSAnY2xzeCc7XG5pbXBvcnQgRm9jdXNMb2NrIGZyb20gJ3JlYWN0LWZvY3VzLWxvY2snO1xuaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xuXG5jb25zdCBwb3BvdmVyVmFyaWFudHMgPSB7XG4gIG9wZW46IHtcbiAgICBvcGFjaXR5OiAxLFxuICAgIG9mZnNldFRvcDogLTIsIC8vIFBvcHBlci5qcyAodW5kZXJseWluZyBQb3BvdmVyKSByZXF1aXJlcyBgb2ZmU2V0VG9wYCBvdmVyIGBtYXJnaW5Ub3BgXG4gICAgdHJhbnNpdGlvbjoge1xuICAgICAgZHVyYXRpb246IDAuMjUsXG4gICAgICBlYXNlOiAnZWFzZU91dCcsXG4gICAgfSxcbiAgfSxcbiAgY2xvc2VkOiB7XG4gICAgb3BhY2l0eTogMCxcbiAgICBvZmZzZXRUb3A6IC0xOCxcbiAgfSxcbn07XG5cbmNvbnN0IHBvcG92ZXJWYXJpYW50c1JlZHVjZWQgPSB7XG4gIG9wZW46IHtcbiAgICBvcGFjaXR5OiAxLFxuICAgIHRyYW5zaXRpb246IHtcbiAgICAgIGR1cmF0aW9uOiAwLjIsXG4gICAgICBlYXNlOiAnZWFzZU91dCcsXG4gICAgfSxcbiAgfSxcbiAgY2xvc2VkOiB7XG4gICAgb3BhY2l0eTogMCxcbiAgfSxcbn07XG5cbmNvbnN0IGxpc3RNb3Rpb25WYXJpYW50cyA9IHtcbiAgb3Blbjoge1xuICAgIHRyYW5zaXRpb246IHtcbiAgICAgIGRlbGF5Q2hpbGRyZW46IDAuMDI1LFxuICAgICAgc3RhZ2dlckNoaWxkcmVuOiAwLjA0NSxcbiAgICAgIGR1cmF0aW9uOiAwLjIsXG4gICAgfSxcbiAgfSxcbiAgY2xvc2VkOiB7fSxcbn07XG5cbmNvbnN0IGxpc3RNb3Rpb25WYXJpYW50c1JlZHVjZWQgPSB7XG4gIG9wZW46IHt9LFxuICBjbG9zZWQ6IHt9LFxufTtcblxuY29uc3QgbGlzdEl0ZW1Nb3Rpb25WYXJpYW50cyA9IHtcbiAgb3Blbjoge1xuICAgIHk6IDAsXG4gICAgb3BhY2l0eTogMSxcbiAgICB0cmFuc2l0aW9uOiB7XG4gICAgICB5OiB7IHN0aWZmbmVzczogMTAwMCwgdmVsb2NpdHk6IC0xMDAgfSxcbiAgICB9LFxuICB9LFxuICBjbG9zZWQ6IHtcbiAgICB5OiAtMTYsXG4gICAgb3BhY2l0eTogMCxcbiAgfSxcbn07XG5cbmNvbnN0IGxpc3RJdGVtTW90aW9uVmFyaWFudHNSZWR1Y2VkID0ge1xuICBvcGVuOiB7XG4gICAgb3BhY2l0eTogMSxcbiAgfSxcbiAgY2xvc2VkOiB7XG4gICAgb3BhY2l0eTogMCxcbiAgfSxcbn07XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ29tYm9Cb3hQcm9wc1xuICBleHRlbmRzIE9taXQ8U2VsZWN0UHJvcHMsICdvbkNoYW5nZScgfCAnc2VsZWN0ZWRPcHRpb25EaXNwbGF5JyB8ICd2YWx1ZSc+IHtcbiAgb25DaGFuZ2U/OiAodmFsdWVzOiBBcnJheTxzdHJpbmc+LCBtZXRhOiBBcnJheTxzdHJpbmc+KSA9PiB2b2lkO1xuICBzZWxlY3RlZE9wdGlvbkRpc3BsYXk/OiAoXG4gICAgb3B0aW9uczogQXJyYXk8U2VsZWN0T3B0aW9uUHJvcHM+XG4gICkgPT4gc3RyaW5nIHwgbnVsbCB8IHVuZGVmaW5lZCB8IFJlYWN0LlJlYWN0Tm9kZTtcbiAgdmFsdWU/OiBBcnJheTxzdHJpbmc+IHwgdW5kZWZpbmVkO1xufVxuXG5leHBvcnQgY29uc3QgQ29tYm9Cb3g6IFJlYWN0LkZDPENvbWJvQm94UHJvcHM+ID0gKHtcbiAgWydhcmlhLWxhYmVsJ106IGFyaWFMYWJlbCxcbiAgY2hpbGRyZW4sXG4gIGNsYXNzTmFtZSxcbiAgY29sb3IgPSAnZGVmYXVsdCcsXG4gIGVycm9yTWVzc2FnZSxcbiAgZnVsbFdpZHRoLFxuICBoYXNFcnJvcixcbiAgaGVscE1lc3NhZ2UsXG4gIGlkLFxuICBsYWJlbCxcbiAgc2Vjb25kYXJ5TGFiZWwsXG4gIG9uQ2hhbmdlLFxuICBwbGFjZWhvbGRlcixcbiAgcGxhY2VtZW50LFxuICBwb3BvdmVyQXJpYUxhYmVsLFxuICBzZWxlY3RlZE9wdGlvbkRpc3BsYXksXG4gIHZhbHVlLFxuICAuLi5yb290UHJvcHNcbn0pID0+IHtcbiAgY29uc3QgY2xhc3NlcyA9IHVzZVN0eWxlcyh7fSk7XG4gIGNvbnN0IHBvcG92ZXIgPSB1c2VQb3BvdmVyU3RhdGUoeyBwbGFjZW1lbnQgfSk7XG4gIGNvbnN0IHJvdmVyID0gdXNlUm92ZXJTdGF0ZSh7IGxvb3A6IHRydWUsIG9yaWVudGF0aW9uOiAndmVydGljYWwnIH0pO1xuICBjb25zdCBzaG91bGRSZWR1Y2VNb3Rpb24gPSB1c2VSZWR1Y2VkTW90aW9uKCk7XG5cbiAgY29uc3QgYnV0dG9uUmVmID0gUmVhY3QudXNlUmVmPGFueT4oKTtcblxuICAvLyBUaGlzIHdpZHRoIGlzIHVzZWQgdG8gZGV0ZXJtaW5lIHRoZSBwb3BvdmVyIHdpZHRoIHdoZW4gb3BlbixcbiAgLy8gYXMgd2VsbCBhcyBzZXR0aW5nIHRoZSBgbWF4V2lkdGhgIG9mIHRoZSB0ZXh0IGluc2lkZSB0byBlbnN1cmVcbiAgLy8gdGhlIGVsZW1lbnQgc2l6ZSBkb2Vzbid0IHNoaWZ0IHdoZW4gdGhlIHNlbGVjdGVkIG9wdGlvbiB0ZXh0XG4gIC8vIGdldHMgbG9uZy5cbiAgY29uc3QgW3dpZHRoLCBzZXRXaWR0aF0gPSBSZWFjdC51c2VTdGF0ZTxudW1iZXI+KDUwKTtcblxuICBjb25zdCBbaW50ZXJuYWxTZWxlY3Rpb25zLCBzZXRJbnRlcm5hbFNlbGVjdGlvbnNdID0gUmVhY3QudXNlU3RhdGU8QXJyYXk8XG4gICAgU2VsZWN0T3B0aW9uUHJvcHNcbiAgPiB8IG51bGw+KG51bGwpO1xuXG4gIC8vIEEgdW5pcXVlSWQgaXMgcmVxdWlyZWQgdG8gd2lyZSB1cCBhcmlhLWF0dHJpYnV0ZXNcbiAgY29uc3QgW3VuaXF1ZUlkXSA9IFJlYWN0LnVzZVN0YXRlPHN0cmluZz4oXG4gICAgKCkgPT4gaWQgfHwgbmFtZSB8fCBnZW5lcmF0ZVVuaXF1ZUlkKCdjb21ib2JveC0nKVxuICApO1xuXG4gIC8vIFVwZGF0ZSB0aGUgb3BlbmVkIHBvcG92ZXIgd2lkdGggd2hlbiB0aGUgd2luZG93IHdpZHRoIGNoYW5nZXNcbiAgLy8gVE9ETzogUmV2aWV3IHRoZSBiZXN0IHdheSB0byBoYW5kbGUgdGhpcyB3aXRob3V0IGJyZWFraW5nXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC1ob29rcy9leGhhdXN0aXZlLWRlcHNcbiAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHtcbiAgICBzZXRXaWR0aChidXR0b25SZWYuY3VycmVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aCk7XG4gIH0pO1xuXG4gIC8vIERldGVybWluZSB3aGljaCBvZiB0aGUgY2hpbGQgc2VsZWN0IG9wdGlvbiB2YWx1ZXMgYXJlIG1hdGNoZXMgYmFzZWQgb25cbiAgLy8gdGhlIFwidmFsdWVcIiBwcm9wLiAgSWYgYSBzZWxlY3Qgb3B0aW9uIHZhbHVlIGlzIGluY2x1ZGVkIGluIHRoZSBcInZhbHVlXCIsXG4gIC8vIHRoZW4gd2UgYWRkIGl0IHRvIHRoZSBsaXN0IG9mIGludGVybmFsIHNlbGVjdCBvcHRpb25zICh3aGljaCBrZWVwXG4gIC8vIHRyYWNrIG9mIHdoaWNoIG9wdGlvbnMgYXJlIHNlbGVjdGVkIHRvIGFwcGx5IGNsYXNzZXMpXG4gIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7XG4gICAgY29uc3QgbWF0Y2hlczogYW55ID0gUmVhY3QuQ2hpbGRyZW4udG9BcnJheShjaGlsZHJlbikuZmlsdGVyKChjaGlsZCkgPT4ge1xuICAgICAgaWYgKCFSZWFjdC5pc1ZhbGlkRWxlbWVudChjaGlsZCkpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB2YWx1ZT8uaW5jbHVkZXMoY2hpbGQucHJvcHMudmFsdWUpO1xuICAgIH0pO1xuXG4gICAgaWYgKG1hdGNoZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICBzZXRJbnRlcm5hbFNlbGVjdGlvbnMoW10pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHNldEludGVybmFsU2VsZWN0aW9ucyhtYXRjaGVzLm1hcCgobTogYW55KSA9PiBtLnByb3BzKSk7XG4gIH0sIFtjaGlsZHJlbiwgdmFsdWVdKTtcblxuICBjb25zdCBoYW5kbGVPcHRpb25TZWxlY3RlZCA9IChvcHRpb25WYWx1ZTogc3RyaW5nLCBtZXRhOiBhbnkpID0+IHtcbiAgICBjb25zdCBpc0FscmVhZHlTZWxlY3RlZCA9IGludGVybmFsU2VsZWN0aW9ucz8uZmluZChcbiAgICAgIChzKSA9PiBzLnZhbHVlID09PSBvcHRpb25WYWx1ZVxuICAgICk7XG5cbiAgICBpZiAoaXNBbHJlYWR5U2VsZWN0ZWQpIHtcbiAgICAgIC8vIEZpbHRlciBvdXQgdGhlIG9wdGlvbiB0aGUgdXNlciBzZWxlY3RlZCBmcm9tIG91ciBsaXN0IG9mIGludGVybmFsIHNlbGVjdGlvbnNcbiAgICAgIC8vIChzbyB0aGF0IGl0J3MgcmVtb3ZlZCksIGFuZCB0aGVuIHBhc3MgdGhlIHZhbHVlcyBhbmQgbWV0YSBhcnJheXMgYmFja1xuICAgICAgLy8gdG8gdGhlIGNvbnN1bWVyLlxuICAgICAgY29uc3QgZmlsdGVyZWRTZWxlY3Rpb25zID1cbiAgICAgICAgaW50ZXJuYWxTZWxlY3Rpb25zPy5maWx0ZXIoKHMpID0+IHMudmFsdWUgIT09IG9wdGlvblZhbHVlKSB8fCBbXTtcbiAgICAgIG9uQ2hhbmdlPy4oXG4gICAgICAgIFsuLi5maWx0ZXJlZFNlbGVjdGlvbnM/Lm1hcCgocykgPT4gcy52YWx1ZSldLFxuICAgICAgICBbLi4uZmlsdGVyZWRTZWxlY3Rpb25zPy5tYXAoKHMpID0+IHMubWV0YSldXG4gICAgICApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFdlIGFyZSBhZGRpbmcgYSBzZWxlY3RlZCBvcHRpb24sIHNvIHdlIGNvbGxlY3QgYWxsIG9mIHRoZSB2YWx1ZXNcbiAgICAvLyBhbmQgbWV0YSBhcnJheXMsIGFkZCBpbiBvdXIgbmV3IHNlbGVjdGlvbiwgYW5kIHJldHVybiB0aGUgdXBkYXRlZFxuICAgIC8vIGxpc3QgdG8gdGhlIGNvbnN1bWVyXG4gICAgY29uc3QgdmFsdWVPcHRpb25zID0gaW50ZXJuYWxTZWxlY3Rpb25zPy5tYXAoKHMpID0+IHMudmFsdWUpIHx8IFtdO1xuICAgIGNvbnN0IG1ldGFPcHRpb25zID0gaW50ZXJuYWxTZWxlY3Rpb25zPy5tYXAoKHMpID0+IHMubWV0YSkgfHwgW107XG4gICAgb25DaGFuZ2U/LihbLi4udmFsdWVPcHRpb25zLCBvcHRpb25WYWx1ZV0sIFsuLi5tZXRhT3B0aW9ucywgbWV0YV0pO1xuICB9O1xuXG4gIGlmICghbGFiZWwgJiYgIWFyaWFMYWJlbCAmJiBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50Jykge1xuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICdJZiBhIFwibGFiZWxcIiBpcyBub3QgcHJvdmlkZWQgdG8gQ29tYm9Cb3gsIHBsZWFzZSBwcm92aWRlIFwiYXJpYS1sYWJlbFwiLidcbiAgICApO1xuICB9XG5cbiAgcmV0dXJuIChcbiAgICA8ZGl2IGNsYXNzTmFtZT17Y2xzeChjbGFzc2VzLnJvb3QsIGNsYXNzTmFtZSl9PlxuICAgICAgPGxhYmVsXG4gICAgICAgIGFyaWEtaGlkZGVuPVwidHJ1ZVwiXG4gICAgICAgIGNsYXNzTmFtZT17Y2xzeChcbiAgICAgICAgICBjbGFzc2VzLmxhYmVsLFxuICAgICAgICAgIGNvbG9yID09PSAnaW52ZXJzZScgJiYgY2xhc3Nlcy5sYWJlbEludmVyc2UsXG4gICAgICAgICAgIWxhYmVsICYmIGFyaWFMYWJlbCAmJiBjbGFzc2VzLnNyT25seVxuICAgICAgICApfVxuICAgICAgICBodG1sRm9yPXt1bmlxdWVJZH1cbiAgICAgID5cbiAgICAgICAge2xhYmVsIHx8IGFyaWFMYWJlbH1cbiAgICAgICAge3NlY29uZGFyeUxhYmVsID8gKFxuICAgICAgICAgIDxzcGFuXG4gICAgICAgICAgICBjbGFzc05hbWU9e2Nsc3goXG4gICAgICAgICAgICAgIGNsYXNzZXMubGFiZWxTZWNvbmRhcnksXG4gICAgICAgICAgICAgIGNvbG9yID09PSAnaW52ZXJzZScgJiYgY2xhc3Nlcy5sYWJlbEludmVyc2VcbiAgICAgICAgICAgICl9XG4gICAgICAgICAgPlxuICAgICAgICAgICAge3NlY29uZGFyeUxhYmVsfVxuICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgKSA6IG51bGx9XG4gICAgICA8L2xhYmVsPlxuICAgICAgPFBvcG92ZXJEaXNjbG9zdXJlXG4gICAgICAgIGNsYXNzTmFtZT17Y2xzeChcbiAgICAgICAgICBjbGFzc2VzLmJ1dHRvbixcbiAgICAgICAgICBjbGFzc2VzLmNvbWJveEJveE92ZXJmbG93LFxuICAgICAgICAgIGhhc0Vycm9yICYmIGNsYXNzZXMuYnV0dG9uRXJyb3IsXG4gICAgICAgICAgZnVsbFdpZHRoICYmIGNsYXNzZXMuYnV0dG9uRnVsbFdpZHRoLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIFtjbGFzc2VzLmJ1dHRvbkludmVyc2VdOiBjb2xvciA9PT0gJ2ludmVyc2UnLFxuICAgICAgICAgIH1cbiAgICAgICAgKX1cbiAgICAgICAgcmVmPXtidXR0b25SZWZ9XG4gICAgICAgIGFyaWEtZGVzY3JpYmVkYnk9e2J1aWxkRGVzY3JpYmVkQnkoe1xuICAgICAgICAgIGhhc0Vycm9yLFxuICAgICAgICAgIGhhc0hlbHBNZXNzYWdlOiAhIWhlbHBNZXNzYWdlLFxuICAgICAgICAgIHVuaXF1ZUlkLFxuICAgICAgICB9KX1cbiAgICAgICAgaWQ9e3VuaXF1ZUlkfVxuICAgICAgICB7Li4ucG9wb3Zlcn1cbiAgICAgICAgey4uLnJvb3RQcm9wc31cbiAgICAgID5cbiAgICAgICAgPD5cbiAgICAgICAgICB7aW50ZXJuYWxTZWxlY3Rpb25zPy5sZW5ndGggPT09IDAgJiYgKFxuICAgICAgICAgICAgPG1vdGlvbi5kaXZcbiAgICAgICAgICAgICAgaW5pdGlhbD17eyBvcGFjaXR5OiAwIH19XG4gICAgICAgICAgICAgIGFuaW1hdGU9e3tcbiAgICAgICAgICAgICAgICBvcGFjaXR5OiAxLFxuICAgICAgICAgICAgICAgIHRyYW5zaXRpb246IHsgZHVyYXRpb246IDAuMiwgZWFzZTogJ2Vhc2VJbicgfSxcbiAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgPFRleHRcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU9e2Nsc3goXG4gICAgICAgICAgICAgICAgICBjbGFzc2VzLmJ1dHRvblRleHQsXG4gICAgICAgICAgICAgICAgICBjbGFzc2VzLnBsYWNlaG9sZGVyVGV4dCxcbiAgICAgICAgICAgICAgICAgIGNsYXNzZXMuY29tYm9Cb3hQbGFjZWhvbGRlclxuICAgICAgICAgICAgICAgICl9XG4gICAgICAgICAgICAgICAgc2l6ZT1cInN1YmJvZHlcIlxuICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAge3BsYWNlaG9sZGVyfVxuICAgICAgICAgICAgICA8L1RleHQ+XG4gICAgICAgICAgICA8L21vdGlvbi5kaXY+XG4gICAgICAgICAgKX1cbiAgICAgICAgICB7aW50ZXJuYWxTZWxlY3Rpb25zICYmXG4gICAgICAgICAgICBpbnRlcm5hbFNlbGVjdGlvbnM/Lmxlbmd0aCA+IDAgJiZcbiAgICAgICAgICAgICFzZWxlY3RlZE9wdGlvbkRpc3BsYXkgJiYgKFxuICAgICAgICAgICAgICA8VGV4dFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17Y2xzeChjbGFzc2VzLmJ1dHRvblRleHQsIGNsYXNzZXMuY2hpcExpc3QpfVxuICAgICAgICAgICAgICAgIHNpemU9XCJzdWJib2R5XCJcbiAgICAgICAgICAgICAgICBzdHlsZT17ZnVsbFdpZHRoID8ge30gOiB7IG1heFdpZHRoOiB3aWR0aCAtIDQyIH19XG4gICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICB7aW50ZXJuYWxTZWxlY3Rpb25zPy5tYXAoKHNlbGVjdGVkT3B0aW9uLCBpbmRleCkgPT4gKFxuICAgICAgICAgICAgICAgICAgPG1vdGlvbi5zcGFuXG4gICAgICAgICAgICAgICAgICAgIGtleT17aW5kZXh9XG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17Y2xhc3Nlcy5jaGlwfVxuICAgICAgICAgICAgICAgICAgICBpbml0aWFsPXtcbiAgICAgICAgICAgICAgICAgICAgICBzaG91bGRSZWR1Y2VNb3Rpb25cbiAgICAgICAgICAgICAgICAgICAgICAgID8geyBvcGFjaXR5OiAwIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIDogeyBvcGFjaXR5OiAwLCB5OiAtOCB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYW5pbWF0ZT17XG4gICAgICAgICAgICAgICAgICAgICAgc2hvdWxkUmVkdWNlTW90aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICA/IHsgb3BhY2l0eTogMSB9XG4gICAgICAgICAgICAgICAgICAgICAgICA6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zaXRpb246IHsgZHVyYXRpb246IDAuMiwgZWFzZTogJ2Vhc2VPdXQnIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeTogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgIHtzZWxlY3RlZE9wdGlvbi50aXRsZX1cbiAgICAgICAgICAgICAgICAgIDwvbW90aW9uLnNwYW4+XG4gICAgICAgICAgICAgICAgKSl9XG4gICAgICAgICAgICAgIDwvVGV4dD5cbiAgICAgICAgICAgICl9XG4gICAgICAgICAge2ludGVybmFsU2VsZWN0aW9ucyAmJlxuICAgICAgICAgICAgaW50ZXJuYWxTZWxlY3Rpb25zPy5sZW5ndGggPiAwICYmXG4gICAgICAgICAgICBzZWxlY3RlZE9wdGlvbkRpc3BsYXkgJiYgKFxuICAgICAgICAgICAgICA8VGV4dCBjbGFzc05hbWU9e2NsYXNzZXMuYnV0dG9uVGV4dH0gc2l6ZT1cInN1YmJvZHlcIj5cbiAgICAgICAgICAgICAgICB7c2VsZWN0ZWRPcHRpb25EaXNwbGF5KGludGVybmFsU2VsZWN0aW9ucyl9XG4gICAgICAgICAgICAgIDwvVGV4dD5cbiAgICAgICAgICAgICl9XG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9e2NsYXNzZXMuYnV0dG9uQXJyb3dDb250YWluZXJ9IHJvbGU9XCJwcmVzZW50YXRpb25cIj5cbiAgICAgICAgICAgIDxDaGV2cm9uRG93blxuICAgICAgICAgICAgICBjbGFzc05hbWU9e2Nsc3goXG4gICAgICAgICAgICAgICAgY2xhc3Nlcy5hcnJvd0ljb24sXG4gICAgICAgICAgICAgICAgcG9wb3Zlci52aXNpYmxlICYmIGNsYXNzZXMucm90YXRlXG4gICAgICAgICAgICAgICl9XG4gICAgICAgICAgICAgIGFyaWEtaGlkZGVuXG4gICAgICAgICAgICAgIHJvbGU9XCJpbWdcIlxuICAgICAgICAgICAgICB3aWR0aD17MTh9XG4gICAgICAgICAgICAgIGhlaWdodD17MTh9XG4gICAgICAgICAgICAvPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8Lz5cbiAgICAgIDwvUG9wb3ZlckRpc2Nsb3N1cmU+XG4gICAgICB7aGVscE1lc3NhZ2UgJiYgKFxuICAgICAgICA8Rm9ybUhlbHBNZXNzYWdlXG4gICAgICAgICAgY2xhc3NOYW1lPXtjbGFzc2VzLm1lc3NhZ2V9XG4gICAgICAgICAgY29sb3I9e2NvbG9yfVxuICAgICAgICAgIHJvb3RFbGVtZW50SWQ9e3VuaXF1ZUlkfVxuICAgICAgICAgIGRlc2NyaWJlZEJ5SWQ9e2hlbHBGb3IodW5pcXVlSWQpfVxuICAgICAgICA+XG4gICAgICAgICAge2hlbHBNZXNzYWdlfVxuICAgICAgICA8L0Zvcm1IZWxwTWVzc2FnZT5cbiAgICAgICl9XG4gICAgICB7aGFzRXJyb3IgJiYgKFxuICAgICAgICA8Rm9ybUVycm9yTWVzc2FnZVxuICAgICAgICAgIGNsYXNzTmFtZT17Y2xhc3Nlcy5tZXNzYWdlfVxuICAgICAgICAgIGNvbG9yPXtjb2xvcn1cbiAgICAgICAgICByb290RWxlbWVudElkPXt1bmlxdWVJZH1cbiAgICAgICAgICBkZXNjcmliZWRCeUlkPXtlcnJvckZvcih1bmlxdWVJZCl9XG4gICAgICAgID5cbiAgICAgICAgICB7ZXJyb3JNZXNzYWdlfVxuICAgICAgICA8L0Zvcm1FcnJvck1lc3NhZ2U+XG4gICAgICApfVxuICAgICAgey8qXG4gICAgICAgIEEgZmV3IHRoaW5ncyBoZXJlOlxuXG4gICAgICAgIDEpIFdlIHdhbnQgdG8gYWx3YXlzIHBvcnRhbCBvdXIgc2VsZWN0IG1lbnUgcmVzdWx0cyBzbyB3ZSBkb24ndFxuICAgICAgICAgICBydW4gaW50byB3ZWlyZCBsYXlvdXQgaXNzdWVzIChyZW5kZXJpbmcgaW5zaWRlIFBvcG92ZXIgb3IgTW9kYWwpXG4gICAgICAgIDIpIFdlIG5lZWQgdG8gdHJhcCBmb2N1cyBpbnNpZGUgb2YgdGhlIG1lbnUgd2hlbiBpdCBpcyBvcGVuIC0gPEZvY3VzTG9jayAvPiBoYW5kbGVzIHRoaXMgZm9yIHVzXG4gICAgICAgIDMpIFdlIG5lZWQga2V5Ym9hcmQgc3VwcG9ydCB2aWEgPFJvdmVyIC8+XG5cbiAgICAgICAgUmVmZXJlbmNlIGZvciAjMSAmICMyOiBodHRwczovL2dpdGh1Yi5jb20vcmVha2l0L3JlYWtpdC9pc3N1ZXMvNTY2XG4gICAgICAqL31cbiAgICAgIDxQb3J0YWw+XG4gICAgICAgIDxGb2N1c0xvY2s+XG4gICAgICAgICAgPFJlYWtpdFBvcG92ZXJcbiAgICAgICAgICAgIGFyaWEtbGFiZWw9e2xhYmVsIHx8IGFyaWFMYWJlbCB8fCBwb3BvdmVyQXJpYUxhYmVsfVxuICAgICAgICAgICAgY2xhc3NOYW1lPXtjbGFzc2VzLnBvcG92ZXJ9XG4gICAgICAgICAgICB7Li4ucG9wb3Zlcn1cbiAgICAgICAgICAgIHN0eWxlPXt7IHdpZHRoIH19XG4gICAgICAgICAgICBhcz17bW90aW9uLmRpdn1cbiAgICAgICAgICAgIGFuaW1hdGU9e3BvcG92ZXIudmlzaWJsZSA/ICdvcGVuJyA6ICdjbG9zZWQnfVxuICAgICAgICAgICAgdmFyaWFudHM9e1xuICAgICAgICAgICAgICBzaG91bGRSZWR1Y2VNb3Rpb24gPyBwb3BvdmVyVmFyaWFudHNSZWR1Y2VkIDogcG9wb3ZlclZhcmlhbnRzXG4gICAgICAgICAgICB9XG4gICAgICAgICAgPlxuICAgICAgICAgICAgPG1vdGlvbi51bFxuICAgICAgICAgICAgICBjbGFzc05hbWU9e2NsYXNzZXMudWx9XG4gICAgICAgICAgICAgIHZhcmlhbnRzPXtcbiAgICAgICAgICAgICAgICBzaG91bGRSZWR1Y2VNb3Rpb25cbiAgICAgICAgICAgICAgICAgID8gbGlzdE1vdGlvblZhcmlhbnRzUmVkdWNlZFxuICAgICAgICAgICAgICAgICAgOiBsaXN0TW90aW9uVmFyaWFudHNcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICByb2xlPVwibGlzdGJveFwiXG4gICAgICAgICAgICAgIGFyaWEtbXVsdGlzZWxlY3RhYmxlPXt0cnVlfVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICB7UmVhY3QuQ2hpbGRyZW4ubWFwKGNoaWxkcmVuLCAoY2hpbGQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIVJlYWN0LmlzVmFsaWRFbGVtZW50KGNoaWxkKSkge1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY29uc3Qgb3B0aW9uOiBSZWFjdC5SZWFjdEVsZW1lbnQ8U2VsZWN0T3B0aW9uUHJvcHM+ID0gY2hpbGQ7XG4gICAgICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgICAgIDxSb3ZlclxuICAgICAgICAgICAgICAgICAgICB7Li4ucm92ZXJ9XG4gICAgICAgICAgICAgICAgICAgIGFyaWEtc2VsZWN0ZWQ9e3ZhbHVlPy5pbmNsdWRlcyhvcHRpb24/LnByb3BzPy52YWx1ZSl9XG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17Y2xhc3Nlcy5vcHRpb259XG4gICAgICAgICAgICAgICAgICAgIGFzPXttb3Rpb24ubGl9XG4gICAgICAgICAgICAgICAgICAgIGRpc2FibGVkPXtjaGlsZD8ucHJvcHM/LmRpc2FibGVkfVxuICAgICAgICAgICAgICAgICAgICByb2xlPVwib3B0aW9uXCJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU9e29wdGlvbj8ucHJvcHM/LnZhbHVlfVxuICAgICAgICAgICAgICAgICAgICB2YXJpYW50cz17XG4gICAgICAgICAgICAgICAgICAgICAgc2hvdWxkUmVkdWNlTW90aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICA/IGxpc3RJdGVtTW90aW9uVmFyaWFudHNSZWR1Y2VkXG4gICAgICAgICAgICAgICAgICAgICAgICA6IGxpc3RJdGVtTW90aW9uVmFyaWFudHNcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXsoKSA9PlxuICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZU9wdGlvblNlbGVjdGVkKFxuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uPy5wcm9wcz8udmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb24/LnByb3BzPy5tZXRhXG4gICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgIHtSZWFjdC5jbG9uZUVsZW1lbnQ8U2VsZWN0T3B0aW9uUHJvcHM+KG9wdGlvbiwge1xuICAgICAgICAgICAgICAgICAgICAgIGlzQ2hlY2tlZDogdmFsdWU/LmluY2x1ZGVzKG9wdGlvbj8ucHJvcHM/LnZhbHVlKSxcbiAgICAgICAgICAgICAgICAgICAgICAuLi5vcHRpb24ucHJvcHMsXG4gICAgICAgICAgICAgICAgICAgIH0pfVxuICAgICAgICAgICAgICAgICAgPC9Sb3Zlcj5cbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICB9KX1cbiAgICAgICAgICAgIDwvbW90aW9uLnVsPlxuICAgICAgICAgIDwvUmVha2l0UG9wb3Zlcj5cbiAgICAgICAgPC9Gb2N1c0xvY2s+XG4gICAgICA8L1BvcnRhbD5cbiAgICA8L2Rpdj5cbiAgKTtcbn07XG4iXX0=