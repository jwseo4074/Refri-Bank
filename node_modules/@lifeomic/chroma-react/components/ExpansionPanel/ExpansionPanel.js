"use strict";
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];
    result["default"] = mod;
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
var clsx_1 = __importDefault(require("clsx"));
var React = __importStar(require("react"));
var chromicons_1 = require("@lifeomic/chromicons");
var styles_1 = require("../../styles");
var UniqueId_1 = require("../_private/UniqueId");
var Text_1 = require("../Text");
exports.ExpansionPanelStylesKey = 'ChromaExpansionPanel';
exports.useStyles = styles_1.makeStyles(function (theme) { return ({
    root: {
        width: '100%',
        borderBottom: "1px solid " + theme.palette.divider,
    },
    rootOpen: {
        maxHeight: 'inherit',
    },
    button: {
        width: '100%',
        background: theme.palette.common.white,
        display: 'flex',
        justifyContent: 'space-between',
        alignItems: 'center',
        position: 'relative',
        textAlign: 'left',
        border: 'none',
        outline: 'none',
        paddingLeft: theme.spacing(2),
        paddingRight: theme.spacing(2),
        paddingTop: theme.spacing(1.25),
        paddingBottom: theme.spacing(1.25),
        cursor: 'pointer',
        '&:focus': {
            outline: 'none',
        },
        '&:hover > p, &:focus > p': {
            color: theme.palette.black.main,
            transform: 'translate3d(2px, 0, 0)',
        },
    },
    buttonShadow: {
        boxShadow: theme.boxShadows.table,
    },
    title: {
        color: theme.palette.text.secondary,
        letterSpacing: 'initial',
        transition: 'color 0.5s ease, transform 0.5s ease',
    },
    icon: {
        transition: 'transform 0.25s ease',
        color: theme.palette.primary.main,
    },
    rotate: {
        transform: 'rotate(45deg)',
    },
    content: {
        maxHeight: 0,
        overflow: 'hidden',
        transition: 'max-height 0.25s ease-in-out',
    },
    inner: {
        display: 'flex',
        flexDirection: 'column',
        background: theme.palette.common.white,
        padding: theme.spacing(2),
        width: '100%',
        height: '100%',
        visibility: 'visible',
    },
    directionRow: {
        flexDirection: 'row',
    },
    innerHidden: {
        visibility: 'hidden',
    },
}); }, { name: exports.ExpansionPanelStylesKey });
exports.ExpansionPanel = function (_a) {
    var _b;
    var _c;
    var ariaOwnsId = _a.ariaOwnsId, children = _a.children, className = _a.className, contentClassName = _a.contentClassName, innerContentClassName = _a.innerContentClassName, onToggle = _a.onToggle, _d = _a.isOpen, isOpen = _d === void 0 ? false : _d, _e = _a.contentDirection, contentDirection = _e === void 0 ? 'column' : _e, title = _a.title, rootProps = __rest(_a, ["ariaOwnsId", "children", "className", "contentClassName", "innerContentClassName", "onToggle", "isOpen", "contentDirection", "title"]);
    var classes = exports.useStyles({});
    var _f = React.useState(isOpen), isExpanded = _f[0], setIsExpanded = _f[1];
    var ref = React.useRef(null);
    var _g = React.useState(0), contentHeight = _g[0], setContentHeight = _g[1];
    var ariaId = React.useState(function () { return ariaOwnsId || UniqueId_1.generateUniqueId('exppanel-'); })[0];
    // Watch for `isOpen` changes
    React.useEffect(function () {
        setIsExpanded(isOpen);
    }, [isOpen]);
    // TODO: Look into https://medium.com/@teh_builder/ref-objects-inside-useeffect-hooks-eb7c15198780
    //
    // Determine the size of our content so we can expand/collapse
    // accordingly.  If the children are dynamically generated, we should
    // re-evaluate our size in case additional content is added/removed
    React.useEffect(function () {
        if (ref && ref.current && children) {
            setContentHeight(ref.current.scrollHeight + 25);
        }
    }, [children, (_c = ref === null || ref === void 0 ? void 0 : ref.current) === null || _c === void 0 ? void 0 : _c.scrollHeight]);
    var handleClick = React.useCallback(function (e) {
        e.preventDefault();
        e.stopPropagation();
        var newState = !isExpanded;
        if (typeof onToggle === 'function') {
            onToggle(newState);
        }
        setIsExpanded(newState);
    }, [isExpanded, onToggle]);
    return (React.createElement("div", __assign({ className: clsx_1.default(classes.root, isExpanded && classes.rootOpen, className) }, rootProps),
        React.createElement("button", { "aria-expanded": isExpanded, "aria-owns": ariaId, className: clsx_1.default(classes.button, isExpanded && classes.buttonShadow), onClick: handleClick, tabIndex: 0 },
            React.createElement(Text_1.Text, { className: classes.title, size: "subbody", weight: "bold" }, title),
            React.createElement(chromicons_1.Plus, { className: clsx_1.default(classes.icon, isExpanded && classes.rotate), "aria-hidden": "true", width: 18, height: 18 })),
        React.createElement("div", { "aria-hidden": !isExpanded, id: ariaId, className: clsx_1.default(classes.content, contentClassName), style: { maxHeight: isExpanded ? contentHeight : 0 } },
            React.createElement("div", { ref: ref, className: clsx_1.default(classes.inner, innerContentClassName, (_b = {},
                    _b[classes.directionRow] = contentDirection === 'row',
                    _b), !isExpanded && classes.innerHidden) }, children))));
};
exports.default = exports.ExpansionPanel;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRXhwYW5zaW9uUGFuZWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvY29tcG9uZW50cy9FeHBhbnNpb25QYW5lbC9FeHBhbnNpb25QYW5lbC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDhDQUF3QjtBQUN4QiwyQ0FBK0I7QUFDL0IsbURBQTRDO0FBQzVDLHVDQUEwQztBQUUxQyxpREFBd0Q7QUFDeEQsZ0NBQStCO0FBRWxCLFFBQUEsdUJBQXVCLEdBQUcsc0JBQXNCLENBQUM7QUFFakQsUUFBQSxTQUFTLEdBQUcsbUJBQVUsQ0FDakMsVUFBQyxLQUFLLElBQUssT0FBQSxDQUFDO0lBQ1YsSUFBSSxFQUFFO1FBQ0osS0FBSyxFQUFFLE1BQU07UUFDYixZQUFZLEVBQUUsZUFBYSxLQUFLLENBQUMsT0FBTyxDQUFDLE9BQVM7S0FDbkQ7SUFDRCxRQUFRLEVBQUU7UUFDUixTQUFTLEVBQUUsU0FBUztLQUNyQjtJQUNELE1BQU0sRUFBRTtRQUNOLEtBQUssRUFBRSxNQUFNO1FBQ2IsVUFBVSxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEtBQUs7UUFDdEMsT0FBTyxFQUFFLE1BQU07UUFDZixjQUFjLEVBQUUsZUFBZTtRQUMvQixVQUFVLEVBQUUsUUFBUTtRQUNwQixRQUFRLEVBQUUsVUFBVTtRQUNwQixTQUFTLEVBQUUsTUFBTTtRQUNqQixNQUFNLEVBQUUsTUFBTTtRQUNkLE9BQU8sRUFBRSxNQUFNO1FBQ2YsV0FBVyxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1FBQzdCLFlBQVksRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztRQUM5QixVQUFVLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUM7UUFDL0IsYUFBYSxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDO1FBQ2xD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LENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRTtZQUVwRCw2QkFDRSxHQUFHLEVBQUUsR0FBRyxFQUNSLFNBQVMsRUFBRSxjQUFJLENBQ2IsT0FBTyxDQUFDLEtBQUssRUFDYixxQkFBcUI7b0JBRW5CLEdBQUMsT0FBTyxDQUFDLFlBQVksSUFBRyxnQkFBZ0IsS0FBSyxLQUFLO3lCQUVwRCxDQUFDLFVBQVUsSUFBSSxPQUFPLENBQUMsV0FBVyxDQUNuQyxJQUVBLFFBQVEsQ0FDTCxDQUNGLENBQ0YsQ0FDUCxDQUFDO0FBQ0osQ0FBQyxDQUFDO0FBRUYsa0JBQWUsc0JBQWMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBjbHN4IGZyb20gJ2Nsc3gnO1xuaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgUGx1cyB9IGZyb20gJ0BsaWZlb21pYy9jaHJvbWljb25zJztcbmltcG9ydCB7IG1ha2VTdHlsZXMgfSBmcm9tICcuLi8uLi9zdHlsZXMnO1xuaW1wb3J0IHsgR2V0Q2xhc3NlcyB9IGZyb20gJy4uLy4uL3R5cGVVdGlscyc7XG5pbXBvcnQgeyBnZW5lcmF0ZVVuaXF1ZUlkIH0gZnJvbSAnLi4vX3ByaXZhdGUvVW5pcXVlSWQnO1xuaW1wb3J0IHsgVGV4dCB9IGZyb20gJy4uL1RleHQnO1xuXG5leHBvcnQgY29uc3QgRXhwYW5zaW9uUGFuZWxTdHlsZXNLZXkgPSAnQ2hyb21hRXhwYW5zaW9uUGFuZWwnO1xuXG5leHBvcnQgY29uc3QgdXNlU3R5bGVzID0gbWFrZVN0eWxlcyhcbiAgKHRoZW1lKSA9PiAoe1xuICAgIHJvb3Q6IHtcbiAgICAgIHdpZHRoOiAnMTAwJScsXG4gICAgICBib3JkZXJCb3R0b206IGAxcHggc29saWQgJHt0aGVtZS5wYWxldHRlLmRpdmlkZXJ9YCxcbiAgICB9LFxuICAgIHJvb3RPcGVuOiB7XG4gICAgICBtYXhIZWlnaHQ6ICdpbmhlcml0JyxcbiAgICB9LFxuICAgIGJ1dHRvbjoge1xuICAgICAgd2lkdGg6ICcxMDAlJyxcbiAgICAgIGJhY2tncm91bmQ6IHRoZW1lLnBhbGV0dGUuY29tbW9uLndoaXRlLFxuICAgICAgZGlzcGxheTogJ2ZsZXgnLFxuICAgICAganVzdGlmeUNvbnRlbnQ6ICdzcGFjZS1iZXR3ZWVuJyxcbiAgICAgIGFsaWduSXRlbXM6ICdjZW50ZXInLFxuICAgICAgcG9zaXRpb246ICdyZWxhdGl2ZScsXG4gICAgICB0ZXh0QWxpZ246ICdsZWZ0JyxcbiAgICAgIGJvcmRlcjogJ25vbmUnLFxuICAgICAgb3V0bGluZTogJ25vbmUnLFxuICAgICAgcGFkZGluZ0xlZnQ6IHRoZW1lLnNwYWNpbmcoMiksXG4gICAgICBwYWRkaW5nUmlnaHQ6IHRoZW1lLnNwYWNpbmcoMiksXG4gICAgICBwYWRkaW5nVG9wOiB0aGVtZS5zcGFjaW5nKDEuMjUpLFxuICAgICAgcGFkZGluZ0JvdHRvbTogdGhlbWUuc3BhY2luZygxLjI1KSxcbiAgICAgIGN1cnNvcjogJ3BvaW50ZXInLFxuICAgICAgJyY6Zm9jdXMnOiB7XG4gICAgICAgIG91dGxpbmU6ICdub25lJyxcbiAgICAgIH0sXG4gICAgICAnJjpob3ZlciA+IHAsICY6Zm9jdXMgPiBwJzoge1xuICAgICAgICBjb2xvcjogdGhlbWUucGFsZXR0ZS5ibGFjay5tYWluLFxuICAgICAgICB0cmFuc2Zvcm06ICd0cmFuc2xhdGUzZCgycHgsIDAsIDApJyxcbiAgICAgIH0sXG4gICAgfSxcbiAgICBidXR0b25TaGFkb3c6IHtcbiAgICAgIGJveFNoYWRvdzogdGhlbWUuYm94U2hhZG93cy50YWJsZSxcbiAgICB9LFxuICAgIHRpdGxlOiB7XG4gICAgICBjb2xvcjogdGhlbWUucGFsZXR0ZS50ZXh0LnNlY29uZGFyeSxcbiAgICAgIGxldHRlclNwYWNpbmc6ICdpbml0aWFsJyxcbiAgICAgIHRyYW5zaXRpb246ICdjb2xvciAwLjVzIGVhc2UsIHRyYW5zZm9ybSAwLjVzIGVhc2UnLFxuICAgIH0sXG4gICAgaWNvbjoge1xuICAgICAgdHJhbnNpdGlvbjogJ3RyYW5zZm9ybSAwLjI1cyBlYXNlJyxcbiAgICAgIGNvbG9yOiB0aGVtZS5wYWxldHRlLnByaW1hcnkubWFpbixcbiAgICB9LFxuICAgIHJvdGF0ZToge1xuICAgICAgdHJhbnNmb3JtOiAncm90YXRlKDQ1ZGVnKScsXG4gICAgfSxcbiAgICBjb250ZW50OiB7XG4gICAgICBtYXhIZWlnaHQ6IDAsXG4gICAgICBvdmVyZmxvdzogJ2hpZGRlbicsXG4gICAgICB0cmFuc2l0aW9uOiAnbWF4LWhlaWdodCAwLjI1cyBlYXNlLWluLW91dCcsXG4gICAgfSxcbiAgICBpbm5lcjoge1xuICAgICAgZGlzcGxheTogJ2ZsZXgnLFxuICAgICAgZmxleERpcmVjdGlvbjogJ2NvbHVtbicsXG4gICAgICBiYWNrZ3JvdW5kOiB0aGVtZS5wYWxldHRlLmNvbW1vbi53aGl0ZSxcbiAgICAgIHBhZGRpbmc6IHRoZW1lLnNwYWNpbmcoMiksXG4gICAgICB3aWR0aDogJzEwMCUnLFxuICAgICAgaGVpZ2h0OiAnMTAwJScsXG4gICAgICB2aXNpYmlsaXR5OiAndmlzaWJsZScsXG4gICAgfSxcbiAgICBkaXJlY3Rpb25Sb3c6IHtcbiAgICAgIGZsZXhEaXJlY3Rpb246ICdyb3cnLFxuICAgIH0sXG4gICAgaW5uZXJIaWRkZW46IHtcbiAgICAgIHZpc2liaWxpdHk6ICdoaWRkZW4nLFxuICAgIH0sXG4gIH0pLFxuICB7IG5hbWU6IEV4cGFuc2lvblBhbmVsU3R5bGVzS2V5IH1cbik7XG5cbmV4cG9ydCB0eXBlIEV4cGFuc2lvblBhbmVsQ2xhc3NlcyA9IEdldENsYXNzZXM8dHlwZW9mIHVzZVN0eWxlcz47XG5cbmV4cG9ydCBpbnRlcmZhY2UgRXhwYW5zaW9uUGFuZWxQcm9wc1xuICBleHRlbmRzIFJlYWN0LkRldGFpbGVkSFRNTFByb3BzPFxuICAgIFJlYWN0LkhUTUxBdHRyaWJ1dGVzPEhUTUxEaXZFbGVtZW50PixcbiAgICBIVE1MRGl2RWxlbWVudFxuICA+IHtcbiAgYXJpYU93bnNJZD86IHN0cmluZztcbiAgY29udGVudENsYXNzTmFtZT86IHN0cmluZztcbiAgaW5uZXJDb250ZW50Q2xhc3NOYW1lPzogc3RyaW5nO1xuICB0aXRsZTogc3RyaW5nO1xuICBvblRvZ2dsZT86IChpc0V4cGFuZGVkOiBib29sZWFuKSA9PiB2b2lkO1xuICBpc09wZW4/OiBib29sZWFuO1xuICBjb250ZW50RGlyZWN0aW9uPzogJ3JvdycgfCAnY29sdW1uJztcbn1cblxuZXhwb3J0IGNvbnN0IEV4cGFuc2lvblBhbmVsOiBSZWFjdC5GQzxFeHBhbnNpb25QYW5lbFByb3BzPiA9ICh7XG4gIGFyaWFPd25zSWQsXG4gIGNoaWxkcmVuLFxuICBjbGFzc05hbWUsXG4gIGNvbnRlbnRDbGFzc05hbWUsXG4gIGlubmVyQ29udGVudENsYXNzTmFtZSxcbiAgb25Ub2dnbGUsXG4gIGlzT3BlbiA9IGZhbHNlLFxuICBjb250ZW50RGlyZWN0aW9uID0gJ2NvbHVtbicsXG4gIHRpdGxlLFxuICAuLi5yb290UHJvcHNcbn0pID0+IHtcbiAgY29uc3QgY2xhc3NlcyA9IHVzZVN0eWxlcyh7fSk7XG4gIGNvbnN0IFtpc0V4cGFuZGVkLCBzZXRJc0V4cGFuZGVkXSA9IFJlYWN0LnVzZVN0YXRlKGlzT3Blbik7XG5cbiAgY29uc3QgcmVmID0gUmVhY3QudXNlUmVmPEhUTUxEaXZFbGVtZW50PihudWxsKTtcbiAgY29uc3QgW2NvbnRlbnRIZWlnaHQsIHNldENvbnRlbnRIZWlnaHRdID0gUmVhY3QudXNlU3RhdGU8bnVtYmVyPigwKTtcblxuICBjb25zdCBbYXJpYUlkXSA9IFJlYWN0LnVzZVN0YXRlPHN0cmluZz4oXG4gICAgKCkgPT4gYXJpYU93bnNJZCB8fCBnZW5lcmF0ZVVuaXF1ZUlkKCdleHBwYW5lbC0nKVxuICApO1xuXG4gIC8vIFdhdGNoIGZvciBgaXNPcGVuYCBjaGFuZ2VzXG4gIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7XG4gICAgc2V0SXNFeHBhbmRlZChpc09wZW4pO1xuICB9LCBbaXNPcGVuXSk7XG5cbiAgLy8gVE9ETzogTG9vayBpbnRvIGh0dHBzOi8vbWVkaXVtLmNvbS9AdGVoX2J1aWxkZXIvcmVmLW9iamVjdHMtaW5zaWRlLXVzZWVmZmVjdC1ob29rcy1lYjdjMTUxOTg3ODBcbiAgLy9cbiAgLy8gRGV0ZXJtaW5lIHRoZSBzaXplIG9mIG91ciBjb250ZW50IHNvIHdlIGNhbiBleHBhbmQvY29sbGFwc2VcbiAgLy8gYWNjb3JkaW5nbHkuICBJZiB0aGUgY2hpbGRyZW4gYXJlIGR5bmFtaWNhbGx5IGdlbmVyYXRlZCwgd2Ugc2hvdWxkXG4gIC8vIHJlLWV2YWx1YXRlIG91ciBzaXplIGluIGNhc2UgYWRkaXRpb25hbCBjb250ZW50IGlzIGFkZGVkL3JlbW92ZWRcbiAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHtcbiAgICBpZiAocmVmICYmIHJlZi5jdXJyZW50ICYmIGNoaWxkcmVuKSB7XG4gICAgICBzZXRDb250ZW50SGVpZ2h0KHJlZi5jdXJyZW50LnNjcm9sbEhlaWdodCArIDI1KTtcbiAgICB9XG4gIH0sIFtjaGlsZHJlbiwgcmVmPy5jdXJyZW50Py5zY3JvbGxIZWlnaHRdKTtcblxuICBjb25zdCBoYW5kbGVDbGljayA9IFJlYWN0LnVzZUNhbGxiYWNrKFxuICAgIChlOiBSZWFjdC5TeW50aGV0aWNFdmVudCkgPT4ge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcblxuICAgICAgY29uc3QgbmV3U3RhdGUgPSAhaXNFeHBhbmRlZDtcbiAgICAgIGlmICh0eXBlb2Ygb25Ub2dnbGUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgb25Ub2dnbGUobmV3U3RhdGUpO1xuICAgICAgfVxuXG4gICAgICBzZXRJc0V4cGFuZGVkKG5ld1N0YXRlKTtcbiAgICB9LFxuICAgIFtpc0V4cGFuZGVkLCBvblRvZ2dsZV1cbiAgKTtcblxuICByZXR1cm4gKFxuICAgIDxkaXZcbiAgICAgIGNsYXNzTmFtZT17Y2xzeChjbGFzc2VzLnJvb3QsIGlzRXhwYW5kZWQgJiYgY2xhc3Nlcy5yb290T3BlbiwgY2xhc3NOYW1lKX1cbiAgICAgIHsuLi5yb290UHJvcHN9XG4gICAgPlxuICAgICAgPGJ1dHRvblxuICAgICAgICBhcmlhLWV4cGFuZGVkPXtpc0V4cGFuZGVkfVxuICAgICAgICBhcmlhLW93bnM9e2FyaWFJZH1cbiAgICAgICAgY2xhc3NOYW1lPXtjbHN4KGNsYXNzZXMuYnV0dG9uLCBpc0V4cGFuZGVkICYmIGNsYXNzZXMuYnV0dG9uU2hhZG93KX1cbiAgICAgICAgb25DbGljaz17aGFuZGxlQ2xpY2t9XG4gICAgICAgIHRhYkluZGV4PXswfVxuICAgICAgPlxuICAgICAgICA8VGV4dCBjbGFzc05hbWU9e2NsYXNzZXMudGl0bGV9IHNpemU9XCJzdWJib2R5XCIgd2VpZ2h0PVwiYm9sZFwiPlxuICAgICAgICAgIHt0aXRsZX1cbiAgICAgICAgPC9UZXh0PlxuICAgICAgICA8UGx1c1xuICAgICAgICAgIGNsYXNzTmFtZT17Y2xzeChjbGFzc2VzLmljb24sIGlzRXhwYW5kZWQgJiYgY2xhc3Nlcy5yb3RhdGUpfVxuICAgICAgICAgIGFyaWEtaGlkZGVuPVwidHJ1ZVwiXG4gICAgICAgICAgd2lkdGg9ezE4fVxuICAgICAgICAgIGhlaWdodD17MTh9XG4gICAgICAgIC8+XG4gICAgICA8L2J1dHRvbj5cbiAgICAgIDxkaXZcbiAgICAgICAgYXJpYS1oaWRkZW49eyFpc0V4cGFuZGVkfVxuICAgICAgICBpZD17YXJpYUlkfVxuICAgICAgICBjbGFzc05hbWU9e2Nsc3goY2xhc3Nlcy5jb250ZW50LCBjb250ZW50Q2xhc3NOYW1lKX1cbiAgICAgICAgc3R5bGU9e3sgbWF4SGVpZ2h0OiBpc0V4cGFuZGVkID8gY29udGVudEhlaWdodCA6IDAgfX1cbiAgICAgID5cbiAgICAgICAgPGRpdlxuICAgICAgICAgIHJlZj17cmVmfVxuICAgICAgICAgIGNsYXNzTmFtZT17Y2xzeChcbiAgICAgICAgICAgIGNsYXNzZXMuaW5uZXIsXG4gICAgICAgICAgICBpbm5lckNvbnRlbnRDbGFzc05hbWUsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIFtjbGFzc2VzLmRpcmVjdGlvblJvd106IGNvbnRlbnREaXJlY3Rpb24gPT09ICdyb3cnLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICFpc0V4cGFuZGVkICYmIGNsYXNzZXMuaW5uZXJIaWRkZW5cbiAgICAgICAgICApfVxuICAgICAgICA+XG4gICAgICAgICAge2NoaWxkcmVufVxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICApO1xufTtcblxuZXhwb3J0IGRlZmF1bHQgRXhwYW5zaW9uUGFuZWw7XG4iXX0=