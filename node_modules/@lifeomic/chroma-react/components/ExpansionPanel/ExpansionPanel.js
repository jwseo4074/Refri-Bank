"use strict";
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.ExpansionPanel = exports.useStyles = exports.ExpansionPanelStylesKey = void 0;
var clsx_1 = __importDefault(require("clsx"));
var React = __importStar(require("react"));
var chromicons_1 = require("@lifeomic/chromicons");
var styles_1 = require("../../styles");
var UniqueId_1 = require("../_private/UniqueId");
var Text_1 = require("../Text");
exports.ExpansionPanelStylesKey = 'ChromaExpansionPanel';
exports.useStyles = (0, styles_1.makeStyles)(function (theme) { return ({
    root: {
        width: '100%',
        borderBottom: "1px solid ".concat(theme.palette.divider),
    },
    rootOpen: {
        maxHeight: 'inherit',
    },
    button: {
        width: '100%',
        background: theme.palette.common.white,
        display: 'flex',
        justifyContent: 'space-between',
        alignItems: 'center',
        position: 'relative',
        textAlign: 'left',
        border: 'none',
        outline: 'none',
        paddingLeft: theme.spacing(2),
        paddingRight: theme.spacing(2),
        paddingTop: theme.spacing(1.25),
        paddingBottom: theme.spacing(1.25),
        cursor: 'pointer',
        '&:focus': {
            outline: 'none',
        },
        '&:hover > p, &:focus > p': {
            color: theme.palette.black.main,
            transform: 'translate3d(2px, 0, 0)',
        },
    },
    buttonShadow: {
        boxShadow: theme.boxShadows.table,
    },
    title: {
        color: theme.palette.text.secondary,
        letterSpacing: 'initial',
        transition: 'color 0.5s ease, transform 0.5s ease',
    },
    icon: {
        transition: 'transform 0.25s ease',
        color: theme.palette.primary.main,
    },
    rotate: {
        transform: 'rotate(45deg)',
    },
    content: {
        maxHeight: 0,
        overflow: 'hidden',
        transition: 'max-height 0.25s ease-in-out',
    },
    inner: {
        display: 'flex',
        flexDirection: 'column',
        background: theme.palette.common.white,
        padding: theme.spacing(2),
        width: '100%',
        height: '100%',
        visibility: 'visible',
    },
    directionRow: {
        flexDirection: 'row',
    },
    innerHidden: {
        visibility: 'hidden',
    },
}); }, { name: exports.ExpansionPanelStylesKey });
var ExpansionPanel = function (_a) {
    var _b;
    var _c;
    var ariaOwnsId = _a.ariaOwnsId, children = _a.children, className = _a.className, contentClassName = _a.contentClassName, innerContentClassName = _a.innerContentClassName, onToggle = _a.onToggle, _d = _a.isOpen, isOpen = _d === void 0 ? false : _d, _e = _a.contentDirection, contentDirection = _e === void 0 ? 'column' : _e, title = _a.title, rootProps = __rest(_a, ["ariaOwnsId", "children", "className", "contentClassName", "innerContentClassName", "onToggle", "isOpen", "contentDirection", "title"]);
    var classes = (0, exports.useStyles)({});
    var _f = React.useState(isOpen), isExpanded = _f[0], setIsExpanded = _f[1];
    var ref = React.useRef(null);
    var _g = React.useState(0), contentHeight = _g[0], setContentHeight = _g[1];
    var ariaId = React.useState(function () { return ariaOwnsId || (0, UniqueId_1.generateUniqueId)('exppanel-'); })[0];
    // Watch for `isOpen` changes
    React.useEffect(function () {
        setIsExpanded(isOpen);
    }, [isOpen]);
    // TODO: Look into https://medium.com/@teh_builder/ref-objects-inside-useeffect-hooks-eb7c15198780
    //
    // Determine the size of our content so we can expand/collapse
    // accordingly.  If the children are dynamically generated, we should
    // re-evaluate our size in case additional content is added/removed
    React.useEffect(function () {
        if (ref && ref.current && children) {
            setContentHeight(ref.current.scrollHeight + 25);
        }
    }, [children, (_c = ref === null || ref === void 0 ? void 0 : ref.current) === null || _c === void 0 ? void 0 : _c.scrollHeight]);
    var handleClick = React.useCallback(function (e) {
        e.preventDefault();
        e.stopPropagation();
        var newState = !isExpanded;
        if (typeof onToggle === 'function') {
            onToggle(newState);
        }
        setIsExpanded(newState);
    }, [isExpanded, onToggle]);
    return (React.createElement("div", __assign({ className: (0, clsx_1.default)(classes.root, isExpanded && classes.rootOpen, className) }, rootProps),
        React.createElement("button", { "aria-expanded": isExpanded, "aria-owns": ariaId, className: (0, clsx_1.default)(classes.button, isExpanded && classes.buttonShadow), onClick: handleClick, tabIndex: 0 },
            React.createElement(Text_1.Text, { className: classes.title, size: "subbody", weight: "bold" }, title),
            React.createElement(chromicons_1.Plus, { className: (0, clsx_1.default)(classes.icon, isExpanded && classes.rotate), "aria-hidden": "true", width: 18, height: 18 })),
        React.createElement("div", { "aria-hidden": !isExpanded, id: ariaId, className: (0, clsx_1.default)(classes.content, contentClassName), style: { maxHeight: isExpanded ? contentHeight : 0 } },
            React.createElement("div", { ref: ref, className: (0, clsx_1.default)(classes.inner, innerContentClassName, (_b = {},
                    _b[classes.directionRow] = contentDirection === 'row',
                    _b), !isExpanded && classes.innerHidden) }, children))));
};
exports.ExpansionPanel = ExpansionPanel;
exports.default = exports.ExpansionPanel;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRXhwYW5zaW9uUGFuZWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvY29tcG9uZW50cy9FeHBhbnNpb25QYW5lbC9FeHBhbnNpb25QYW5lbC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsOENBQXdCO0FBQ3hCLDJDQUErQjtBQUMvQixtREFBNEM7QUFDNUMsdUNBQTBDO0FBRTFDLGlEQUF3RDtBQUN4RCxnQ0FBK0I7QUFFbEIsUUFBQSx1QkFBdUIsR0FBRyxzQkFBc0IsQ0FBQztBQUVqRCxRQUFBLFNBQVMsR0FBRyxJQUFBLG1CQUFVLEVBQ2pDLFVBQUMsS0FBSyxJQUFLLE9BQUEsQ0FBQztJQUNWLElBQUksRUFBRTtRQUNKLEtBQUssRUFBRSxNQUFNO1FBQ2IsWUFBWSxFQUFFLG9CQUFhLEtBQUssQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFFO0tBQ25EO0lBQ0QsUUFBUSxFQUFFO1FBQ1IsU0FBUyxFQUFFLFNBQVM7S0FDckI7SUFDRCxNQUFNLEVBQUU7UUFDTixLQUFLLEVBQUUsTUFBTTtRQUNiLFVBQVUsRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxLQUFLO1FBQ3RDLE9BQU8sRUFBRSxNQUFNO1FBQ2YsY0FBYyxFQUFFLGVBQWU7UUFDL0IsVUFBVSxFQUFFLFFBQVE7UUFDcEIsUUFBUSxFQUFFLFVBQVU7UUFDcEIsU0FBUyxFQUFFLE1BQU07UUFDakIsTUFBTSxFQUFFLE1BQU07UUFDZCxPQUFPLEVBQUUsTUFBTTtRQUNmLFdBQVcsRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztRQUM3QixZQUFZLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7UUFDOUIsVUFBVSxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDO1FBQy9CLGFBQWEsRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQztRQUNsQyxNQUFNLEVBQUUsU0FBUztRQUNqQixTQUFTLEVBQUU7WUFDVCxPQUFPLEVBQUUsTUFBTTtTQUNoQjtRQUNELDBCQUEwQixFQUFFO1lBQzFCLEtBQUssRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJO1lBQy9CLFNBQVMsRUFBRSx3QkFBd0I7U0FDcEM7S0FDRjtJQUNELFlBQVksRUFBRTtRQUNaLFNBQVMsRUFBRSxLQUFLLENBQUMsVUFBVSxDQUFDLEtBQUs7S0FDbEM7SUFDRCxLQUFLLEVBQUU7UUFDTCxLQUFLLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsU0FBUztRQUNuQyxhQUFhLEVBQUUsU0FBUztRQUN4QixVQUFVLEVBQUUsc0NBQXNDO0tBQ25EO0lBQ0QsSUFBSSxFQUFFO1FBQ0osVUFBVSxFQUFFLHNCQUFzQjtRQUNsQyxLQUFLLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsSUFBSTtLQUNsQztJQUNELE1BQU0sRUFBRTtRQUNOLFNBQVMsRUFBRSxlQUFlO0tBQzNCO0lBQ0QsT0FBTyxFQUFFO1FBQ1AsU0FBUyxFQUFFLENBQUM7UUFDWixRQUFRLEVBQUUsUUFBUTtRQUNsQixVQUFVLEVBQUUsOEJBQThCO0tBQzNDO0lBQ0QsS0FBSyxFQUFFO1FBQ0wsT0FBTyxFQUFFLE1BQU07UUFDZixhQUFhLEVBQUUsUUFBUTtRQUN2QixVQUFVLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsS0FBSztRQUN0QyxPQUFPLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7UUFDekIsS0FBSyxFQUFFLE1BQU07UUFDYixNQUFNLEVBQUUsTUFBTTtRQUNkLFVBQVUsRUFBRSxTQUFTO0tBQ3RCO0lBQ0QsWUFBWSxFQUFFO1FBQ1osYUFBYSxFQUFFLEtBQUs7S0FDckI7SUFDRCxXQUFXLEVBQUU7UUFDWCxVQUFVLEVBQUUsUUFBUTtLQUNyQjtDQUNGLENBQUMsRUFsRVMsQ0FrRVQsRUFDRixFQUFFLElBQUksRUFBRSwrQkFBdUIsRUFBRSxDQUNsQyxDQUFDO0FBbUJLLElBQU0sY0FBYyxHQUFrQyxVQUFDLEVBVzdEOzs7SUFWQyxJQUFBLFVBQVUsZ0JBQUEsRUFDVixRQUFRLGNBQUEsRUFDUixTQUFTLGVBQUEsRUFDVCxnQkFBZ0Isc0JBQUEsRUFDaEIscUJBQXFCLDJCQUFBLEVBQ3JCLFFBQVEsY0FBQSxFQUNSLGNBQWMsRUFBZCxNQUFNLG1CQUFHLEtBQUssS0FBQSxFQUNkLHdCQUEyQixFQUEzQixnQkFBZ0IsbUJBQUcsUUFBUSxLQUFBLEVBQzNCLEtBQUssV0FBQSxFQUNGLFNBQVMsY0FWZ0QsdUlBVzdELENBRGE7SUFFWixJQUFNLE9BQU8sR0FBRyxJQUFBLGlCQUFTLEVBQUMsRUFBRSxDQUFDLENBQUM7SUFDeEIsSUFBQSxLQUE4QixLQUFLLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxFQUFuRCxVQUFVLFFBQUEsRUFBRSxhQUFhLFFBQTBCLENBQUM7SUFFM0QsSUFBTSxHQUFHLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBaUIsSUFBSSxDQUFDLENBQUM7SUFDekMsSUFBQSxLQUFvQyxLQUFLLENBQUMsUUFBUSxDQUFTLENBQUMsQ0FBQyxFQUE1RCxhQUFhLFFBQUEsRUFBRSxnQkFBZ0IsUUFBNkIsQ0FBQztJQUU3RCxJQUFBLE1BQU0sR0FBSSxLQUFLLENBQUMsUUFBUSxDQUM3QixjQUFNLE9BQUEsVUFBVSxJQUFJLElBQUEsMkJBQWdCLEVBQUMsV0FBVyxDQUFDLEVBQTNDLENBQTJDLENBQ2xELEdBRlksQ0FFWDtJQUVGLDZCQUE2QjtJQUM3QixLQUFLLENBQUMsU0FBUyxDQUFDO1FBQ2QsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ3hCLENBQUMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7SUFFYixrR0FBa0c7SUFDbEcsRUFBRTtJQUNGLDhEQUE4RDtJQUM5RCxxRUFBcUU7SUFDckUsbUVBQW1FO0lBQ25FLEtBQUssQ0FBQyxTQUFTLENBQUM7UUFDZCxJQUFJLEdBQUcsSUFBSSxHQUFHLENBQUMsT0FBTyxJQUFJLFFBQVEsRUFBRTtZQUNsQyxnQkFBZ0IsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLFlBQVksR0FBRyxFQUFFLENBQUMsQ0FBQztTQUNqRDtJQUNILENBQUMsRUFBRSxDQUFDLFFBQVEsRUFBRSxNQUFBLEdBQUcsYUFBSCxHQUFHLHVCQUFILEdBQUcsQ0FBRSxPQUFPLDBDQUFFLFlBQVksQ0FBQyxDQUFDLENBQUM7SUFFM0MsSUFBTSxXQUFXLEdBQUcsS0FBSyxDQUFDLFdBQVcsQ0FDbkMsVUFBQyxDQUF1QjtRQUN0QixDQUFDLENBQUMsY0FBYyxFQUFFLENBQUM7UUFDbkIsQ0FBQyxDQUFDLGVBQWUsRUFBRSxDQUFDO1FBRXBCLElBQU0sUUFBUSxHQUFHLENBQUMsVUFBVSxDQUFDO1FBQzdCLElBQUksT0FBTyxRQUFRLEtBQUssVUFBVSxFQUFFO1lBQ2xDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQztTQUNwQjtRQUVELGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUMxQixDQUFDLEVBQ0QsQ0FBQyxVQUFVLEVBQUUsUUFBUSxDQUFDLENBQ3ZCLENBQUM7SUFFRixPQUFPLENBQ0wsc0NBQ0UsU0FBUyxFQUFFLElBQUEsY0FBSSxFQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsVUFBVSxJQUFJLE9BQU8sQ0FBQyxRQUFRLEVBQUUsU0FBUyxDQUFDLElBQ3BFLFNBQVM7UUFFYixpREFDaUIsVUFBVSxlQUNkLE1BQU0sRUFDakIsU0FBUyxFQUFFLElBQUEsY0FBSSxFQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsVUFBVSxJQUFJLE9BQU8sQ0FBQyxZQUFZLENBQUMsRUFDbkUsT0FBTyxFQUFFLFdBQVcsRUFDcEIsUUFBUSxFQUFFLENBQUM7WUFFWCxvQkFBQyxXQUFJLElBQUMsU0FBUyxFQUFFLE9BQU8sQ0FBQyxLQUFLLEVBQUUsSUFBSSxFQUFDLFNBQVMsRUFBQyxNQUFNLEVBQUMsTUFBTSxJQUN6RCxLQUFLLENBQ0Q7WUFDUCxvQkFBQyxpQkFBSSxJQUNILFNBQVMsRUFBRSxJQUFBLGNBQUksRUFBQyxPQUFPLENBQUMsSUFBSSxFQUFFLFVBQVUsSUFBSSxPQUFPLENBQUMsTUFBTSxDQUFDLGlCQUMvQyxNQUFNLEVBQ2xCLEtBQUssRUFBRSxFQUFFLEVBQ1QsTUFBTSxFQUFFLEVBQUUsR0FDVixDQUNLO1FBQ1QsNENBQ2UsQ0FBQyxVQUFVLEVBQ3hCLEVBQUUsRUFBRSxNQUFNLEVBQ1YsU0FBUyxFQUFFLElBQUEsY0FBSSxFQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsZ0JBQWdCLENBQUMsRUFDbEQsS0FBSyxFQUFFLEVBQUUsU0FBUyxFQUFFLFVBQVUsQ0FBQyxDQUFDLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUU7WUFFcEQsNkJBQ0UsR0FBRyxFQUFFLEdBQUcsRUFDUixTQUFTLEVBQUUsSUFBQSxjQUFJLEVBQ2IsT0FBTyxDQUFDLEtBQUssRUFDYixxQkFBcUI7b0JBRW5CLEdBQUMsT0FBTyxDQUFDLFlBQVksSUFBRyxnQkFBZ0IsS0FBSyxLQUFLO3lCQUVwRCxDQUFDLFVBQVUsSUFBSSxPQUFPLENBQUMsV0FBVyxDQUNuQyxJQUVBLFFBQVEsQ0FDTCxDQUNGLENBQ0YsQ0FDUCxDQUFDO0FBQ0osQ0FBQyxDQUFDO0FBakdXLFFBQUEsY0FBYyxrQkFpR3pCO0FBRUYsa0JBQWUsc0JBQWMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBjbHN4IGZyb20gJ2Nsc3gnO1xuaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgUGx1cyB9IGZyb20gJ0BsaWZlb21pYy9jaHJvbWljb25zJztcbmltcG9ydCB7IG1ha2VTdHlsZXMgfSBmcm9tICcuLi8uLi9zdHlsZXMnO1xuaW1wb3J0IHsgR2V0Q2xhc3NlcyB9IGZyb20gJy4uLy4uL3R5cGVVdGlscyc7XG5pbXBvcnQgeyBnZW5lcmF0ZVVuaXF1ZUlkIH0gZnJvbSAnLi4vX3ByaXZhdGUvVW5pcXVlSWQnO1xuaW1wb3J0IHsgVGV4dCB9IGZyb20gJy4uL1RleHQnO1xuXG5leHBvcnQgY29uc3QgRXhwYW5zaW9uUGFuZWxTdHlsZXNLZXkgPSAnQ2hyb21hRXhwYW5zaW9uUGFuZWwnO1xuXG5leHBvcnQgY29uc3QgdXNlU3R5bGVzID0gbWFrZVN0eWxlcyhcbiAgKHRoZW1lKSA9PiAoe1xuICAgIHJvb3Q6IHtcbiAgICAgIHdpZHRoOiAnMTAwJScsXG4gICAgICBib3JkZXJCb3R0b206IGAxcHggc29saWQgJHt0aGVtZS5wYWxldHRlLmRpdmlkZXJ9YCxcbiAgICB9LFxuICAgIHJvb3RPcGVuOiB7XG4gICAgICBtYXhIZWlnaHQ6ICdpbmhlcml0JyxcbiAgICB9LFxuICAgIGJ1dHRvbjoge1xuICAgICAgd2lkdGg6ICcxMDAlJyxcbiAgICAgIGJhY2tncm91bmQ6IHRoZW1lLnBhbGV0dGUuY29tbW9uLndoaXRlLFxuICAgICAgZGlzcGxheTogJ2ZsZXgnLFxuICAgICAganVzdGlmeUNvbnRlbnQ6ICdzcGFjZS1iZXR3ZWVuJyxcbiAgICAgIGFsaWduSXRlbXM6ICdjZW50ZXInLFxuICAgICAgcG9zaXRpb246ICdyZWxhdGl2ZScsXG4gICAgICB0ZXh0QWxpZ246ICdsZWZ0JyxcbiAgICAgIGJvcmRlcjogJ25vbmUnLFxuICAgICAgb3V0bGluZTogJ25vbmUnLFxuICAgICAgcGFkZGluZ0xlZnQ6IHRoZW1lLnNwYWNpbmcoMiksXG4gICAgICBwYWRkaW5nUmlnaHQ6IHRoZW1lLnNwYWNpbmcoMiksXG4gICAgICBwYWRkaW5nVG9wOiB0aGVtZS5zcGFjaW5nKDEuMjUpLFxuICAgICAgcGFkZGluZ0JvdHRvbTogdGhlbWUuc3BhY2luZygxLjI1KSxcbiAgICAgIGN1cnNvcjogJ3BvaW50ZXInLFxuICAgICAgJyY6Zm9jdXMnOiB7XG4gICAgICAgIG91dGxpbmU6ICdub25lJyxcbiAgICAgIH0sXG4gICAgICAnJjpob3ZlciA+IHAsICY6Zm9jdXMgPiBwJzoge1xuICAgICAgICBjb2xvcjogdGhlbWUucGFsZXR0ZS5ibGFjay5tYWluLFxuICAgICAgICB0cmFuc2Zvcm06ICd0cmFuc2xhdGUzZCgycHgsIDAsIDApJyxcbiAgICAgIH0sXG4gICAgfSxcbiAgICBidXR0b25TaGFkb3c6IHtcbiAgICAgIGJveFNoYWRvdzogdGhlbWUuYm94U2hhZG93cy50YWJsZSxcbiAgICB9LFxuICAgIHRpdGxlOiB7XG4gICAgICBjb2xvcjogdGhlbWUucGFsZXR0ZS50ZXh0LnNlY29uZGFyeSxcbiAgICAgIGxldHRlclNwYWNpbmc6ICdpbml0aWFsJyxcbiAgICAgIHRyYW5zaXRpb246ICdjb2xvciAwLjVzIGVhc2UsIHRyYW5zZm9ybSAwLjVzIGVhc2UnLFxuICAgIH0sXG4gICAgaWNvbjoge1xuICAgICAgdHJhbnNpdGlvbjogJ3RyYW5zZm9ybSAwLjI1cyBlYXNlJyxcbiAgICAgIGNvbG9yOiB0aGVtZS5wYWxldHRlLnByaW1hcnkubWFpbixcbiAgICB9LFxuICAgIHJvdGF0ZToge1xuICAgICAgdHJhbnNmb3JtOiAncm90YXRlKDQ1ZGVnKScsXG4gICAgfSxcbiAgICBjb250ZW50OiB7XG4gICAgICBtYXhIZWlnaHQ6IDAsXG4gICAgICBvdmVyZmxvdzogJ2hpZGRlbicsXG4gICAgICB0cmFuc2l0aW9uOiAnbWF4LWhlaWdodCAwLjI1cyBlYXNlLWluLW91dCcsXG4gICAgfSxcbiAgICBpbm5lcjoge1xuICAgICAgZGlzcGxheTogJ2ZsZXgnLFxuICAgICAgZmxleERpcmVjdGlvbjogJ2NvbHVtbicsXG4gICAgICBiYWNrZ3JvdW5kOiB0aGVtZS5wYWxldHRlLmNvbW1vbi53aGl0ZSxcbiAgICAgIHBhZGRpbmc6IHRoZW1lLnNwYWNpbmcoMiksXG4gICAgICB3aWR0aDogJzEwMCUnLFxuICAgICAgaGVpZ2h0OiAnMTAwJScsXG4gICAgICB2aXNpYmlsaXR5OiAndmlzaWJsZScsXG4gICAgfSxcbiAgICBkaXJlY3Rpb25Sb3c6IHtcbiAgICAgIGZsZXhEaXJlY3Rpb246ICdyb3cnLFxuICAgIH0sXG4gICAgaW5uZXJIaWRkZW46IHtcbiAgICAgIHZpc2liaWxpdHk6ICdoaWRkZW4nLFxuICAgIH0sXG4gIH0pLFxuICB7IG5hbWU6IEV4cGFuc2lvblBhbmVsU3R5bGVzS2V5IH1cbik7XG5cbmV4cG9ydCB0eXBlIEV4cGFuc2lvblBhbmVsQ2xhc3NlcyA9IEdldENsYXNzZXM8dHlwZW9mIHVzZVN0eWxlcz47XG5cbmV4cG9ydCBpbnRlcmZhY2UgRXhwYW5zaW9uUGFuZWxQcm9wc1xuICBleHRlbmRzIFJlYWN0LkRldGFpbGVkSFRNTFByb3BzPFxuICAgIFJlYWN0LkhUTUxBdHRyaWJ1dGVzPEhUTUxEaXZFbGVtZW50PixcbiAgICBIVE1MRGl2RWxlbWVudFxuICA+IHtcbiAgYXJpYU93bnNJZD86IHN0cmluZztcbiAgY2hpbGRyZW4/OiBSZWFjdC5SZWFjdE5vZGU7XG4gIGNvbnRlbnRDbGFzc05hbWU/OiBzdHJpbmc7XG4gIGlubmVyQ29udGVudENsYXNzTmFtZT86IHN0cmluZztcbiAgdGl0bGU6IHN0cmluZztcbiAgb25Ub2dnbGU/OiAoaXNFeHBhbmRlZDogYm9vbGVhbikgPT4gdm9pZDtcbiAgaXNPcGVuPzogYm9vbGVhbjtcbiAgY29udGVudERpcmVjdGlvbj86ICdyb3cnIHwgJ2NvbHVtbic7XG59XG5cbmV4cG9ydCBjb25zdCBFeHBhbnNpb25QYW5lbDogUmVhY3QuRkM8RXhwYW5zaW9uUGFuZWxQcm9wcz4gPSAoe1xuICBhcmlhT3duc0lkLFxuICBjaGlsZHJlbixcbiAgY2xhc3NOYW1lLFxuICBjb250ZW50Q2xhc3NOYW1lLFxuICBpbm5lckNvbnRlbnRDbGFzc05hbWUsXG4gIG9uVG9nZ2xlLFxuICBpc09wZW4gPSBmYWxzZSxcbiAgY29udGVudERpcmVjdGlvbiA9ICdjb2x1bW4nLFxuICB0aXRsZSxcbiAgLi4ucm9vdFByb3BzXG59KSA9PiB7XG4gIGNvbnN0IGNsYXNzZXMgPSB1c2VTdHlsZXMoe30pO1xuICBjb25zdCBbaXNFeHBhbmRlZCwgc2V0SXNFeHBhbmRlZF0gPSBSZWFjdC51c2VTdGF0ZShpc09wZW4pO1xuXG4gIGNvbnN0IHJlZiA9IFJlYWN0LnVzZVJlZjxIVE1MRGl2RWxlbWVudD4obnVsbCk7XG4gIGNvbnN0IFtjb250ZW50SGVpZ2h0LCBzZXRDb250ZW50SGVpZ2h0XSA9IFJlYWN0LnVzZVN0YXRlPG51bWJlcj4oMCk7XG5cbiAgY29uc3QgW2FyaWFJZF0gPSBSZWFjdC51c2VTdGF0ZTxzdHJpbmc+KFxuICAgICgpID0+IGFyaWFPd25zSWQgfHwgZ2VuZXJhdGVVbmlxdWVJZCgnZXhwcGFuZWwtJylcbiAgKTtcblxuICAvLyBXYXRjaCBmb3IgYGlzT3BlbmAgY2hhbmdlc1xuICBSZWFjdC51c2VFZmZlY3QoKCkgPT4ge1xuICAgIHNldElzRXhwYW5kZWQoaXNPcGVuKTtcbiAgfSwgW2lzT3Blbl0pO1xuXG4gIC8vIFRPRE86IExvb2sgaW50byBodHRwczovL21lZGl1bS5jb20vQHRlaF9idWlsZGVyL3JlZi1vYmplY3RzLWluc2lkZS11c2VlZmZlY3QtaG9va3MtZWI3YzE1MTk4NzgwXG4gIC8vXG4gIC8vIERldGVybWluZSB0aGUgc2l6ZSBvZiBvdXIgY29udGVudCBzbyB3ZSBjYW4gZXhwYW5kL2NvbGxhcHNlXG4gIC8vIGFjY29yZGluZ2x5LiAgSWYgdGhlIGNoaWxkcmVuIGFyZSBkeW5hbWljYWxseSBnZW5lcmF0ZWQsIHdlIHNob3VsZFxuICAvLyByZS1ldmFsdWF0ZSBvdXIgc2l6ZSBpbiBjYXNlIGFkZGl0aW9uYWwgY29udGVudCBpcyBhZGRlZC9yZW1vdmVkXG4gIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKHJlZiAmJiByZWYuY3VycmVudCAmJiBjaGlsZHJlbikge1xuICAgICAgc2V0Q29udGVudEhlaWdodChyZWYuY3VycmVudC5zY3JvbGxIZWlnaHQgKyAyNSk7XG4gICAgfVxuICB9LCBbY2hpbGRyZW4sIHJlZj8uY3VycmVudD8uc2Nyb2xsSGVpZ2h0XSk7XG5cbiAgY29uc3QgaGFuZGxlQ2xpY2sgPSBSZWFjdC51c2VDYWxsYmFjayhcbiAgICAoZTogUmVhY3QuU3ludGhldGljRXZlbnQpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICAgIGNvbnN0IG5ld1N0YXRlID0gIWlzRXhwYW5kZWQ7XG4gICAgICBpZiAodHlwZW9mIG9uVG9nZ2xlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIG9uVG9nZ2xlKG5ld1N0YXRlKTtcbiAgICAgIH1cblxuICAgICAgc2V0SXNFeHBhbmRlZChuZXdTdGF0ZSk7XG4gICAgfSxcbiAgICBbaXNFeHBhbmRlZCwgb25Ub2dnbGVdXG4gICk7XG5cbiAgcmV0dXJuIChcbiAgICA8ZGl2XG4gICAgICBjbGFzc05hbWU9e2Nsc3goY2xhc3Nlcy5yb290LCBpc0V4cGFuZGVkICYmIGNsYXNzZXMucm9vdE9wZW4sIGNsYXNzTmFtZSl9XG4gICAgICB7Li4ucm9vdFByb3BzfVxuICAgID5cbiAgICAgIDxidXR0b25cbiAgICAgICAgYXJpYS1leHBhbmRlZD17aXNFeHBhbmRlZH1cbiAgICAgICAgYXJpYS1vd25zPXthcmlhSWR9XG4gICAgICAgIGNsYXNzTmFtZT17Y2xzeChjbGFzc2VzLmJ1dHRvbiwgaXNFeHBhbmRlZCAmJiBjbGFzc2VzLmJ1dHRvblNoYWRvdyl9XG4gICAgICAgIG9uQ2xpY2s9e2hhbmRsZUNsaWNrfVxuICAgICAgICB0YWJJbmRleD17MH1cbiAgICAgID5cbiAgICAgICAgPFRleHQgY2xhc3NOYW1lPXtjbGFzc2VzLnRpdGxlfSBzaXplPVwic3ViYm9keVwiIHdlaWdodD1cImJvbGRcIj5cbiAgICAgICAgICB7dGl0bGV9XG4gICAgICAgIDwvVGV4dD5cbiAgICAgICAgPFBsdXNcbiAgICAgICAgICBjbGFzc05hbWU9e2Nsc3goY2xhc3Nlcy5pY29uLCBpc0V4cGFuZGVkICYmIGNsYXNzZXMucm90YXRlKX1cbiAgICAgICAgICBhcmlhLWhpZGRlbj1cInRydWVcIlxuICAgICAgICAgIHdpZHRoPXsxOH1cbiAgICAgICAgICBoZWlnaHQ9ezE4fVxuICAgICAgICAvPlxuICAgICAgPC9idXR0b24+XG4gICAgICA8ZGl2XG4gICAgICAgIGFyaWEtaGlkZGVuPXshaXNFeHBhbmRlZH1cbiAgICAgICAgaWQ9e2FyaWFJZH1cbiAgICAgICAgY2xhc3NOYW1lPXtjbHN4KGNsYXNzZXMuY29udGVudCwgY29udGVudENsYXNzTmFtZSl9XG4gICAgICAgIHN0eWxlPXt7IG1heEhlaWdodDogaXNFeHBhbmRlZCA/IGNvbnRlbnRIZWlnaHQgOiAwIH19XG4gICAgICA+XG4gICAgICAgIDxkaXZcbiAgICAgICAgICByZWY9e3JlZn1cbiAgICAgICAgICBjbGFzc05hbWU9e2Nsc3goXG4gICAgICAgICAgICBjbGFzc2VzLmlubmVyLFxuICAgICAgICAgICAgaW5uZXJDb250ZW50Q2xhc3NOYW1lLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBbY2xhc3Nlcy5kaXJlY3Rpb25Sb3ddOiBjb250ZW50RGlyZWN0aW9uID09PSAncm93JyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAhaXNFeHBhbmRlZCAmJiBjbGFzc2VzLmlubmVySGlkZGVuXG4gICAgICAgICAgKX1cbiAgICAgICAgPlxuICAgICAgICAgIHtjaGlsZHJlbn1cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgKTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IEV4cGFuc2lvblBhbmVsO1xuIl19