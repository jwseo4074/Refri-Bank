"use strict";
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];
    result["default"] = mod;
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
var ConditionalWrapper_1 = require("../_private/ConditionalWrapper");
var IconButton_1 = require("../IconButton");
var styles_1 = require("../../styles");
var ModalActions_1 = require("./ModalActions");
var framer_motion_1 = require("framer-motion");
var Portal_1 = require("reakit/Portal");
var react_remove_scroll_1 = require("react-remove-scroll");
var Text_1 = require("../Text");
var helpers_1 = require("./helpers");
var chromicons_1 = require("@lifeomic/chromicons");
var clsx_1 = __importDefault(require("clsx"));
var react_focus_lock_1 = __importDefault(require("react-focus-lock"));
var React = __importStar(require("react"));
var ariaDescribedBy = 'modal-content';
var ariaLabelledBy = 'modal-header';
exports.ModalStylesKey = 'ChromaModal';
exports.OVERLAY_TEST_ID = 'chroma-overlay-testid';
exports.useStyles = styles_1.makeStyles(function (theme) { return ({
    overlay: {
        backgroundColor: 'rgba(0, 0, 0, 0.5)',
        bottom: 0,
        display: 'flex',
        flexDirection: 'column',
        justifyContent: 'center',
        left: 0,
        overflow: 'auto',
        position: 'fixed',
        right: 0,
        top: 0,
        zIndex: 1200,
        '@media screen and (max-width: 480px)': {
            justifyContent: 'flex-end',
        },
    },
    content: {
        background: theme.palette.common.white,
        borderRadius: theme.pxToRem(10),
        display: 'flex',
        flexDirection: 'column',
        margin: '10vh auto',
        outline: 'none',
        paddingTop: theme.spacing(0.25),
        paddingBottom: theme.spacing(0.25),
        width: theme.pxToRem(384),
        maxWidth: theme.pxToRem(600),
        overflow: 'hidden',
        '@media screen and (max-width: 480px)': {
            marginBottom: theme.spacing(0.75),
            marginLeft: theme.spacing(0.75),
            marginRight: theme.spacing(0.75),
            maxHeight: '95%',
            maxWidth: '480px',
            width: 'unset',
        },
        '& form': {
            display: 'flex',
            flexDirection: 'column',
            overflow: 'hidden',
        },
    },
    contentFullWidth: {
        width: 'calc(100% - 6rem)',
        '@media screen and (max-width: 480px)': {
            width: 'unset',
        },
    },
    contentSize0: {
        maxHeight: theme.pxToRem(256),
        '@media screen and (max-width: 480px)': {
            maxHeight: 'unset',
        },
    },
    contentSize1: {
        maxHeight: theme.pxToRem(480),
        '@media screen and (max-width: 480px)': {
            maxHeight: 'unset',
        },
    },
    contentFullScreen: {
        background: theme.palette.common.white,
        display: 'flex',
        flexDirection: 'column',
        height: '100%',
        width: '100%',
        zIndex: 1200,
    },
    verticalPadding: {
        paddingLeft: theme.spacing(2),
        paddingRight: theme.spacing(2),
    },
    modalHeader: {
        alignItems: 'center',
        borderBottom: "1px solid " + theme.palette.divider,
        display: 'flex',
        justifyContent: 'space-between',
        '&:only-child': {
            borderBottom: 'none',
        },
    },
    modalHeaderFullScreen: {
        alignItems: 'center',
        backgroundColor: theme.palette.common.white,
        borderBottom: "1px solid " + theme.palette.divider,
        display: 'flex',
        justifyContent: 'space-between',
        paddingBottom: theme.spacing(0.5),
        paddingLeft: theme.spacing(2.5),
        paddingRight: theme.spacing(2.5),
        paddingTop: theme.spacing(0.5),
    },
    modalChildrenContainer: {
        background: theme.palette.background.default,
        // Added padding on the bottom so that the spacing
        // between the title and top of the text ~equals spacing
        // between bottom of content and actions container
        padding: theme.spacing(2, 2, 2.5),
        overflowY: 'auto',
        WebkitOverflowScrolling: 'touch',
    },
    modalChildrenContainerFullScreen: {
        background: theme.palette.grey[50],
        height: '100%',
        overflowY: 'auto',
        padding: theme.spacing(4, 3.75, 4, 3.75),
        width: '100%',
        WebkitOverflowScrolling: 'touch',
    },
    modalActions: {
        // On mobile, we want to do the following:
        // 1) Vertically stack the buttons
        // 2) Reverse the order of the actions.  On mobile devices,
        //    the negative/cancel action is normally at the *bottom*,
        //    whereas our default behavior with standard modals is
        //    <cancel> <save>
        // 3) Target the buttons and set the widths to take 100%
        // 4) Target the height of buttons and make them taller,
        //    just so that users have a larger tap-target
        '@media screen and (max-width: 480px)': {
            display: 'flex',
            flexDirection: 'column-reverse',
            '& > button': {
                width: '100%',
                height: theme.pxToRem(48),
                // Since we are `column-reverse`, margin on the bottom is now
                // margin top
                marginTop: theme.spacing(1),
                '&:last-of-type': {
                    marginTop: 0,
                },
            },
        },
    },
}); }, { name: exports.ModalStylesKey });
var ModalInner = React.forwardRef(function (_a, ref) {
    var allowPinchZoom = _a.allowPinchZoom, overlayClassName = _a.overlayClassName, children = _a.children, onClick = _a.onClick, onDismiss = _a.onDismiss, disableDismissOnClickOutside = _a.disableDismissOnClickOutside, onMouseDown = _a.onMouseDown, onKeyDown = _a.onKeyDown;
    var classes = exports.useStyles({});
    var mouseDownTarget = React.useRef(null);
    var overlayNode = React.useRef(null);
    var thisRef = helpers_1.useForkedRef(overlayNode, ref);
    return (
    // Since we are using FocusLock, we can safely ignore the `autoFocus` ESLint complaint
    // eslint-disable-next-line jsx-a11y/no-autofocus
    React.createElement(react_focus_lock_1.default, { autoFocus: true, returnFocus: true },
        React.createElement(react_remove_scroll_1.RemoveScroll, { allowPinchZoom: allowPinchZoom },
            React.createElement(framer_motion_1.motion.div, { "data-testid": exports.OVERLAY_TEST_ID, className: clsx_1.default(classes.overlay, overlayClassName), onClick: helpers_1.wrapEvent(onClick, function (event) {
                    if (mouseDownTarget.current === event.target) {
                        event.stopPropagation();
                        onDismiss && !disableDismissOnClickOutside && onDismiss(event);
                    }
                }), onMouseDown: helpers_1.wrapEvent(onMouseDown, function (event) {
                    mouseDownTarget.current = event.target;
                }), onKeyDown: helpers_1.wrapEvent(onKeyDown, function (event) {
                    if (event.key === 'Escape') {
                        event.stopPropagation();
                        onDismiss && onDismiss(event);
                    }
                }), ref: thisRef, positionTransition: true, initial: { opacity: 0 }, animate: {
                    opacity: 1,
                    transition: { delay: 0.15, duration: 0.2 },
                }, exit: { opacity: 0, transition: { duration: 0.15 } } }, children))));
});
var Overlay = React.forwardRef(function (_a, ref) {
    var allowPinchZoom = _a.allowPinchZoom, _b = _a.isOpen, isOpen = _b === void 0 ? true : _b, rootProps = __rest(_a, ["allowPinchZoom", "isOpen"]);
    var ownRef = React.useRef(null);
    var thisRef = ref || ownRef;
    return (React.createElement(React.Fragment, null, isOpen ? (React.createElement(Portal_1.Portal, null,
        React.createElement(ModalInner, __assign({ allowPinchZoom: allowPinchZoom, ref: thisRef }, rootProps)))) : null));
});
var Content = React.forwardRef(function (_a, ref) {
    var _b;
    var actions = _a.actions, className = _a.className, children = _a.children, contentClassName = _a.contentClassName, fullWidth = _a.fullWidth, justifyActions = _a.justifyActions, isFormContent = _a.isFormContent, onFormSubmit = _a.onFormSubmit, onClick = _a.onClick, onDismiss = _a.onDismiss, customHeader = _a.customHeader, size = _a.size, title = _a.title, _c = _a.poses, poses = _c === void 0 ? {} : _c, rootProps = __rest(_a, ["actions", "className", "children", "contentClassName", "fullWidth", "justifyActions", "isFormContent", "onFormSubmit", "onClick", "onDismiss", "customHeader", "size", "title", "poses"]);
    var classes = exports.useStyles({});
    var shouldReduceMotion = framer_motion_1.useReducedMotion();
    var poseVariants = {
        init: poses.init || { y: 50, scale: 0.3 },
        open: poses.open || { y: 0, scale: 1 },
        exit: poses.exit || { scale: 0.5, transition: { duration: 0.15 } },
    };
    return (React.createElement(framer_motion_1.motion.div, __assign({ className: clsx_1.default(classes.content, fullWidth && classes.contentFullWidth, className), role: "dialog", "aria-modal": "true", "aria-describedby": ariaDescribedBy, "aria-labelledby": ariaLabelledBy, tabIndex: -1, onClick: helpers_1.wrapEvent(onClick, function (event) {
            event.stopPropagation();
        }), ref: ref, variants: poseVariants, initial: shouldReduceMotion ? {} : 'init', animate: shouldReduceMotion ? {} : 'open', exit: shouldReduceMotion ? {} : 'exit' }, rootProps),
        customHeader ? (customHeader) : (React.createElement("div", { id: ariaLabelledBy, className: clsx_1.default(classes.modalHeader, classes.verticalPadding) },
            !!title && (React.createElement(Text_1.Text, { size: "subbody", weight: "bold" }, title)),
            React.createElement(IconButton_1.IconButton, { "aria-label": "Close open modal", icon: chromicons_1.X, size: 0, tabIndex: 0, onClick: onDismiss, paddingRight: 0 }))),
        React.createElement(ConditionalWrapper_1.ConditionalWrapper, { condition: Boolean(isFormContent && onFormSubmit), wrapper: function (children) { return (React.createElement("form", { onSubmit: onFormSubmit }, children)); } },
            children && (React.createElement("div", { id: ariaDescribedBy, className: clsx_1.default(classes.modalChildrenContainer, classes.verticalPadding, (_b = {},
                    _b[classes.contentSize0] = size === 0,
                    _b[classes.contentSize1] = size === 1,
                    _b), contentClassName) }, children)),
            !!actions && (React.createElement(ModalActions_1.ModalActions, { className: clsx_1.default(classes.modalActions, classes.verticalPadding), justify: justifyActions }, actions)))));
});
var FullScreenContent = React.forwardRef(function (_a, ref) {
    var children = _a.children, className = _a.className, contentClassName = _a.contentClassName, onClick = _a.onClick, onDismiss = _a.onDismiss, title = _a.title, customHeader = _a.customHeader, rootProps = __rest(_a, ["children", "className", "contentClassName", "onClick", "onDismiss", "title", "customHeader"]);
    var classes = exports.useStyles({});
    return (React.createElement(framer_motion_1.motion.div, __assign({ className: clsx_1.default(classes.contentFullScreen, className), role: "dialog", "aria-modal": "true", "aria-describedby": ariaDescribedBy, "aria-labelledby": ariaLabelledBy, tabIndex: -1, onClick: helpers_1.wrapEvent(onClick, function (event) {
            event.stopPropagation();
        }), ref: ref, initial: { opacity: 0 }, animate: {
            opacity: 1,
            transition: { duration: 0.1, ease: [0.16, 1, 0.3, 1] },
        }, exit: {
            opacity: 0,
            transition: { duration: 0.08, ease: [0.7, 0, 0.84, 0] },
        } }, rootProps),
        customHeader ? (customHeader) : (React.createElement("div", { id: ariaLabelledBy, className: classes.modalHeaderFullScreen },
            !!title && React.createElement(Text_1.Text, { size: "subbody" }, title),
            React.createElement(IconButton_1.IconButton, { "aria-label": "Close open modal", icon: chromicons_1.X, size: 0, tabIndex: 0, onClick: onDismiss, paddingRight: 0 }))),
        React.createElement("div", { id: ariaDescribedBy, className: clsx_1.default(classes.modalChildrenContainerFullScreen, contentClassName) }, children)));
});
exports.Modal = React.forwardRef(function (_a, ref) {
    var allowPinchZoom = _a.allowPinchZoom, isFullScreen = _a.isFullScreen, isOpen = _a.isOpen, onDismiss = _a.onDismiss, disableDismissOnClickOutside = _a.disableDismissOnClickOutside, _b = _a.size, size = _b === void 0 ? 0 : _b, overlayClassName = _a.overlayClassName, rootProps = __rest(_a, ["allowPinchZoom", "isFullScreen", "isOpen", "onDismiss", "disableDismissOnClickOutside", "size", "overlayClassName"]);
    var ownRef = React.useRef(null);
    // If a ref is forwarded, use it; otherwise, use ourselves as the ref
    var thisRef = ref || ownRef;
    return (React.createElement(framer_motion_1.AnimatePresence, null, isOpen ? (React.createElement(Overlay, { overlayClassName: overlayClassName, allowPinchZoom: allowPinchZoom, isOpen: isOpen, onDismiss: onDismiss, disableDismissOnClickOutside: disableDismissOnClickOutside }, isFullScreen ? (React.createElement(FullScreenContent, __assign({ ref: thisRef, size: size, onDismiss: onDismiss }, rootProps))) : (React.createElement(Content, __assign({ ref: thisRef, size: size, onDismiss: onDismiss }, rootProps))))) : null));
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTW9kYWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvY29tcG9uZW50cy9Nb2RhbC9Nb2RhbC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLHFFQUFvRTtBQUVwRSw0Q0FBMkM7QUFDM0MsdUNBQTBDO0FBQzFDLCtDQUFpRTtBQUNqRSwrQ0FLdUI7QUFDdkIsd0NBQXVDO0FBQ3ZDLDJEQUFtRDtBQUNuRCxnQ0FBK0I7QUFDL0IscUNBQW9EO0FBQ3BELG1EQUF5QztBQUN6Qyw4Q0FBd0I7QUFDeEIsc0VBQXlDO0FBQ3pDLDJDQUErQjtBQUUvQixJQUFNLGVBQWUsR0FBRyxlQUFlLENBQUM7QUFDeEMsSUFBTSxjQUFjLEdBQUcsY0FBYyxDQUFDO0FBRXpCLFFBQUEsY0FBYyxHQUFHLGFBQWEsQ0FBQztBQUUvQixRQUFBLGVBQWUsR0FBRyx1QkFBdUIsQ0FBQztBQUUxQyxRQUFBLFNBQVMsR0FBRyxtQkFBVSxDQUNqQyxVQUFDLEtBQUssSUFBSyxPQUFBLENBQUM7SUFDVixPQUFPLEVBQUU7UUFDUCxlQUFlLEVBQUUsb0JBQW9CO1FBQ3JDLE1BQU0sRUFBRSxDQUFDO1FBQ1QsT0FBTyxFQUFFLE1BQU07UUFDZixhQUFhLEVBQUUsUUFBUTtRQUN2QixjQUFjLEVBQUUsUUFBUTtRQUN4QixJQUFJLEVBQUUsQ0FBQztRQUNQLFFBQVEsRUFBRSxNQUFNO1FBQ2hCLFFBQVEsRUFBRSxPQUFPO1FBQ2pCLEtBQUssRUFBRSxDQUFDO1FBQ1IsR0FBRyxFQUFFLENBQUM7UUFDTixNQUFNLEVBQUUsSUFBSTtRQUNaLHNDQUFzQyxFQUFFO1lBQ3RDLGNBQWMsRUFBRSxVQUFVO1NBQzNCO0tBQ0Y7SUFDRCxPQUFPLEVBQUU7UUFDUCxVQUFVLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsS0FBSztRQUN0QyxZQUFZLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FB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SUFJZCxJQUFNLE1BQU0sR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBRWxDLHFFQUFxRTtJQUNyRSxJQUFNLE9BQU8sR0FBRyxHQUFHLElBQUksTUFBTSxDQUFDO0lBRTlCLE9BQU8sQ0FDTCxvQkFBQywrQkFBZSxRQUNiLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FDUixvQkFBQyxPQUFPLElBQ04sZ0JBQWdCLEVBQUUsZ0JBQWdCLEVBQ2xDLGNBQWMsRUFBRSxjQUFjLEVBQzlCLE1BQU0sRUFBRSxNQUFNLEVBQ2QsU0FBUyxFQUFFLFNBQVMsRUFDcEIsNEJBQTRCLEVBQUUsNEJBQTRCLElBRXpELFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FDZCxvQkFBQyxpQkFBaUIsYUFDaEIsR0FBRyxFQUFFLE9BQU8sRUFDWixJQUFJLEVBQUUsSUFBSSxFQUNWLFNBQVMsRUFBRSxTQUFTLElBQ2hCLFNBQVMsRUFDYixDQUNILENBQUMsQ0FBQyxDQUFDLENBQ0Ysb0JBQUMsT0FBTyxhQUNOLEdBQUcsRUFBRSxPQUFPLEVBQ1osSUFBSSxFQUFFLElBQUksRUFDVixTQUFTLEVBQUUsU0FBUyxJQUNoQixTQUFTLEVBQ2IsQ0FDSCxDQUNPLENBQ1gsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUNRLENBQ25CLENBQUM7QUFDSixDQUFDLENBQ0YsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbmRpdGlvbmFsV3JhcHBlciB9IGZyb20gJy4uL19wcml2YXRlL0NvbmRpdGlvbmFsV3JhcHBlcic7XG5pbXBvcnQgeyBHZXRDbGFzc2VzIH0gZnJvbSAnLi4vLi4vdHlwZVV0aWxzJztcbmltcG9ydCB7IEljb25CdXR0b24gfSBmcm9tICcuLi9JY29uQnV0dG9uJztcbmltcG9ydCB7IG1ha2VTdHlsZXMgfSBmcm9tICcuLi8uLi9zdHlsZXMnO1xuaW1wb3J0IHsgTW9kYWxBY3Rpb25zLCBNb2RhbEFjdGlvbnNQcm9wcyB9IGZyb20gJy4vTW9kYWxBY3Rpb25zJztcbmltcG9ydCB7XG4gIG1vdGlvbixcbiAgQW5pbWF0ZVByZXNlbmNlLFxuICB1c2VSZWR1Y2VkTW90aW9uLFxuICBWYXJpYW50cyxcbn0gZnJvbSAnZnJhbWVyLW1vdGlvbic7XG5pbXBvcnQgeyBQb3J0YWwgfSBmcm9tICdyZWFraXQvUG9ydGFsJztcbmltcG9ydCB7IFJlbW92ZVNjcm9sbCB9IGZyb20gJ3JlYWN0LXJlbW92ZS1zY3JvbGwnO1xuaW1wb3J0IHsgVGV4dCB9IGZyb20gJy4uL1RleHQnO1xuaW1wb3J0IHsgdXNlRm9ya2VkUmVmLCB3cmFwRXZlbnQgfSBmcm9tICcuL2hlbHBlcnMnO1xuaW1wb3J0IHsgWCB9IGZyb20gJ0BsaWZlb21pYy9jaHJvbWljb25zJztcbmltcG9ydCBjbHN4IGZyb20gJ2Nsc3gnO1xuaW1wb3J0IEZvY3VzTG9jayBmcm9tICdyZWFjdC1mb2N1cy1sb2NrJztcbmltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcblxuY29uc3QgYXJpYURlc2NyaWJlZEJ5ID0gJ21vZGFsLWNvbnRlbnQnO1xuY29uc3QgYXJpYUxhYmVsbGVkQnkgPSAnbW9kYWwtaGVhZGVyJztcblxuZXhwb3J0IGNvbnN0IE1vZGFsU3R5bGVzS2V5ID0gJ0Nocm9tYU1vZGFsJztcblxuZXhwb3J0IGNvbnN0IE9WRVJMQVlfVEVTVF9JRCA9ICdjaHJvbWEtb3ZlcmxheS10ZXN0aWQnO1xuXG5leHBvcnQgY29uc3QgdXNlU3R5bGVzID0gbWFrZVN0eWxlcyhcbiAgKHRoZW1lKSA9PiAoe1xuICAgIG92ZXJsYXk6IHtcbiAgICAgIGJhY2tncm91bmRDb2xvcjogJ3JnYmEoMCwgMCwgMCwgMC41KScsXG4gICAgICBib3R0b206IDAsXG4gICAgICBkaXNwbGF5OiAnZmxleCcsXG4gICAgICBmbGV4RGlyZWN0aW9uOiAnY29sdW1uJyxcbiAgICAgIGp1c3RpZnlDb250ZW50OiAnY2VudGVyJyxcbiAgICAgIGxlZnQ6IDAsXG4gICAgICBvdmVyZmxvdzogJ2F1dG8nLFxuICAgICAgcG9zaXRpb246ICdmaXhlZCcsXG4gICAgICByaWdodDogMCxcbiAgICAgIHRvcDogMCxcbiAgICAgIHpJbmRleDogMTIwMCwgLy8gSGFzIHRvIGdvIGFib3ZlIHRoZSBIZWFkZXIgei1pbmRleFxuICAgICAgJ0BtZWRpYSBzY3JlZW4gYW5kIChtYXgtd2lkdGg6IDQ4MHB4KSc6IHtcbiAgICAgICAganVzdGlmeUNvbnRlbnQ6ICdmbGV4LWVuZCcsXG4gICAgICB9LFxuICAgIH0sXG4gICAgY29udGVudDoge1xuICAgICAgYmFja2dyb3VuZDogdGhlbWUucGFsZXR0ZS5jb21tb24ud2hpdGUsXG4gICAgICBib3JkZXJSYWRpdXM6IHRoZW1lLnB4VG9SZW0oMTApLFxuICAgICAgZGlzcGxheTogJ2ZsZXgnLFxuICAgICAgZmxleERpcmVjdGlvbjogJ2NvbHVtbicsXG4gICAgICBtYXJnaW46ICcxMHZoIGF1dG8nLFxuICAgICAgb3V0bGluZTogJ25vbmUnLFxuICAgICAgcGFkZGluZ1RvcDogdGhlbWUuc3BhY2luZygwLjI1KSxcbiAgICAgIHBhZGRpbmdCb3R0b206IHRoZW1lLnNwYWNpbmcoMC4yNSksXG4gICAgICB3aWR0aDogdGhlbWUucHhUb1JlbSgzODQpLFxuICAgICAgbWF4V2lkdGg6IHRoZW1lLnB4VG9SZW0oNjAwKSxcbiAgICAgIG92ZXJmbG93OiAnaGlkZGVuJyxcbiAgICAgICdAbWVkaWEgc2NyZWVuIGFuZCAobWF4LXdpZHRoOiA0ODBweCknOiB7XG4gICAgICAgIG1hcmdpbkJvdHRvbTogdGhlbWUuc3BhY2luZygwLjc1KSxcbiAgICAgICAgbWFyZ2luTGVmdDogdGhlbWUuc3BhY2luZygwLjc1KSxcbiAgICAgICAgbWFyZ2luUmlnaHQ6IHRoZW1lLnNwYWNpbmcoMC43NSksXG4gICAgICAgIG1heEhlaWdodDogJzk1JScsXG4gICAgICAgIG1heFdpZHRoOiAnNDgwcHgnLFxuICAgICAgICB3aWR0aDogJ3Vuc2V0JyxcbiAgICAgIH0sXG4gICAgICAnJiBmb3JtJzoge1xuICAgICAgICBkaXNwbGF5OiAnZmxleCcsXG4gICAgICAgIGZsZXhEaXJlY3Rpb246ICdjb2x1bW4nLFxuICAgICAgICBvdmVyZmxvdzogJ2hpZGRlbicsXG4gICAgICB9LFxuICAgIH0sXG4gICAgY29udGVudEZ1bGxXaWR0aDoge1xuICAgICAgd2lkdGg6ICdjYWxjKDEwMCUgLSA2cmVtKScsXG4gICAgICAnQG1lZGlhIHNjcmVlbiBhbmQgKG1heC13aWR0aDogNDgwcHgpJzoge1xuICAgICAgICB3aWR0aDogJ3Vuc2V0JyxcbiAgICAgIH0sXG4gICAgfSxcbiAgICBjb250ZW50U2l6ZTA6IHtcbiAgICAgIG1heEhlaWdodDogdGhlbWUucHhUb1JlbSgyNTYpLFxuICAgICAgJ0BtZWRpYSBzY3JlZW4gYW5kIChtYXgtd2lkdGg6IDQ4MHB4KSc6IHtcbiAgICAgICAgbWF4SGVpZ2h0OiAndW5zZXQnLFxuICAgICAgfSxcbiAgICB9LFxuICAgIGNvbnRlbnRTaXplMToge1xuICAgICAgbWF4SGVpZ2h0OiB0aGVtZS5weFRvUmVtKDQ4MCksXG4gICAgICAnQG1lZGlhIHNjcmVlbiBhbmQgKG1heC13aWR0aDogNDgwcHgpJzoge1xuICAgICAgICBtYXhIZWlnaHQ6ICd1bnNldCcsXG4gICAgICB9LFxuICAgIH0sXG4gICAgY29udGVudEZ1bGxTY3JlZW46IHtcbiAgICAgIGJhY2tncm91bmQ6IHRoZW1lLnBhbGV0dGUuY29tbW9uLndoaXRlLFxuICAgICAgZGlzcGxheTogJ2ZsZXgnLFxuICAgICAgZmxleERpcmVjdGlvbjogJ2NvbHVtbicsXG4gICAgICBoZWlnaHQ6ICcxMDAlJyxcbiAgICAgIHdpZHRoOiAnMTAwJScsXG4gICAgICB6SW5kZXg6IDEyMDAsIC8vIEhhcyB0byBnbyBhYm92ZSB0aGUgSGVhZGVyIHotaW5kZXhcbiAgICB9LFxuICAgIHZlcnRpY2FsUGFkZGluZzoge1xuICAgICAgcGFkZGluZ0xlZnQ6IHRoZW1lLnNwYWNpbmcoMiksXG4gICAgICBwYWRkaW5nUmlnaHQ6IHRoZW1lLnNwYWNpbmcoMiksXG4gICAgfSxcbiAgICBtb2RhbEhlYWRlcjoge1xuICAgICAgYWxpZ25JdGVtczogJ2NlbnRlcicsXG4gICAgICBib3JkZXJCb3R0b206IGAxcHggc29saWQgJHt0aGVtZS5wYWxldHRlLmRpdmlkZXJ9YCxcbiAgICAgIGRpc3BsYXk6ICdmbGV4JyxcbiAgICAgIGp1c3RpZnlDb250ZW50OiAnc3BhY2UtYmV0d2VlbicsXG4gICAgICAnJjpvbmx5LWNoaWxkJzoge1xuICAgICAgICBib3JkZXJCb3R0b206ICdub25lJyxcbiAgICAgIH0sXG4gICAgfSxcbiAgICBtb2RhbEhlYWRlckZ1bGxTY3JlZW46IHtcbiAgICAgIGFsaWduSXRlbXM6ICdjZW50ZXInLFxuICAgICAgYmFja2dyb3VuZENvbG9yOiB0aGVtZS5wYWxldHRlLmNvbW1vbi53aGl0ZSxcbiAgICAgIGJvcmRlckJvdHRvbTogYDFweCBzb2xpZCAke3RoZW1lLnBhbGV0dGUuZGl2aWRlcn1gLFxuICAgICAgZGlzcGxheTogJ2ZsZXgnLFxuICAgICAganVzdGlmeUNvbnRlbnQ6ICdzcGFjZS1iZXR3ZWVuJyxcbiAgICAgIHBhZGRpbmdCb3R0b206IHRoZW1lLnNwYWNpbmcoMC41KSxcbiAgICAgIHBhZGRpbmdMZWZ0OiB0aGVtZS5zcGFjaW5nKDIuNSksXG4gICAgICBwYWRkaW5nUmlnaHQ6IHRoZW1lLnNwYWNpbmcoMi41KSxcbiAgICAgIHBhZGRpbmdUb3A6IHRoZW1lLnNwYWNpbmcoMC41KSxcbiAgICB9LFxuICAgIG1vZGFsQ2hpbGRyZW5Db250YWluZXI6IHtcbiAgICAgIGJhY2tncm91bmQ6IHRoZW1lLnBhbGV0dGUuYmFja2dyb3VuZC5kZWZhdWx0LFxuICAgICAgLy8gQWRkZWQgcGFkZGluZyBvbiB0aGUgYm90dG9tIHNvIHRoYXQgdGhlIHNwYWNpbmdcbiAgICAgIC8vIGJldHdlZW4gdGhlIHRpdGxlIGFuZCB0b3Agb2YgdGhlIHRleHQgfmVxdWFscyBzcGFjaW5nXG4gICAgICAvLyBiZXR3ZWVuIGJvdHRvbSBvZiBjb250ZW50IGFuZCBhY3Rpb25zIGNvbnRhaW5lclxuICAgICAgcGFkZGluZzogdGhlbWUuc3BhY2luZygyLCAyLCAyLjUpLFxuICAgICAgb3ZlcmZsb3dZOiAnYXV0bycsXG4gICAgICBXZWJraXRPdmVyZmxvd1Njcm9sbGluZzogJ3RvdWNoJywgLy8gQWRkIGlPUyBtb21lbnR1bSBzY3JvbGxpbmcuXG4gICAgfSxcbiAgICBtb2RhbENoaWxkcmVuQ29udGFpbmVyRnVsbFNjcmVlbjoge1xuICAgICAgYmFja2dyb3VuZDogdGhlbWUucGFsZXR0ZS5ncmV5WzUwXSxcbiAgICAgIGhlaWdodDogJzEwMCUnLFxuICAgICAgb3ZlcmZsb3dZOiAnYXV0bycsXG4gICAgICBwYWRkaW5nOiB0aGVtZS5zcGFjaW5nKDQsIDMuNzUsIDQsIDMuNzUpLFxuICAgICAgd2lkdGg6ICcxMDAlJyxcbiAgICAgIFdlYmtpdE92ZXJmbG93U2Nyb2xsaW5nOiAndG91Y2gnLCAvLyBBZGQgaU9TIG1vbWVudHVtIHNjcm9sbGluZy5cbiAgICB9LFxuICAgIG1vZGFsQWN0aW9uczoge1xuICAgICAgLy8gT24gbW9iaWxlLCB3ZSB3YW50IHRvIGRvIHRoZSBmb2xsb3dpbmc6XG4gICAgICAvLyAxKSBWZXJ0aWNhbGx5IHN0YWNrIHRoZSBidXR0b25zXG4gICAgICAvLyAyKSBSZXZlcnNlIHRoZSBvcmRlciBvZiB0aGUgYWN0aW9ucy4gIE9uIG1vYmlsZSBkZXZpY2VzLFxuICAgICAgLy8gICAgdGhlIG5lZ2F0aXZlL2NhbmNlbCBhY3Rpb24gaXMgbm9ybWFsbHkgYXQgdGhlICpib3R0b20qLFxuICAgICAgLy8gICAgd2hlcmVhcyBvdXIgZGVmYXVsdCBiZWhhdmlvciB3aXRoIHN0YW5kYXJkIG1vZGFscyBpc1xuICAgICAgLy8gICAgPGNhbmNlbD4gPHNhdmU+XG4gICAgICAvLyAzKSBUYXJnZXQgdGhlIGJ1dHRvbnMgYW5kIHNldCB0aGUgd2lkdGhzIHRvIHRha2UgMTAwJVxuICAgICAgLy8gNCkgVGFyZ2V0IHRoZSBoZWlnaHQgb2YgYnV0dG9ucyBhbmQgbWFrZSB0aGVtIHRhbGxlcixcbiAgICAgIC8vICAgIGp1c3Qgc28gdGhhdCB1c2VycyBoYXZlIGEgbGFyZ2VyIHRhcC10YXJnZXRcbiAgICAgICdAbWVkaWEgc2NyZWVuIGFuZCAobWF4LXdpZHRoOiA0ODBweCknOiB7XG4gICAgICAgIGRpc3BsYXk6ICdmbGV4JyxcbiAgICAgICAgZmxleERpcmVjdGlvbjogJ2NvbHVtbi1yZXZlcnNlJyxcbiAgICAgICAgJyYgPiBidXR0b24nOiB7XG4gICAgICAgICAgd2lkdGg6ICcxMDAlJyxcbiAgICAgICAgICBoZWlnaHQ6IHRoZW1lLnB4VG9SZW0oNDgpLFxuICAgICAgICAgIC8vIFNpbmNlIHdlIGFyZSBgY29sdW1uLXJldmVyc2VgLCBtYXJnaW4gb24gdGhlIGJvdHRvbSBpcyBub3dcbiAgICAgICAgICAvLyBtYXJnaW4gdG9wXG4gICAgICAgICAgbWFyZ2luVG9wOiB0aGVtZS5zcGFjaW5nKDEpLFxuICAgICAgICAgICcmOmxhc3Qtb2YtdHlwZSc6IHtcbiAgICAgICAgICAgIG1hcmdpblRvcDogMCxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9LFxuICB9KSxcbiAgeyBuYW1lOiBNb2RhbFN0eWxlc0tleSB9XG4pO1xuXG5leHBvcnQgdHlwZSBNb2RhbENsYXNzZXMgPSBHZXRDbGFzc2VzPHR5cGVvZiB1c2VTdHlsZXM+O1xuXG5leHBvcnQgaW50ZXJmYWNlIE1vZGFsUHJvcHNcbiAgZXh0ZW5kcyBQaWNrPFxuICAgIFJlYWN0LkNvbXBvbmVudFByb3BzV2l0aG91dFJlZjwnZGl2Jz4sXG4gICAgJ2NsYXNzTmFtZScgfCAnb25DbGljaycgfCAnb25Nb3VzZURvd24nIHwgJ29uS2V5RG93bidcbiAgPiB7XG4gIGFjdGlvbnM/OiBSZWFjdC5SZWFjdE5vZGU7XG4gIGFsbG93UGluY2hab29tPzogYm9vbGVhbjtcbiAgY2hpbGRyZW4/OiBSZWFjdC5SZWFjdE5vZGU7XG4gIGN1c3RvbUhlYWRlcj86IFJlYWN0LlJlYWN0Tm9kZTtcbiAgY29udGVudENsYXNzTmFtZT86IHN0cmluZztcbiAgb3ZlcmxheUNsYXNzTmFtZT86IHN0cmluZztcbiAgZnVsbFdpZHRoPzogYm9vbGVhbjtcbiAgaXNGb3JtQ29udGVudD86IGJvb2xlYW47XG4gIGlzRnVsbFNjcmVlbj86IGJvb2xlYW47XG4gIGlzT3Blbj86IGJvb2xlYW47XG4gIGp1c3RpZnlBY3Rpb25zPzogTW9kYWxBY3Rpb25zUHJvcHNbJ2p1c3RpZnknXTtcbiAgb25EaXNtaXNzPzogKHByb3BzOiBhbnkpID0+IHZvaWQ7XG4gIGRpc2FibGVEaXNtaXNzT25DbGlja091dHNpZGU/OiBib29sZWFuO1xuICBvbkZvcm1TdWJtaXQ/OiAoZGF0YTogYW55KSA9PiB2b2lkO1xuICBwb3Nlcz86IFZhcmlhbnRzO1xuICBzaXplPzogMCB8IDE7XG4gIHRpdGxlPzogc3RyaW5nO1xufVxuXG5jb25zdCBNb2RhbElubmVyID0gUmVhY3QuZm9yd2FyZFJlZjxIVE1MRGl2RWxlbWVudCwgTW9kYWxQcm9wcz4oXG4gIChcbiAgICB7XG4gICAgICBhbGxvd1BpbmNoWm9vbSxcbiAgICAgIG92ZXJsYXlDbGFzc05hbWUsXG4gICAgICBjaGlsZHJlbixcbiAgICAgIG9uQ2xpY2ssXG4gICAgICBvbkRpc21pc3MsXG4gICAgICBkaXNhYmxlRGlzbWlzc09uQ2xpY2tPdXRzaWRlLFxuICAgICAgb25Nb3VzZURvd24sXG4gICAgICBvbktleURvd24sXG4gICAgfSxcbiAgICByZWZcbiAgKSA9PiB7XG4gICAgY29uc3QgY2xhc3NlcyA9IHVzZVN0eWxlcyh7fSk7XG4gICAgY29uc3QgbW91c2VEb3duVGFyZ2V0ID0gUmVhY3QudXNlUmVmPGFueT4obnVsbCk7XG4gICAgY29uc3Qgb3ZlcmxheU5vZGUgPSBSZWFjdC51c2VSZWYobnVsbCk7XG4gICAgY29uc3QgdGhpc1JlZiA9IHVzZUZvcmtlZFJlZihvdmVybGF5Tm9kZSwgcmVmKTtcblxuICAgIHJldHVybiAoXG4gICAgICAvLyBTaW5jZSB3ZSBhcmUgdXNpbmcgRm9jdXNMb2NrLCB3ZSBjYW4gc2FmZWx5IGlnbm9yZSB0aGUgYGF1dG9Gb2N1c2AgRVNMaW50IGNvbXBsYWludFxuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGpzeC1hMTF5L25vLWF1dG9mb2N1c1xuICAgICAgPEZvY3VzTG9jayBhdXRvRm9jdXMgcmV0dXJuRm9jdXM+XG4gICAgICAgIDxSZW1vdmVTY3JvbGwgYWxsb3dQaW5jaFpvb209e2FsbG93UGluY2hab29tfT5cbiAgICAgICAgICA8bW90aW9uLmRpdlxuICAgICAgICAgICAgZGF0YS10ZXN0aWQ9e09WRVJMQVlfVEVTVF9JRH1cbiAgICAgICAgICAgIGNsYXNzTmFtZT17Y2xzeChjbGFzc2VzLm92ZXJsYXksIG92ZXJsYXlDbGFzc05hbWUpfVxuICAgICAgICAgICAgb25DbGljaz17d3JhcEV2ZW50KG9uQ2xpY2ssIChldmVudDogUmVhY3QuU3ludGhldGljRXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgaWYgKG1vdXNlRG93blRhcmdldC5jdXJyZW50ID09PSBldmVudC50YXJnZXQpIHtcbiAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICBvbkRpc21pc3MgJiYgIWRpc2FibGVEaXNtaXNzT25DbGlja091dHNpZGUgJiYgb25EaXNtaXNzKGV2ZW50KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSl9XG4gICAgICAgICAgICBvbk1vdXNlRG93bj17d3JhcEV2ZW50KG9uTW91c2VEb3duLCAoZXZlbnQ6IFJlYWN0Lk1vdXNlRXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgbW91c2VEb3duVGFyZ2V0LmN1cnJlbnQgPSBldmVudC50YXJnZXQ7XG4gICAgICAgICAgICB9KX1cbiAgICAgICAgICAgIG9uS2V5RG93bj17d3JhcEV2ZW50KG9uS2V5RG93biwgKGV2ZW50OiBSZWFjdC5LZXlib2FyZEV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgIGlmIChldmVudC5rZXkgPT09ICdFc2NhcGUnKSB7XG4gICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgb25EaXNtaXNzICYmIG9uRGlzbWlzcyhldmVudCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pfVxuICAgICAgICAgICAgcmVmPXt0aGlzUmVmfVxuICAgICAgICAgICAgcG9zaXRpb25UcmFuc2l0aW9uXG4gICAgICAgICAgICBpbml0aWFsPXt7IG9wYWNpdHk6IDAgfX1cbiAgICAgICAgICAgIGFuaW1hdGU9e3tcbiAgICAgICAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgICAgICAgdHJhbnNpdGlvbjogeyBkZWxheTogMC4xNSwgZHVyYXRpb246IDAuMiB9LFxuICAgICAgICAgICAgfX1cbiAgICAgICAgICAgIGV4aXQ9e3sgb3BhY2l0eTogMCwgdHJhbnNpdGlvbjogeyBkdXJhdGlvbjogMC4xNSB9IH19XG4gICAgICAgICAgPlxuICAgICAgICAgICAge2NoaWxkcmVufVxuICAgICAgICAgIDwvbW90aW9uLmRpdj5cbiAgICAgICAgPC9SZW1vdmVTY3JvbGw+XG4gICAgICA8L0ZvY3VzTG9jaz5cbiAgICApO1xuICB9XG4pO1xuXG5jb25zdCBPdmVybGF5ID0gUmVhY3QuZm9yd2FyZFJlZjxIVE1MRGl2RWxlbWVudCwgTW9kYWxQcm9wcz4oXG4gICh7IGFsbG93UGluY2hab29tLCBpc09wZW4gPSB0cnVlLCAuLi5yb290UHJvcHMgfSwgcmVmKSA9PiB7XG4gICAgY29uc3Qgb3duUmVmID0gUmVhY3QudXNlUmVmKG51bGwpO1xuICAgIGNvbnN0IHRoaXNSZWYgPSByZWYgfHwgb3duUmVmO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDw+XG4gICAgICAgIHtpc09wZW4gPyAoXG4gICAgICAgICAgPFBvcnRhbD5cbiAgICAgICAgICAgIDxNb2RhbElubmVyXG4gICAgICAgICAgICAgIGFsbG93UGluY2hab29tPXthbGxvd1BpbmNoWm9vbX1cbiAgICAgICAgICAgICAgcmVmPXt0aGlzUmVmfVxuICAgICAgICAgICAgICB7Li4ucm9vdFByb3BzfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICA8L1BvcnRhbD5cbiAgICAgICAgKSA6IG51bGx9XG4gICAgICA8Lz5cbiAgICApO1xuICB9XG4pO1xuXG5jb25zdCBDb250ZW50ID0gUmVhY3QuZm9yd2FyZFJlZjxIVE1MRGl2RWxlbWVudCwgTW9kYWxQcm9wcz4oXG4gIChcbiAgICB7XG4gICAgICBhY3Rpb25zLFxuICAgICAgY2xhc3NOYW1lLFxuICAgICAgY2hpbGRyZW4sXG4gICAgICBjb250ZW50Q2xhc3NOYW1lLFxuICAgICAgZnVsbFdpZHRoLFxuICAgICAganVzdGlmeUFjdGlvbnMsXG4gICAgICBpc0Zvcm1Db250ZW50LFxuICAgICAgb25Gb3JtU3VibWl0LFxuICAgICAgb25DbGljayxcbiAgICAgIG9uRGlzbWlzcyxcbiAgICAgIGN1c3RvbUhlYWRlcixcbiAgICAgIHNpemUsXG4gICAgICB0aXRsZSxcbiAgICAgIHBvc2VzID0ge30sXG4gICAgICAuLi5yb290UHJvcHNcbiAgICB9LFxuICAgIHJlZlxuICApID0+IHtcbiAgICBjb25zdCBjbGFzc2VzID0gdXNlU3R5bGVzKHt9KTtcbiAgICBjb25zdCBzaG91bGRSZWR1Y2VNb3Rpb24gPSB1c2VSZWR1Y2VkTW90aW9uKCk7XG4gICAgY29uc3QgcG9zZVZhcmlhbnRzID0ge1xuICAgICAgaW5pdDogcG9zZXMuaW5pdCB8fCB7IHk6IDUwLCBzY2FsZTogMC4zIH0sXG4gICAgICBvcGVuOiBwb3Nlcy5vcGVuIHx8IHsgeTogMCwgc2NhbGU6IDEgfSxcbiAgICAgIGV4aXQ6IHBvc2VzLmV4aXQgfHwgeyBzY2FsZTogMC41LCB0cmFuc2l0aW9uOiB7IGR1cmF0aW9uOiAwLjE1IH0gfSxcbiAgICB9O1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxtb3Rpb24uZGl2XG4gICAgICAgIGNsYXNzTmFtZT17Y2xzeChcbiAgICAgICAgICBjbGFzc2VzLmNvbnRlbnQsXG4gICAgICAgICAgZnVsbFdpZHRoICYmIGNsYXNzZXMuY29udGVudEZ1bGxXaWR0aCxcbiAgICAgICAgICBjbGFzc05hbWVcbiAgICAgICAgKX1cbiAgICAgICAgcm9sZT1cImRpYWxvZ1wiXG4gICAgICAgIGFyaWEtbW9kYWw9XCJ0cnVlXCJcbiAgICAgICAgYXJpYS1kZXNjcmliZWRieT17YXJpYURlc2NyaWJlZEJ5fVxuICAgICAgICBhcmlhLWxhYmVsbGVkYnk9e2FyaWFMYWJlbGxlZEJ5fVxuICAgICAgICB0YWJJbmRleD17LTF9XG4gICAgICAgIG9uQ2xpY2s9e3dyYXBFdmVudChvbkNsaWNrLCAoZXZlbnQ6IGFueSkgPT4ge1xuICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB9KX1cbiAgICAgICAgcmVmPXtyZWZ9XG4gICAgICAgIHZhcmlhbnRzPXtwb3NlVmFyaWFudHN9XG4gICAgICAgIGluaXRpYWw9e3Nob3VsZFJlZHVjZU1vdGlvbiA/IHt9IDogJ2luaXQnfVxuICAgICAgICBhbmltYXRlPXtzaG91bGRSZWR1Y2VNb3Rpb24gPyB7fSA6ICdvcGVuJ31cbiAgICAgICAgZXhpdD17c2hvdWxkUmVkdWNlTW90aW9uID8ge30gOiAnZXhpdCd9XG4gICAgICAgIHsuLi5yb290UHJvcHN9XG4gICAgICA+XG4gICAgICAgIHtjdXN0b21IZWFkZXIgPyAoXG4gICAgICAgICAgY3VzdG9tSGVhZGVyXG4gICAgICAgICkgOiAoXG4gICAgICAgICAgPGRpdlxuICAgICAgICAgICAgaWQ9e2FyaWFMYWJlbGxlZEJ5fVxuICAgICAgICAgICAgY2xhc3NOYW1lPXtjbHN4KGNsYXNzZXMubW9kYWxIZWFkZXIsIGNsYXNzZXMudmVydGljYWxQYWRkaW5nKX1cbiAgICAgICAgICA+XG4gICAgICAgICAgICB7ISF0aXRsZSAmJiAoXG4gICAgICAgICAgICAgIDxUZXh0IHNpemU9XCJzdWJib2R5XCIgd2VpZ2h0PVwiYm9sZFwiPlxuICAgICAgICAgICAgICAgIHt0aXRsZX1cbiAgICAgICAgICAgICAgPC9UZXh0PlxuICAgICAgICAgICAgKX1cbiAgICAgICAgICAgIDxJY29uQnV0dG9uXG4gICAgICAgICAgICAgIGFyaWEtbGFiZWw9XCJDbG9zZSBvcGVuIG1vZGFsXCJcbiAgICAgICAgICAgICAgaWNvbj17WH1cbiAgICAgICAgICAgICAgc2l6ZT17MH1cbiAgICAgICAgICAgICAgdGFiSW5kZXg9ezB9XG4gICAgICAgICAgICAgIG9uQ2xpY2s9e29uRGlzbWlzc31cbiAgICAgICAgICAgICAgcGFkZGluZ1JpZ2h0PXswfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgKX1cbiAgICAgICAgPENvbmRpdGlvbmFsV3JhcHBlclxuICAgICAgICAgIGNvbmRpdGlvbj17Qm9vbGVhbihpc0Zvcm1Db250ZW50ICYmIG9uRm9ybVN1Ym1pdCl9XG4gICAgICAgICAgd3JhcHBlcj17KGNoaWxkcmVuOiBSZWFjdC5SZWFjdE5vZGUpID0+IChcbiAgICAgICAgICAgIDxmb3JtIG9uU3VibWl0PXtvbkZvcm1TdWJtaXR9PntjaGlsZHJlbn08L2Zvcm0+XG4gICAgICAgICAgKX1cbiAgICAgICAgPlxuICAgICAgICAgIHtjaGlsZHJlbiAmJiAoXG4gICAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICAgIGlkPXthcmlhRGVzY3JpYmVkQnl9XG4gICAgICAgICAgICAgIGNsYXNzTmFtZT17Y2xzeChcbiAgICAgICAgICAgICAgICBjbGFzc2VzLm1vZGFsQ2hpbGRyZW5Db250YWluZXIsXG4gICAgICAgICAgICAgICAgY2xhc3Nlcy52ZXJ0aWNhbFBhZGRpbmcsXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgW2NsYXNzZXMuY29udGVudFNpemUwXTogc2l6ZSA9PT0gMCxcbiAgICAgICAgICAgICAgICAgIFtjbGFzc2VzLmNvbnRlbnRTaXplMV06IHNpemUgPT09IDEsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBjb250ZW50Q2xhc3NOYW1lXG4gICAgICAgICAgICAgICl9XG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIHtjaGlsZHJlbn1cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICl9XG4gICAgICAgICAgeyEhYWN0aW9ucyAmJiAoXG4gICAgICAgICAgICA8TW9kYWxBY3Rpb25zXG4gICAgICAgICAgICAgIGNsYXNzTmFtZT17Y2xzeChjbGFzc2VzLm1vZGFsQWN0aW9ucywgY2xhc3Nlcy52ZXJ0aWNhbFBhZGRpbmcpfVxuICAgICAgICAgICAgICBqdXN0aWZ5PXtqdXN0aWZ5QWN0aW9uc31cbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAge2FjdGlvbnN9XG4gICAgICAgICAgICA8L01vZGFsQWN0aW9ucz5cbiAgICAgICAgICApfVxuICAgICAgICA8L0NvbmRpdGlvbmFsV3JhcHBlcj5cbiAgICAgIDwvbW90aW9uLmRpdj5cbiAgICApO1xuICB9XG4pO1xuXG5jb25zdCBGdWxsU2NyZWVuQ29udGVudCA9IFJlYWN0LmZvcndhcmRSZWY8SFRNTERpdkVsZW1lbnQsIE1vZGFsUHJvcHM+KFxuICAoXG4gICAge1xuICAgICAgY2hpbGRyZW4sXG4gICAgICBjbGFzc05hbWUsXG4gICAgICBjb250ZW50Q2xhc3NOYW1lLFxuICAgICAgb25DbGljayxcbiAgICAgIG9uRGlzbWlzcyxcbiAgICAgIHRpdGxlLFxuICAgICAgY3VzdG9tSGVhZGVyLFxuICAgICAgLi4ucm9vdFByb3BzXG4gICAgfSxcbiAgICByZWZcbiAgKSA9PiB7XG4gICAgY29uc3QgY2xhc3NlcyA9IHVzZVN0eWxlcyh7fSk7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPG1vdGlvbi5kaXZcbiAgICAgICAgY2xhc3NOYW1lPXtjbHN4KGNsYXNzZXMuY29udGVudEZ1bGxTY3JlZW4sIGNsYXNzTmFtZSl9XG4gICAgICAgIHJvbGU9XCJkaWFsb2dcIlxuICAgICAgICBhcmlhLW1vZGFsPVwidHJ1ZVwiXG4gICAgICAgIGFyaWEtZGVzY3JpYmVkYnk9e2FyaWFEZXNjcmliZWRCeX1cbiAgICAgICAgYXJpYS1sYWJlbGxlZGJ5PXthcmlhTGFiZWxsZWRCeX1cbiAgICAgICAgdGFiSW5kZXg9ey0xfVxuICAgICAgICBvbkNsaWNrPXt3cmFwRXZlbnQob25DbGljaywgKGV2ZW50OiBhbnkpID0+IHtcbiAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgfSl9XG4gICAgICAgIHJlZj17cmVmfVxuICAgICAgICBpbml0aWFsPXt7IG9wYWNpdHk6IDAgfX1cbiAgICAgICAgYW5pbWF0ZT17e1xuICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgICAgdHJhbnNpdGlvbjogeyBkdXJhdGlvbjogMC4xLCBlYXNlOiBbMC4xNiwgMSwgMC4zLCAxXSB9LCAvLyBodHRwczovL2Vhc2luZ3MubmV0LyNlYXNlT3V0RXhwb1xuICAgICAgICB9fVxuICAgICAgICBleGl0PXt7XG4gICAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgICB0cmFuc2l0aW9uOiB7IGR1cmF0aW9uOiAwLjA4LCBlYXNlOiBbMC43LCAwLCAwLjg0LCAwXSB9LFxuICAgICAgICB9fSAvLyBodHRwczovL2Vhc2luZ3MubmV0LyNlYXNlSW5FeHBvXG4gICAgICAgIHsuLi5yb290UHJvcHN9XG4gICAgICA+XG4gICAgICAgIHtjdXN0b21IZWFkZXIgPyAoXG4gICAgICAgICAgY3VzdG9tSGVhZGVyXG4gICAgICAgICkgOiAoXG4gICAgICAgICAgPGRpdiBpZD17YXJpYUxhYmVsbGVkQnl9IGNsYXNzTmFtZT17Y2xhc3Nlcy5tb2RhbEhlYWRlckZ1bGxTY3JlZW59PlxuICAgICAgICAgICAgeyEhdGl0bGUgJiYgPFRleHQgc2l6ZT1cInN1YmJvZHlcIj57dGl0bGV9PC9UZXh0Pn1cbiAgICAgICAgICAgIDxJY29uQnV0dG9uXG4gICAgICAgICAgICAgIGFyaWEtbGFiZWw9XCJDbG9zZSBvcGVuIG1vZGFsXCJcbiAgICAgICAgICAgICAgaWNvbj17WH1cbiAgICAgICAgICAgICAgc2l6ZT17MH1cbiAgICAgICAgICAgICAgdGFiSW5kZXg9ezB9XG4gICAgICAgICAgICAgIG9uQ2xpY2s9e29uRGlzbWlzc31cbiAgICAgICAgICAgICAgcGFkZGluZ1JpZ2h0PXswfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgKX1cbiAgICAgICAgPGRpdlxuICAgICAgICAgIGlkPXthcmlhRGVzY3JpYmVkQnl9XG4gICAgICAgICAgY2xhc3NOYW1lPXtjbHN4KFxuICAgICAgICAgICAgY2xhc3Nlcy5tb2RhbENoaWxkcmVuQ29udGFpbmVyRnVsbFNjcmVlbixcbiAgICAgICAgICAgIGNvbnRlbnRDbGFzc05hbWVcbiAgICAgICAgICApfVxuICAgICAgICA+XG4gICAgICAgICAge2NoaWxkcmVufVxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvbW90aW9uLmRpdj5cbiAgICApO1xuICB9XG4pO1xuXG5leHBvcnQgY29uc3QgTW9kYWwgPSBSZWFjdC5mb3J3YXJkUmVmPEhUTUxEaXZFbGVtZW50LCBNb2RhbFByb3BzPihcbiAgKFxuICAgIHtcbiAgICAgIGFsbG93UGluY2hab29tLFxuICAgICAgaXNGdWxsU2NyZWVuLFxuICAgICAgaXNPcGVuLFxuICAgICAgb25EaXNtaXNzLFxuICAgICAgZGlzYWJsZURpc21pc3NPbkNsaWNrT3V0c2lkZSxcbiAgICAgIHNpemUgPSAwLFxuICAgICAgb3ZlcmxheUNsYXNzTmFtZSxcbiAgICAgIC4uLnJvb3RQcm9wc1xuICAgIH0sXG4gICAgcmVmXG4gICkgPT4ge1xuICAgIGNvbnN0IG93blJlZiA9IFJlYWN0LnVzZVJlZihudWxsKTtcblxuICAgIC8vIElmIGEgcmVmIGlzIGZvcndhcmRlZCwgdXNlIGl0OyBvdGhlcndpc2UsIHVzZSBvdXJzZWx2ZXMgYXMgdGhlIHJlZlxuICAgIGNvbnN0IHRoaXNSZWYgPSByZWYgfHwgb3duUmVmO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxBbmltYXRlUHJlc2VuY2U+XG4gICAgICAgIHtpc09wZW4gPyAoXG4gICAgICAgICAgPE92ZXJsYXlcbiAgICAgICAgICAgIG92ZXJsYXlDbGFzc05hbWU9e292ZXJsYXlDbGFzc05hbWV9XG4gICAgICAgICAgICBhbGxvd1BpbmNoWm9vbT17YWxsb3dQaW5jaFpvb219XG4gICAgICAgICAgICBpc09wZW49e2lzT3Blbn1cbiAgICAgICAgICAgIG9uRGlzbWlzcz17b25EaXNtaXNzfVxuICAgICAgICAgICAgZGlzYWJsZURpc21pc3NPbkNsaWNrT3V0c2lkZT17ZGlzYWJsZURpc21pc3NPbkNsaWNrT3V0c2lkZX1cbiAgICAgICAgICA+XG4gICAgICAgICAgICB7aXNGdWxsU2NyZWVuID8gKFxuICAgICAgICAgICAgICA8RnVsbFNjcmVlbkNvbnRlbnRcbiAgICAgICAgICAgICAgICByZWY9e3RoaXNSZWZ9XG4gICAgICAgICAgICAgICAgc2l6ZT17c2l6ZX1cbiAgICAgICAgICAgICAgICBvbkRpc21pc3M9e29uRGlzbWlzc31cbiAgICAgICAgICAgICAgICB7Li4ucm9vdFByb3BzfVxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgKSA6IChcbiAgICAgICAgICAgICAgPENvbnRlbnRcbiAgICAgICAgICAgICAgICByZWY9e3RoaXNSZWZ9XG4gICAgICAgICAgICAgICAgc2l6ZT17c2l6ZX1cbiAgICAgICAgICAgICAgICBvbkRpc21pc3M9e29uRGlzbWlzc31cbiAgICAgICAgICAgICAgICB7Li4ucm9vdFByb3BzfVxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgKX1cbiAgICAgICAgICA8L092ZXJsYXk+XG4gICAgICAgICkgOiBudWxsfVxuICAgICAgPC9BbmltYXRlUHJlc2VuY2U+XG4gICAgKTtcbiAgfVxuKTtcbiJdfQ==