"use strict";
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];
    result["default"] = mod;
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
var clsx_1 = __importDefault(require("clsx"));
var React = __importStar(require("react"));
var react_router_dom_1 = require("react-router-dom");
var chromicons_1 = require("@lifeomic/chromicons");
var index_1 = require("../../styles/index");
var LayoutManager_1 = require("../LayoutManager");
var Pill_1 = require("../Pill");
var Text_1 = require("../Text");
var Tooltip_1 = require("../Tooltip");
var common_1 = require("./_private/common");
var NavOrExternalLink_1 = require("./_private/NavOrExternalLink");
var framer_motion_1 = require("framer-motion");
exports.PrimaryNavigationExpansionItemStylesKey = 'ChromaPrimaryNavigationExpansionItem';
exports.useStyles = index_1.makeStyles(function (theme) { return ({
    root: {
        listStyle: 'none',
        padding: 0,
        margin: 0,
        position: 'relative',
    },
    rootOpen: {
        backgroundColor: 'var(--link-active-bg)',
        maxHeight: 'inherit',
        paddingBottom: theme.spacing(1),
        fallbacks: {
            backgroundColor: theme.palette.action.active,
        },
    },
    sidebarCollapsed: {
        paddingBottom: 0,
    },
    link: {
        display: 'flex',
        alignItems: 'center',
        height: theme.pxToRem(47),
        color: 'inherit',
        textDecoration: 'none',
        transition: 'color 0.5s ease, opacity 0.5s ease',
        '&:hover': {
            color: 'var(--link-hover)',
            textDecoration: 'none',
            fallbacks: {
                color: 'inherit',
            },
        },
    },
    linkActive: {
        color: 'var(--link-active)',
        '&:hover': {
            color: 'var(--link-active)',
            opacity: 0.75,
        },
        fallbacks: {
            color: theme.palette.primary[300],
        },
    },
    icon: {
        width: LayoutManager_1.sideBarWidthCollapsed,
        flexShrink: 0,
        display: 'flex',
        alignItems: 'center',
        maxWidth: 60,
        outline: 'none',
        justifyContent: 'center',
    },
    label: {
        alignSelf: 'center',
        color: 'inherit',
        flex: 1,
        letterSpacing: 0.15,
        lineHeight: 'unset',
        overflowX: 'hidden',
        paddingRight: theme.spacing(2.25),
        textOverflow: 'ellipsis',
        whiteSpace: 'nowrap',
    },
    labelBeta: {
        justifyContent: 'flex-start',
        maxWidth: 120,
        paddingRight: 0,
    },
    plusIcon: {
        color: 'inherit',
        justifySelf: 'flex-end',
        marginRight: theme.spacing(2),
        position: 'absolute',
        right: 0,
    },
    hidden: {
        display: 'none',
    },
    content: {
        maxHeight: 0,
        overflow: 'hidden',
        transition: 'max-height 0.25s ease-in-out',
    },
    inner: {
        display: 'flex',
        flexDirection: 'column',
        backgroundColor: 'inherit',
        width: '100%',
        height: '100%',
        visibility: 'visible',
    },
    innerHidden: {
        visibility: 'hidden',
    },
    innerUl: {
        margin: theme.spacing(-1, 0, 0),
        padding: 0,
        position: 'relative',
    },
    beta: {
        margin: theme.spacing(0.125, 1, 0),
        position: 'absolute',
        right: theme.spacing(4),
        transform: 'scale(0.75)',
    },
}); }, { name: exports.PrimaryNavigationExpansionItemStylesKey });
var BASE_TRANSITION_VARIANTS = {
    hide: { opacity: 0, x: 16, transition: { ease: 'easeIn' } },
    show: { opacity: 1, x: 0, transition: { ease: 'easeOut' } },
};
exports.PrimaryNavigationExpansionItem = React.forwardRef(function (_a, ref) {
    var _b;
    var rootParentPath = _a.rootParentPath, exact = _a.exact, icon = _a.icon, label = _a.label, beta = _a.beta, betaLabelText = _a.betaLabelText, to = _a.to, children = _a.children, className = _a.className, additionalClasses = _a.classes, rootProps = __rest(_a, ["rootParentPath", "exact", "icon", "label", "beta", "betaLabelText", "to", "children", "className", "classes"]);
    var classes = exports.useStyles({ classes: additionalClasses });
    var isSidebarCollapsed = LayoutManager_1.useLayoutManager().isSidebarCollapsed;
    var location = react_router_dom_1.useLocation();
    var innerRef = React.useRef(null);
    var _c = React.useState(0), contentHeight = _c[0], setContentHeight = _c[1];
    var isExpanded = React.useMemo(function () { return location.pathname.startsWith(rootParentPath); }, [location, rootParentPath]);
    React.useEffect(function () {
        if (innerRef && innerRef.current && children) {
            setContentHeight(innerRef.current.scrollHeight);
        }
    }, [children, (_b = innerRef === null || innerRef === void 0 ? void 0 : innerRef.current) === null || _b === void 0 ? void 0 : _b.scrollHeight]);
    return (React.createElement(framer_motion_1.motion.li, __assign({ ref: ref, className: clsx_1.default(classes.root, isExpanded && classes.rootOpen, isSidebarCollapsed && classes.sidebarCollapsed, className) }, rootProps),
        React.createElement(NavOrExternalLink_1.NavOrExternalLink, { exact: exact, className: classes.link, activeClassName: classes.linkActive, to: to },
            isSidebarCollapsed ? (React.createElement(Tooltip_1.Tooltip, { title: label, placement: "right", gutter: -4 },
                React.createElement("div", { className: classes.icon }, icon))) : (React.createElement("div", { className: classes.icon }, icon)),
            React.createElement(framer_motion_1.motion.div, { variants: BASE_TRANSITION_VARIANTS },
                React.createElement(Text_1.Text, { size: "subbody", className: clsx_1.default(classes.label, beta && classes.labelBeta, className) }, label)),
            beta && !isSidebarCollapsed && (React.createElement(Pill_1.Pill, { variant: "highlight", label: betaLabelText, className: classes.beta, initial: common_1.BETA_INITIAL_TRANSITION, animate: common_1.BETA_ANIMATE_TRANSITION, exit: common_1.BETA_EXIT_TRANSITION })),
            !isSidebarCollapsed && (React.createElement(framer_motion_1.motion.span, { className: clsx_1.default(classes.plusIcon, isExpanded && classes.hidden), initial: common_1.PLUS_INITIAL_TRANSITION, animate: common_1.PLUS_ANIMATE_TRANSITION, exit: common_1.PLUS_EXIT_TRANSITION, role: "presentation" },
                React.createElement(chromicons_1.Plus, { "aria-hidden": "true", width: 18, height: 18 })))),
        React.createElement(framer_motion_1.motion.div, { "aria-hidden": !isExpanded, className: clsx_1.default(classes.content), style: { maxHeight: isExpanded ? contentHeight : 0 } },
            React.createElement("div", { ref: innerRef, className: clsx_1.default(classes.inner, !isExpanded && classes.innerHidden) },
                React.createElement(framer_motion_1.motion.ul, { className: classes.innerUl }, children)))));
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUHJpbWFyeU5hdmlnYXRpb25FeHBhbnNpb25JdGVtLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvUHJpbWFyeU5hdmlnYXRpb24vUHJpbWFyeU5hdmlnYXRpb25FeHBhbnNpb25JdGVtLnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsOENBQXdCO0FBQ3hCLDJDQUErQjtBQUMvQixxREFBNkQ7QUFDN0QsbURBQTRDO0FBQzVDLDRDQUFnRDtBQUVoRCxrREFBMkU7QUFDM0UsZ0NBQStCO0FBQy9CLGdDQUErQjtBQUMvQixzQ0FBcUM7QUFDckMsNENBTzJCO0FBQzNCLGtFQUFpRTtBQUNqRSwrQ0FBOEQ7QUFFakQsUUFBQSx1Q0FBdUMsR0FDbEQsc0NBQXNDLENBQUM7QUFFNUIsUUFBQSxTQUFTLEdBQUcsa0JBQVUsQ0FDakMsVUFBQyxLQUFLLElBQUssT0FBQSxDQUFDO0lBQ1YsSUFBSSxFQUFFO1FBQ0osU0FBUyxFQUFFLE1BQU07UUFDakIsT0FBTyxFQUFFLENBQUM7UUFDVixNQUFNLEVBQUUsQ0FBQztRQUNULFFBQVEsRUFBRSxVQUFVO0tBQ3JCO0lBQ0QsUUFBUSxFQUFFO1FBQ1IsZUFBZSxFQUFFLHVCQUF1QjtRQUN4QyxTQUFTLEVBQUUsU0FBUztRQUNwQixhQUFhLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7UUFDL0IsU0FBUyxFQUFFO1lBQ1QsZUFBZSxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLE1BQU07U0FDN0M7S0FDRjtJQUNELGdCQUFnQixFQUFFO1FBQ2hCLGFBQWEsRUFBRSxDQUFDO0tBQ2pCO0lBQ0QsSUFBSSxFQUFFO1FBQ0osT0FBTyxFQUFFLE1BQU07UUFDZixVQUFVLEVBQUUsUUFBUTtRQUNwQixNQUFNLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7UUFDekIsS0FBSyxFQUFFLFNBQVM7UUFDaEIsY0FBYyxFQUFFLE1BQU07UUFDdEIsVUFBVSxFQUFFLG9DQUFvQztRQUNoRCxTQUFTLEVBQUU7WUFDVCxLQUFLLEVBQUUsbUJBQW1CO1lBQzFCLGNBQWMsRUFBRSxNQUFNO1lBQ3RCLFNBQVMsRUFBRTtnQkFDVCxLQUFLLEVBQUUsU0FBUzthQUNqQjtTQUNGO0tBQ0Y7SUFDRCxVQUFVLEVBQUU7UUFDVixLQUFLLEVBQUUsb0JBQW9CO1FBQzNCLFNBQVMsRUFBRTtZQUNULEtBQUssRUFBRSxvQkFBb0I7WUFDM0IsT0FBTyxFQUFFLElBQUk7U0FDZDtRQUNELFNBQVMsRUFBRTtZQUNULEtBQUssRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUM7U0FDbEM7S0FDRjtJQUNELElBQUksRUFBRTtRQUNKLEtBQUssRUFBRSxxQ0FBcUI7UUFDNUIsVUFBVSxFQUFFLENBQUM7UUFDYixPQUFPLEVBQUUsTUFBTTtRQUNmLFVBQVUsRUFBRSxRQUFRO1FBQ3BCLFFBQVEsRUFBRSxFQUFFO1FBQ1osT0FBTyxFQUFFLE1BQU07UUFDZixjQUFjLEVBQUUsUUFBUTtLQUN6QjtJQUNELEtBQUssRUFBRTtRQUNMLFNBQVMsRUFBRSxRQUFRO1FBQ25CLEtBQUssRUFBRSxTQUFTO1FBQ2hCLElBQUksRUFBRSxDQUFDO1FBQ1AsYUFBYSxFQUFFLElBQUk7UUFDbkIsVUFBVSxFQUFFLE9BQU87UUFDbkIsU0FBUyxFQUFFLFFBQVE7UUFDbkIsWUFBWSxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDO1FBQ2pDLFlBQVksRUFBRSxVQUFVO1FBQ3hCLFVBQVUsRUFBRSxRQUFRO0tBQ3JCO0lBQ0QsU0FBUyxFQUFFO1FBQ1QsY0FBYyxFQUFFLFlBQVk7UUFDNUIsUUFBUSxFQUFFLEdBQUc7UUFDYixZQUFZLEVBQUUsQ0FBQztLQUNoQjtJQUNELFFBQVEsRUFBRTtRQUNSLEtBQUssRUFBRSxTQUFTO1FBQ2hCLFdBQVcsRUFBRSxVQUFVO1FBQ3ZCLFdBQVcsRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztRQUM3QixRQUFRLEVBQUUsVUFBVTtRQUNwQixLQUFLLEVBQUUsQ0FBQztLQUNUO0lBQ0QsTUFBTSxFQUFFO1FBQ04sT0FBTyxFQUFFLE1BQU07S0FDaEI7SUFDRCxPQUFPLEVBQUU7UUFDUCxTQUFTLEVBQUUsQ0FBQztRQUNaLFFBQVEsRUFBRSxRQUFRO1FBQ2xCLFVBQVUsRUFBRSw4QkFBOEI7S0FDM0M7SUFDRCxLQUFLLEVBQUU7UUFDTCxPQUFPLEVBQUUsTUFBTTtRQUNmLGFBQWEsRUFBRSxRQUFRO1FBQ3ZCLGVBQWUsRUFBRSxTQUFTO1FBQzFCLEtBQUssRUFBRSxNQUFNO1FBQ2IsTUFBTSxFQUFFLE1BQU07UUFDZCxVQUFVLEVBQUUsU0FBUztLQUN0QjtJQUNELFdBQVcsRUFBRTtRQUNYLFVBQVUsRUFBRSxRQUFRO0tBQ3JCO0lBQ0QsT0FBTyxFQUFFO1FBQ1AsTUFBTSxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUMvQixPQUFPLEVBQUUsQ0FBQztRQUNWLFFBQVEsRUFBRSxVQUFVO0tBQ3JCO0lBQ0QsSUFBSSxFQUFFO1FBQ0osTUFBTSxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDbEMsUUFBUSxFQUFFLFVBQVU7UUFDcEIsS0FBSyxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1FBQ3ZCLFNBQVMsRUFBRSxhQUFhO0tBQ3pCO0NBQ0YsQ0FBQyxFQXpHUyxDQXlHVCxFQUNGLEVBQUUsSUFBSSxFQUFFLCtDQUF1QyxFQUFFLENBQ2xELENBQUM7QUFFRixJQUFNLHdCQUF3QixHQUFhO0lBQ3pDLElBQUksRUFBRSxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxVQUFVLEVBQUUsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLEVBQUU7SUFDM0QsSUFBSSxFQUFFLEVBQUUsT0FBTyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLFVBQVUsRUFBRSxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsRUFBRTtDQUM1RCxDQUFDO0FBb0JXLFFBQUEsOEJBQThCLEdBQUcsS0FBSyxDQUFDLFVBQVUsQ0FJNUQsVUFDRSxFQVlDLEVBQ0QsR0FBRzs7SUFaRCxJQUFBLGtDQUFjLEVBQ2QsZ0JBQUssRUFDTCxjQUFJLEVBQ0osZ0JBQUssRUFDTCxjQUFJLEVBQ0osZ0NBQWEsRUFDYixVQUFFLEVBQ0Ysc0JBQVEsRUFDUix3QkFBUyxFQUNULDhCQUEwQixFQUMxQix1SUFBWTtJQUlkLElBQU0sT0FBTyxHQUFHLGlCQUFTLENBQUMsRUFBRSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsQ0FBQyxDQUFDO0lBQ2xELElBQUEsMEVBQWtCLENBQXdCO0lBQ2xELElBQU0sUUFBUSxHQUFHLDhCQUFXLEVBQUUsQ0FBQztJQUUvQixJQUFNLFFBQVEsR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFpQixJQUFJLENBQUMsQ0FBQztJQUM5QyxJQUFBLHNCQUE2RCxFQUE1RCxxQkFBYSxFQUFFLHdCQUE2QyxDQUFDO0lBQ3BFLElBQU0sVUFBVSxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQzlCLGNBQU0sT0FBQSxRQUFRLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxjQUFjLENBQUMsRUFBNUMsQ0FBNEMsRUFDbEQsQ0FBQyxRQUFRLEVBQUUsY0FBYyxDQUFDLENBQzNCLENBQUM7SUFFRixLQUFLLENBQUMsU0FBUyxDQUFDO1FBQ2QsSUFBSSxRQUFRLElBQUksUUFBUSxDQUFDLE9BQU8sSUFBSSxRQUFRLEVBQUU7WUFDNUMsZ0JBQWdCLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQztTQUNqRDtJQUNILENBQUMsRUFBRSxDQUFDLFFBQVEsUUFBRSxRQUFRLGFBQVIsUUFBUSx1QkFBUixRQUFRLENBQUUsT0FBTywwQ0FBRSxZQUFZLENBQUMsQ0FBQyxDQUFDO0lBRWhELE9BQU8sQ0FDTCxvQkFBQyxzQkFBTSxDQUFDLEVBQUUsYUFDUixHQUFHLEVBQUUsR0FBRyxFQUNSLFNBQVMsRUFBRSxjQUFJLENBQ2IsT0FBTyxDQUFDLElBQUksRUFDWixVQUFVLElBQUksT0FBTyxDQUFDLFFBQVEsRUFDOUIsa0JBQWtCLElBQUksT0FBTyxDQUFDLGdCQUFnQixFQUM5QyxTQUFTLENBQ1YsSUFDRyxTQUFTO1FBRWIsb0JBQUMscUNBQWlCLElBQ2hCLEtBQUssRUFBRSxLQUFLLEVBQ1osU0FBUyxFQUFFLE9BQU8sQ0FBQyxJQUFJLEVBQ3ZCLGVBQWUsRUFBRSxPQUFPLENBQUMsVUFBVSxFQUNuQyxFQUFFLEVBQUUsRUFBRTtZQUVMLGtCQUFrQixDQUFDLENBQUMsQ0FBQyxDQUNwQixvQkFBQyxpQkFBTyxJQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFDLE9BQU8sRUFBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDO2dCQUNqRCw2QkFBSyxTQUFTLEVBQUUsT0FBTyxDQUFDLElBQUksSUFBRyxJQUFJLENBQU8sQ0FDbEMsQ0FDWCxDQUFDLENBQUMsQ0FBQyxDQUNGLDZCQUFLLFNBQVMsRUFBRSxPQUFPLENBQUMsSUFBSSxJQUFHLElBQUksQ0FBTyxDQUMzQztZQUNELG9CQUFDLHNCQUFNLENBQUMsR0FBRyxJQUFDLFFBQVEsRUFBRSx3QkFBd0I7Z0JBQzVDLG9CQUFDLFdBQUksSUFDSCxJQUFJLEVBQUMsU0FBUyxFQUNkLFNBQVMsRUFBRSxjQUFJLENBQ2IsT0FBTyxDQUFDLEtBQUssRUFDYixJQUFJLElBQUksT0FBTyxDQUFDLFNBQVMsRUFDekIsU0FBUyxDQUNWLElBRUEsS0FBSyxDQUNELENBQ0k7WUFDWixJQUFJLElBQUksQ0FBQyxrQkFBa0IsSUFBSSxDQUM5QixvQkFBQyxXQUFJLElBQ0gsT0FBTyxFQUFDLFdBQVcsRUFDbkIsS0FBSyxFQUFFLGFBQWEsRUFDcEIsU0FBUyxFQUFFLE9BQU8sQ0FBQyxJQUFJLEVBQ3ZCLE9BQU8sRUFBRSxnQ0FBdUIsRUFDaEMsT0FBTyxFQUFFLGdDQUF1QixFQUNoQyxJQUFJLEVBQUUsNkJBQW9CLEdBQzFCLENBQ0g7WUFDQSxDQUFDLGtCQUFrQixJQUFJLENBQ3RCLG9CQUFDLHNCQUFNLENBQUMsSUFBSSxJQUNWLFNBQVMsRUFBRSxjQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFBRSxVQUFVLElBQUksT0FBTyxDQUFDLE1BQU0sQ0FBQyxFQUMvRCxPQUFPLEVBQUUsZ0NBQXVCLEVBQ2hDLE9BQU8sRUFBRSxnQ0FBdUIsRUFDaEMsSUFBSSxFQUFFLDZCQUFvQixFQUMxQixJQUFJLEVBQUMsY0FBYztnQkFFbkIsb0JBQUMsaUJBQUksbUJBQWEsTUFBTSxFQUFDLEtBQUssRUFBRSxFQUFFLEVBQUUsTUFBTSxFQUFFLEVBQUUsR0FBSSxDQUN0QyxDQUNmLENBQ2lCO1FBQ3BCLG9CQUFDLHNCQUFNLENBQUMsR0FBRyxtQkFDSSxDQUFDLFVBQVUsRUFDeEIsU0FBUyxFQUFFLGNBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQ2hDLEtBQUssRUFBRSxFQUFFLFNBQVMsRUFBRSxVQUFVLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFO1lBRXBELDZCQUNFLEdBQUcsRUFBRSxRQUFRLEVBQ2IsU0FBUyxFQUFFLGNBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUMsVUFBVSxJQUFJLE9BQU8sQ0FBQyxXQUFXLENBQUM7Z0JBRWxFLG9CQUFDLHNCQUFNLENBQUMsRUFBRSxJQUFDLFNBQVMsRUFBRSxPQUFPLENBQUMsT0FBTyxJQUFHLFFBQVEsQ0FBYSxDQUN6RCxDQUNLLENBQ0gsQ0FDYixDQUFDO0FBQ0osQ0FBQyxDQUNGLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgY2xzeCBmcm9tICdjbHN4JztcbmltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IE5hdkxpbmtQcm9wcywgdXNlTG9jYXRpb24gfSBmcm9tICdyZWFjdC1yb3V0ZXItZG9tJztcbmltcG9ydCB7IFBsdXMgfSBmcm9tICdAbGlmZW9taWMvY2hyb21pY29ucyc7XG5pbXBvcnQgeyBtYWtlU3R5bGVzIH0gZnJvbSAnLi4vLi4vc3R5bGVzL2luZGV4JztcbmltcG9ydCB7IEdldENsYXNzZXMsIFN0YW5kYXJkUHJvcHMgfSBmcm9tICcuLi8uLi90eXBlVXRpbHMnO1xuaW1wb3J0IHsgc2lkZUJhcldpZHRoQ29sbGFwc2VkLCB1c2VMYXlvdXRNYW5hZ2VyIH0gZnJvbSAnLi4vTGF5b3V0TWFuYWdlcic7XG5pbXBvcnQgeyBQaWxsIH0gZnJvbSAnLi4vUGlsbCc7XG5pbXBvcnQgeyBUZXh0IH0gZnJvbSAnLi4vVGV4dCc7XG5pbXBvcnQgeyBUb29sdGlwIH0gZnJvbSAnLi4vVG9vbHRpcCc7XG5pbXBvcnQge1xuICBCRVRBX0lOSVRJQUxfVFJBTlNJVElPTixcbiAgQkVUQV9BTklNQVRFX1RSQU5TSVRJT04sXG4gIEJFVEFfRVhJVF9UUkFOU0lUSU9OLFxuICBQTFVTX0lOSVRJQUxfVFJBTlNJVElPTixcbiAgUExVU19BTklNQVRFX1RSQU5TSVRJT04sXG4gIFBMVVNfRVhJVF9UUkFOU0lUSU9OLFxufSBmcm9tICcuL19wcml2YXRlL2NvbW1vbic7XG5pbXBvcnQgeyBOYXZPckV4dGVybmFsTGluayB9IGZyb20gJy4vX3ByaXZhdGUvTmF2T3JFeHRlcm5hbExpbmsnO1xuaW1wb3J0IHsgbW90aW9uLCBNb3Rpb25Qcm9wcywgVmFyaWFudHMgfSBmcm9tICdmcmFtZXItbW90aW9uJztcblxuZXhwb3J0IGNvbnN0IFByaW1hcnlOYXZpZ2F0aW9uRXhwYW5zaW9uSXRlbVN0eWxlc0tleSA9XG4gICdDaHJvbWFQcmltYXJ5TmF2aWdhdGlvbkV4cGFuc2lvbkl0ZW0nO1xuXG5leHBvcnQgY29uc3QgdXNlU3R5bGVzID0gbWFrZVN0eWxlcyhcbiAgKHRoZW1lKSA9PiAoe1xuICAgIHJvb3Q6IHtcbiAgICAgIGxpc3RTdHlsZTogJ25vbmUnLFxuICAgICAgcGFkZGluZzogMCxcbiAgICAgIG1hcmdpbjogMCxcbiAgICAgIHBvc2l0aW9uOiAncmVsYXRpdmUnLFxuICAgIH0sXG4gICAgcm9vdE9wZW46IHtcbiAgICAgIGJhY2tncm91bmRDb2xvcjogJ3ZhcigtLWxpbmstYWN0aXZlLWJnKScsXG4gICAgICBtYXhIZWlnaHQ6ICdpbmhlcml0JyxcbiAgICAgIHBhZGRpbmdCb3R0b206IHRoZW1lLnNwYWNpbmcoMSksXG4gICAgICBmYWxsYmFja3M6IHtcbiAgICAgICAgYmFja2dyb3VuZENvbG9yOiB0aGVtZS5wYWxldHRlLmFjdGlvbi5hY3RpdmUsXG4gICAgICB9LFxuICAgIH0sXG4gICAgc2lkZWJhckNvbGxhcHNlZDoge1xuICAgICAgcGFkZGluZ0JvdHRvbTogMCxcbiAgICB9LFxuICAgIGxpbms6IHtcbiAgICAgIGRpc3BsYXk6ICdmbGV4JyxcbiAgICAgIGFsaWduSXRlbXM6ICdjZW50ZXInLFxuICAgICAgaGVpZ2h0OiB0aGVtZS5weFRvUmVtKDQ3KSxcbiAgICAgIGNvbG9yOiAnaW5oZXJpdCcsXG4gICAgICB0ZXh0RGVjb3JhdGlvbjogJ25vbmUnLFxuICAgICAgdHJhbnNpdGlvbjogJ2NvbG9yIDAuNXMgZWFzZSwgb3BhY2l0eSAwLjVzIGVhc2UnLFxuICAgICAgJyY6aG92ZXInOiB7XG4gICAgICAgIGNvbG9yOiAndmFyKC0tbGluay1ob3ZlciknLFxuICAgICAgICB0ZXh0RGVjb3JhdGlvbjogJ25vbmUnLFxuICAgICAgICBmYWxsYmFja3M6IHtcbiAgICAgICAgICBjb2xvcjogJ2luaGVyaXQnLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9LFxuICAgIGxpbmtBY3RpdmU6IHtcbiAgICAgIGNvbG9yOiAndmFyKC0tbGluay1hY3RpdmUpJyxcbiAgICAgICcmOmhvdmVyJzoge1xuICAgICAgICBjb2xvcjogJ3ZhcigtLWxpbmstYWN0aXZlKScsXG4gICAgICAgIG9wYWNpdHk6IDAuNzUsXG4gICAgICB9LFxuICAgICAgZmFsbGJhY2tzOiB7XG4gICAgICAgIGNvbG9yOiB0aGVtZS5wYWxldHRlLnByaW1hcnlbMzAwXSxcbiAgICAgIH0sXG4gICAgfSxcbiAgICBpY29uOiB7XG4gICAgICB3aWR0aDogc2lkZUJhcldpZHRoQ29sbGFwc2VkLFxuICAgICAgZmxleFNocmluazogMCxcbiAgICAgIGRpc3BsYXk6ICdmbGV4JyxcbiAgICAgIGFsaWduSXRlbXM6ICdjZW50ZXInLFxuICAgICAgbWF4V2lkdGg6IDYwLFxuICAgICAgb3V0bGluZTogJ25vbmUnLFxuICAgICAganVzdGlmeUNvbnRlbnQ6ICdjZW50ZXInLFxuICAgIH0sXG4gICAgbGFiZWw6IHtcbiAgICAgIGFsaWduU2VsZjogJ2NlbnRlcicsXG4gICAgICBjb2xvcjogJ2luaGVyaXQnLFxuICAgICAgZmxleDogMSxcbiAgICAgIGxldHRlclNwYWNpbmc6IDAuMTUsXG4gICAgICBsaW5lSGVpZ2h0OiAndW5zZXQnLFxuICAgICAgb3ZlcmZsb3dYOiAnaGlkZGVuJyxcbiAgICAgIHBhZGRpbmdSaWdodDogdGhlbWUuc3BhY2luZygyLjI1KSxcbiAgICAgIHRleHRPdmVyZmxvdzogJ2VsbGlwc2lzJyxcbiAgICAgIHdoaXRlU3BhY2U6ICdub3dyYXAnLFxuICAgIH0sXG4gICAgbGFiZWxCZXRhOiB7XG4gICAgICBqdXN0aWZ5Q29udGVudDogJ2ZsZXgtc3RhcnQnLFxuICAgICAgbWF4V2lkdGg6IDEyMCxcbiAgICAgIHBhZGRpbmdSaWdodDogMCxcbiAgICB9LFxuICAgIHBsdXNJY29uOiB7XG4gICAgICBjb2xvcjogJ2luaGVyaXQnLFxuICAgICAganVzdGlmeVNlbGY6ICdmbGV4LWVuZCcsXG4gICAgICBtYXJnaW5SaWdodDogdGhlbWUuc3BhY2luZygyKSxcbiAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLFxuICAgICAgcmlnaHQ6IDAsXG4gICAgfSxcbiAgICBoaWRkZW46IHtcbiAgICAgIGRpc3BsYXk6ICdub25lJyxcbiAgICB9LFxuICAgIGNvbnRlbnQ6IHtcbiAgICAgIG1heEhlaWdodDogMCxcbiAgICAgIG92ZXJmbG93OiAnaGlkZGVuJyxcbiAgICAgIHRyYW5zaXRpb246ICdtYXgtaGVpZ2h0IDAuMjVzIGVhc2UtaW4tb3V0JyxcbiAgICB9LFxuICAgIGlubmVyOiB7XG4gICAgICBkaXNwbGF5OiAnZmxleCcsXG4gICAgICBmbGV4RGlyZWN0aW9uOiAnY29sdW1uJyxcbiAgICAgIGJhY2tncm91bmRDb2xvcjogJ2luaGVyaXQnLFxuICAgICAgd2lkdGg6ICcxMDAlJyxcbiAgICAgIGhlaWdodDogJzEwMCUnLFxuICAgICAgdmlzaWJpbGl0eTogJ3Zpc2libGUnLFxuICAgIH0sXG4gICAgaW5uZXJIaWRkZW46IHtcbiAgICAgIHZpc2liaWxpdHk6ICdoaWRkZW4nLFxuICAgIH0sXG4gICAgaW5uZXJVbDoge1xuICAgICAgbWFyZ2luOiB0aGVtZS5zcGFjaW5nKC0xLCAwLCAwKSxcbiAgICAgIHBhZGRpbmc6IDAsXG4gICAgICBwb3NpdGlvbjogJ3JlbGF0aXZlJyxcbiAgICB9LFxuICAgIGJldGE6IHtcbiAgICAgIG1hcmdpbjogdGhlbWUuc3BhY2luZygwLjEyNSwgMSwgMCksXG4gICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJyxcbiAgICAgIHJpZ2h0OiB0aGVtZS5zcGFjaW5nKDQpLFxuICAgICAgdHJhbnNmb3JtOiAnc2NhbGUoMC43NSknLFxuICAgIH0sXG4gIH0pLFxuICB7IG5hbWU6IFByaW1hcnlOYXZpZ2F0aW9uRXhwYW5zaW9uSXRlbVN0eWxlc0tleSB9XG4pO1xuXG5jb25zdCBCQVNFX1RSQU5TSVRJT05fVkFSSUFOVFM6IFZhcmlhbnRzID0ge1xuICBoaWRlOiB7IG9wYWNpdHk6IDAsIHg6IDE2LCB0cmFuc2l0aW9uOiB7IGVhc2U6ICdlYXNlSW4nIH0gfSxcbiAgc2hvdzogeyBvcGFjaXR5OiAxLCB4OiAwLCB0cmFuc2l0aW9uOiB7IGVhc2U6ICdlYXNlT3V0JyB9IH0sXG59O1xuXG5leHBvcnQgdHlwZSBQcmltYXJ5TmF2aWdhdGlvbkV4cGFuc2lvbkl0ZW1DbGFzc2VzID0gR2V0Q2xhc3NlczxcbiAgdHlwZW9mIHVzZVN0eWxlc1xuPjtcblxuZXhwb3J0IGludGVyZmFjZSBQcmltYXJ5TmF2aWdhdGlvbkV4cGFuc2lvbkl0ZW1Qcm9wc1xuICBleHRlbmRzIE9taXQ8XG4gICAgICBTdGFuZGFyZFByb3BzPEhUTUxMSUVsZW1lbnQsIFByaW1hcnlOYXZpZ2F0aW9uRXhwYW5zaW9uSXRlbUNsYXNzZXM+LFxuICAgICAgJ29uQW5pbWF0aW9uU3RhcnQnIHwgJ29uRHJhZycgfCAnb25EcmFnRW5kJyB8ICdvbkRyYWdTdGFydCcgfCAnc3R5bGUnXG4gICAgPixcbiAgICBQaWNrPE5hdkxpbmtQcm9wcywgJ2V4YWN0JyB8ICd0byc+LFxuICAgIE1vdGlvblByb3BzIHtcbiAgcm9vdFBhcmVudFBhdGg/OiBzdHJpbmc7XG4gIGxhYmVsPzogc3RyaW5nO1xuICBiZXRhPzogYm9vbGVhbjtcbiAgYmV0YUxhYmVsVGV4dD86IHN0cmluZztcbiAgaWNvbj86IFJlYWN0LlJlYWN0Tm9kZTtcbn1cblxuZXhwb3J0IGNvbnN0IFByaW1hcnlOYXZpZ2F0aW9uRXhwYW5zaW9uSXRlbSA9IFJlYWN0LmZvcndhcmRSZWY8XG4gIEhUTUxMSUVsZW1lbnQsXG4gIFByaW1hcnlOYXZpZ2F0aW9uRXhwYW5zaW9uSXRlbVByb3BzXG4+KFxuICAoXG4gICAge1xuICAgICAgcm9vdFBhcmVudFBhdGgsXG4gICAgICBleGFjdCxcbiAgICAgIGljb24sXG4gICAgICBsYWJlbCxcbiAgICAgIGJldGEsXG4gICAgICBiZXRhTGFiZWxUZXh0LFxuICAgICAgdG8sXG4gICAgICBjaGlsZHJlbixcbiAgICAgIGNsYXNzTmFtZSxcbiAgICAgIGNsYXNzZXM6IGFkZGl0aW9uYWxDbGFzc2VzLFxuICAgICAgLi4ucm9vdFByb3BzXG4gICAgfSxcbiAgICByZWZcbiAgKSA9PiB7XG4gICAgY29uc3QgY2xhc3NlcyA9IHVzZVN0eWxlcyh7IGNsYXNzZXM6IGFkZGl0aW9uYWxDbGFzc2VzIH0pO1xuICAgIGNvbnN0IHsgaXNTaWRlYmFyQ29sbGFwc2VkIH0gPSB1c2VMYXlvdXRNYW5hZ2VyKCk7XG4gICAgY29uc3QgbG9jYXRpb24gPSB1c2VMb2NhdGlvbigpO1xuXG4gICAgY29uc3QgaW5uZXJSZWYgPSBSZWFjdC51c2VSZWY8SFRNTERpdkVsZW1lbnQ+KG51bGwpO1xuICAgIGNvbnN0IFtjb250ZW50SGVpZ2h0LCBzZXRDb250ZW50SGVpZ2h0XSA9IFJlYWN0LnVzZVN0YXRlPG51bWJlcj4oMCk7XG4gICAgY29uc3QgaXNFeHBhbmRlZCA9IFJlYWN0LnVzZU1lbW8oXG4gICAgICAoKSA9PiBsb2NhdGlvbi5wYXRobmFtZS5zdGFydHNXaXRoKHJvb3RQYXJlbnRQYXRoKSxcbiAgICAgIFtsb2NhdGlvbiwgcm9vdFBhcmVudFBhdGhdXG4gICAgKTtcblxuICAgIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICBpZiAoaW5uZXJSZWYgJiYgaW5uZXJSZWYuY3VycmVudCAmJiBjaGlsZHJlbikge1xuICAgICAgICBzZXRDb250ZW50SGVpZ2h0KGlubmVyUmVmLmN1cnJlbnQuc2Nyb2xsSGVpZ2h0KTtcbiAgICAgIH1cbiAgICB9LCBbY2hpbGRyZW4sIGlubmVyUmVmPy5jdXJyZW50Py5zY3JvbGxIZWlnaHRdKTtcblxuICAgIHJldHVybiAoXG4gICAgICA8bW90aW9uLmxpXG4gICAgICAgIHJlZj17cmVmfVxuICAgICAgICBjbGFzc05hbWU9e2Nsc3goXG4gICAgICAgICAgY2xhc3Nlcy5yb290LFxuICAgICAgICAgIGlzRXhwYW5kZWQgJiYgY2xhc3Nlcy5yb290T3BlbixcbiAgICAgICAgICBpc1NpZGViYXJDb2xsYXBzZWQgJiYgY2xhc3Nlcy5zaWRlYmFyQ29sbGFwc2VkLFxuICAgICAgICAgIGNsYXNzTmFtZVxuICAgICAgICApfVxuICAgICAgICB7Li4ucm9vdFByb3BzfVxuICAgICAgPlxuICAgICAgICA8TmF2T3JFeHRlcm5hbExpbmtcbiAgICAgICAgICBleGFjdD17ZXhhY3R9XG4gICAgICAgICAgY2xhc3NOYW1lPXtjbGFzc2VzLmxpbmt9XG4gICAgICAgICAgYWN0aXZlQ2xhc3NOYW1lPXtjbGFzc2VzLmxpbmtBY3RpdmV9XG4gICAgICAgICAgdG89e3RvfVxuICAgICAgICA+XG4gICAgICAgICAge2lzU2lkZWJhckNvbGxhcHNlZCA/IChcbiAgICAgICAgICAgIDxUb29sdGlwIHRpdGxlPXtsYWJlbH0gcGxhY2VtZW50PVwicmlnaHRcIiBndXR0ZXI9ey00fT5cbiAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9e2NsYXNzZXMuaWNvbn0+e2ljb259PC9kaXY+XG4gICAgICAgICAgICA8L1Rvb2x0aXA+XG4gICAgICAgICAgKSA6IChcbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXtjbGFzc2VzLmljb259PntpY29ufTwvZGl2PlxuICAgICAgICAgICl9XG4gICAgICAgICAgPG1vdGlvbi5kaXYgdmFyaWFudHM9e0JBU0VfVFJBTlNJVElPTl9WQVJJQU5UU30+XG4gICAgICAgICAgICA8VGV4dFxuICAgICAgICAgICAgICBzaXplPVwic3ViYm9keVwiXG4gICAgICAgICAgICAgIGNsYXNzTmFtZT17Y2xzeChcbiAgICAgICAgICAgICAgICBjbGFzc2VzLmxhYmVsLFxuICAgICAgICAgICAgICAgIGJldGEgJiYgY2xhc3Nlcy5sYWJlbEJldGEsXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lXG4gICAgICAgICAgICAgICl9XG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIHtsYWJlbH1cbiAgICAgICAgICAgIDwvVGV4dD5cbiAgICAgICAgICA8L21vdGlvbi5kaXY+XG4gICAgICAgICAge2JldGEgJiYgIWlzU2lkZWJhckNvbGxhcHNlZCAmJiAoXG4gICAgICAgICAgICA8UGlsbFxuICAgICAgICAgICAgICB2YXJpYW50PVwiaGlnaGxpZ2h0XCJcbiAgICAgICAgICAgICAgbGFiZWw9e2JldGFMYWJlbFRleHR9XG4gICAgICAgICAgICAgIGNsYXNzTmFtZT17Y2xhc3Nlcy5iZXRhfVxuICAgICAgICAgICAgICBpbml0aWFsPXtCRVRBX0lOSVRJQUxfVFJBTlNJVElPTn1cbiAgICAgICAgICAgICAgYW5pbWF0ZT17QkVUQV9BTklNQVRFX1RSQU5TSVRJT059XG4gICAgICAgICAgICAgIGV4aXQ9e0JFVEFfRVhJVF9UUkFOU0lUSU9OfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICApfVxuICAgICAgICAgIHshaXNTaWRlYmFyQ29sbGFwc2VkICYmIChcbiAgICAgICAgICAgIDxtb3Rpb24uc3BhblxuICAgICAgICAgICAgICBjbGFzc05hbWU9e2Nsc3goY2xhc3Nlcy5wbHVzSWNvbiwgaXNFeHBhbmRlZCAmJiBjbGFzc2VzLmhpZGRlbil9XG4gICAgICAgICAgICAgIGluaXRpYWw9e1BMVVNfSU5JVElBTF9UUkFOU0lUSU9OfVxuICAgICAgICAgICAgICBhbmltYXRlPXtQTFVTX0FOSU1BVEVfVFJBTlNJVElPTn1cbiAgICAgICAgICAgICAgZXhpdD17UExVU19FWElUX1RSQU5TSVRJT059XG4gICAgICAgICAgICAgIHJvbGU9XCJwcmVzZW50YXRpb25cIlxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICA8UGx1cyBhcmlhLWhpZGRlbj1cInRydWVcIiB3aWR0aD17MTh9IGhlaWdodD17MTh9IC8+XG4gICAgICAgICAgICA8L21vdGlvbi5zcGFuPlxuICAgICAgICAgICl9XG4gICAgICAgIDwvTmF2T3JFeHRlcm5hbExpbms+XG4gICAgICAgIDxtb3Rpb24uZGl2XG4gICAgICAgICAgYXJpYS1oaWRkZW49eyFpc0V4cGFuZGVkfVxuICAgICAgICAgIGNsYXNzTmFtZT17Y2xzeChjbGFzc2VzLmNvbnRlbnQpfVxuICAgICAgICAgIHN0eWxlPXt7IG1heEhlaWdodDogaXNFeHBhbmRlZCA/IGNvbnRlbnRIZWlnaHQgOiAwIH19XG4gICAgICAgID5cbiAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICByZWY9e2lubmVyUmVmfVxuICAgICAgICAgICAgY2xhc3NOYW1lPXtjbHN4KGNsYXNzZXMuaW5uZXIsICFpc0V4cGFuZGVkICYmIGNsYXNzZXMuaW5uZXJIaWRkZW4pfVxuICAgICAgICAgID5cbiAgICAgICAgICAgIDxtb3Rpb24udWwgY2xhc3NOYW1lPXtjbGFzc2VzLmlubmVyVWx9PntjaGlsZHJlbn08L21vdGlvbi51bD5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9tb3Rpb24uZGl2PlxuICAgICAgPC9tb3Rpb24ubGk+XG4gICAgKTtcbiAgfVxuKTtcbiJdfQ==