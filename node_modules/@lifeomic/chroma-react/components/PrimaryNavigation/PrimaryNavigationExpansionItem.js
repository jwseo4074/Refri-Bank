"use strict";
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.PrimaryNavigationExpansionItem = exports.useStyles = exports.PrimaryNavigationExpansionItemStylesKey = void 0;
var clsx_1 = __importDefault(require("clsx"));
var React = __importStar(require("react"));
var react_router_dom_1 = require("react-router-dom");
var chromicons_1 = require("@lifeomic/chromicons");
var index_1 = require("../../styles/index");
var LayoutManager_1 = require("../LayoutManager");
var Pill_1 = require("../Pill");
var Text_1 = require("../Text");
var Tooltip_1 = require("../Tooltip");
var common_1 = require("./_private/common");
var NavOrExternalLink_1 = require("./_private/NavOrExternalLink");
var framer_motion_1 = require("framer-motion");
exports.PrimaryNavigationExpansionItemStylesKey = 'ChromaPrimaryNavigationExpansionItem';
exports.useStyles = (0, index_1.makeStyles)(function (theme) { return ({
    root: {
        listStyle: 'none',
        padding: 0,
        margin: 0,
        position: 'relative',
    },
    rootOpen: {
        backgroundColor: 'var(--link-active-bg)',
        maxHeight: 'inherit',
        paddingBottom: theme.spacing(1),
        fallbacks: {
            backgroundColor: theme.palette.action.active,
        },
    },
    sidebarCollapsed: {
        paddingBottom: 0,
    },
    link: {
        display: 'flex',
        alignItems: 'center',
        height: theme.pxToRem(47),
        color: 'inherit',
        textDecoration: 'none',
        transition: 'color 0.5s ease, opacity 0.5s ease',
        '&:hover': {
            color: 'var(--link-hover)',
            textDecoration: 'none',
            fallbacks: {
                color: 'inherit',
            },
        },
    },
    linkActive: {
        color: 'var(--link-active)',
        '&:hover': {
            color: 'var(--link-active)',
            opacity: 0.75,
        },
        fallbacks: {
            color: theme.palette.primary[300],
        },
    },
    icon: {
        width: LayoutManager_1.sideBarWidthCollapsed,
        flexShrink: 0,
        display: 'flex',
        alignItems: 'center',
        maxWidth: 60,
        outline: 'none',
        justifyContent: 'center',
    },
    label: {
        alignSelf: 'center',
        color: 'inherit',
        flex: 1,
        letterSpacing: 0.15,
        lineHeight: 'unset',
        overflowX: 'hidden',
        paddingRight: theme.spacing(2.25),
        textOverflow: 'ellipsis',
        whiteSpace: 'nowrap',
    },
    labelBeta: {
        justifyContent: 'flex-start',
        maxWidth: 120,
        paddingRight: 0,
    },
    plusIcon: {
        color: 'inherit',
        justifySelf: 'flex-end',
        marginRight: theme.spacing(2),
        position: 'absolute',
        right: 0,
    },
    hidden: {
        display: 'none',
    },
    content: {
        maxHeight: 0,
        overflow: 'hidden',
        transition: 'max-height 0.25s ease-in-out',
    },
    inner: {
        display: 'flex',
        flexDirection: 'column',
        backgroundColor: 'inherit',
        width: '100%',
        height: '100%',
        visibility: 'visible',
    },
    innerHidden: {
        visibility: 'hidden',
    },
    innerUl: {
        margin: theme.spacing(-1, 0, 0),
        padding: 0,
        position: 'relative',
    },
    beta: {
        margin: theme.spacing(0.125, 1, 0),
        position: 'absolute',
        right: theme.spacing(4),
        transform: 'scale(0.75)',
    },
}); }, { name: exports.PrimaryNavigationExpansionItemStylesKey });
var BASE_TRANSITION_VARIANTS = {
    hide: { opacity: 0, x: 16, transition: { ease: 'easeIn' } },
    show: { opacity: 1, x: 0, transition: { ease: 'easeOut' } },
};
exports.PrimaryNavigationExpansionItem = React.forwardRef(function (_a, ref) {
    var _b;
    var rootParentPath = _a.rootParentPath, exact = _a.exact, icon = _a.icon, label = _a.label, beta = _a.beta, betaLabelText = _a.betaLabelText, to = _a.to, children = _a.children, className = _a.className, additionalClasses = _a.classes, rootProps = __rest(_a, ["rootParentPath", "exact", "icon", "label", "beta", "betaLabelText", "to", "children", "className", "classes"]);
    var classes = (0, exports.useStyles)({ classes: additionalClasses });
    var isSidebarCollapsed = (0, LayoutManager_1.useLayoutManager)().isSidebarCollapsed;
    var location = (0, react_router_dom_1.useLocation)();
    var innerRef = React.useRef(null);
    var _c = React.useState(0), contentHeight = _c[0], setContentHeight = _c[1];
    var isExpanded = React.useMemo(function () { return location.pathname.startsWith(rootParentPath); }, [location, rootParentPath]);
    React.useEffect(function () {
        if (innerRef && innerRef.current && children) {
            setContentHeight(innerRef.current.scrollHeight);
        }
    }, [children, (_b = innerRef === null || innerRef === void 0 ? void 0 : innerRef.current) === null || _b === void 0 ? void 0 : _b.scrollHeight]);
    return (React.createElement(framer_motion_1.motion.li, __assign({ ref: ref, className: (0, clsx_1.default)(classes.root, isExpanded && classes.rootOpen, isSidebarCollapsed && classes.sidebarCollapsed, className) }, rootProps),
        React.createElement(NavOrExternalLink_1.NavOrExternalLink, { exact: exact, className: classes.link, activeClassName: classes.linkActive, to: to },
            isSidebarCollapsed ? (React.createElement(Tooltip_1.Tooltip, { title: label, placement: "right", gutter: -4 },
                React.createElement("div", { className: classes.icon }, icon))) : (React.createElement("div", { className: classes.icon }, icon)),
            React.createElement(framer_motion_1.motion.div, { variants: BASE_TRANSITION_VARIANTS },
                React.createElement(Text_1.Text, { size: "subbody", className: (0, clsx_1.default)(classes.label, beta && classes.labelBeta, className) }, label)),
            beta && !isSidebarCollapsed && (React.createElement(Pill_1.Pill, { variant: "highlight", label: betaLabelText, className: classes.beta, initial: common_1.BETA_INITIAL_TRANSITION, animate: common_1.BETA_ANIMATE_TRANSITION, exit: common_1.BETA_EXIT_TRANSITION })),
            !isSidebarCollapsed && (React.createElement(framer_motion_1.motion.span, { className: (0, clsx_1.default)(classes.plusIcon, isExpanded && classes.hidden), initial: common_1.PLUS_INITIAL_TRANSITION, animate: common_1.PLUS_ANIMATE_TRANSITION, exit: common_1.PLUS_EXIT_TRANSITION, role: "presentation" },
                React.createElement(chromicons_1.Plus, { "aria-hidden": "true", width: 18, height: 18 })))),
        React.createElement(framer_motion_1.motion.div, { "aria-hidden": !isExpanded, className: (0, clsx_1.default)(classes.content), style: { maxHeight: isExpanded ? contentHeight : 0 } },
            React.createElement("div", { ref: innerRef, className: (0, clsx_1.default)(classes.inner, !isExpanded && classes.innerHidden) },
                React.createElement(framer_motion_1.motion.ul, { className: classes.innerUl }, children)))));
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUHJpbWFyeU5hdmlnYXRpb25FeHBhbnNpb25JdGVtLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvUHJpbWFyeU5hdmlnYXRpb24vUHJpbWFyeU5hdmlnYXRpb25FeHBhbnNpb25JdGVtLnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSw4Q0FBd0I7QUFDeEIsMkNBQStCO0FBQy9CLHFEQUE2RDtBQUM3RCxtREFBNEM7QUFDNUMsNENBQWdEO0FBRWhELGtEQUEyRTtBQUMzRSxnQ0FBK0I7QUFDL0IsZ0NBQStCO0FBQy9CLHNDQUFxQztBQUNyQyw0Q0FPMkI7QUFDM0Isa0VBQWlFO0FBQ2pFLCtDQUE4RDtBQUVqRCxRQUFBLHVDQUF1QyxHQUNsRCxzQ0FBc0MsQ0FBQztBQUU1QixRQUFBLFNBQVMsR0FBRyxJQUFBLGtCQUFVLEVBQ2pDLFVBQUMsS0FBSyxJQUFLLE9BQUEsQ0FBQztJQUNWLElBQUksRUFBRTtRQUNKLFNBQVMsRUFBRSxNQUFNO1FBQ2pCLE9BQU8sRUFBRSxDQUFDO1FBQ1YsTUFBTSxFQUFFLENBQUM7UUFDVCxRQUFRLEVBQUUsVUFBVTtLQUNyQjtJQUNELFFBQVEsRUFBRTtRQUNSLGVBQWUsRUFBRSx1QkFBdUI7UUFDeEMsU0FBUyxFQUFFLFNBQVM7UUFDcEIsYUFBYSxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1FBQy9CLFNBQVMsRUFBRTtZQUNULGVBQWUsRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxNQUFNO1NBQzdDO0tBQ0Y7SUFDRCxnQkFBZ0IsRUFBRTtRQUNoQixhQUFhLEVBQUUsQ0FBQztLQUNqQjtJQUNELElBQUksRUFBRTtRQUNKLE9BQU8sRUFBRSxNQUFNO1FBQ2YsVUFBVSxFQUFFLFFBQVE7UUFDcEIsTUFBTSxFQUFFLEtBQUssQ0FBQyxP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LENBQ0ssQ0FDSCxDQUNiLENBQUM7QUFDSixDQUFDLENBQ0YsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBjbHN4IGZyb20gJ2Nsc3gnO1xuaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgTmF2TGlua1Byb3BzLCB1c2VMb2NhdGlvbiB9IGZyb20gJ3JlYWN0LXJvdXRlci1kb20nO1xuaW1wb3J0IHsgUGx1cyB9IGZyb20gJ0BsaWZlb21pYy9jaHJvbWljb25zJztcbmltcG9ydCB7IG1ha2VTdHlsZXMgfSBmcm9tICcuLi8uLi9zdHlsZXMvaW5kZXgnO1xuaW1wb3J0IHsgR2V0Q2xhc3NlcywgU3RhbmRhcmRQcm9wcyB9IGZyb20gJy4uLy4uL3R5cGVVdGlscyc7XG5pbXBvcnQgeyBzaWRlQmFyV2lkdGhDb2xsYXBzZWQsIHVzZUxheW91dE1hbmFnZXIgfSBmcm9tICcuLi9MYXlvdXRNYW5hZ2VyJztcbmltcG9ydCB7IFBpbGwgfSBmcm9tICcuLi9QaWxsJztcbmltcG9ydCB7IFRleHQgfSBmcm9tICcuLi9UZXh0JztcbmltcG9ydCB7IFRvb2x0aXAgfSBmcm9tICcuLi9Ub29sdGlwJztcbmltcG9ydCB7XG4gIEJFVEFfSU5JVElBTF9UUkFOU0lUSU9OLFxuICBCRVRBX0FOSU1BVEVfVFJBTlNJVElPTixcbiAgQkVUQV9FWElUX1RSQU5TSVRJT04sXG4gIFBMVVNfSU5JVElBTF9UUkFOU0lUSU9OLFxuICBQTFVTX0FOSU1BVEVfVFJBTlNJVElPTixcbiAgUExVU19FWElUX1RSQU5TSVRJT04sXG59IGZyb20gJy4vX3ByaXZhdGUvY29tbW9uJztcbmltcG9ydCB7IE5hdk9yRXh0ZXJuYWxMaW5rIH0gZnJvbSAnLi9fcHJpdmF0ZS9OYXZPckV4dGVybmFsTGluayc7XG5pbXBvcnQgeyBtb3Rpb24sIE1vdGlvblByb3BzLCBWYXJpYW50cyB9IGZyb20gJ2ZyYW1lci1tb3Rpb24nO1xuXG5leHBvcnQgY29uc3QgUHJpbWFyeU5hdmlnYXRpb25FeHBhbnNpb25JdGVtU3R5bGVzS2V5ID1cbiAgJ0Nocm9tYVByaW1hcnlOYXZpZ2F0aW9uRXhwYW5zaW9uSXRlbSc7XG5cbmV4cG9ydCBjb25zdCB1c2VTdHlsZXMgPSBtYWtlU3R5bGVzKFxuICAodGhlbWUpID0+ICh7XG4gICAgcm9vdDoge1xuICAgICAgbGlzdFN0eWxlOiAnbm9uZScsXG4gICAgICBwYWRkaW5nOiAwLFxuICAgICAgbWFyZ2luOiAwLFxuICAgICAgcG9zaXRpb246ICdyZWxhdGl2ZScsXG4gICAgfSxcbiAgICByb290T3Blbjoge1xuICAgICAgYmFja2dyb3VuZENvbG9yOiAndmFyKC0tbGluay1hY3RpdmUtYmcpJyxcbiAgICAgIG1heEhlaWdodDogJ2luaGVyaXQnLFxuICAgICAgcGFkZGluZ0JvdHRvbTogdGhlbWUuc3BhY2luZygxKSxcbiAgICAgIGZhbGxiYWNrczoge1xuICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IHRoZW1lLnBhbGV0dGUuYWN0aW9uLmFjdGl2ZSxcbiAgICAgIH0sXG4gICAgfSxcbiAgICBzaWRlYmFyQ29sbGFwc2VkOiB7XG4gICAgICBwYWRkaW5nQm90dG9tOiAwLFxuICAgIH0sXG4gICAgbGluazoge1xuICAgICAgZGlzcGxheTogJ2ZsZXgnLFxuICAgICAgYWxpZ25JdGVtczogJ2NlbnRlcicsXG4gICAgICBoZWlnaHQ6IHRoZW1lLnB4VG9SZW0oNDcpLFxuICAgICAgY29sb3I6ICdpbmhlcml0JyxcbiAgICAgIHRleHREZWNvcmF0aW9uOiAnbm9uZScsXG4gICAgICB0cmFuc2l0aW9uOiAnY29sb3IgMC41cyBlYXNlLCBvcGFjaXR5IDAuNXMgZWFzZScsXG4gICAgICAnJjpob3Zlcic6IHtcbiAgICAgICAgY29sb3I6ICd2YXIoLS1saW5rLWhvdmVyKScsXG4gICAgICAgIHRleHREZWNvcmF0aW9uOiAnbm9uZScsXG4gICAgICAgIGZhbGxiYWNrczoge1xuICAgICAgICAgIGNvbG9yOiAnaW5oZXJpdCcsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0sXG4gICAgbGlua0FjdGl2ZToge1xuICAgICAgY29sb3I6ICd2YXIoLS1saW5rLWFjdGl2ZSknLFxuICAgICAgJyY6aG92ZXInOiB7XG4gICAgICAgIGNvbG9yOiAndmFyKC0tbGluay1hY3RpdmUpJyxcbiAgICAgICAgb3BhY2l0eTogMC43NSxcbiAgICAgIH0sXG4gICAgICBmYWxsYmFja3M6IHtcbiAgICAgICAgY29sb3I6IHRoZW1lLnBhbGV0dGUucHJpbWFyeVszMDBdLFxuICAgICAgfSxcbiAgICB9LFxuICAgIGljb246IHtcbiAgICAgIHdpZHRoOiBzaWRlQmFyV2lkdGhDb2xsYXBzZWQsXG4gICAgICBmbGV4U2hyaW5rOiAwLFxuICAgICAgZGlzcGxheTogJ2ZsZXgnLFxuICAgICAgYWxpZ25JdGVtczogJ2NlbnRlcicsXG4gICAgICBtYXhXaWR0aDogNjAsXG4gICAgICBvdXRsaW5lOiAnbm9uZScsXG4gICAgICBqdXN0aWZ5Q29udGVudDogJ2NlbnRlcicsXG4gICAgfSxcbiAgICBsYWJlbDoge1xuICAgICAgYWxpZ25TZWxmOiAnY2VudGVyJyxcbiAgICAgIGNvbG9yOiAnaW5oZXJpdCcsXG4gICAgICBmbGV4OiAxLFxuICAgICAgbGV0dGVyU3BhY2luZzogMC4xNSxcbiAgICAgIGxpbmVIZWlnaHQ6ICd1bnNldCcsXG4gICAgICBvdmVyZmxvd1g6ICdoaWRkZW4nLFxuICAgICAgcGFkZGluZ1JpZ2h0OiB0aGVtZS5zcGFjaW5nKDIuMjUpLFxuICAgICAgdGV4dE92ZXJmbG93OiAnZWxsaXBzaXMnLFxuICAgICAgd2hpdGVTcGFjZTogJ25vd3JhcCcsXG4gICAgfSxcbiAgICBsYWJlbEJldGE6IHtcbiAgICAgIGp1c3RpZnlDb250ZW50OiAnZmxleC1zdGFydCcsXG4gICAgICBtYXhXaWR0aDogMTIwLFxuICAgICAgcGFkZGluZ1JpZ2h0OiAwLFxuICAgIH0sXG4gICAgcGx1c0ljb246IHtcbiAgICAgIGNvbG9yOiAnaW5oZXJpdCcsXG4gICAgICBqdXN0aWZ5U2VsZjogJ2ZsZXgtZW5kJyxcbiAgICAgIG1hcmdpblJpZ2h0OiB0aGVtZS5zcGFjaW5nKDIpLFxuICAgICAgcG9zaXRpb246ICdhYnNvbHV0ZScsXG4gICAgICByaWdodDogMCxcbiAgICB9LFxuICAgIGhpZGRlbjoge1xuICAgICAgZGlzcGxheTogJ25vbmUnLFxuICAgIH0sXG4gICAgY29udGVudDoge1xuICAgICAgbWF4SGVpZ2h0OiAwLFxuICAgICAgb3ZlcmZsb3c6ICdoaWRkZW4nLFxuICAgICAgdHJhbnNpdGlvbjogJ21heC1oZWlnaHQgMC4yNXMgZWFzZS1pbi1vdXQnLFxuICAgIH0sXG4gICAgaW5uZXI6IHtcbiAgICAgIGRpc3BsYXk6ICdmbGV4JyxcbiAgICAgIGZsZXhEaXJlY3Rpb246ICdjb2x1bW4nLFxuICAgICAgYmFja2dyb3VuZENvbG9yOiAnaW5oZXJpdCcsXG4gICAgICB3aWR0aDogJzEwMCUnLFxuICAgICAgaGVpZ2h0OiAnMTAwJScsXG4gICAgICB2aXNpYmlsaXR5OiAndmlzaWJsZScsXG4gICAgfSxcbiAgICBpbm5lckhpZGRlbjoge1xuICAgICAgdmlzaWJpbGl0eTogJ2hpZGRlbicsXG4gICAgfSxcbiAgICBpbm5lclVsOiB7XG4gICAgICBtYXJnaW46IHRoZW1lLnNwYWNpbmcoLTEsIDAsIDApLFxuICAgICAgcGFkZGluZzogMCxcbiAgICAgIHBvc2l0aW9uOiAncmVsYXRpdmUnLFxuICAgIH0sXG4gICAgYmV0YToge1xuICAgICAgbWFyZ2luOiB0aGVtZS5zcGFjaW5nKDAuMTI1LCAxLCAwKSxcbiAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLFxuICAgICAgcmlnaHQ6IHRoZW1lLnNwYWNpbmcoNCksXG4gICAgICB0cmFuc2Zvcm06ICdzY2FsZSgwLjc1KScsXG4gICAgfSxcbiAgfSksXG4gIHsgbmFtZTogUHJpbWFyeU5hdmlnYXRpb25FeHBhbnNpb25JdGVtU3R5bGVzS2V5IH1cbik7XG5cbmNvbnN0IEJBU0VfVFJBTlNJVElPTl9WQVJJQU5UUzogVmFyaWFudHMgPSB7XG4gIGhpZGU6IHsgb3BhY2l0eTogMCwgeDogMTYsIHRyYW5zaXRpb246IHsgZWFzZTogJ2Vhc2VJbicgfSB9LFxuICBzaG93OiB7IG9wYWNpdHk6IDEsIHg6IDAsIHRyYW5zaXRpb246IHsgZWFzZTogJ2Vhc2VPdXQnIH0gfSxcbn07XG5cbmV4cG9ydCB0eXBlIFByaW1hcnlOYXZpZ2F0aW9uRXhwYW5zaW9uSXRlbUNsYXNzZXMgPSBHZXRDbGFzc2VzPFxuICB0eXBlb2YgdXNlU3R5bGVzXG4+O1xuXG5leHBvcnQgaW50ZXJmYWNlIFByaW1hcnlOYXZpZ2F0aW9uRXhwYW5zaW9uSXRlbVByb3BzXG4gIGV4dGVuZHMgT21pdDxcbiAgICAgIFN0YW5kYXJkUHJvcHM8SFRNTExJRWxlbWVudCwgUHJpbWFyeU5hdmlnYXRpb25FeHBhbnNpb25JdGVtQ2xhc3Nlcz4sXG4gICAgICAnb25BbmltYXRpb25TdGFydCcgfCAnb25EcmFnJyB8ICdvbkRyYWdFbmQnIHwgJ29uRHJhZ1N0YXJ0JyB8ICdzdHlsZSdcbiAgICA+LFxuICAgIFBpY2s8TmF2TGlua1Byb3BzLCAnZXhhY3QnIHwgJ3RvJz4sXG4gICAgTW90aW9uUHJvcHMge1xuICBjaGlsZHJlbj86IFJlYWN0LlJlYWN0Tm9kZTtcbiAgcm9vdFBhcmVudFBhdGg/OiBzdHJpbmc7XG4gIGxhYmVsPzogc3RyaW5nO1xuICBiZXRhPzogYm9vbGVhbjtcbiAgYmV0YUxhYmVsVGV4dD86IHN0cmluZztcbiAgaWNvbj86IFJlYWN0LlJlYWN0Tm9kZTtcbn1cblxuZXhwb3J0IGNvbnN0IFByaW1hcnlOYXZpZ2F0aW9uRXhwYW5zaW9uSXRlbSA9IFJlYWN0LmZvcndhcmRSZWY8XG4gIEhUTUxMSUVsZW1lbnQsXG4gIFByaW1hcnlOYXZpZ2F0aW9uRXhwYW5zaW9uSXRlbVByb3BzXG4+KFxuICAoXG4gICAge1xuICAgICAgcm9vdFBhcmVudFBhdGgsXG4gICAgICBleGFjdCxcbiAgICAgIGljb24sXG4gICAgICBsYWJlbCxcbiAgICAgIGJldGEsXG4gICAgICBiZXRhTGFiZWxUZXh0LFxuICAgICAgdG8sXG4gICAgICBjaGlsZHJlbixcbiAgICAgIGNsYXNzTmFtZSxcbiAgICAgIGNsYXNzZXM6IGFkZGl0aW9uYWxDbGFzc2VzLFxuICAgICAgLi4ucm9vdFByb3BzXG4gICAgfSxcbiAgICByZWZcbiAgKSA9PiB7XG4gICAgY29uc3QgY2xhc3NlcyA9IHVzZVN0eWxlcyh7IGNsYXNzZXM6IGFkZGl0aW9uYWxDbGFzc2VzIH0pO1xuICAgIGNvbnN0IHsgaXNTaWRlYmFyQ29sbGFwc2VkIH0gPSB1c2VMYXlvdXRNYW5hZ2VyKCk7XG4gICAgY29uc3QgbG9jYXRpb24gPSB1c2VMb2NhdGlvbigpO1xuXG4gICAgY29uc3QgaW5uZXJSZWYgPSBSZWFjdC51c2VSZWY8SFRNTERpdkVsZW1lbnQ+KG51bGwpO1xuICAgIGNvbnN0IFtjb250ZW50SGVpZ2h0LCBzZXRDb250ZW50SGVpZ2h0XSA9IFJlYWN0LnVzZVN0YXRlPG51bWJlcj4oMCk7XG4gICAgY29uc3QgaXNFeHBhbmRlZCA9IFJlYWN0LnVzZU1lbW8oXG4gICAgICAoKSA9PiBsb2NhdGlvbi5wYXRobmFtZS5zdGFydHNXaXRoKHJvb3RQYXJlbnRQYXRoKSxcbiAgICAgIFtsb2NhdGlvbiwgcm9vdFBhcmVudFBhdGhdXG4gICAgKTtcblxuICAgIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICBpZiAoaW5uZXJSZWYgJiYgaW5uZXJSZWYuY3VycmVudCAmJiBjaGlsZHJlbikge1xuICAgICAgICBzZXRDb250ZW50SGVpZ2h0KGlubmVyUmVmLmN1cnJlbnQuc2Nyb2xsSGVpZ2h0KTtcbiAgICAgIH1cbiAgICB9LCBbY2hpbGRyZW4sIGlubmVyUmVmPy5jdXJyZW50Py5zY3JvbGxIZWlnaHRdKTtcblxuICAgIHJldHVybiAoXG4gICAgICA8bW90aW9uLmxpXG4gICAgICAgIHJlZj17cmVmfVxuICAgICAgICBjbGFzc05hbWU9e2Nsc3goXG4gICAgICAgICAgY2xhc3Nlcy5yb290LFxuICAgICAgICAgIGlzRXhwYW5kZWQgJiYgY2xhc3Nlcy5yb290T3BlbixcbiAgICAgICAgICBpc1NpZGViYXJDb2xsYXBzZWQgJiYgY2xhc3Nlcy5zaWRlYmFyQ29sbGFwc2VkLFxuICAgICAgICAgIGNsYXNzTmFtZVxuICAgICAgICApfVxuICAgICAgICB7Li4ucm9vdFByb3BzfVxuICAgICAgPlxuICAgICAgICA8TmF2T3JFeHRlcm5hbExpbmtcbiAgICAgICAgICBleGFjdD17ZXhhY3R9XG4gICAgICAgICAgY2xhc3NOYW1lPXtjbGFzc2VzLmxpbmt9XG4gICAgICAgICAgYWN0aXZlQ2xhc3NOYW1lPXtjbGFzc2VzLmxpbmtBY3RpdmV9XG4gICAgICAgICAgdG89e3RvfVxuICAgICAgICA+XG4gICAgICAgICAge2lzU2lkZWJhckNvbGxhcHNlZCA/IChcbiAgICAgICAgICAgIDxUb29sdGlwIHRpdGxlPXtsYWJlbH0gcGxhY2VtZW50PVwicmlnaHRcIiBndXR0ZXI9ey00fT5cbiAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9e2NsYXNzZXMuaWNvbn0+e2ljb259PC9kaXY+XG4gICAgICAgICAgICA8L1Rvb2x0aXA+XG4gICAgICAgICAgKSA6IChcbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXtjbGFzc2VzLmljb259PntpY29ufTwvZGl2PlxuICAgICAgICAgICl9XG4gICAgICAgICAgPG1vdGlvbi5kaXYgdmFyaWFudHM9e0JBU0VfVFJBTlNJVElPTl9WQVJJQU5UU30+XG4gICAgICAgICAgICA8VGV4dFxuICAgICAgICAgICAgICBzaXplPVwic3ViYm9keVwiXG4gICAgICAgICAgICAgIGNsYXNzTmFtZT17Y2xzeChcbiAgICAgICAgICAgICAgICBjbGFzc2VzLmxhYmVsLFxuICAgICAgICAgICAgICAgIGJldGEgJiYgY2xhc3Nlcy5sYWJlbEJldGEsXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lXG4gICAgICAgICAgICAgICl9XG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIHtsYWJlbH1cbiAgICAgICAgICAgIDwvVGV4dD5cbiAgICAgICAgICA8L21vdGlvbi5kaXY+XG4gICAgICAgICAge2JldGEgJiYgIWlzU2lkZWJhckNvbGxhcHNlZCAmJiAoXG4gICAgICAgICAgICA8UGlsbFxuICAgICAgICAgICAgICB2YXJpYW50PVwiaGlnaGxpZ2h0XCJcbiAgICAgICAgICAgICAgbGFiZWw9e2JldGFMYWJlbFRleHR9XG4gICAgICAgICAgICAgIGNsYXNzTmFtZT17Y2xhc3Nlcy5iZXRhfVxuICAgICAgICAgICAgICBpbml0aWFsPXtCRVRBX0lOSVRJQUxfVFJBTlNJVElPTn1cbiAgICAgICAgICAgICAgYW5pbWF0ZT17QkVUQV9BTklNQVRFX1RSQU5TSVRJT059XG4gICAgICAgICAgICAgIGV4aXQ9e0JFVEFfRVhJVF9UUkFOU0lUSU9OfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICApfVxuICAgICAgICAgIHshaXNTaWRlYmFyQ29sbGFwc2VkICYmIChcbiAgICAgICAgICAgIDxtb3Rpb24uc3BhblxuICAgICAgICAgICAgICBjbGFzc05hbWU9e2Nsc3goY2xhc3Nlcy5wbHVzSWNvbiwgaXNFeHBhbmRlZCAmJiBjbGFzc2VzLmhpZGRlbil9XG4gICAgICAgICAgICAgIGluaXRpYWw9e1BMVVNfSU5JVElBTF9UUkFOU0lUSU9OfVxuICAgICAgICAgICAgICBhbmltYXRlPXtQTFVTX0FOSU1BVEVfVFJBTlNJVElPTn1cbiAgICAgICAgICAgICAgZXhpdD17UExVU19FWElUX1RSQU5TSVRJT059XG4gICAgICAgICAgICAgIHJvbGU9XCJwcmVzZW50YXRpb25cIlxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICA8UGx1cyBhcmlhLWhpZGRlbj1cInRydWVcIiB3aWR0aD17MTh9IGhlaWdodD17MTh9IC8+XG4gICAgICAgICAgICA8L21vdGlvbi5zcGFuPlxuICAgICAgICAgICl9XG4gICAgICAgIDwvTmF2T3JFeHRlcm5hbExpbms+XG4gICAgICAgIDxtb3Rpb24uZGl2XG4gICAgICAgICAgYXJpYS1oaWRkZW49eyFpc0V4cGFuZGVkfVxuICAgICAgICAgIGNsYXNzTmFtZT17Y2xzeChjbGFzc2VzLmNvbnRlbnQpfVxuICAgICAgICAgIHN0eWxlPXt7IG1heEhlaWdodDogaXNFeHBhbmRlZCA/IGNvbnRlbnRIZWlnaHQgOiAwIH19XG4gICAgICAgID5cbiAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICByZWY9e2lubmVyUmVmfVxuICAgICAgICAgICAgY2xhc3NOYW1lPXtjbHN4KGNsYXNzZXMuaW5uZXIsICFpc0V4cGFuZGVkICYmIGNsYXNzZXMuaW5uZXJIaWRkZW4pfVxuICAgICAgICAgID5cbiAgICAgICAgICAgIDxtb3Rpb24udWwgY2xhc3NOYW1lPXtjbGFzc2VzLmlubmVyVWx9PntjaGlsZHJlbn08L21vdGlvbi51bD5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9tb3Rpb24uZGl2PlxuICAgICAgPC9tb3Rpb24ubGk+XG4gICAgKTtcbiAgfVxuKTtcbiJdfQ==