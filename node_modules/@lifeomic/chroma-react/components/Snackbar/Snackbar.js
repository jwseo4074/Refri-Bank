"use strict";
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];
    result["default"] = mod;
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
var styles_1 = require("../../styles");
var framer_motion_1 = require("framer-motion");
var Text_1 = require("../Text");
var clsx_1 = __importDefault(require("clsx"));
var React = __importStar(require("react"));
var IconButton_1 = require("../IconButton");
var chromicons_1 = require("@lifeomic/chromicons");
exports.SnackbarStylesKey = 'ChromaSnackbar';
exports.useStyles = styles_1.makeStyles(function (theme) { return ({
    root: {
        color: theme.palette.text.secondary,
        paddingTop: theme.spacing(1),
        paddingBottom: theme.spacing(1),
        paddingLeft: theme.spacing(2),
        paddingRight: theme.spacing(2),
        backgroundColor: theme.palette.common.white,
        borderRadius: 'unset',
        position: 'fixed',
        display: 'flex',
        alignItems: 'center',
        boxShadow: theme.boxShadows.tooltip,
        top: 0,
        right: 0,
        zIndex: 1500,
        pointerEvents: 'auto',
        '@media screen and (max-width: 480px)': {
            top: 'unset',
            bottom: 0,
            width: '100%',
        },
    },
    infoModifier: {
        borderLeft: "10px solid " + theme.palette.blue.main,
    },
    errorModifier: {
        borderLeft: "10px solid " + theme.palette.red.main,
    },
    warningModifier: {
        borderLeft: "10px solid " + theme.palette.yellow.main,
    },
    successModifier: {
        borderLeft: "10px solid " + theme.palette.green.main,
    },
    icon: {
        width: theme.pxToRem(16),
        height: theme.pxToRem(16),
        marginRight: theme.spacing(1),
    },
    title: {
        color: theme.palette.black[600],
    },
    closeButton: {
        marginLeft: theme.spacing(2),
        borderLeft: "1px solid " + theme.palette.divider,
    },
}); }, { name: exports.SnackbarStylesKey });
exports.Snackbar = React.forwardRef(function (_a, ref) {
    var _b;
    var className = _a.className, _c = _a.duration, duration = _c === void 0 ? 6000 : _c, Icon = _a.icon, _d = _a.isOpen, isOpen = _d === void 0 ? false : _d, _e = _a.allowDismiss, allowDismiss = _e === void 0 ? false : _e, onClose = _a.onClose, _f = _a.role, role = _f === void 0 ? 'status' : _f, _g = _a.statusType, statusType = _g === void 0 ? 'info' : _g, title = _a.title, children = _a.children, rootProps = __rest(_a, ["className", "duration", "icon", "isOpen", "allowDismiss", "onClose", "role", "statusType", "title", "children"]);
    var classes = exports.useStyles({});
    var shouldReduceMotion = framer_motion_1.useReducedMotion();
    var _h = React.useState(duration), snackbarTimeout = _h[0], setSnackbarTimeout = _h[1];
    // Event handlers
    var onMouseEnter = function () { return setSnackbarTimeout(null); };
    var onMouseLeave = function () { return setSnackbarTimeout(duration); };
    var closeSnackbar = React.useCallback(function () {
        onClose && onClose();
    }, [onClose]);
    // Use a ref to close our Snackbar after the timeout
    var callbackRef = React.useRef();
    React.useEffect(function () {
        if (!callbackRef.current) {
            callbackRef.current = closeSnackbar;
        }
    }, [closeSnackbar]);
    React.useEffect(function () {
        // Ignore setting up a timer for the Snackbar
        // if one is not isOpen.
        if (!isOpen) {
            return;
        }
        var tick = function () {
            if (callbackRef.current) {
                callbackRef.current();
            }
        };
        if (snackbarTimeout) {
            var id_1 = setTimeout(tick, snackbarTimeout);
            return function () { return clearTimeout(id_1); };
        }
    }, [snackbarTimeout, isOpen]);
    return (React.createElement(framer_motion_1.AnimatePresence, { initial: false }, isOpen ? (React.createElement(framer_motion_1.motion.div, __assign({ ref: ref, className: clsx_1.default(classes.root, (_b = {},
            _b[classes.infoModifier] = statusType === 'info',
            _b[classes.errorModifier] = statusType === 'error',
            _b[classes.warningModifier] = statusType === 'warning',
            _b[classes.successModifier] = statusType === 'success',
            _b), className), "aria-live": role === 'alert' ? 'assertive' : 'polite', role: role, onMouseEnter: onMouseEnter, onMouseLeave: onMouseLeave, positionTransition: true, initial: shouldReduceMotion ? { opacity: 0 } : { opacity: 0, y: -40 }, animate: shouldReduceMotion
            ? { opacity: 1 }
            : {
                opacity: 1,
                y: 0,
            }, exit: shouldReduceMotion
            ? { opacity: 0 }
            : {
                opacity: 0,
                y: 60,
                transition: { duration: 0.25, ease: 'easeIn' },
            } }, rootProps),
        !!Icon && React.createElement(Icon, { role: "img", "aria-hidden": true, className: classes.icon }),
        children ? (children) : (React.createElement(Text_1.Text, { className: classes.title }, title)),
        allowDismiss && (React.createElement(React.Fragment, null,
            React.createElement(IconButton_1.IconButton, { className: classes.closeButton, "aria-label": "Close Notification", size: 0, paddingTop: 0, paddingBottom: 0, paddingRight: 0, icon: chromicons_1.X, onClick: closeSnackbar }))))) : null));
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU25hY2tiYXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvY29tcG9uZW50cy9TbmFja2Jhci9TbmFja2Jhci50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUNBLHVDQUEwQztBQUMxQywrQ0FBMEU7QUFDMUUsZ0NBQStCO0FBQy9CLDhDQUF3QjtBQUN4QiwyQ0FBK0I7QUFDL0IsNENBQTJDO0FBQzNDLG1EQUF5QztBQUc1QixRQUFBLGlCQUFpQixHQUFHLGdCQUFnQixDQUFDO0FBRXJDLFFBQUEsU0FBUyxHQUFHLG1CQUFVLENBQ2pDLFVBQUMsS0FBSyxJQUFLLE9BQUEsQ0FBQztJQUNWLElBQUksRUFBRTtRQUNKLEtBQUssRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxTQUFTO1FBQ25DLFVBQVUsRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztRQUM1QixhQUFhLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7UUFDL0IsV0FBVyxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1FBQzdCLFlBQVksRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztRQUM5QixlQUFlLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsS0FBSztRQUMzQyxZQUFZLEVBQUUsT0FBTztRQUNyQixRQUFRLEVBQUUsT0FBTztRQUNqQixPQUFPLEVBQUUsTUFBTTtRQUNmLFVBQVUsRUFBRSxRQUFRO1FBQ3BCLFNBQVMsRUFBRSxLQUFLLENBQUMsVUFBVSxDQUFDLE9BQU87UUFDbkMsR0FBRyxFQUFFLENBQUM7UUFDTixLQUFLLEVBQUUsQ0FBQztRQUNSLE1BQU0sRUFBRSxJQUFJO1FBQ1osYUFBYSxFQUFFLE1BQU07UUFDckIsc0NBQXNDLEVBQUU7WUFDdEMsR0FBRyxFQUFFLE9BQU87WUFDWixN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Z0JBQ0UsT0FBTyxFQUFFLENBQUM7Z0JBQ1YsQ0FBQyxFQUFFLENBQUM7YUFDTCxFQUVQLElBQUksRUFDRixrQkFBa0I7WUFDaEIsQ0FBQyxDQUFDLEVBQUUsT0FBTyxFQUFFLENBQUMsRUFBRTtZQUNoQixDQUFDLENBQUM7Z0JBQ0UsT0FBTyxFQUFFLENBQUM7Z0JBQ1YsQ0FBQyxFQUFFLEVBQUU7Z0JBQ0wsVUFBVSxFQUFFLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFO2FBQy9DLElBRUgsU0FBUztRQUVaLENBQUMsQ0FBQyxJQUFJLElBQUksb0JBQUMsSUFBSSxJQUFDLElBQUksRUFBQyxLQUFLLHVCQUFhLFNBQVMsRUFBRSxPQUFPLENBQUMsSUFBSSxHQUFJO1FBQ2xFLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FDVixRQUFRLENBQ1QsQ0FBQyxDQUFDLENBQUMsQ0FDRixvQkFBQyxXQUFJLElBQUMsU0FBUyxFQUFFLE9BQU8sQ0FBQyxLQUFLLElBQUcsS0FBSyxDQUFRLENBQy9DO1FBQ0EsWUFBWSxJQUFJLENBQ2Y7WUFDRSxvQkFBQyx1QkFBVSxJQUNULFNBQVMsRUFBRSxPQUFPLENBQUMsV0FBVyxnQkFDbkIsb0JBQW9CLEVBQy9CLElBQUksRUFBRSxDQUFDLEVBQ1AsVUFBVSxFQUFFLENBQUMsRUFDYixhQUFhLEVBQUUsQ0FBQyxFQUNoQixZQUFZLEVBQUUsQ0FBQyxFQUNmLElBQUksRUFBRSxjQUFDLEVBQ1AsT0FBTyxFQUFFLGFBQWEsR0FDdEIsQ0FDRCxDQUNKLENBQ1UsQ0FDZCxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQ1EsQ0FDbkIsQ0FBQztBQUNKLENBQUMsQ0FDRixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgR2V0Q2xhc3NlcyB9IGZyb20gJy4uLy4uL3R5cGVVdGlscyc7XG5pbXBvcnQgeyBtYWtlU3R5bGVzIH0gZnJvbSAnLi4vLi4vc3R5bGVzJztcbmltcG9ydCB7IG1vdGlvbiwgQW5pbWF0ZVByZXNlbmNlLCB1c2VSZWR1Y2VkTW90aW9uIH0gZnJvbSAnZnJhbWVyLW1vdGlvbic7XG5pbXBvcnQgeyBUZXh0IH0gZnJvbSAnLi4vVGV4dCc7XG5pbXBvcnQgY2xzeCBmcm9tICdjbHN4JztcbmltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IEljb25CdXR0b24gfSBmcm9tICcuLi9JY29uQnV0dG9uJztcbmltcG9ydCB7IFggfSBmcm9tICdAbGlmZW9taWMvY2hyb21pY29ucyc7XG5pbXBvcnQgeyBOb3RpZmljYXRpb25TdGF0dXNUeXBlIH0gZnJvbSAnLi4vX3ByaXZhdGUvbm90aWZpY2F0aW9uVHlwZXMnO1xuXG5leHBvcnQgY29uc3QgU25hY2tiYXJTdHlsZXNLZXkgPSAnQ2hyb21hU25hY2tiYXInO1xuXG5leHBvcnQgY29uc3QgdXNlU3R5bGVzID0gbWFrZVN0eWxlcyhcbiAgKHRoZW1lKSA9PiAoe1xuICAgIHJvb3Q6IHtcbiAgICAgIGNvbG9yOiB0aGVtZS5wYWxldHRlLnRleHQuc2Vjb25kYXJ5LFxuICAgICAgcGFkZGluZ1RvcDogdGhlbWUuc3BhY2luZygxKSxcbiAgICAgIHBhZGRpbmdCb3R0b206IHRoZW1lLnNwYWNpbmcoMSksXG4gICAgICBwYWRkaW5nTGVmdDogdGhlbWUuc3BhY2luZygyKSxcbiAgICAgIHBhZGRpbmdSaWdodDogdGhlbWUuc3BhY2luZygyKSxcbiAgICAgIGJhY2tncm91bmRDb2xvcjogdGhlbWUucGFsZXR0ZS5jb21tb24ud2hpdGUsXG4gICAgICBib3JkZXJSYWRpdXM6ICd1bnNldCcsXG4gICAgICBwb3NpdGlvbjogJ2ZpeGVkJyxcbiAgICAgIGRpc3BsYXk6ICdmbGV4JyxcbiAgICAgIGFsaWduSXRlbXM6ICdjZW50ZXInLFxuICAgICAgYm94U2hhZG93OiB0aGVtZS5ib3hTaGFkb3dzLnRvb2x0aXAsXG4gICAgICB0b3A6IDAsXG4gICAgICByaWdodDogMCxcbiAgICAgIHpJbmRleDogMTUwMCxcbiAgICAgIHBvaW50ZXJFdmVudHM6ICdhdXRvJyxcbiAgICAgICdAbWVkaWEgc2NyZWVuIGFuZCAobWF4LXdpZHRoOiA0ODBweCknOiB7XG4gICAgICAgIHRvcDogJ3Vuc2V0JyxcbiAgICAgICAgYm90dG9tOiAwLFxuICAgICAgICB3aWR0aDogJzEwMCUnLFxuICAgICAgfSxcbiAgICB9LFxuICAgIGluZm9Nb2RpZmllcjoge1xuICAgICAgYm9yZGVyTGVmdDogYDEwcHggc29saWQgJHt0aGVtZS5wYWxldHRlLmJsdWUubWFpbn1gLFxuICAgIH0sXG4gICAgZXJyb3JNb2RpZmllcjoge1xuICAgICAgYm9yZGVyTGVmdDogYDEwcHggc29saWQgJHt0aGVtZS5wYWxldHRlLnJlZC5tYWlufWAsXG4gICAgfSxcbiAgICB3YXJuaW5nTW9kaWZpZXI6IHtcbiAgICAgIGJvcmRlckxlZnQ6IGAxMHB4IHNvbGlkICR7dGhlbWUucGFsZXR0ZS55ZWxsb3cubWFpbn1gLFxuICAgIH0sXG4gICAgc3VjY2Vzc01vZGlmaWVyOiB7XG4gICAgICBib3JkZXJMZWZ0OiBgMTBweCBzb2xpZCAke3RoZW1lLnBhbGV0dGUuZ3JlZW4ubWFpbn1gLFxuICAgIH0sXG4gICAgaWNvbjoge1xuICAgICAgd2lkdGg6IHRoZW1lLnB4VG9SZW0oMTYpLFxuICAgICAgaGVpZ2h0OiB0aGVtZS5weFRvUmVtKDE2KSxcbiAgICAgIG1hcmdpblJpZ2h0OiB0aGVtZS5zcGFjaW5nKDEpLFxuICAgIH0sXG4gICAgdGl0bGU6IHtcbiAgICAgIGNvbG9yOiB0aGVtZS5wYWxldHRlLmJsYWNrWzYwMF0sXG4gICAgfSxcbiAgICBjbG9zZUJ1dHRvbjoge1xuICAgICAgbWFyZ2luTGVmdDogdGhlbWUuc3BhY2luZygyKSxcbiAgICAgIGJvcmRlckxlZnQ6IGAxcHggc29saWQgJHt0aGVtZS5wYWxldHRlLmRpdmlkZXJ9YCxcbiAgICB9LFxuICB9KSxcbiAgeyBuYW1lOiBTbmFja2JhclN0eWxlc0tleSB9XG4pO1xuXG5leHBvcnQgdHlwZSBTbmFja2JhckNsYXNzZXMgPSBHZXRDbGFzc2VzPHR5cGVvZiB1c2VTdHlsZXM+O1xuXG5leHBvcnQgaW50ZXJmYWNlIFNuYWNrYmFyUHJvcHMge1xuICBkdXJhdGlvbj86IG51bWJlcjtcbiAgY2xhc3NOYW1lPzogc3RyaW5nO1xuICBpY29uPzogUmVhY3QuQ29tcG9uZW50VHlwZTxSZWFjdC5TVkdQcm9wczxTVkdTVkdFbGVtZW50Pj47XG4gIGlzT3Blbj86IGJvb2xlYW47XG4gIGFsbG93RGlzbWlzcz86IGJvb2xlYW47XG4gIG9uQ2xvc2U/OiAoKSA9PiB2b2lkO1xuICByb2xlPzogJ2FsZXJ0JyB8ICdzdGF0dXMnO1xuICBzdGF0dXNUeXBlPzogTm90aWZpY2F0aW9uU3RhdHVzVHlwZTtcbiAgdGl0bGU/OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBjb25zdCBTbmFja2JhcjogUmVhY3QuRkM8U25hY2tiYXJQcm9wcz4gPSBSZWFjdC5mb3J3YXJkUmVmPFxuICBIVE1MRGl2RWxlbWVudCxcbiAgU25hY2tiYXJQcm9wc1xuPihcbiAgKFxuICAgIHtcbiAgICAgIGNsYXNzTmFtZSxcbiAgICAgIGR1cmF0aW9uID0gNjAwMCxcbiAgICAgIGljb246IEljb24sXG4gICAgICBpc09wZW4gPSBmYWxzZSxcbiAgICAgIGFsbG93RGlzbWlzcyA9IGZhbHNlLFxuICAgICAgb25DbG9zZSxcbiAgICAgIHJvbGUgPSAnc3RhdHVzJyxcbiAgICAgIHN0YXR1c1R5cGUgPSAnaW5mbycsXG4gICAgICB0aXRsZSxcbiAgICAgIGNoaWxkcmVuLFxuICAgICAgLi4ucm9vdFByb3BzXG4gICAgfSxcbiAgICByZWZcbiAgKSA9PiB7XG4gICAgY29uc3QgY2xhc3NlcyA9IHVzZVN0eWxlcyh7fSk7XG5cbiAgICBjb25zdCBzaG91bGRSZWR1Y2VNb3Rpb24gPSB1c2VSZWR1Y2VkTW90aW9uKCk7XG5cbiAgICBjb25zdCBbc25hY2tiYXJUaW1lb3V0LCBzZXRTbmFja2JhclRpbWVvdXRdID0gUmVhY3QudXNlU3RhdGU8bnVtYmVyIHwgbnVsbD4oXG4gICAgICBkdXJhdGlvblxuICAgICk7XG5cbiAgICAvLyBFdmVudCBoYW5kbGVyc1xuICAgIGNvbnN0IG9uTW91c2VFbnRlciA9ICgpID0+IHNldFNuYWNrYmFyVGltZW91dChudWxsKTtcbiAgICBjb25zdCBvbk1vdXNlTGVhdmUgPSAoKSA9PiBzZXRTbmFja2JhclRpbWVvdXQoZHVyYXRpb24pO1xuICAgIGNvbnN0IGNsb3NlU25hY2tiYXIgPSBSZWFjdC51c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgICBvbkNsb3NlICYmIG9uQ2xvc2UoKTtcbiAgICB9LCBbb25DbG9zZV0pO1xuXG4gICAgLy8gVXNlIGEgcmVmIHRvIGNsb3NlIG91ciBTbmFja2JhciBhZnRlciB0aGUgdGltZW91dFxuICAgIGNvbnN0IGNhbGxiYWNrUmVmID0gUmVhY3QudXNlUmVmPCgpID0+IHZvaWQgfCBudWxsPigpO1xuXG4gICAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHtcbiAgICAgIGlmICghY2FsbGJhY2tSZWYuY3VycmVudCkge1xuICAgICAgICBjYWxsYmFja1JlZi5jdXJyZW50ID0gY2xvc2VTbmFja2JhcjtcbiAgICAgIH1cbiAgICB9LCBbY2xvc2VTbmFja2Jhcl0pO1xuXG4gICAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHtcbiAgICAgIC8vIElnbm9yZSBzZXR0aW5nIHVwIGEgdGltZXIgZm9yIHRoZSBTbmFja2JhclxuICAgICAgLy8gaWYgb25lIGlzIG5vdCBpc09wZW4uXG4gICAgICBpZiAoIWlzT3Blbikge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHRpY2sgPSAoKSA9PiB7XG4gICAgICAgIGlmIChjYWxsYmFja1JlZi5jdXJyZW50KSB7XG4gICAgICAgICAgY2FsbGJhY2tSZWYuY3VycmVudCgpO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBpZiAoc25hY2tiYXJUaW1lb3V0KSB7XG4gICAgICAgIGNvbnN0IGlkID0gc2V0VGltZW91dCh0aWNrLCBzbmFja2JhclRpbWVvdXQpO1xuICAgICAgICByZXR1cm4gKCkgPT4gY2xlYXJUaW1lb3V0KGlkKTtcbiAgICAgIH1cbiAgICB9LCBbc25hY2tiYXJUaW1lb3V0LCBpc09wZW5dKTtcblxuICAgIHJldHVybiAoXG4gICAgICA8QW5pbWF0ZVByZXNlbmNlIGluaXRpYWw9e2ZhbHNlfT5cbiAgICAgICAge2lzT3BlbiA/IChcbiAgICAgICAgICA8bW90aW9uLmRpdlxuICAgICAgICAgICAgcmVmPXtyZWZ9XG4gICAgICAgICAgICBjbGFzc05hbWU9e2Nsc3goXG4gICAgICAgICAgICAgIGNsYXNzZXMucm9vdCxcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIFtjbGFzc2VzLmluZm9Nb2RpZmllcl06IHN0YXR1c1R5cGUgPT09ICdpbmZvJyxcbiAgICAgICAgICAgICAgICBbY2xhc3Nlcy5lcnJvck1vZGlmaWVyXTogc3RhdHVzVHlwZSA9PT0gJ2Vycm9yJyxcbiAgICAgICAgICAgICAgICBbY2xhc3Nlcy53YXJuaW5nTW9kaWZpZXJdOiBzdGF0dXNUeXBlID09PSAnd2FybmluZycsXG4gICAgICAgICAgICAgICAgW2NsYXNzZXMuc3VjY2Vzc01vZGlmaWVyXTogc3RhdHVzVHlwZSA9PT0gJ3N1Y2Nlc3MnLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBjbGFzc05hbWVcbiAgICAgICAgICAgICl9XG4gICAgICAgICAgICBhcmlhLWxpdmU9e3JvbGUgPT09ICdhbGVydCcgPyAnYXNzZXJ0aXZlJyA6ICdwb2xpdGUnfVxuICAgICAgICAgICAgcm9sZT17cm9sZX1cbiAgICAgICAgICAgIG9uTW91c2VFbnRlcj17b25Nb3VzZUVudGVyfVxuICAgICAgICAgICAgb25Nb3VzZUxlYXZlPXtvbk1vdXNlTGVhdmV9XG4gICAgICAgICAgICBwb3NpdGlvblRyYW5zaXRpb25cbiAgICAgICAgICAgIGluaXRpYWw9e1xuICAgICAgICAgICAgICBzaG91bGRSZWR1Y2VNb3Rpb24gPyB7IG9wYWNpdHk6IDAgfSA6IHsgb3BhY2l0eTogMCwgeTogLTQwIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGFuaW1hdGU9e1xuICAgICAgICAgICAgICBzaG91bGRSZWR1Y2VNb3Rpb25cbiAgICAgICAgICAgICAgICA/IHsgb3BhY2l0eTogMSB9XG4gICAgICAgICAgICAgICAgOiB7XG4gICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgICAgICAgICAgICAgIHk6IDAsXG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBleGl0PXtcbiAgICAgICAgICAgICAgc2hvdWxkUmVkdWNlTW90aW9uXG4gICAgICAgICAgICAgICAgPyB7IG9wYWNpdHk6IDAgfVxuICAgICAgICAgICAgICAgIDoge1xuICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAwLFxuICAgICAgICAgICAgICAgICAgICB5OiA2MCxcbiAgICAgICAgICAgICAgICAgICAgdHJhbnNpdGlvbjogeyBkdXJhdGlvbjogMC4yNSwgZWFzZTogJ2Vhc2VJbicgfSxcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHsuLi5yb290UHJvcHN9XG4gICAgICAgICAgPlxuICAgICAgICAgICAgeyEhSWNvbiAmJiA8SWNvbiByb2xlPVwiaW1nXCIgYXJpYS1oaWRkZW4gY2xhc3NOYW1lPXtjbGFzc2VzLmljb259IC8+fVxuICAgICAgICAgICAge2NoaWxkcmVuID8gKFxuICAgICAgICAgICAgICBjaGlsZHJlblxuICAgICAgICAgICAgKSA6IChcbiAgICAgICAgICAgICAgPFRleHQgY2xhc3NOYW1lPXtjbGFzc2VzLnRpdGxlfT57dGl0bGV9PC9UZXh0PlxuICAgICAgICAgICAgKX1cbiAgICAgICAgICAgIHthbGxvd0Rpc21pc3MgJiYgKFxuICAgICAgICAgICAgICA8PlxuICAgICAgICAgICAgICAgIDxJY29uQnV0dG9uXG4gICAgICAgICAgICAgICAgICBjbGFzc05hbWU9e2NsYXNzZXMuY2xvc2VCdXR0b259XG4gICAgICAgICAgICAgICAgICBhcmlhLWxhYmVsPVwiQ2xvc2UgTm90aWZpY2F0aW9uXCJcbiAgICAgICAgICAgICAgICAgIHNpemU9ezB9XG4gICAgICAgICAgICAgICAgICBwYWRkaW5nVG9wPXswfVxuICAgICAgICAgICAgICAgICAgcGFkZGluZ0JvdHRvbT17MH1cbiAgICAgICAgICAgICAgICAgIHBhZGRpbmdSaWdodD17MH1cbiAgICAgICAgICAgICAgICAgIGljb249e1h9XG4gICAgICAgICAgICAgICAgICBvbkNsaWNrPXtjbG9zZVNuYWNrYmFyfVxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgIDwvPlxuICAgICAgICAgICAgKX1cbiAgICAgICAgICA8L21vdGlvbi5kaXY+XG4gICAgICAgICkgOiBudWxsfVxuICAgICAgPC9BbmltYXRlUHJlc2VuY2U+XG4gICAgKTtcbiAgfVxuKTtcbiJdfQ==