var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
import clsx from 'clsx';
import * as React from 'react';
import { makeStyles } from '../../styles';
import { buildDescribedBy, FormHelpMessage, helpFor, } from '../_private/forms';
import { generateUniqueId } from '../_private/UniqueId';
import { clearClipPath, defaultClipPath } from './clipPaths';
export var SearchFieldStylesKey = 'ChromaSearchField';
export var useStyles = makeStyles(function (theme) { return ({
    root: {
        position: 'relative',
    },
    input: {
        backgroundColor: 'rgba(132, 137, 166, 0.15)',
        border: "1px solid transparent",
        borderRadius: theme.pxToRem(4),
        color: theme.palette.text.primary,
        fontFamily: theme.typography.fontFamily,
        fontSize: theme.pxToRem(14),
        lineHeight: 1.25,
        paddingLeft: theme.spacing(1.25),
        // Requires more paddingRight so we give the search icon enough
        // room when the text inside the search field is long.
        paddingRight: theme.spacing(3.75),
        transition: 'border 0.25s ease',
        maxWidth: theme.pxToRem(173),
        '&:focus': {
            outline: 'none',
            backgroundColor: 'rgba(255, 255, 255, 0.5)',
            border: "1px solid rgba(132, 137, 166, 0.45)",
        },
        '&:disabled': {
            cursor: 'not-allowed',
            opacity: 0.625,
            '& + $button': {
                cursor: 'not-allowed',
                opacity: 0.625,
            },
        },
        '&::-webkit-input-placeholder': {
            color: theme.palette.black[400],
        },
        '&::-moz-placeholder': {
            color: theme.palette.black[400],
        },
        '&:-ms-input-placeholder': {
            color: theme.palette.black[400],
        },
        '&:-moz-placeholder': {
            color: theme.palette.black[400],
        },
        // Hide the webkit clear (x) button
        '&::-webkit-search-decoration,&::-webkit-search-cancel-button,&::-webkit-search-results-button,&::-webkit-search-results-decoration': {
            display: 'none',
        },
    },
    inputInverse: {
        backgroundColor: 'rgba(230, 231, 237, 0.1)',
        color: theme.palette.common.white,
        '&:focus': {
            backgroundColor: 'rgba(230, 231, 237, 0.1)',
            border: "1px solid rgba(230, 231, 237, 0.55)",
        },
        '&::-webkit-input-placeholder': {
            color: 'rgba(255, 255, 255, 0.8)',
        },
        '&::-moz-placeholder': {
            color: 'rgba(255, 255, 255, 0.8)',
        },
        '&:-ms-input-placeholder': {
            color: 'rgba(255, 255, 255, 0.8)',
        },
        '&:-moz-placeholder': {
            color: 'rgba(255, 255, 255, 0.8)',
        },
    },
    inputHeight0: {
        paddingBottom: theme.spacing(0.5),
        paddingTop: theme.spacing(0.5),
    },
    inputHeight1: {
        paddingBottom: theme.spacing(1),
        paddingTop: theme.spacing(1),
    },
    fullWidth: {
        '& $input': {
            maxWidth: 'none',
            width: '100%',
        },
        '& $button': {
            left: 'auto',
            right: theme.pxToRem(5),
        },
    },
    button: {
        position: 'absolute',
        left: theme.pxToRem(144),
        alignItems: 'center',
        backgroundColor: 'transparent',
        border: 0,
        color: theme.palette.black[500],
        cursor: 'pointer',
        display: 'inline-flex',
        flex: '0 0 auto',
        justifyContent: 'center',
        margin: 0,
        outline: 'none',
        padding: 0,
        transition: 'color 0.25s ease, opacity 0.25s ease',
        userSelect: 'none',
    },
    buttonHeight0: {
        top: theme.pxToRem(0.25),
    },
    buttonHeight1: {
        top: theme.pxToRem(4),
    },
    buttonSvg: {
        width: theme.pxToRem(24),
        height: theme.pxToRem(24),
        // Glass
        '& > circle': {
            fill: 'transparent',
            stroke: theme.palette.black[500],
            strokeWidth: 6,
            strokeLinecap: 'round',
        },
        // Magnifying glass pole part
        '& > path': {
            fill: 'none',
            stroke: theme.palette.black[500],
            strokeDasharray: '10 50',
            strokeDashoffset: 20,
            strokeLinecap: 'round',
            strokeWidth: 7,
            transition: 'stroke-dasharray 200ms, stroke-dashoffset 200ms, stroke 200ms',
            '@media (prefers-reduced-motion: reduce)': {
                transition: 'none',
            },
        },
        // Background circle for glass and X clear
        '& > rect': {
            clipPath: defaultClipPath,
            WebkitClipPath: defaultClipPath,
            fill: 'transparent',
            transition: 'clip-path 100ms 100ms',
            '@media (prefers-reduced-motion: reduce)': {
                transition: 'none',
            },
        },
    },
    buttonSvgInverse: {
        '& > circle': {
            stroke: theme.palette.common.white,
        },
        '& > path': {
            stroke: theme.palette.common.white,
        },
    },
    buttonSvgClear: {
        marginTop: theme.spacing(0.125),
        '& > circle': {
            fill: theme.palette.black[500],
        },
        '& > path': {
            strokeDasharray: '24 50',
            strokeDashoffset: 74,
            stroke: theme.palette.common.white,
        },
        '& > rect': {
            clipPath: clearClipPath,
            WebkitClipPath: clearClipPath,
            fill: theme.palette.common.white,
            transition: 'clip-path 100ms',
            '@media (prefers-reduced-motion: reduce)': {
                transition: 'none',
            },
        },
    },
    buttonSvgClearInverse: {
        '& > circle': {
            fill: theme.palette.common.white,
            stroke: theme.palette.common.white,
        },
        '& > path': {
            stroke: theme.palette.blue[700],
        },
        '& > rect': {
            fill: theme.palette.blue[700],
        },
    },
    helpMessage: {
        marginTop: theme.spacing(1),
        marginLeft: 0,
    },
}); }, { name: SearchFieldStylesKey });
export var SearchField = React.forwardRef(function (_a, ref) {
    var _b, _c, _d;
    var _e;
    var ariaLabel = _a["aria-label"], className = _a.className, _f = _a.color, color = _f === void 0 ? 'default' : _f, _g = _a.disableClearOnSearch, disableClearOnSearch = _g === void 0 ? false : _g, fullWidth = _a.fullWidth, _h = _a.height, height = _h === void 0 ? 1 : _h, id = _a.id, name = _a.name, helpMessage = _a.helpMessage, onChange = _a.onChange, onSearch = _a.onSearch, onClear = _a.onClear, valueProp = _a.value, defaultValue = _a.defaultValue, rootProps = __rest(_a, ['aria-label', "className", "color", "disableClearOnSearch", "fullWidth", "height", "id", "name", "helpMessage", "onChange", "onSearch", "onClear", "value", "defaultValue"]);
    var classes = useStyles({});
    var uniqueId = React.useState(function () { return id || name || generateUniqueId('searchField-'); })[0];
    var _j = React.useState(false), showClear = _j[0], setShowClear = _j[1];
    var _k = React.useState((_e = defaultValue === null || defaultValue === void 0 ? void 0 : defaultValue.toString()) !== null && _e !== void 0 ? _e : ''), searchText = _k[0], setSearchText = _k[1];
    var isControlled = valueProp !== undefined;
    var value = isControlled ? valueProp.toString() : searchText;
    if (!ariaLabel && process.env.NODE_ENV === 'development') {
        console.warn('Please provide an aria-label to SearchField. This will be a required property in a future major release.');
    }
    var handleFocus = function (e) {
        if (e.target.value.length > 0) {
            setShowClear(true);
        }
    };
    var handleBlur = function () {
        if (value.length === 0) {
            setShowClear(false);
        }
    };
    var handleChange = function (e) {
        if (!isControlled) {
            setSearchText(e.target.value);
        }
        if (showClear && e.target.value.length === 0) {
            setShowClear(false);
        }
        if (!showClear && e.target.value.length > 0) {
            setShowClear(true);
        }
        onChange === null || onChange === void 0 ? void 0 : onChange(e);
    };
    var handleKeyPress = function (e) {
        if (e.key === 'Enter' && !disableClearOnSearch) {
            setShowClear(false);
            onSearch && onSearch(value);
            setSearchText('');
        }
        if (e.key === 'Enter' && disableClearOnSearch) {
            onSearch && onSearch(value);
        }
    };
    var handleClearButtonClick = function () {
        setSearchText('');
        setShowClear(false);
        onClear === null || onClear === void 0 ? void 0 : onClear();
        var input = document.getElementById(uniqueId);
        var event = new Event('change');
        input.value = '';
        input.dispatchEvent(event);
        onChange === null || onChange === void 0 ? void 0 : onChange(event);
    };
    return (React.createElement("div", { className: clsx(classes.root, fullWidth && classes.fullWidth, className) },
        React.createElement("input", __assign({ "aria-describedby": buildDescribedBy({
                hasHelpMessage: !!helpMessage,
                uniqueId: uniqueId,
            }), "aria-label": ariaLabel || 'Search field', className: clsx(classes.input, (_b = {},
                _b[classes.inputInverse] = color === 'inverse',
                _b), (_c = {},
                _c[classes.inputHeight0] = height === 0,
                _c[classes.inputHeight1] = height === 1,
                _c)), id: uniqueId, name: name, ref: ref, type: "search", onChange: handleChange, onKeyPress: handleKeyPress, onFocus: handleFocus, onBlur: handleBlur, value: value }, rootProps)),
        React.createElement("button", { "aria-label": showClear ? 'Clear input' : 'Search', className: clsx(classes.button, (_d = {},
                _d[classes.buttonHeight0] = height === 0,
                _d[classes.buttonHeight1] = height === 1,
                _d)), tabIndex: -1, onClick: handleClearButtonClick },
            React.createElement("svg", { className: clsx(classes.buttonSvg, color === 'inverse' && classes.buttonSvgInverse, showClear && classes.buttonSvgClear, color === 'inverse' && showClear && classes.buttonSvgClearInverse), viewBox: "0 0 100 100", role: "img", "aria-hidden": true },
                React.createElement("circle", { r: "24.5", cy: "54.200001", cx: "45.700001" }),
                React.createElement("path", { d: "M 37.240349,46.733243 72.551185,82.414382" }),
                React.createElement("rect", { x: "0", y: "0", width: "100", height: "100" }))),
        helpMessage && (React.createElement(FormHelpMessage, { className: classes.helpMessage, color: color, rootElementId: uniqueId, describedById: helpFor(uniqueId) }, helpMessage))));
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2VhcmNoRmllbGQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9TZWFyY2hGaWVsZC9TZWFyY2hGaWVsZC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLE9BQU8sSUFBSSxNQUFNLE1BQU0sQ0FBQztBQUN4QixPQUFPLEtBQUssS0FBSyxNQUFNLE9BQU8sQ0FBQztBQUMvQixPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBRTFDLE9BQU8sRUFFTCxnQkFBZ0IsRUFDaEIsZUFBZSxFQUNmLE9BQU8sR0FDUixNQUFNLG1CQUFtQixDQUFDO0FBQzNCLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ3hELE9BQU8sRUFBRSxhQUFhLEVBQUUsZUFBZSxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBRTdELE1BQU0sQ0FBQyxJQUFNLG9CQUFvQixHQUFHLG1CQUFtQixDQUFDO0FBRXhELE1BQU0sQ0FBQyxJQUFNLFNBQVMsR0FBRyxVQUFVLENBQ2pDLFVBQUMsS0FBSyxJQUFLLE9BQUEsQ0FBQztJQUNWLElBQUksRUFBRTtRQUNKLFFBQVEsRUFBRSxVQUFVO0tBQ3JCO0lBQ0QsS0FBSyxFQUFFO1FBQ0wsZUFBZSxFQUFFLDJCQUEyQjtRQUM1QyxNQUFNLEVBQUUsdUJBQXVCO1FBQy9CLFlBQVksRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztRQUM5QixLQUFLLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsT0FBTztRQUNqQyxVQUFVLEVBQUUsS0FBSyxDQUFDLFVBQVUsQ0FBQyxVQUFVO1FBQ3ZDLFFBQVEsRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQztRQUMzQixVQUFVLEVBQUUsSUFBSTtRQUNoQixXQUFXLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUM7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LFdBQVcsRUFBQyxFQUFFLEVBQUMsV0FBVyxHQUFHO2dCQUNqRCw4QkFBTSxDQUFDLEVBQUMsMkNBQTJDLEdBQUc7Z0JBRXRELDhCQUFNLENBQUMsRUFBQyxHQUFHLEVBQUMsQ0FBQyxFQUFDLEdBQUcsRUFBQyxLQUFLLEVBQUMsS0FBSyxFQUFDLE1BQU0sRUFBQyxLQUFLLEdBQUcsQ0FDekMsQ0FDQztRQUNSLFdBQVcsSUFBSSxDQUNkLG9CQUFDLGVBQWUsSUFDZCxTQUFTLEVBQUUsT0FBTyxDQUFDLFdBQVcsRUFDOUIsS0FBSyxFQUFFLEtBQUssRUFDWixhQUFhLEVBQUUsUUFBUSxFQUN2QixhQUFhLEVBQUUsT0FBTyxDQUFDLFFBQVEsQ0FBQyxJQUUvQixXQUFXLENBQ0ksQ0FDbkIsQ0FDRyxDQUNQLENBQUM7QUFDSixDQUFDLENBQ0YsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBjbHN4IGZyb20gJ2Nsc3gnO1xuaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgbWFrZVN0eWxlcyB9IGZyb20gJy4uLy4uL3N0eWxlcyc7XG5pbXBvcnQgeyBHZXRDbGFzc2VzIH0gZnJvbSAnLi4vLi4vdHlwZVV0aWxzJztcbmltcG9ydCB7XG4gIEJhc2VGb3JtRWxlbWVudCxcbiAgYnVpbGREZXNjcmliZWRCeSxcbiAgRm9ybUhlbHBNZXNzYWdlLFxuICBoZWxwRm9yLFxufSBmcm9tICcuLi9fcHJpdmF0ZS9mb3Jtcyc7XG5pbXBvcnQgeyBnZW5lcmF0ZVVuaXF1ZUlkIH0gZnJvbSAnLi4vX3ByaXZhdGUvVW5pcXVlSWQnO1xuaW1wb3J0IHsgY2xlYXJDbGlwUGF0aCwgZGVmYXVsdENsaXBQYXRoIH0gZnJvbSAnLi9jbGlwUGF0aHMnO1xuXG5leHBvcnQgY29uc3QgU2VhcmNoRmllbGRTdHlsZXNLZXkgPSAnQ2hyb21hU2VhcmNoRmllbGQnO1xuXG5leHBvcnQgY29uc3QgdXNlU3R5bGVzID0gbWFrZVN0eWxlcyhcbiAgKHRoZW1lKSA9PiAoe1xuICAgIHJvb3Q6IHtcbiAgICAgIHBvc2l0aW9uOiAncmVsYXRpdmUnLFxuICAgIH0sXG4gICAgaW5wdXQ6IHtcbiAgICAgIGJhY2tncm91bmRDb2xvcjogJ3JnYmEoMTMyLCAxMzcsIDE2NiwgMC4xNSknLFxuICAgICAgYm9yZGVyOiBgMXB4IHNvbGlkIHRyYW5zcGFyZW50YCxcbiAgICAgIGJvcmRlclJhZGl1czogdGhlbWUucHhUb1JlbSg0KSxcbiAgICAgIGNvbG9yOiB0aGVtZS5wYWxldHRlLnRleHQucHJpbWFyeSxcbiAgICAgIGZvbnRGYW1pbHk6IHRoZW1lLnR5cG9ncmFwaHkuZm9udEZhbWlseSxcbiAgICAgIGZvbnRTaXplOiB0aGVtZS5weFRvUmVtKDE0KSxcbiAgICAgIGxpbmVIZWlnaHQ6IDEuMjUsXG4gICAgICBwYWRkaW5nTGVmdDogdGhlbWUuc3BhY2luZygxLjI1KSxcbiAgICAgIC8vIFJlcXVpcmVzIG1vcmUgcGFkZGluZ1JpZ2h0IHNvIHdlIGdpdmUgdGhlIHNlYXJjaCBpY29uIGVub3VnaFxuICAgICAgLy8gcm9vbSB3aGVuIHRoZSB0ZXh0IGluc2lkZSB0aGUgc2VhcmNoIGZpZWxkIGlzIGxvbmcuXG4gICAgICBwYWRkaW5nUmlnaHQ6IHRoZW1lLnNwYWNpbmcoMy43NSksXG4gICAgICB0cmFuc2l0aW9uOiAnYm9yZGVyIDAuMjVzIGVhc2UnLFxuICAgICAgbWF4V2lkdGg6IHRoZW1lLnB4VG9SZW0oMTczKSxcbiAgICAgICcmOmZvY3VzJzoge1xuICAgICAgICBvdXRsaW5lOiAnbm9uZScsXG4gICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMC41KScsXG4gICAgICAgIGJvcmRlcjogYDFweCBzb2xpZCByZ2JhKDEzMiwgMTM3LCAxNjYsIDAuNDUpYCxcbiAgICAgIH0sXG4gICAgICAnJjpkaXNhYmxlZCc6IHtcbiAgICAgICAgY3Vyc29yOiAnbm90LWFsbG93ZWQnLFxuICAgICAgICBvcGFjaXR5OiAwLjYyNSxcbiAgICAgICAgJyYgKyAkYnV0dG9uJzoge1xuICAgICAgICAgIGN1cnNvcjogJ25vdC1hbGxvd2VkJyxcbiAgICAgICAgICBvcGFjaXR5OiAwLjYyNSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICAnJjo6LXdlYmtpdC1pbnB1dC1wbGFjZWhvbGRlcic6IHtcbiAgICAgICAgY29sb3I6IHRoZW1lLnBhbGV0dGUuYmxhY2tbNDAwXSxcbiAgICAgIH0sXG4gICAgICAnJjo6LW1vei1wbGFjZWhvbGRlcic6IHtcbiAgICAgICAgY29sb3I6IHRoZW1lLnBhbGV0dGUuYmxhY2tbNDAwXSxcbiAgICAgIH0sXG4gICAgICAnJjotbXMtaW5wdXQtcGxhY2Vob2xkZXInOiB7XG4gICAgICAgIGNvbG9yOiB0aGVtZS5wYWxldHRlLmJsYWNrWzQwMF0sXG4gICAgICB9LFxuICAgICAgJyY6LW1vei1wbGFjZWhvbGRlcic6IHtcbiAgICAgICAgY29sb3I6IHRoZW1lLnBhbGV0dGUuYmxhY2tbNDAwXSxcbiAgICAgIH0sXG4gICAgICAvLyBIaWRlIHRoZSB3ZWJraXQgY2xlYXIgKHgpIGJ1dHRvblxuICAgICAgJyY6Oi13ZWJraXQtc2VhcmNoLWRlY29yYXRpb24sJjo6LXdlYmtpdC1zZWFyY2gtY2FuY2VsLWJ1dHRvbiwmOjotd2Via2l0LXNlYXJjaC1yZXN1bHRzLWJ1dHRvbiwmOjotd2Via2l0LXNlYXJjaC1yZXN1bHRzLWRlY29yYXRpb24nOiB7XG4gICAgICAgIGRpc3BsYXk6ICdub25lJyxcbiAgICAgIH0sXG4gICAgfSxcbiAgICBpbnB1dEludmVyc2U6IHtcbiAgICAgIGJhY2tncm91bmRDb2xvcjogJ3JnYmEoMjMwLCAyMzEsIDIzNywgMC4xKScsXG4gICAgICBjb2xvcjogdGhlbWUucGFsZXR0ZS5jb21tb24ud2hpdGUsXG4gICAgICAnJjpmb2N1cyc6IHtcbiAgICAgICAgYmFja2dyb3VuZENvbG9yOiAncmdiYSgyMzAsIDIzMSwgMjM3LCAwLjEpJyxcbiAgICAgICAgYm9yZGVyOiBgMXB4IHNvbGlkIHJnYmEoMjMwLCAyMzEsIDIzNywgMC41NSlgLFxuICAgICAgfSxcbiAgICAgICcmOjotd2Via2l0LWlucHV0LXBsYWNlaG9sZGVyJzoge1xuICAgICAgICBjb2xvcjogJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMC44KScsXG4gICAgICB9LFxuICAgICAgJyY6Oi1tb3otcGxhY2Vob2xkZXInOiB7XG4gICAgICAgIGNvbG9yOiAncmdiYSgyNTUsIDI1NSwgMjU1LCAwLjgpJyxcbiAgICAgIH0sXG4gICAgICAnJjotbXMtaW5wdXQtcGxhY2Vob2xkZXInOiB7XG4gICAgICAgIGNvbG9yOiAncmdiYSgyNTUsIDI1NSwgMjU1LCAwLjgpJyxcbiAgICAgIH0sXG4gICAgICAnJjotbW96LXBsYWNlaG9sZGVyJzoge1xuICAgICAgICBjb2xvcjogJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMC44KScsXG4gICAgICB9LFxuICAgIH0sXG4gICAgaW5wdXRIZWlnaHQwOiB7XG4gICAgICBwYWRkaW5nQm90dG9tOiB0aGVtZS5zcGFjaW5nKDAuNSksXG4gICAgICBwYWRkaW5nVG9wOiB0aGVtZS5zcGFjaW5nKDAuNSksXG4gICAgfSxcbiAgICBpbnB1dEhlaWdodDE6IHtcbiAgICAgIHBhZGRpbmdCb3R0b206IHRoZW1lLnNwYWNpbmcoMSksXG4gICAgICBwYWRkaW5nVG9wOiB0aGVtZS5zcGFjaW5nKDEpLFxuICAgIH0sXG4gICAgZnVsbFdpZHRoOiB7XG4gICAgICAnJiAkaW5wdXQnOiB7XG4gICAgICAgIG1heFdpZHRoOiAnbm9uZScsXG4gICAgICAgIHdpZHRoOiAnMTAwJScsXG4gICAgICB9LFxuICAgICAgJyYgJGJ1dHRvbic6IHtcbiAgICAgICAgbGVmdDogJ2F1dG8nLFxuICAgICAgICByaWdodDogdGhlbWUucHhUb1JlbSg1KSxcbiAgICAgIH0sXG4gICAgfSxcbiAgICBidXR0b246IHtcbiAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLFxuICAgICAgbGVmdDogdGhlbWUucHhUb1JlbSgxNDQpLFxuICAgICAgYWxpZ25JdGVtczogJ2NlbnRlcicsXG4gICAgICBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsXG4gICAgICBib3JkZXI6IDAsXG4gICAgICBjb2xvcjogdGhlbWUucGFsZXR0ZS5ibGFja1s1MDBdLFxuICAgICAgY3Vyc29yOiAncG9pbnRlcicsXG4gICAgICBkaXNwbGF5OiAnaW5saW5lLWZsZXgnLFxuICAgICAgZmxleDogJzAgMCBhdXRvJyxcbiAgICAgIGp1c3RpZnlDb250ZW50OiAnY2VudGVyJyxcbiAgICAgIG1hcmdpbjogMCxcbiAgICAgIG91dGxpbmU6ICdub25lJyxcbiAgICAgIHBhZGRpbmc6IDAsXG4gICAgICB0cmFuc2l0aW9uOiAnY29sb3IgMC4yNXMgZWFzZSwgb3BhY2l0eSAwLjI1cyBlYXNlJyxcbiAgICAgIHVzZXJTZWxlY3Q6ICdub25lJyxcbiAgICB9LFxuICAgIGJ1dHRvbkhlaWdodDA6IHtcbiAgICAgIHRvcDogdGhlbWUucHhUb1JlbSgwLjI1KSxcbiAgICB9LFxuICAgIGJ1dHRvbkhlaWdodDE6IHtcbiAgICAgIHRvcDogdGhlbWUucHhUb1JlbSg0KSxcbiAgICB9LFxuICAgIGJ1dHRvblN2Zzoge1xuICAgICAgd2lkdGg6IHRoZW1lLnB4VG9SZW0oMjQpLFxuICAgICAgaGVpZ2h0OiB0aGVtZS5weFRvUmVtKDI0KSxcbiAgICAgIC8vIEdsYXNzXG4gICAgICAnJiA+IGNpcmNsZSc6IHtcbiAgICAgICAgZmlsbDogJ3RyYW5zcGFyZW50JyxcbiAgICAgICAgc3Ryb2tlOiB0aGVtZS5wYWxldHRlLmJsYWNrWzUwMF0sXG4gICAgICAgIHN0cm9rZVdpZHRoOiA2LFxuICAgICAgICBzdHJva2VMaW5lY2FwOiAncm91bmQnLFxuICAgICAgfSxcbiAgICAgIC8vIE1hZ25pZnlpbmcgZ2xhc3MgcG9sZSBwYXJ0XG4gICAgICAnJiA+IHBhdGgnOiB7XG4gICAgICAgIGZpbGw6ICdub25lJyxcbiAgICAgICAgc3Ryb2tlOiB0aGVtZS5wYWxldHRlLmJsYWNrWzUwMF0sXG4gICAgICAgIHN0cm9rZURhc2hhcnJheTogJzEwIDUwJyxcbiAgICAgICAgc3Ryb2tlRGFzaG9mZnNldDogMjAsXG4gICAgICAgIHN0cm9rZUxpbmVjYXA6ICdyb3VuZCcsXG4gICAgICAgIHN0cm9rZVdpZHRoOiA3LFxuICAgICAgICB0cmFuc2l0aW9uOlxuICAgICAgICAgICdzdHJva2UtZGFzaGFycmF5IDIwMG1zLCBzdHJva2UtZGFzaG9mZnNldCAyMDBtcywgc3Ryb2tlIDIwMG1zJyxcbiAgICAgICAgJ0BtZWRpYSAocHJlZmVycy1yZWR1Y2VkLW1vdGlvbjogcmVkdWNlKSc6IHtcbiAgICAgICAgICB0cmFuc2l0aW9uOiAnbm9uZScsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgLy8gQmFja2dyb3VuZCBjaXJjbGUgZm9yIGdsYXNzIGFuZCBYIGNsZWFyXG4gICAgICAnJiA+IHJlY3QnOiB7XG4gICAgICAgIGNsaXBQYXRoOiBkZWZhdWx0Q2xpcFBhdGgsXG4gICAgICAgIFdlYmtpdENsaXBQYXRoOiBkZWZhdWx0Q2xpcFBhdGgsXG4gICAgICAgIGZpbGw6ICd0cmFuc3BhcmVudCcsXG4gICAgICAgIHRyYW5zaXRpb246ICdjbGlwLXBhdGggMTAwbXMgMTAwbXMnLFxuICAgICAgICAnQG1lZGlhIChwcmVmZXJzLXJlZHVjZWQtbW90aW9uOiByZWR1Y2UpJzoge1xuICAgICAgICAgIHRyYW5zaXRpb246ICdub25lJyxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgICBidXR0b25TdmdJbnZlcnNlOiB7XG4gICAgICAnJiA+IGNpcmNsZSc6IHtcbiAgICAgICAgc3Ryb2tlOiB0aGVtZS5wYWxldHRlLmNvbW1vbi53aGl0ZSxcbiAgICAgIH0sXG4gICAgICAnJiA+IHBhdGgnOiB7XG4gICAgICAgIHN0cm9rZTogdGhlbWUucGFsZXR0ZS5jb21tb24ud2hpdGUsXG4gICAgICB9LFxuICAgIH0sXG4gICAgYnV0dG9uU3ZnQ2xlYXI6IHtcbiAgICAgIG1hcmdpblRvcDogdGhlbWUuc3BhY2luZygwLjEyNSksXG4gICAgICAnJiA+IGNpcmNsZSc6IHtcbiAgICAgICAgZmlsbDogdGhlbWUucGFsZXR0ZS5ibGFja1s1MDBdLFxuICAgICAgfSxcbiAgICAgICcmID4gcGF0aCc6IHtcbiAgICAgICAgc3Ryb2tlRGFzaGFycmF5OiAnMjQgNTAnLFxuICAgICAgICBzdHJva2VEYXNob2Zmc2V0OiA3NCxcbiAgICAgICAgc3Ryb2tlOiB0aGVtZS5wYWxldHRlLmNvbW1vbi53aGl0ZSxcbiAgICAgIH0sXG4gICAgICAnJiA+IHJlY3QnOiB7XG4gICAgICAgIGNsaXBQYXRoOiBjbGVhckNsaXBQYXRoLFxuICAgICAgICBXZWJraXRDbGlwUGF0aDogY2xlYXJDbGlwUGF0aCxcbiAgICAgICAgZmlsbDogdGhlbWUucGFsZXR0ZS5jb21tb24ud2hpdGUsXG4gICAgICAgIHRyYW5zaXRpb246ICdjbGlwLXBhdGggMTAwbXMnLFxuICAgICAgICAnQG1lZGlhIChwcmVmZXJzLXJlZHVjZWQtbW90aW9uOiByZWR1Y2UpJzoge1xuICAgICAgICAgIHRyYW5zaXRpb246ICdub25lJyxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgICBidXR0b25TdmdDbGVhckludmVyc2U6IHtcbiAgICAgICcmID4gY2lyY2xlJzoge1xuICAgICAgICBmaWxsOiB0aGVtZS5wYWxldHRlLmNvbW1vbi53aGl0ZSxcbiAgICAgICAgc3Ryb2tlOiB0aGVtZS5wYWxldHRlLmNvbW1vbi53aGl0ZSxcbiAgICAgIH0sXG4gICAgICAnJiA+IHBhdGgnOiB7XG4gICAgICAgIHN0cm9rZTogdGhlbWUucGFsZXR0ZS5ibHVlWzcwMF0sXG4gICAgICB9LFxuICAgICAgJyYgPiByZWN0Jzoge1xuICAgICAgICBmaWxsOiB0aGVtZS5wYWxldHRlLmJsdWVbNzAwXSxcbiAgICAgIH0sXG4gICAgfSxcbiAgICBoZWxwTWVzc2FnZToge1xuICAgICAgbWFyZ2luVG9wOiB0aGVtZS5zcGFjaW5nKDEpLFxuICAgICAgbWFyZ2luTGVmdDogMCxcbiAgICB9LFxuICB9KSxcbiAgeyBuYW1lOiBTZWFyY2hGaWVsZFN0eWxlc0tleSB9XG4pO1xuXG5leHBvcnQgdHlwZSBTZWFyY2hGaWVsZENsYXNzZXMgPSBHZXRDbGFzc2VzPHR5cGVvZiB1c2VTdHlsZXM+O1xuXG5leHBvcnQgaW50ZXJmYWNlIFNlYXJjaEZpZWxkUHJvcHNcbiAgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnRQcm9wc1dpdGhSZWY8J2lucHV0Jz4sXG4gICAgUGljazxCYXNlRm9ybUVsZW1lbnQsICdoZWxwTWVzc2FnZSc+IHtcbiAgYnV0dG9uVHlwZT86IHN0cmluZztcbiAgY29sb3I/OiAnZGVmYXVsdCcgfCAnaW52ZXJzZSc7XG4gIGRpc2FibGVDbGVhck9uU2VhcmNoPzogYm9vbGVhbjtcbiAgZnVsbFdpZHRoPzogYm9vbGVhbjtcbiAgb25DbGVhcj86ICgpID0+IGFueTtcbiAgb25TZWFyY2g/KHRleHRWYWx1ZTogc3RyaW5nIHwgbnVtYmVyIHwgc3RyaW5nW10gfCB1bmRlZmluZWQpOiBhbnk7XG4gIGhlaWdodD86IDAgfCAxO1xufVxuXG5leHBvcnQgY29uc3QgU2VhcmNoRmllbGQgPSBSZWFjdC5mb3J3YXJkUmVmPEhUTUxJbnB1dEVsZW1lbnQsIFNlYXJjaEZpZWxkUHJvcHM+KFxuICAoXG4gICAge1xuICAgICAgWydhcmlhLWxhYmVsJ106IGFyaWFMYWJlbCxcbiAgICAgIGNsYXNzTmFtZSxcbiAgICAgIGNvbG9yID0gJ2RlZmF1bHQnLFxuICAgICAgZGlzYWJsZUNsZWFyT25TZWFyY2ggPSBmYWxzZSxcbiAgICAgIGZ1bGxXaWR0aCxcbiAgICAgIGhlaWdodCA9IDEsXG4gICAgICBpZCxcbiAgICAgIG5hbWUsXG4gICAgICBoZWxwTWVzc2FnZSxcbiAgICAgIG9uQ2hhbmdlLFxuICAgICAgb25TZWFyY2gsXG4gICAgICBvbkNsZWFyLFxuICAgICAgdmFsdWU6IHZhbHVlUHJvcCxcbiAgICAgIGRlZmF1bHRWYWx1ZSxcbiAgICAgIC4uLnJvb3RQcm9wc1xuICAgIH0sXG4gICAgcmVmXG4gICkgPT4ge1xuICAgIGNvbnN0IGNsYXNzZXMgPSB1c2VTdHlsZXMoe30pO1xuXG4gICAgY29uc3QgW3VuaXF1ZUlkXSA9IFJlYWN0LnVzZVN0YXRlPHN0cmluZz4oXG4gICAgICAoKSA9PiBpZCB8fCBuYW1lIHx8IGdlbmVyYXRlVW5pcXVlSWQoJ3NlYXJjaEZpZWxkLScpXG4gICAgKTtcblxuICAgIGNvbnN0IFtzaG93Q2xlYXIsIHNldFNob3dDbGVhcl0gPSBSZWFjdC51c2VTdGF0ZTxib29sZWFuPihmYWxzZSk7XG4gICAgY29uc3QgW3NlYXJjaFRleHQsIHNldFNlYXJjaFRleHRdID0gUmVhY3QudXNlU3RhdGU8c3RyaW5nPihcbiAgICAgIGRlZmF1bHRWYWx1ZT8udG9TdHJpbmcoKSA/PyAnJ1xuICAgICk7XG4gICAgY29uc3QgaXNDb250cm9sbGVkID0gdmFsdWVQcm9wICE9PSB1bmRlZmluZWQ7XG4gICAgY29uc3QgdmFsdWUgPSBpc0NvbnRyb2xsZWQgPyB2YWx1ZVByb3AhLnRvU3RyaW5nKCkgOiBzZWFyY2hUZXh0O1xuXG4gICAgaWYgKCFhcmlhTGFiZWwgJiYgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcpIHtcbiAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgJ1BsZWFzZSBwcm92aWRlIGFuIGFyaWEtbGFiZWwgdG8gU2VhcmNoRmllbGQuIFRoaXMgd2lsbCBiZSBhIHJlcXVpcmVkIHByb3BlcnR5IGluIGEgZnV0dXJlIG1ham9yIHJlbGVhc2UuJ1xuICAgICAgKTtcbiAgICB9XG5cbiAgICBjb25zdCBoYW5kbGVGb2N1cyA9IChlOiBSZWFjdC5Gb2N1c0V2ZW50PEhUTUxJbnB1dEVsZW1lbnQ+KSA9PiB7XG4gICAgICBpZiAoZS50YXJnZXQudmFsdWUubGVuZ3RoID4gMCkge1xuICAgICAgICBzZXRTaG93Q2xlYXIodHJ1ZSk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIGNvbnN0IGhhbmRsZUJsdXIgPSAoKSA9PiB7XG4gICAgICBpZiAodmFsdWUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHNldFNob3dDbGVhcihmYWxzZSk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIGNvbnN0IGhhbmRsZUNoYW5nZSA9IChlOiBSZWFjdC5DaGFuZ2VFdmVudDxIVE1MSW5wdXRFbGVtZW50PikgPT4ge1xuICAgICAgaWYgKCFpc0NvbnRyb2xsZWQpIHtcbiAgICAgICAgc2V0U2VhcmNoVGV4dChlLnRhcmdldC52YWx1ZSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChzaG93Q2xlYXIgJiYgZS50YXJnZXQudmFsdWUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHNldFNob3dDbGVhcihmYWxzZSk7XG4gICAgICB9XG5cbiAgICAgIGlmICghc2hvd0NsZWFyICYmIGUudGFyZ2V0LnZhbHVlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgc2V0U2hvd0NsZWFyKHRydWUpO1xuICAgICAgfVxuXG4gICAgICBvbkNoYW5nZT8uKGUpO1xuICAgIH07XG5cbiAgICBjb25zdCBoYW5kbGVLZXlQcmVzcyA9IChlOiBSZWFjdC5LZXlib2FyZEV2ZW50PEhUTUxJbnB1dEVsZW1lbnQ+KSA9PiB7XG4gICAgICBpZiAoZS5rZXkgPT09ICdFbnRlcicgJiYgIWRpc2FibGVDbGVhck9uU2VhcmNoKSB7XG4gICAgICAgIHNldFNob3dDbGVhcihmYWxzZSk7XG4gICAgICAgIG9uU2VhcmNoICYmIG9uU2VhcmNoKHZhbHVlKTtcbiAgICAgICAgc2V0U2VhcmNoVGV4dCgnJyk7XG4gICAgICB9XG5cbiAgICAgIGlmIChlLmtleSA9PT0gJ0VudGVyJyAmJiBkaXNhYmxlQ2xlYXJPblNlYXJjaCkge1xuICAgICAgICBvblNlYXJjaCAmJiBvblNlYXJjaCh2YWx1ZSk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIGNvbnN0IGhhbmRsZUNsZWFyQnV0dG9uQ2xpY2sgPSAoKSA9PiB7XG4gICAgICBzZXRTZWFyY2hUZXh0KCcnKTtcbiAgICAgIHNldFNob3dDbGVhcihmYWxzZSk7XG4gICAgICBvbkNsZWFyPy4oKTtcbiAgICAgIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodW5pcXVlSWQpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG4gICAgICBjb25zdCBldmVudCA9IG5ldyBFdmVudCgnY2hhbmdlJyk7XG4gICAgICBpbnB1dC52YWx1ZSA9ICcnO1xuICAgICAgaW5wdXQuZGlzcGF0Y2hFdmVudChldmVudCk7XG4gICAgICBvbkNoYW5nZT8uKChldmVudCBhcyB1bmtub3duKSBhcyBSZWFjdC5DaGFuZ2VFdmVudDxIVE1MSW5wdXRFbGVtZW50Pik7XG4gICAgfTtcblxuICAgIHJldHVybiAoXG4gICAgICA8ZGl2XG4gICAgICAgIGNsYXNzTmFtZT17Y2xzeChcbiAgICAgICAgICBjbGFzc2VzLnJvb3QsXG4gICAgICAgICAgZnVsbFdpZHRoICYmIGNsYXNzZXMuZnVsbFdpZHRoLFxuICAgICAgICAgIGNsYXNzTmFtZVxuICAgICAgICApfVxuICAgICAgPlxuICAgICAgICA8aW5wdXRcbiAgICAgICAgICBhcmlhLWRlc2NyaWJlZGJ5PXtidWlsZERlc2NyaWJlZEJ5KHtcbiAgICAgICAgICAgIGhhc0hlbHBNZXNzYWdlOiAhIWhlbHBNZXNzYWdlLFxuICAgICAgICAgICAgdW5pcXVlSWQsXG4gICAgICAgICAgfSl9XG4gICAgICAgICAgYXJpYS1sYWJlbD17YXJpYUxhYmVsIHx8ICdTZWFyY2ggZmllbGQnfVxuICAgICAgICAgIGNsYXNzTmFtZT17Y2xzeChcbiAgICAgICAgICAgIGNsYXNzZXMuaW5wdXQsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIFtjbGFzc2VzLmlucHV0SW52ZXJzZV06IGNvbG9yID09PSAnaW52ZXJzZScsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBbY2xhc3Nlcy5pbnB1dEhlaWdodDBdOiBoZWlnaHQgPT09IDAsXG4gICAgICAgICAgICAgIFtjbGFzc2VzLmlucHV0SGVpZ2h0MV06IGhlaWdodCA9PT0gMSxcbiAgICAgICAgICAgIH1cbiAgICAgICAgICApfVxuICAgICAgICAgIGlkPXt1bmlxdWVJZH1cbiAgICAgICAgICBuYW1lPXtuYW1lfVxuICAgICAgICAgIHJlZj17cmVmfVxuICAgICAgICAgIHR5cGU9XCJzZWFyY2hcIlxuICAgICAgICAgIG9uQ2hhbmdlPXtoYW5kbGVDaGFuZ2V9XG4gICAgICAgICAgb25LZXlQcmVzcz17aGFuZGxlS2V5UHJlc3N9XG4gICAgICAgICAgb25Gb2N1cz17aGFuZGxlRm9jdXN9XG4gICAgICAgICAgb25CbHVyPXtoYW5kbGVCbHVyfVxuICAgICAgICAgIHZhbHVlPXt2YWx1ZX1cbiAgICAgICAgICB7Li4ucm9vdFByb3BzfVxuICAgICAgICAvPlxuICAgICAgICA8YnV0dG9uXG4gICAgICAgICAgYXJpYS1sYWJlbD17c2hvd0NsZWFyID8gJ0NsZWFyIGlucHV0JyA6ICdTZWFyY2gnfVxuICAgICAgICAgIGNsYXNzTmFtZT17Y2xzeChjbGFzc2VzLmJ1dHRvbiwge1xuICAgICAgICAgICAgW2NsYXNzZXMuYnV0dG9uSGVpZ2h0MF06IGhlaWdodCA9PT0gMCxcbiAgICAgICAgICAgIFtjbGFzc2VzLmJ1dHRvbkhlaWdodDFdOiBoZWlnaHQgPT09IDEsXG4gICAgICAgICAgfSl9XG4gICAgICAgICAgdGFiSW5kZXg9ey0xfVxuICAgICAgICAgIG9uQ2xpY2s9e2hhbmRsZUNsZWFyQnV0dG9uQ2xpY2t9XG4gICAgICAgID5cbiAgICAgICAgICA8c3ZnXG4gICAgICAgICAgICBjbGFzc05hbWU9e2Nsc3goXG4gICAgICAgICAgICAgIGNsYXNzZXMuYnV0dG9uU3ZnLFxuICAgICAgICAgICAgICBjb2xvciA9PT0gJ2ludmVyc2UnICYmIGNsYXNzZXMuYnV0dG9uU3ZnSW52ZXJzZSxcbiAgICAgICAgICAgICAgc2hvd0NsZWFyICYmIGNsYXNzZXMuYnV0dG9uU3ZnQ2xlYXIsXG4gICAgICAgICAgICAgIGNvbG9yID09PSAnaW52ZXJzZScgJiYgc2hvd0NsZWFyICYmIGNsYXNzZXMuYnV0dG9uU3ZnQ2xlYXJJbnZlcnNlXG4gICAgICAgICAgICApfVxuICAgICAgICAgICAgdmlld0JveD1cIjAgMCAxMDAgMTAwXCJcbiAgICAgICAgICAgIHJvbGU9XCJpbWdcIlxuICAgICAgICAgICAgYXJpYS1oaWRkZW5cbiAgICAgICAgICA+XG4gICAgICAgICAgICA8Y2lyY2xlIHI9XCIyNC41XCIgY3k9XCI1NC4yMDAwMDFcIiBjeD1cIjQ1LjcwMDAwMVwiIC8+XG4gICAgICAgICAgICA8cGF0aCBkPVwiTSAzNy4yNDAzNDksNDYuNzMzMjQzIDcyLjU1MTE4NSw4Mi40MTQzODJcIiAvPlxuXG4gICAgICAgICAgICA8cmVjdCB4PVwiMFwiIHk9XCIwXCIgd2lkdGg9XCIxMDBcIiBoZWlnaHQ9XCIxMDBcIiAvPlxuICAgICAgICAgIDwvc3ZnPlxuICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAge2hlbHBNZXNzYWdlICYmIChcbiAgICAgICAgICA8Rm9ybUhlbHBNZXNzYWdlXG4gICAgICAgICAgICBjbGFzc05hbWU9e2NsYXNzZXMuaGVscE1lc3NhZ2V9XG4gICAgICAgICAgICBjb2xvcj17Y29sb3J9XG4gICAgICAgICAgICByb290RWxlbWVudElkPXt1bmlxdWVJZH1cbiAgICAgICAgICAgIGRlc2NyaWJlZEJ5SWQ9e2hlbHBGb3IodW5pcXVlSWQpfVxuICAgICAgICAgID5cbiAgICAgICAgICAgIHtoZWxwTWVzc2FnZX1cbiAgICAgICAgICA8L0Zvcm1IZWxwTWVzc2FnZT5cbiAgICAgICAgKX1cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH1cbik7XG4iXX0=