var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
import 'focus-visible';
import { DotLoader } from '../DotLoader/index';
import { getTestProps } from '../../testUtils/getTestProps';
import { makeStyles } from '../../styles/index';
import { motion } from 'framer-motion';
import { TableHeaderCell } from './TableHeaderCell';
import { TableModuleRow } from './TableModuleRow';
import { warning } from '../../utils';
import * as React from 'react';
import clsx from 'clsx';
export var testIds = {
    bodyCell: 'tableModule-bodyCell',
    bodyRow: 'tableModule-bodyRow',
    headerCell: 'tableModule-headerCell',
    headerRow: 'tableModule-headerRow',
    isLoadingRow: 'tableModule-isLoadingRow',
    noResultsRow: 'tableModule-noResultsRow',
};
export var TableModuleStylesKey = 'ChromaTableModule';
export var useStyles = makeStyles(function (theme) { return ({
    root: {
        background: theme.palette.common.white,
        borderSpacing: 0,
        boxShadow: theme.boxShadows.table,
        display: 'table',
        overflowX: 'auto',
        width: '100%',
    },
    rounded: {
        borderRadius: theme.pxToRem(4),
    },
    tableHeader: {
        display: 'table-header-group',
    },
    tableRow: {
        background: theme.palette.common.white,
        color: 'inherit',
        display: 'table-row',
        outline: 'none',
        verticalAlign: 'middle',
        '&:hover': {
            '& $tableRowActionCell': {
                visibility: 'visible',
            },
        },
        '&:focus.focus-visible, &:focus-within': {
            '& $tableRowActionCell': {
                visibility: 'visible',
            },
        },
    },
    tableDataRow: {
        borderBottom: "1px solid " + theme.palette.divider,
        '&:last-child': {
            borderBottom: 'none',
            // Hide table action cell bottom border
            // on the last table row to avoid 1px
            // vertical scroll
            '& $tableRowActionCell::after': {
                display: 'none',
            },
        },
        '&:hover': {
            background: "rgb(222, 244, 252, 0.25)",
            '& $tableModuleActions': {
                left: theme.pxToRem(8),
                opacity: 1,
                transition: '0.15s ease-out',
                transitionDelay: '0.15s',
            },
        },
        '&:focus.focus-visible, &:focus-within': {
            background: "rgb(222, 244, 252, 0.25)",
            '& $tableModuleActions': {
                left: theme.pxToRem(8),
                opacity: 1,
                transition: '0.15s ease-out',
                transitionDelay: '0.15s',
            },
        },
    },
    tableRowCell: {
        borderBottom: 'inherit',
        display: 'table-cell',
        fontSize: theme.typography.caption.fontSize,
        fontWeight: theme.typography.fontWeightRegular,
        paddingBottom: theme.spacing(1.75),
        paddingLeft: theme.spacing(2),
        paddingRight: theme.spacing(2),
        paddingTop: theme.spacing(1.75),
        textAlign: 'left',
        whiteSpace: 'nowrap',
        // First and last cells have default spacing
        // This matches the `TableHeaderCell`
        '&:first-of-type': {
            paddingLeft: theme.spacing(4),
        },
        '&:last-of-type': {
            paddingRight: theme.spacing(4),
        },
    },
    tableRowCellAlignRight: {
        textAlign: 'right',
    },
    tableRowCellTruncate: {
        textOverflow: 'ellipsis',
        overflow: 'hidden',
    },
    tableRowCellMaxWidth1: {
        maxWidth: '6.875rem',
    },
    tableRowCellMaxWidth2: {
        maxWidth: '10rem',
    },
    tableRowActionCell: {
        paddingTop: 0,
        paddingBottom: 0,
        paddingRight: 16,
        paddingLeft: 0,
        position: 'relative',
        textAlign: 'right',
        width: theme.pxToRem(1),
        // Add bottom border to table action row
        // when actions are hidden
        '&::after': {
            background: theme.palette.divider,
            content: "''",
            display: 'block',
            height: theme.pxToRem(1),
            left: 0,
            position: 'absolute',
            width: '100%',
            bottom: theme.pxToRem(-1),
        },
    },
    sticky: {
        position: 'sticky',
        right: 0,
    },
    tableModuleActions: {
        background: "linear-gradient(135deg,\n        " + theme.palette.primary.light + " 0%,\n        " + theme.palette.primary.main + " 22%,\n        " + theme.palette.purple[700] + " 92%)",
        borderRadius: theme.pxToRem(16),
        boxShadow: theme.boxShadows.tooltip,
        display: 'inline-flex',
        minHeight: theme.pxToRem(32),
        left: 0,
        opacity: 0,
        paddingLeft: '0.75rem',
        paddingRight: '0.75rem',
        paddingTop: '0.2rem',
        paddingBottom: '0.2rem',
        position: 'relative',
        '& > button': {
            minHeight: 0,
            // Add negative horizontal margins when there is
            // only one button so container appears as circle
            // instead of a pill shape
            '&:only-of-type': {
                marginLeft: theme.spacing(-0.375),
                marginRight: theme.spacing(-0.375),
            },
        },
    },
    tableLoadingCell: {
        borderBottom: 'inherit',
        display: 'table-cell',
        paddingBottom: theme.spacing(1),
        paddingLeft: theme.spacing(4),
        paddingTop: theme.spacing(1),
    },
    clickable: {
        '&:hover': {
            cursor: 'pointer',
        },
    },
}); }, { name: TableModuleStylesKey });
export var TableModule = React.memo(function (_a) {
    var _b = _a.config, config = _b === void 0 ? [] : _b, className = _a.className, data = _a.data, onRowClick = _a.onRowClick, _c = _a.isLoading, isLoading = _c === void 0 ? false : _c, rowRole = _a.rowRole, noResultsMessage = _a.noResultsMessage, _d = _a.sortState, sortState = _d === void 0 ? { sortKey: null, sortDirection: null } : _d, maxCellWidth = _a.maxCellWidth, rowActions = _a.rowActions, rowClickLabel = _a.rowClickLabel, rootProps = __rest(_a, ["config", "className", "data", "onRowClick", "isLoading", "rowRole", "noResultsMessage", "sortState", "maxCellWidth", "rowActions", "rowClickLabel"]);
    var classes = useStyles({});
    warning(Boolean(onRowClick) &&
        !rowClickLabel &&
        process.env.NODE_ENV === 'development', 'Chroma Warning: It is recommended you provide "rowClickLabel" if specifying a "onRowClick" for the <TableModule> component. This will be a required prop in a future major version.');
    var _e = React.useState(sortState), sort = _e[0], setSort = _e[1];
    var _f = React.useState((config === null || config === void 0 ? void 0 : config.map(function (c) { return c.header; })) || []), headings = _f[0], setHeadings = _f[1];
    var _g = React.useState((config === null || config === void 0 ? void 0 : config.map(function (c) { return c.cell; })) || []), cells = _g[0], setCells = _g[1];
    React.useEffect(function () {
        if (config.length > 0) {
            setHeadings(config.map(function (c) { return c.header; }));
            setCells(config.map(function (c) { return c.cell; }));
        }
    }, [config]);
    React.useEffect(function () {
        if (sortState.sortKey && headings) {
            var column = headings && headings[sortState.sortKey];
            column.onSort &&
                column.onSort({
                    index: sortState.sortKey,
                    sortDirection: sortState.sortDirection,
                    header: column,
                });
        }
    }, [headings, sortState.sortDirection, sortState.sortKey]);
    var handleSortColumnClick = function (_a) {
        var index = _a.index, sortDirection = _a.sortDirection, header = _a.header;
        // A column was clicked, and we either don't have a sort setup yet,
        // or we are moving from one column to another
        if (sort.sortKey !== index) {
            setSort({ sortKey: index, sortDirection: 'asc' });
            header.onSort && header.onSort({ index: index, sortDirection: 'asc', header: header });
            return;
        }
        // The same column was clicked, so we need to figure out
        // the sorting direction now
        if (!sortDirection) {
            setSort({ sortKey: index, sortDirection: 'asc' });
            header.onSort && header.onSort({ index: index, sortDirection: 'asc', header: header });
            return;
        }
        if (sortDirection === 'asc') {
            setSort({ sortKey: index, sortDirection: 'desc' });
            header.onSort &&
                header.onSort({ index: index, sortDirection: 'desc', header: header });
            return;
        }
        if (sortDirection === 'desc') {
            setSort({ sortKey: index, sortDirection: null });
            header.onSort && header.onSort({ index: index, sortDirection: null, header: header });
            return;
        }
    };
    return (React.createElement("table", __assign({ role: "table", className: clsx(classes.root, className) }, rootProps),
        React.createElement("thead", { className: classes.tableHeader },
            React.createElement("tr", __assign({ className: classes.tableRow, role: "row" }, getTestProps(testIds.headerRow)), headings === null || headings === void 0 ? void 0 :
                headings.map(function (header, i) { return (React.createElement(TableHeaderCell, __assign({ index: i, headingsCount: headings.length, key: i, header: header, isSorting: sort.sortKey === i, sortDirection: sort.sortDirection, onClick: handleSortColumnClick }, getTestProps(testIds.headerCell)))); }),
                (rowActions || onRowClick) && (React.createElement(TableHeaderCell, { header: {
                        label: '',
                    }, index: (headings === null || headings === void 0 ? void 0 : headings.length) + 1, headingsCount: headings.length, isSorting: false, sortDirection: sort.sortDirection })))),
        React.createElement("tbody", { role: "rowgroup" },
            !isLoading && data && data.length === 0 && (React.createElement("tr", __assign({ className: clsx(classes.tableRow, classes.tableDataRow), role: "row" }, getTestProps(testIds.noResultsRow)),
                React.createElement(motion.td, { className: classes.tableRowCell, colSpan: headings.length, role: "cell", initial: { opacity: 0 }, animate: { opacity: 1, transition: { duration: 1.5 } } }, noResultsMessage || 'No results'))), data === null || data === void 0 ? void 0 :
            data.map(function (row, rowIndex) {
                return (React.createElement(TableModuleRow, { key: "tableRow-" + rowIndex, data: row, onRowClick: onRowClick, rowRole: rowRole, maxCellWidth: maxCellWidth, row: row, headingsLength: headings === null || headings === void 0 ? void 0 : headings.length, cells: cells, rowActions: rowActions, rowClickLabel: rowClickLabel }));
            }),
            isLoading && (React.createElement("tr", __assign({ className: classes.tableRow }, getTestProps(testIds.isLoadingRow)),
                React.createElement("td", { className: classes.tableLoadingCell, colSpan: headings.length },
                    React.createElement(DotLoader, { size: 0 })))))));
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGFibGVNb2R1bGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9UYWJsZU1vZHVsZS9UYWJsZU1vZHVsZS50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLE9BQU8sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUUvQyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDNUQsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ2hELE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDdkMsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ3BELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBUXRDLE9BQU8sS0FBSyxLQUFLLE1BQU0sT0FBTyxDQUFDO0FBQy9CLE9BQU8sSUFBSSxNQUFNLE1BQU0sQ0FBQztBQUV4QixNQUFNLENBQUMsSUFBTSxPQUFPLEdBQUc7SUFDckIsUUFBUSxFQUFFLHNCQUFzQjtJQUNoQyxPQUFPLEVBQUUscUJBQXFCO0lBQzlCLFVBQVUsRUFBRSx3QkFBd0I7SUFDcEMsU0FBUyxFQUFFLHVCQUF1QjtJQUNsQyxZQUFZLEVBQUUsMEJBQTBCO0lBQ3hDLFlBQVksRUFBRSwwQkFBMEI7Q0FDekMsQ0FBQztBQUVGLE1BQU0sQ0FBQyxJQUFNLG9CQUFvQixHQUFHLG1CQUFtQixDQUFDO0FBRXhELE1BQU0sQ0FBQyxJQUFNLFNBQVMsR0FBRyxVQUFVLENBQ2pDLFVBQUMsS0FBSyxJQUFLLE9BQUEsQ0FBQztJQUNWLElBQUksRUFBRTtRQUNKLFVBQVUsRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FB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LHVCQUFSLFFBQVEsQ0FBRSxNQUFNLEVBQ2hDLEtBQUssRUFBRSxLQUFLLEVBQ1osVUFBVSxFQUFFLFVBQVUsRUFDdEIsYUFBYSxFQUFFLGFBQWEsR0FDNUIsQ0FDSCxDQUFDO1lBQ0osQ0FBQztZQUNBLFNBQVMsSUFBSSxDQUNaLHFDQUNFLFNBQVMsRUFBRSxPQUFPLENBQUMsUUFBUSxJQUN2QixZQUFZLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQztnQkFFdEMsNEJBQ0UsU0FBUyxFQUFFLE9BQU8sQ0FBQyxnQkFBZ0IsRUFDbkMsT0FBTyxFQUFFLFFBQVEsQ0FBQyxNQUFNO29CQUV4QixvQkFBQyxTQUFTLElBQUMsSUFBSSxFQUFFLENBQUMsR0FBSSxDQUNuQixDQUNGLENBQ04sQ0FDSyxDQUNGLENBQ1QsQ0FBQztBQUNKLENBQUMsQ0FDRixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICdmb2N1cy12aXNpYmxlJztcbmltcG9ydCB7IERvdExvYWRlciB9IGZyb20gJy4uL0RvdExvYWRlci9pbmRleCc7XG5pbXBvcnQgeyBHZXRDbGFzc2VzIH0gZnJvbSAnLi4vLi4vdHlwZVV0aWxzJztcbmltcG9ydCB7IGdldFRlc3RQcm9wcyB9IGZyb20gJy4uLy4uL3Rlc3RVdGlscy9nZXRUZXN0UHJvcHMnO1xuaW1wb3J0IHsgbWFrZVN0eWxlcyB9IGZyb20gJy4uLy4uL3N0eWxlcy9pbmRleCc7XG5pbXBvcnQgeyBtb3Rpb24gfSBmcm9tICdmcmFtZXItbW90aW9uJztcbmltcG9ydCB7IFRhYmxlSGVhZGVyQ2VsbCB9IGZyb20gJy4vVGFibGVIZWFkZXJDZWxsJztcbmltcG9ydCB7IFRhYmxlTW9kdWxlUm93IH0gZnJvbSAnLi9UYWJsZU1vZHVsZVJvdyc7XG5pbXBvcnQgeyB3YXJuaW5nIH0gZnJvbSAnLi4vLi4vdXRpbHMnO1xuaW1wb3J0IHtcbiAgVGFibGVTb3J0U3RhdGUsXG4gIFRhYmxlSGVhZGVyLFxuICBUYWJsZUNlbGwsXG4gIFRhYmxlQ29uZmlndXJhdGlvbixcbiAgVGFibGVTb3J0Q2xpY2tQcm9wcyxcbn0gZnJvbSAnLi90eXBlcyc7XG5pbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgY2xzeCBmcm9tICdjbHN4JztcblxuZXhwb3J0IGNvbnN0IHRlc3RJZHMgPSB7XG4gIGJvZHlDZWxsOiAndGFibGVNb2R1bGUtYm9keUNlbGwnLFxuICBib2R5Um93OiAndGFibGVNb2R1bGUtYm9keVJvdycsXG4gIGhlYWRlckNlbGw6ICd0YWJsZU1vZHVsZS1oZWFkZXJDZWxsJyxcbiAgaGVhZGVyUm93OiAndGFibGVNb2R1bGUtaGVhZGVyUm93JyxcbiAgaXNMb2FkaW5nUm93OiAndGFibGVNb2R1bGUtaXNMb2FkaW5nUm93JyxcbiAgbm9SZXN1bHRzUm93OiAndGFibGVNb2R1bGUtbm9SZXN1bHRzUm93Jyxcbn07XG5cbmV4cG9ydCBjb25zdCBUYWJsZU1vZHVsZVN0eWxlc0tleSA9ICdDaHJvbWFUYWJsZU1vZHVsZSc7XG5cbmV4cG9ydCBjb25zdCB1c2VTdHlsZXMgPSBtYWtlU3R5bGVzKFxuICAodGhlbWUpID0+ICh7XG4gICAgcm9vdDoge1xuICAgICAgYmFja2dyb3VuZDogdGhlbWUucGFsZXR0ZS5jb21tb24ud2hpdGUsXG4gICAgICBib3JkZXJTcGFjaW5nOiAwLFxuICAgICAgYm94U2hhZG93OiB0aGVtZS5ib3hTaGFkb3dzLnRhYmxlLFxuICAgICAgZGlzcGxheTogJ3RhYmxlJyxcbiAgICAgIG92ZXJmbG93WDogJ2F1dG8nLFxuICAgICAgd2lkdGg6ICcxMDAlJyxcbiAgICB9LFxuICAgIHJvdW5kZWQ6IHtcbiAgICAgIGJvcmRlclJhZGl1czogdGhlbWUucHhUb1JlbSg0KSxcbiAgICB9LFxuICAgIHRhYmxlSGVhZGVyOiB7XG4gICAgICBkaXNwbGF5OiAndGFibGUtaGVhZGVyLWdyb3VwJyxcbiAgICB9LFxuICAgIHRhYmxlUm93OiB7XG4gICAgICBiYWNrZ3JvdW5kOiB0aGVtZS5wYWxldHRlLmNvbW1vbi53aGl0ZSxcbiAgICAgIGNvbG9yOiAnaW5oZXJpdCcsXG4gICAgICBkaXNwbGF5OiAndGFibGUtcm93JyxcbiAgICAgIG91dGxpbmU6ICdub25lJyxcbiAgICAgIHZlcnRpY2FsQWxpZ246ICdtaWRkbGUnLFxuICAgICAgJyY6aG92ZXInOiB7XG4gICAgICAgICcmICR0YWJsZVJvd0FjdGlvbkNlbGwnOiB7XG4gICAgICAgICAgdmlzaWJpbGl0eTogJ3Zpc2libGUnLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgICcmOmZvY3VzLmZvY3VzLXZpc2libGUsICY6Zm9jdXMtd2l0aGluJzoge1xuICAgICAgICAnJiAkdGFibGVSb3dBY3Rpb25DZWxsJzoge1xuICAgICAgICAgIHZpc2liaWxpdHk6ICd2aXNpYmxlJyxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgICB0YWJsZURhdGFSb3c6IHtcbiAgICAgIGJvcmRlckJvdHRvbTogYDFweCBzb2xpZCAke3RoZW1lLnBhbGV0dGUuZGl2aWRlcn1gLFxuICAgICAgJyY6bGFzdC1jaGlsZCc6IHtcbiAgICAgICAgYm9yZGVyQm90dG9tOiAnbm9uZScsXG4gICAgICAgIC8vIEhpZGUgdGFibGUgYWN0aW9uIGNlbGwgYm90dG9tIGJvcmRlclxuICAgICAgICAvLyBvbiB0aGUgbGFzdCB0YWJsZSByb3cgdG8gYXZvaWQgMXB4XG4gICAgICAgIC8vIHZlcnRpY2FsIHNjcm9sbFxuICAgICAgICAnJiAkdGFibGVSb3dBY3Rpb25DZWxsOjphZnRlcic6IHtcbiAgICAgICAgICBkaXNwbGF5OiAnbm9uZScsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgJyY6aG92ZXInOiB7XG4gICAgICAgIGJhY2tncm91bmQ6IGByZ2IoMjIyLCAyNDQsIDI1MiwgMC4yNSlgLFxuICAgICAgICAnJiAkdGFibGVNb2R1bGVBY3Rpb25zJzoge1xuICAgICAgICAgIGxlZnQ6IHRoZW1lLnB4VG9SZW0oOCksXG4gICAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgICB0cmFuc2l0aW9uOiAnMC4xNXMgZWFzZS1vdXQnLFxuICAgICAgICAgIHRyYW5zaXRpb25EZWxheTogJzAuMTVzJyxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICAnJjpmb2N1cy5mb2N1cy12aXNpYmxlLCAmOmZvY3VzLXdpdGhpbic6IHtcbiAgICAgICAgYmFja2dyb3VuZDogYHJnYigyMjIsIDI0NCwgMjUyLCAwLjI1KWAsXG4gICAgICAgICcmICR0YWJsZU1vZHVsZUFjdGlvbnMnOiB7XG4gICAgICAgICAgbGVmdDogdGhlbWUucHhUb1JlbSg4KSxcbiAgICAgICAgICBvcGFjaXR5OiAxLFxuICAgICAgICAgIHRyYW5zaXRpb246ICcwLjE1cyBlYXNlLW91dCcsXG4gICAgICAgICAgdHJhbnNpdGlvbkRlbGF5OiAnMC4xNXMnLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9LFxuICAgIHRhYmxlUm93Q2VsbDoge1xuICAgICAgYm9yZGVyQm90dG9tOiAnaW5oZXJpdCcsXG4gICAgICBkaXNwbGF5OiAndGFibGUtY2VsbCcsXG4gICAgICBmb250U2l6ZTogdGhlbWUudHlwb2dyYXBoeS5jYXB0aW9uLmZvbnRTaXplLFxuICAgICAgZm9udFdlaWdodDogdGhlbWUudHlwb2dyYXBoeS5mb250V2VpZ2h0UmVndWxhcixcbiAgICAgIHBhZGRpbmdCb3R0b206IHRoZW1lLnNwYWNpbmcoMS43NSksXG4gICAgICBwYWRkaW5nTGVmdDogdGhlbWUuc3BhY2luZygyKSxcbiAgICAgIHBhZGRpbmdSaWdodDogdGhlbWUuc3BhY2luZygyKSxcbiAgICAgIHBhZGRpbmdUb3A6IHRoZW1lLnNwYWNpbmcoMS43NSksXG4gICAgICB0ZXh0QWxpZ246ICdsZWZ0JyxcbiAgICAgIHdoaXRlU3BhY2U6ICdub3dyYXAnLFxuICAgICAgLy8gRmlyc3QgYW5kIGxhc3QgY2VsbHMgaGF2ZSBkZWZhdWx0IHNwYWNpbmdcbiAgICAgIC8vIFRoaXMgbWF0Y2hlcyB0aGUgYFRhYmxlSGVhZGVyQ2VsbGBcbiAgICAgICcmOmZpcnN0LW9mLXR5cGUnOiB7XG4gICAgICAgIHBhZGRpbmdMZWZ0OiB0aGVtZS5zcGFjaW5nKDQpLFxuICAgICAgfSxcbiAgICAgICcmOmxhc3Qtb2YtdHlwZSc6IHtcbiAgICAgICAgcGFkZGluZ1JpZ2h0OiB0aGVtZS5zcGFjaW5nKDQpLFxuICAgICAgfSxcbiAgICB9LFxuICAgIHRhYmxlUm93Q2VsbEFsaWduUmlnaHQ6IHtcbiAgICAgIHRleHRBbGlnbjogJ3JpZ2h0JyxcbiAgICB9LFxuICAgIHRhYmxlUm93Q2VsbFRydW5jYXRlOiB7XG4gICAgICB0ZXh0T3ZlcmZsb3c6ICdlbGxpcHNpcycsXG4gICAgICBvdmVyZmxvdzogJ2hpZGRlbicsXG4gICAgfSxcbiAgICB0YWJsZVJvd0NlbGxNYXhXaWR0aDE6IHtcbiAgICAgIG1heFdpZHRoOiAnNi44NzVyZW0nLFxuICAgIH0sXG4gICAgdGFibGVSb3dDZWxsTWF4V2lkdGgyOiB7XG4gICAgICBtYXhXaWR0aDogJzEwcmVtJyxcbiAgICB9LFxuICAgIHRhYmxlUm93QWN0aW9uQ2VsbDoge1xuICAgICAgcGFkZGluZ1RvcDogMCxcbiAgICAgIHBhZGRpbmdCb3R0b206IDAsXG4gICAgICBwYWRkaW5nUmlnaHQ6IDE2LFxuICAgICAgcGFkZGluZ0xlZnQ6IDAsXG4gICAgICBwb3NpdGlvbjogJ3JlbGF0aXZlJyxcbiAgICAgIHRleHRBbGlnbjogJ3JpZ2h0JyxcbiAgICAgIHdpZHRoOiB0aGVtZS5weFRvUmVtKDEpLFxuICAgICAgLy8gQWRkIGJvdHRvbSBib3JkZXIgdG8gdGFibGUgYWN0aW9uIHJvd1xuICAgICAgLy8gd2hlbiBhY3Rpb25zIGFyZSBoaWRkZW5cbiAgICAgICcmOjphZnRlcic6IHtcbiAgICAgICAgYmFja2dyb3VuZDogdGhlbWUucGFsZXR0ZS5kaXZpZGVyLFxuICAgICAgICBjb250ZW50OiBgJydgLFxuICAgICAgICBkaXNwbGF5OiAnYmxvY2snLFxuICAgICAgICBoZWlnaHQ6IHRoZW1lLnB4VG9SZW0oMSksXG4gICAgICAgIGxlZnQ6IDAsXG4gICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLFxuICAgICAgICB3aWR0aDogJzEwMCUnLFxuICAgICAgICBib3R0b206IHRoZW1lLnB4VG9SZW0oLTEpLFxuICAgICAgfSxcbiAgICB9LFxuICAgIHN0aWNreToge1xuICAgICAgcG9zaXRpb246ICdzdGlja3knLFxuICAgICAgcmlnaHQ6IDAsXG4gICAgfSxcbiAgICB0YWJsZU1vZHVsZUFjdGlvbnM6IHtcbiAgICAgIGJhY2tncm91bmQ6IGBsaW5lYXItZ3JhZGllbnQoMTM1ZGVnLFxuICAgICAgICAke3RoZW1lLnBhbGV0dGUucHJpbWFyeS5saWdodH0gMCUsXG4gICAgICAgICR7dGhlbWUucGFsZXR0ZS5wcmltYXJ5Lm1haW59IDIyJSxcbiAgICAgICAgJHt0aGVtZS5wYWxldHRlLnB1cnBsZVs3MDBdfSA5MiUpYCxcbiAgICAgIGJvcmRlclJhZGl1czogdGhlbWUucHhUb1JlbSgxNiksXG4gICAgICBib3hTaGFkb3c6IHRoZW1lLmJveFNoYWRvd3MudG9vbHRpcCxcbiAgICAgIGRpc3BsYXk6ICdpbmxpbmUtZmxleCcsXG4gICAgICBtaW5IZWlnaHQ6IHRoZW1lLnB4VG9SZW0oMzIpLFxuICAgICAgbGVmdDogMCxcbiAgICAgIG9wYWNpdHk6IDAsXG4gICAgICBwYWRkaW5nTGVmdDogJzAuNzVyZW0nLFxuICAgICAgcGFkZGluZ1JpZ2h0OiAnMC43NXJlbScsXG4gICAgICBwYWRkaW5nVG9wOiAnMC4ycmVtJyxcbiAgICAgIHBhZGRpbmdCb3R0b206ICcwLjJyZW0nLFxuICAgICAgcG9zaXRpb246ICdyZWxhdGl2ZScsXG4gICAgICAnJiA+IGJ1dHRvbic6IHtcbiAgICAgICAgbWluSGVpZ2h0OiAwLFxuICAgICAgICAvLyBBZGQgbmVnYXRpdmUgaG9yaXpvbnRhbCBtYXJnaW5zIHdoZW4gdGhlcmUgaXNcbiAgICAgICAgLy8gb25seSBvbmUgYnV0dG9uIHNvIGNvbnRhaW5lciBhcHBlYXJzIGFzIGNpcmNsZVxuICAgICAgICAvLyBpbnN0ZWFkIG9mIGEgcGlsbCBzaGFwZVxuICAgICAgICAnJjpvbmx5LW9mLXR5cGUnOiB7XG4gICAgICAgICAgbWFyZ2luTGVmdDogdGhlbWUuc3BhY2luZygtMC4zNzUpLFxuICAgICAgICAgIG1hcmdpblJpZ2h0OiB0aGVtZS5zcGFjaW5nKC0wLjM3NSksXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0sXG4gICAgdGFibGVMb2FkaW5nQ2VsbDoge1xuICAgICAgYm9yZGVyQm90dG9tOiAnaW5oZXJpdCcsXG4gICAgICBkaXNwbGF5OiAndGFibGUtY2VsbCcsXG4gICAgICBwYWRkaW5nQm90dG9tOiB0aGVtZS5zcGFjaW5nKDEpLFxuICAgICAgcGFkZGluZ0xlZnQ6IHRoZW1lLnNwYWNpbmcoNCksXG4gICAgICBwYWRkaW5nVG9wOiB0aGVtZS5zcGFjaW5nKDEpLFxuICAgIH0sXG4gICAgY2xpY2thYmxlOiB7XG4gICAgICAnJjpob3Zlcic6IHtcbiAgICAgICAgY3Vyc29yOiAncG9pbnRlcicsXG4gICAgICB9LFxuICAgIH0sXG4gIH0pLFxuICB7IG5hbWU6IFRhYmxlTW9kdWxlU3R5bGVzS2V5IH1cbik7XG5cbmV4cG9ydCB0eXBlIFRhYmxlTW9kdWxlQ2xhc3NlcyA9IEdldENsYXNzZXM8dHlwZW9mIHVzZVN0eWxlcz47XG5cbmV4cG9ydCBpbnRlcmZhY2UgVGFibGVNb2R1bGVQcm9wczxJdGVtID0gYW55PlxuICBleHRlbmRzIFJlYWN0LkRldGFpbGVkSFRNTFByb3BzPFxuICAgIFJlYWN0LkhUTUxBdHRyaWJ1dGVzPEhUTUxUYWJsZUVsZW1lbnQ+LFxuICAgIEhUTUxUYWJsZUVsZW1lbnRcbiAgPiB7XG4gIGNvbmZpZz86IEFycmF5PFRhYmxlQ29uZmlndXJhdGlvbjxJdGVtPj47XG4gIGRhdGE/OiBBcnJheTxhbnk+O1xuICBpc0xvYWRpbmc/OiBib29sZWFuO1xuICBvblJvd0NsaWNrPzogKHJvdzogYW55KSA9PiB2b2lkO1xuICByb3dSb2xlPzogJ2xpbmsnO1xuICBub1Jlc3VsdHNNZXNzYWdlPzogc3RyaW5nO1xuICBzb3J0U3RhdGU/OiBUYWJsZVNvcnRTdGF0ZTtcbiAgbWF4Q2VsbFdpZHRoPzogMSB8IDI7XG4gIHJvd0FjdGlvbnM/OiAocm93OiBhbnkpID0+IFJlYWN0LlJlYWN0Tm9kZTtcbiAgcm93Q2xpY2tMYWJlbD86IHN0cmluZztcbn1cblxuZXhwb3J0IGNvbnN0IFRhYmxlTW9kdWxlOiBSZWFjdC5GQzxUYWJsZU1vZHVsZVByb3BzPiA9IFJlYWN0Lm1lbW8oXG4gICh7XG4gICAgY29uZmlnID0gW10sXG4gICAgY2xhc3NOYW1lLFxuICAgIGRhdGEsXG4gICAgb25Sb3dDbGljayxcbiAgICBpc0xvYWRpbmcgPSBmYWxzZSxcbiAgICByb3dSb2xlLFxuICAgIG5vUmVzdWx0c01lc3NhZ2UsXG4gICAgc29ydFN0YXRlID0geyBzb3J0S2V5OiBudWxsLCBzb3J0RGlyZWN0aW9uOiBudWxsIH0sXG4gICAgbWF4Q2VsbFdpZHRoLFxuICAgIHJvd0FjdGlvbnMsXG4gICAgcm93Q2xpY2tMYWJlbCxcbiAgICAuLi5yb290UHJvcHNcbiAgfSkgPT4ge1xuICAgIGNvbnN0IGNsYXNzZXMgPSB1c2VTdHlsZXMoe30pO1xuXG4gICAgd2FybmluZyhcbiAgICAgIEJvb2xlYW4ob25Sb3dDbGljaykgJiZcbiAgICAgICAgIXJvd0NsaWNrTGFiZWwgJiZcbiAgICAgICAgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcsXG4gICAgICAnQ2hyb21hIFdhcm5pbmc6IEl0IGlzIHJlY29tbWVuZGVkIHlvdSBwcm92aWRlIFwicm93Q2xpY2tMYWJlbFwiIGlmIHNwZWNpZnlpbmcgYSBcIm9uUm93Q2xpY2tcIiBmb3IgdGhlIDxUYWJsZU1vZHVsZT4gY29tcG9uZW50LiBUaGlzIHdpbGwgYmUgYSByZXF1aXJlZCBwcm9wIGluIGEgZnV0dXJlIG1ham9yIHZlcnNpb24uJ1xuICAgICk7XG5cbiAgICBjb25zdCBbc29ydCwgc2V0U29ydF0gPSBSZWFjdC51c2VTdGF0ZTxUYWJsZVNvcnRTdGF0ZT4oc29ydFN0YXRlKTtcblxuICAgIGNvbnN0IFtoZWFkaW5ncywgc2V0SGVhZGluZ3NdID0gUmVhY3QudXNlU3RhdGU8QXJyYXk8VGFibGVIZWFkZXI+PihcbiAgICAgIGNvbmZpZz8ubWFwKChjKSA9PiBjLmhlYWRlcikgfHwgW11cbiAgICApO1xuICAgIGNvbnN0IFtjZWxscywgc2V0Q2VsbHNdID0gUmVhY3QudXNlU3RhdGU8QXJyYXk8VGFibGVDZWxsPj4oXG4gICAgICBjb25maWc/Lm1hcCgoYykgPT4gYy5jZWxsKSB8fCBbXVxuICAgICk7XG5cbiAgICBSZWFjdC51c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgaWYgKGNvbmZpZy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHNldEhlYWRpbmdzKGNvbmZpZy5tYXAoKGMpID0+IGMuaGVhZGVyKSk7XG4gICAgICAgIHNldENlbGxzKGNvbmZpZy5tYXAoKGMpID0+IGMuY2VsbCkpO1xuICAgICAgfVxuICAgIH0sIFtjb25maWddKTtcblxuICAgIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICBpZiAoc29ydFN0YXRlLnNvcnRLZXkgJiYgaGVhZGluZ3MpIHtcbiAgICAgICAgY29uc3QgY29sdW1uID0gaGVhZGluZ3MgJiYgaGVhZGluZ3Nbc29ydFN0YXRlLnNvcnRLZXldO1xuICAgICAgICBjb2x1bW4ub25Tb3J0ICYmXG4gICAgICAgICAgY29sdW1uLm9uU29ydCh7XG4gICAgICAgICAgICBpbmRleDogc29ydFN0YXRlLnNvcnRLZXksXG4gICAgICAgICAgICBzb3J0RGlyZWN0aW9uOiBzb3J0U3RhdGUuc29ydERpcmVjdGlvbixcbiAgICAgICAgICAgIGhlYWRlcjogY29sdW1uLFxuICAgICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sIFtoZWFkaW5ncywgc29ydFN0YXRlLnNvcnREaXJlY3Rpb24sIHNvcnRTdGF0ZS5zb3J0S2V5XSk7XG5cbiAgICBjb25zdCBoYW5kbGVTb3J0Q29sdW1uQ2xpY2sgPSAoe1xuICAgICAgaW5kZXgsXG4gICAgICBzb3J0RGlyZWN0aW9uLFxuICAgICAgaGVhZGVyLFxuICAgIH06IFRhYmxlU29ydENsaWNrUHJvcHMpID0+IHtcbiAgICAgIC8vIEEgY29sdW1uIHdhcyBjbGlja2VkLCBhbmQgd2UgZWl0aGVyIGRvbid0IGhhdmUgYSBzb3J0IHNldHVwIHlldCxcbiAgICAgIC8vIG9yIHdlIGFyZSBtb3ZpbmcgZnJvbSBvbmUgY29sdW1uIHRvIGFub3RoZXJcbiAgICAgIGlmIChzb3J0LnNvcnRLZXkgIT09IGluZGV4KSB7XG4gICAgICAgIHNldFNvcnQoeyBzb3J0S2V5OiBpbmRleCwgc29ydERpcmVjdGlvbjogJ2FzYycgfSk7XG4gICAgICAgIGhlYWRlci5vblNvcnQgJiYgaGVhZGVyLm9uU29ydCh7IGluZGV4LCBzb3J0RGlyZWN0aW9uOiAnYXNjJywgaGVhZGVyIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIFRoZSBzYW1lIGNvbHVtbiB3YXMgY2xpY2tlZCwgc28gd2UgbmVlZCB0byBmaWd1cmUgb3V0XG4gICAgICAvLyB0aGUgc29ydGluZyBkaXJlY3Rpb24gbm93XG4gICAgICBpZiAoIXNvcnREaXJlY3Rpb24pIHtcbiAgICAgICAgc2V0U29ydCh7IHNvcnRLZXk6IGluZGV4LCBzb3J0RGlyZWN0aW9uOiAnYXNjJyB9KTtcbiAgICAgICAgaGVhZGVyLm9uU29ydCAmJiBoZWFkZXIub25Tb3J0KHsgaW5kZXgsIHNvcnREaXJlY3Rpb246ICdhc2MnLCBoZWFkZXIgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgaWYgKHNvcnREaXJlY3Rpb24gPT09ICdhc2MnKSB7XG4gICAgICAgIHNldFNvcnQoeyBzb3J0S2V5OiBpbmRleCwgc29ydERpcmVjdGlvbjogJ2Rlc2MnIH0pO1xuICAgICAgICBoZWFkZXIub25Tb3J0ICYmXG4gICAgICAgICAgaGVhZGVyLm9uU29ydCh7IGluZGV4LCBzb3J0RGlyZWN0aW9uOiAnZGVzYycsIGhlYWRlciB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAoc29ydERpcmVjdGlvbiA9PT0gJ2Rlc2MnKSB7XG4gICAgICAgIHNldFNvcnQoeyBzb3J0S2V5OiBpbmRleCwgc29ydERpcmVjdGlvbjogbnVsbCB9KTtcbiAgICAgICAgaGVhZGVyLm9uU29ydCAmJiBoZWFkZXIub25Tb3J0KHsgaW5kZXgsIHNvcnREaXJlY3Rpb246IG51bGwsIGhlYWRlciB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH07XG5cbiAgICByZXR1cm4gKFxuICAgICAgPHRhYmxlXG4gICAgICAgIHJvbGU9XCJ0YWJsZVwiXG4gICAgICAgIGNsYXNzTmFtZT17Y2xzeChjbGFzc2VzLnJvb3QsIGNsYXNzTmFtZSl9XG4gICAgICAgIHsuLi5yb290UHJvcHN9XG4gICAgICA+XG4gICAgICAgIDx0aGVhZCBjbGFzc05hbWU9e2NsYXNzZXMudGFibGVIZWFkZXJ9PlxuICAgICAgICAgIDx0clxuICAgICAgICAgICAgY2xhc3NOYW1lPXtjbGFzc2VzLnRhYmxlUm93fVxuICAgICAgICAgICAgcm9sZT1cInJvd1wiXG4gICAgICAgICAgICB7Li4uZ2V0VGVzdFByb3BzKHRlc3RJZHMuaGVhZGVyUm93KX1cbiAgICAgICAgICA+XG4gICAgICAgICAgICB7aGVhZGluZ3M/Lm1hcCgoaGVhZGVyLCBpKSA9PiAoXG4gICAgICAgICAgICAgIDxUYWJsZUhlYWRlckNlbGxcbiAgICAgICAgICAgICAgICBpbmRleD17aX1cbiAgICAgICAgICAgICAgICBoZWFkaW5nc0NvdW50PXtoZWFkaW5ncy5sZW5ndGh9XG4gICAgICAgICAgICAgICAga2V5PXtpfVxuICAgICAgICAgICAgICAgIGhlYWRlcj17aGVhZGVyfVxuICAgICAgICAgICAgICAgIGlzU29ydGluZz17c29ydC5zb3J0S2V5ID09PSBpfVxuICAgICAgICAgICAgICAgIHNvcnREaXJlY3Rpb249e3NvcnQuc29ydERpcmVjdGlvbn1cbiAgICAgICAgICAgICAgICBvbkNsaWNrPXtoYW5kbGVTb3J0Q29sdW1uQ2xpY2t9XG4gICAgICAgICAgICAgICAgey4uLmdldFRlc3RQcm9wcyh0ZXN0SWRzLmhlYWRlckNlbGwpfVxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgKSl9XG4gICAgICAgICAgICB7KHJvd0FjdGlvbnMgfHwgb25Sb3dDbGljaykgJiYgKFxuICAgICAgICAgICAgICA8VGFibGVIZWFkZXJDZWxsXG4gICAgICAgICAgICAgICAgaGVhZGVyPXt7XG4gICAgICAgICAgICAgICAgICBsYWJlbDogJycsXG4gICAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgICBpbmRleD17aGVhZGluZ3M/Lmxlbmd0aCArIDF9XG4gICAgICAgICAgICAgICAgaGVhZGluZ3NDb3VudD17aGVhZGluZ3MubGVuZ3RofVxuICAgICAgICAgICAgICAgIGlzU29ydGluZz17ZmFsc2V9XG4gICAgICAgICAgICAgICAgc29ydERpcmVjdGlvbj17c29ydC5zb3J0RGlyZWN0aW9ufVxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgKX1cbiAgICAgICAgICA8L3RyPlxuICAgICAgICA8L3RoZWFkPlxuICAgICAgICA8dGJvZHkgcm9sZT1cInJvd2dyb3VwXCI+XG4gICAgICAgICAgeyFpc0xvYWRpbmcgJiYgZGF0YSAmJiBkYXRhLmxlbmd0aCA9PT0gMCAmJiAoXG4gICAgICAgICAgICA8dHJcbiAgICAgICAgICAgICAgY2xhc3NOYW1lPXtjbHN4KGNsYXNzZXMudGFibGVSb3csIGNsYXNzZXMudGFibGVEYXRhUm93KX1cbiAgICAgICAgICAgICAgcm9sZT1cInJvd1wiXG4gICAgICAgICAgICAgIHsuLi5nZXRUZXN0UHJvcHModGVzdElkcy5ub1Jlc3VsdHNSb3cpfVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICA8bW90aW9uLnRkXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lPXtjbGFzc2VzLnRhYmxlUm93Q2VsbH1cbiAgICAgICAgICAgICAgICBjb2xTcGFuPXtoZWFkaW5ncy5sZW5ndGh9XG4gICAgICAgICAgICAgICAgcm9sZT1cImNlbGxcIlxuICAgICAgICAgICAgICAgIGluaXRpYWw9e3sgb3BhY2l0eTogMCB9fVxuICAgICAgICAgICAgICAgIGFuaW1hdGU9e3sgb3BhY2l0eTogMSwgdHJhbnNpdGlvbjogeyBkdXJhdGlvbjogMS41IH0gfX1cbiAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIHtub1Jlc3VsdHNNZXNzYWdlIHx8ICdObyByZXN1bHRzJ31cbiAgICAgICAgICAgICAgPC9tb3Rpb24udGQ+XG4gICAgICAgICAgICA8L3RyPlxuICAgICAgICAgICl9XG4gICAgICAgICAge2RhdGE/Lm1hcCgocm93LCByb3dJbmRleCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgPFRhYmxlTW9kdWxlUm93XG4gICAgICAgICAgICAgICAga2V5PXtgdGFibGVSb3ctJHtyb3dJbmRleH1gfVxuICAgICAgICAgICAgICAgIGRhdGE9e3Jvd31cbiAgICAgICAgICAgICAgICBvblJvd0NsaWNrPXtvblJvd0NsaWNrfVxuICAgICAgICAgICAgICAgIHJvd1JvbGU9e3Jvd1JvbGV9XG4gICAgICAgICAgICAgICAgbWF4Q2VsbFdpZHRoPXttYXhDZWxsV2lkdGh9XG4gICAgICAgICAgICAgICAgcm93PXtyb3d9XG4gICAgICAgICAgICAgICAgaGVhZGluZ3NMZW5ndGg9e2hlYWRpbmdzPy5sZW5ndGh9XG4gICAgICAgICAgICAgICAgY2VsbHM9e2NlbGxzfVxuICAgICAgICAgICAgICAgIHJvd0FjdGlvbnM9e3Jvd0FjdGlvbnN9XG4gICAgICAgICAgICAgICAgcm93Q2xpY2tMYWJlbD17cm93Q2xpY2tMYWJlbH1cbiAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSl9XG4gICAgICAgICAge2lzTG9hZGluZyAmJiAoXG4gICAgICAgICAgICA8dHJcbiAgICAgICAgICAgICAgY2xhc3NOYW1lPXtjbGFzc2VzLnRhYmxlUm93fVxuICAgICAgICAgICAgICB7Li4uZ2V0VGVzdFByb3BzKHRlc3RJZHMuaXNMb2FkaW5nUm93KX1cbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgPHRkXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lPXtjbGFzc2VzLnRhYmxlTG9hZGluZ0NlbGx9XG4gICAgICAgICAgICAgICAgY29sU3Bhbj17aGVhZGluZ3MubGVuZ3RofVxuICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgPERvdExvYWRlciBzaXplPXswfSAvPlxuICAgICAgICAgICAgICA8L3RkPlxuICAgICAgICAgICAgPC90cj5cbiAgICAgICAgICApfVxuICAgICAgICA8L3Rib2R5PlxuICAgICAgPC90YWJsZT5cbiAgICApO1xuICB9XG4pO1xuIl19