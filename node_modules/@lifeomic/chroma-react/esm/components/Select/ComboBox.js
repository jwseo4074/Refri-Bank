var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
var __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {
    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {
        if (ar || !(i in from)) {
            if (!ar) ar = Array.prototype.slice.call(from, 0, i);
            ar[i] = from[i];
        }
    }
    return to.concat(ar || Array.prototype.slice.call(from));
};
import { ChevronDown } from '@lifeomic/chromicons';
import { generateUniqueId } from '../_private/UniqueId';
import { motion, useReducedMotion } from 'framer-motion';
import { Portal } from 'reakit/Portal';
import { Rover, useRoverState } from 'reakit/Rover';
import { useStyles } from './Select';
import { Text } from '../Text';
import { buildDescribedBy, errorFor, FormErrorMessage, FormHelpMessage, helpFor, } from '../_private/forms';
import { Popover as ReakitPopover, PopoverDisclosure, usePopoverState, } from 'reakit/Popover';
import clsx from 'clsx';
import FocusLock from 'react-focus-lock';
import * as React from 'react';
var popoverVariants = {
    open: {
        opacity: 1,
        offsetTop: -2,
        transition: {
            duration: 0.25,
            ease: 'easeOut',
        },
    },
    closed: {
        opacity: 0,
        offsetTop: -18,
    },
};
var popoverVariantsReduced = {
    open: {
        opacity: 1,
        transition: {
            duration: 0.2,
            ease: 'easeOut',
        },
    },
    closed: {
        opacity: 0,
    },
};
var listMotionVariants = {
    open: {
        transition: {
            delayChildren: 0.025,
            staggerChildren: 0.045,
            duration: 0.2,
        },
    },
    closed: {},
};
var listMotionVariantsReduced = {
    open: {},
    closed: {},
};
var listItemMotionVariants = {
    open: {
        y: 0,
        opacity: 1,
        transition: {
            y: { stiffness: 1000, velocity: -100 },
        },
    },
    closed: {
        y: -16,
        opacity: 0,
    },
};
var listItemMotionVariantsReduced = {
    open: {
        opacity: 1,
    },
    closed: {
        opacity: 0,
    },
};
export var ComboBox = function (_a) {
    var _b;
    var ariaLabel = _a["aria-label"], children = _a.children, className = _a.className, _c = _a.color, color = _c === void 0 ? 'default' : _c, errorMessage = _a.errorMessage, fullWidth = _a.fullWidth, hasError = _a.hasError, helpMessage = _a.helpMessage, id = _a.id, label = _a.label, secondaryLabel = _a.secondaryLabel, onChange = _a.onChange, placeholder = _a.placeholder, placement = _a.placement, popoverAriaLabel = _a.popoverAriaLabel, selectedOptionDisplay = _a.selectedOptionDisplay, value = _a.value, rootProps = __rest(_a, ['aria-label', "children", "className", "color", "errorMessage", "fullWidth", "hasError", "helpMessage", "id", "label", "secondaryLabel", "onChange", "placeholder", "placement", "popoverAriaLabel", "selectedOptionDisplay", "value"]);
    var classes = useStyles({});
    var popover = usePopoverState({ placement: placement });
    var rover = useRoverState({ loop: true, orientation: 'vertical' });
    var shouldReduceMotion = useReducedMotion();
    var buttonRef = React.useRef();
    // This width is used to determine the popover width when open,
    // as well as setting the `maxWidth` of the text inside to ensure
    // the element size doesn't shift when the selected option text
    // gets long.
    var _d = React.useState(50), width = _d[0], setWidth = _d[1];
    var _e = React.useState(null), internalSelections = _e[0], setInternalSelections = _e[1];
    // A uniqueId is required to wire up aria-attributes
    var uniqueId = React.useState(function () { return id || name || generateUniqueId('combobox-'); })[0];
    // Update the opened popover width when the window width changes
    // TODO: Review the best way to handle this without breaking
    // eslint-disable-next-line react-hooks/exhaustive-deps
    React.useEffect(function () {
        setWidth(buttonRef.current.getBoundingClientRect().width);
    });
    // Determine which of the child select option values are matches based on
    // the "value" prop.  If a select option value is included in the "value",
    // then we add it to the list of internal select options (which keep
    // track of which options are selected to apply classes)
    React.useEffect(function () {
        var matches = React.Children.toArray(children).filter(function (child) {
            if (!React.isValidElement(child)) {
                return null;
            }
            return value === null || value === void 0 ? void 0 : value.includes(child.props.value);
        });
        if (matches.length === 0) {
            setInternalSelections([]);
            return;
        }
        setInternalSelections(matches.map(function (m) { return m.props; }));
    }, [children, value]);
    var handleOptionSelected = function (optionValue, meta) {
        var isAlreadySelected = internalSelections === null || internalSelections === void 0 ? void 0 : internalSelections.find(function (s) { return s.value === optionValue; });
        if (isAlreadySelected) {
            // Filter out the option the user selected from our list of internal selections
            // (so that it's removed), and then pass the values and meta arrays back
            // to the consumer.
            var filteredSelections = (internalSelections === null || internalSelections === void 0 ? void 0 : internalSelections.filter(function (s) { return s.value !== optionValue; })) || [];
            onChange === null || onChange === void 0 ? void 0 : onChange(__spreadArray([], filteredSelections === null || filteredSelections === void 0 ? void 0 : filteredSelections.map(function (s) { return s.value; }), true), __spreadArray([], filteredSelections === null || filteredSelections === void 0 ? void 0 : filteredSelections.map(function (s) { return s.meta; }), true));
            return;
        }
        // We are adding a selected option, so we collect all of the values
        // and meta arrays, add in our new selection, and return the updated
        // list to the consumer
        var valueOptions = (internalSelections === null || internalSelections === void 0 ? void 0 : internalSelections.map(function (s) { return s.value; })) || [];
        var metaOptions = (internalSelections === null || internalSelections === void 0 ? void 0 : internalSelections.map(function (s) { return s.meta; })) || [];
        onChange === null || onChange === void 0 ? void 0 : onChange(__spreadArray(__spreadArray([], valueOptions, true), [optionValue], false), __spreadArray(__spreadArray([], metaOptions, true), [meta], false));
    };
    if (!label && !ariaLabel && process.env.NODE_ENV === 'development') {
        throw new Error('If a "label" is not provided to ComboBox, please provide "aria-label".');
    }
    return (React.createElement("div", { className: clsx(classes.root, className) },
        React.createElement("label", { "aria-hidden": "true", className: clsx(classes.label, color === 'inverse' && classes.labelInverse, !label && ariaLabel && classes.srOnly), htmlFor: uniqueId },
            label || ariaLabel,
            secondaryLabel ? (React.createElement("span", { className: clsx(classes.labelSecondary, color === 'inverse' && classes.labelInverse) }, secondaryLabel)) : null),
        React.createElement(PopoverDisclosure, __assign({ className: clsx(classes.button, classes.comboxBoxOverflow, hasError && classes.buttonError, fullWidth && classes.buttonFullWidth, (_b = {},
                _b[classes.buttonInverse] = color === 'inverse',
                _b)), ref: buttonRef, "aria-describedby": buildDescribedBy({
                hasError: hasError,
                hasHelpMessage: !!helpMessage,
                uniqueId: uniqueId,
            }), id: uniqueId }, popover, rootProps),
            React.createElement(React.Fragment, null,
                (internalSelections === null || internalSelections === void 0 ? void 0 : internalSelections.length) === 0 && (React.createElement(motion.div, { initial: { opacity: 0 }, animate: {
                        opacity: 1,
                        transition: { duration: 0.2, ease: 'easeIn' },
                    } },
                    React.createElement(Text, { className: clsx(classes.buttonText, classes.placeholderText, classes.comboBoxPlaceholder), size: "subbody" }, placeholder))),
                internalSelections &&
                    (internalSelections === null || internalSelections === void 0 ? void 0 : internalSelections.length) > 0 &&
                    !selectedOptionDisplay && (React.createElement(Text, { className: clsx(classes.buttonText, classes.chipList), size: "subbody", style: fullWidth ? {} : { maxWidth: width - 42 } }, internalSelections === null || internalSelections === void 0 ? void 0 : internalSelections.map(function (selectedOption, index) { return (React.createElement(motion.span, { key: index, className: classes.chip, initial: shouldReduceMotion
                        ? { opacity: 0 }
                        : { opacity: 0, y: -8 }, animate: shouldReduceMotion
                        ? { opacity: 1 }
                        : {
                            opacity: 1,
                            transition: { duration: 0.2, ease: 'easeOut' },
                            y: 0,
                        } }, selectedOption.title)); }))),
                internalSelections &&
                    (internalSelections === null || internalSelections === void 0 ? void 0 : internalSelections.length) > 0 &&
                    selectedOptionDisplay && (React.createElement(Text, { className: classes.buttonText, size: "subbody" }, selectedOptionDisplay(internalSelections))),
                React.createElement("div", { className: classes.buttonArrowContainer, role: "presentation" },
                    React.createElement(ChevronDown, { className: clsx(classes.arrowIcon, popover.visible && classes.rotate), "aria-hidden": true, role: "img", width: 18, height: 18 })))),
        helpMessage && (React.createElement(FormHelpMessage, { className: classes.message, color: color, rootElementId: uniqueId, describedById: helpFor(uniqueId) }, helpMessage)),
        hasError && (React.createElement(FormErrorMessage, { className: classes.message, color: color, rootElementId: uniqueId, describedById: errorFor(uniqueId) }, errorMessage)),
        React.createElement(Portal, null,
            React.createElement(FocusLock, null,
                React.createElement(ReakitPopover, __assign({ "aria-label": label || ariaLabel || popoverAriaLabel, className: classes.popover }, popover, { style: { width: width }, as: motion.div, animate: popover.visible ? 'open' : 'closed', variants: shouldReduceMotion ? popoverVariantsReduced : popoverVariants }),
                    React.createElement(motion.ul, { className: classes.ul, variants: shouldReduceMotion
                            ? listMotionVariantsReduced
                            : listMotionVariants, role: "listbox", "aria-multiselectable": true }, React.Children.map(children, function (child) {
                        var _a, _b, _c, _d;
                        if (!React.isValidElement(child)) {
                            return null;
                        }
                        var option = child;
                        return (React.createElement(Rover, __assign({}, rover, { "aria-selected": value === null || value === void 0 ? void 0 : value.includes((_a = option === null || option === void 0 ? void 0 : option.props) === null || _a === void 0 ? void 0 : _a.value), className: classes.option, as: motion.li, disabled: (_b = child === null || child === void 0 ? void 0 : child.props) === null || _b === void 0 ? void 0 : _b.disabled, role: "option", value: (_c = option === null || option === void 0 ? void 0 : option.props) === null || _c === void 0 ? void 0 : _c.value, variants: shouldReduceMotion
                                ? listItemMotionVariantsReduced
                                : listItemMotionVariants, onClick: function () {
                                var _a, _b;
                                return handleOptionSelected((_a = option === null || option === void 0 ? void 0 : option.props) === null || _a === void 0 ? void 0 : _a.value, (_b = option === null || option === void 0 ? void 0 : option.props) === null || _b === void 0 ? void 0 : _b.meta);
                            } }), React.cloneElement(option, __assign({ isChecked: value === null || value === void 0 ? void 0 : value.includes((_d = option === null || option === void 0 ? void 0 : option.props) === null || _d === void 0 ? void 0 : _d.value) }, option.props))));
                    })))))));
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ29tYm9Cb3guanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9TZWxlY3QvQ29tYm9Cb3gudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDbkQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDeEQsT0FBTyxFQUFFLE1BQU0sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN6RCxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3ZDLE9BQU8sRUFBRSxLQUFLLEVBQUUsYUFBYSxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBRXBELE9BQU8sRUFBZSxTQUFTLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFDbEQsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLFNBQVMsQ0FBQztBQUMvQixPQUFPLEVBQ0wsZ0JBQWdCLEVBQ2hCLFFBQVEsRUFDUixnQkFBZ0IsRUFDaEIsZUFBZSxFQUNmLE9BQU8sR0FDUixNQUFNLG1CQUFtQixDQUFDO0FBQzNCLE9BQU8sRUFDTCxPQUFPLElBQUksYUFBYSxFQUN4QixpQkFBaUIsRUFDakIsZUFBZSxHQUNoQixNQUFNLGdCQUFnQixDQUFDO0FBQ3hCLE9BQU8sSUFBSSxNQUFNLE1BQU0sQ0FBQztBQUN4QixPQUFPLFNBQVMsTUFBTSxrQkFBa0IsQ0FBQztBQUN6QyxPQUFPLEtBQUssS0FBSyxNQUFNLE9BQU8sQ0FBQztBQUUvQixJQUFNLGVBQWUsR0FBRztJQUN0QixJQUFJLEVBQUU7UUFDSixPQUFPLEVBQUUsQ0FBQztRQUNWLFNBQVMsRUFBRSxDQUFDLENBQUM7UUFDYixVQUFVLEVBQUU7WUFDVixRQUFRLEVBQUUsSUFBSTtZQUNkLElBQUksRUFBRSxTQUFTO1NBQ2hCO0tBQ0Y7SUFDRCxN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dCI6WyJpbXBvcnQgeyBDaGV2cm9uRG93biB9IGZyb20gJ0BsaWZlb21pYy9jaHJvbWljb25zJztcbmltcG9ydCB7IGdlbmVyYXRlVW5pcXVlSWQgfSBmcm9tICcuLi9fcHJpdmF0ZS9VbmlxdWVJZCc7XG5pbXBvcnQgeyBtb3Rpb24sIHVzZVJlZHVjZWRNb3Rpb24gfSBmcm9tICdmcmFtZXItbW90aW9uJztcbmltcG9ydCB7IFBvcnRhbCB9IGZyb20gJ3JlYWtpdC9Qb3J0YWwnO1xuaW1wb3J0IHsgUm92ZXIsIHVzZVJvdmVyU3RhdGUgfSBmcm9tICdyZWFraXQvUm92ZXInO1xuaW1wb3J0IHsgU2VsZWN0T3B0aW9uUHJvcHMgfSBmcm9tICcuL1NlbGVjdE9wdGlvbic7XG5pbXBvcnQgeyBTZWxlY3RQcm9wcywgdXNlU3R5bGVzIH0gZnJvbSAnLi9TZWxlY3QnO1xuaW1wb3J0IHsgVGV4dCB9IGZyb20gJy4uL1RleHQnO1xuaW1wb3J0IHtcbiAgYnVpbGREZXNjcmliZWRCeSxcbiAgZXJyb3JGb3IsXG4gIEZvcm1FcnJvck1lc3NhZ2UsXG4gIEZvcm1IZWxwTWVzc2FnZSxcbiAgaGVscEZvcixcbn0gZnJvbSAnLi4vX3ByaXZhdGUvZm9ybXMnO1xuaW1wb3J0IHtcbiAgUG9wb3ZlciBhcyBSZWFraXRQb3BvdmVyLFxuICBQb3BvdmVyRGlzY2xvc3VyZSxcbiAgdXNlUG9wb3ZlclN0YXRlLFxufSBmcm9tICdyZWFraXQvUG9wb3Zlcic7XG5pbXBvcnQgY2xzeCBmcm9tICdjbHN4JztcbmltcG9ydCBGb2N1c0xvY2sgZnJvbSAncmVhY3QtZm9jdXMtbG9jayc7XG5pbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XG5cbmNvbnN0IHBvcG92ZXJWYXJpYW50cyA9IHtcbiAgb3Blbjoge1xuICAgIG9wYWNpdHk6IDEsXG4gICAgb2Zmc2V0VG9wOiAtMiwgLy8gUG9wcGVyLmpzICh1bmRlcmx5aW5nIFBvcG92ZXIpIHJlcXVpcmVzIGBvZmZTZXRUb3BgIG92ZXIgYG1hcmdpblRvcGBcbiAgICB0cmFuc2l0aW9uOiB7XG4gICAgICBkdXJhdGlvbjogMC4yNSxcbiAgICAgIGVhc2U6ICdlYXNlT3V0JyxcbiAgICB9LFxuICB9LFxuICBjbG9zZWQ6IHtcbiAgICBvcGFjaXR5OiAwLFxuICAgIG9mZnNldFRvcDogLTE4LFxuICB9LFxufTtcblxuY29uc3QgcG9wb3ZlclZhcmlhbnRzUmVkdWNlZCA9IHtcbiAgb3Blbjoge1xuICAgIG9wYWNpdHk6IDEsXG4gICAgdHJhbnNpdGlvbjoge1xuICAgICAgZHVyYXRpb246IDAuMixcbiAgICAgIGVhc2U6ICdlYXNlT3V0JyxcbiAgICB9LFxuICB9LFxuICBjbG9zZWQ6IHtcbiAgICBvcGFjaXR5OiAwLFxuICB9LFxufTtcblxuY29uc3QgbGlzdE1vdGlvblZhcmlhbnRzID0ge1xuICBvcGVuOiB7XG4gICAgdHJhbnNpdGlvbjoge1xuICAgICAgZGVsYXlDaGlsZHJlbjogMC4wMjUsXG4gICAgICBzdGFnZ2VyQ2hpbGRyZW46IDAuMDQ1LFxuICAgICAgZHVyYXRpb246IDAuMixcbiAgICB9LFxuICB9LFxuICBjbG9zZWQ6IHt9LFxufTtcblxuY29uc3QgbGlzdE1vdGlvblZhcmlhbnRzUmVkdWNlZCA9IHtcbiAgb3Blbjoge30sXG4gIGNsb3NlZDoge30sXG59O1xuXG5jb25zdCBsaXN0SXRlbU1vdGlvblZhcmlhbnRzID0ge1xuICBvcGVuOiB7XG4gICAgeTogMCxcbiAgICBvcGFjaXR5OiAxLFxuICAgIHRyYW5zaXRpb246IHtcbiAgICAgIHk6IHsgc3RpZmZuZXNzOiAxMDAwLCB2ZWxvY2l0eTogLTEwMCB9LFxuICAgIH0sXG4gIH0sXG4gIGNsb3NlZDoge1xuICAgIHk6IC0xNixcbiAgICBvcGFjaXR5OiAwLFxuICB9LFxufTtcblxuY29uc3QgbGlzdEl0ZW1Nb3Rpb25WYXJpYW50c1JlZHVjZWQgPSB7XG4gIG9wZW46IHtcbiAgICBvcGFjaXR5OiAxLFxuICB9LFxuICBjbG9zZWQ6IHtcbiAgICBvcGFjaXR5OiAwLFxuICB9LFxufTtcblxuZXhwb3J0IGludGVyZmFjZSBDb21ib0JveFByb3BzXG4gIGV4dGVuZHMgT21pdDxTZWxlY3RQcm9wcywgJ29uQ2hhbmdlJyB8ICdzZWxlY3RlZE9wdGlvbkRpc3BsYXknIHwgJ3ZhbHVlJz4ge1xuICBvbkNoYW5nZT86ICh2YWx1ZXM6IEFycmF5PHN0cmluZz4sIG1ldGE6IEFycmF5PHN0cmluZz4pID0+IHZvaWQ7XG4gIHNlbGVjdGVkT3B0aW9uRGlzcGxheT86IChcbiAgICBvcHRpb25zOiBBcnJheTxTZWxlY3RPcHRpb25Qcm9wcz5cbiAgKSA9PiBzdHJpbmcgfCBudWxsIHwgdW5kZWZpbmVkIHwgUmVhY3QuUmVhY3ROb2RlO1xuICB2YWx1ZT86IEFycmF5PHN0cmluZz4gfCB1bmRlZmluZWQ7XG59XG5cbmV4cG9ydCBjb25zdCBDb21ib0JveDogUmVhY3QuRkM8Q29tYm9Cb3hQcm9wcz4gPSAoe1xuICBbJ2FyaWEtbGFiZWwnXTogYXJpYUxhYmVsLFxuICBjaGlsZHJlbixcbiAgY2xhc3NOYW1lLFxuICBjb2xvciA9ICdkZWZhdWx0JyxcbiAgZXJyb3JNZXNzYWdlLFxuICBmdWxsV2lkdGgsXG4gIGhhc0Vycm9yLFxuICBoZWxwTWVzc2FnZSxcbiAgaWQsXG4gIGxhYmVsLFxuICBzZWNvbmRhcnlMYWJlbCxcbiAgb25DaGFuZ2UsXG4gIHBsYWNlaG9sZGVyLFxuICBwbGFjZW1lbnQsXG4gIHBvcG92ZXJBcmlhTGFiZWwsXG4gIHNlbGVjdGVkT3B0aW9uRGlzcGxheSxcbiAgdmFsdWUsXG4gIC4uLnJvb3RQcm9wc1xufSkgPT4ge1xuICBjb25zdCBjbGFzc2VzID0gdXNlU3R5bGVzKHt9KTtcbiAgY29uc3QgcG9wb3ZlciA9IHVzZVBvcG92ZXJTdGF0ZSh7IHBsYWNlbWVudCB9KTtcbiAgY29uc3Qgcm92ZXIgPSB1c2VSb3ZlclN0YXRlKHsgbG9vcDogdHJ1ZSwgb3JpZW50YXRpb246ICd2ZXJ0aWNhbCcgfSk7XG4gIGNvbnN0IHNob3VsZFJlZHVjZU1vdGlvbiA9IHVzZVJlZHVjZWRNb3Rpb24oKTtcblxuICBjb25zdCBidXR0b25SZWYgPSBSZWFjdC51c2VSZWY8YW55PigpO1xuXG4gIC8vIFRoaXMgd2lkdGggaXMgdXNlZCB0byBkZXRlcm1pbmUgdGhlIHBvcG92ZXIgd2lkdGggd2hlbiBvcGVuLFxuICAvLyBhcyB3ZWxsIGFzIHNldHRpbmcgdGhlIGBtYXhXaWR0aGAgb2YgdGhlIHRleHQgaW5zaWRlIHRvIGVuc3VyZVxuICAvLyB0aGUgZWxlbWVudCBzaXplIGRvZXNuJ3Qgc2hpZnQgd2hlbiB0aGUgc2VsZWN0ZWQgb3B0aW9uIHRleHRcbiAgLy8gZ2V0cyBsb25nLlxuICBjb25zdCBbd2lkdGgsIHNldFdpZHRoXSA9IFJlYWN0LnVzZVN0YXRlPG51bWJlcj4oNTApO1xuXG4gIGNvbnN0IFtpbnRlcm5hbFNlbGVjdGlvbnMsIHNldEludGVybmFsU2VsZWN0aW9uc10gPSBSZWFjdC51c2VTdGF0ZTxBcnJheTxcbiAgICBTZWxlY3RPcHRpb25Qcm9wc1xuICA+IHwgbnVsbD4obnVsbCk7XG5cbiAgLy8gQSB1bmlxdWVJZCBpcyByZXF1aXJlZCB0byB3aXJlIHVwIGFyaWEtYXR0cmlidXRlc1xuICBjb25zdCBbdW5pcXVlSWRdID0gUmVhY3QudXNlU3RhdGU8c3RyaW5nPihcbiAgICAoKSA9PiBpZCB8fCBuYW1lIHx8IGdlbmVyYXRlVW5pcXVlSWQoJ2NvbWJvYm94LScpXG4gICk7XG5cbiAgLy8gVXBkYXRlIHRoZSBvcGVuZWQgcG9wb3ZlciB3aWR0aCB3aGVuIHRoZSB3aW5kb3cgd2lkdGggY2hhbmdlc1xuICAvLyBUT0RPOiBSZXZpZXcgdGhlIGJlc3Qgd2F5IHRvIGhhbmRsZSB0aGlzIHdpdGhvdXQgYnJlYWtpbmdcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0LWhvb2tzL2V4aGF1c3RpdmUtZGVwc1xuICBSZWFjdC51c2VFZmZlY3QoKCkgPT4ge1xuICAgIHNldFdpZHRoKGJ1dHRvblJlZi5jdXJyZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoKTtcbiAgfSk7XG5cbiAgLy8gRGV0ZXJtaW5lIHdoaWNoIG9mIHRoZSBjaGlsZCBzZWxlY3Qgb3B0aW9uIHZhbHVlcyBhcmUgbWF0Y2hlcyBiYXNlZCBvblxuICAvLyB0aGUgXCJ2YWx1ZVwiIHByb3AuICBJZiBhIHNlbGVjdCBvcHRpb24gdmFsdWUgaXMgaW5jbHVkZWQgaW4gdGhlIFwidmFsdWVcIixcbiAgLy8gdGhlbiB3ZSBhZGQgaXQgdG8gdGhlIGxpc3Qgb2YgaW50ZXJuYWwgc2VsZWN0IG9wdGlvbnMgKHdoaWNoIGtlZXBcbiAgLy8gdHJhY2sgb2Ygd2hpY2ggb3B0aW9ucyBhcmUgc2VsZWN0ZWQgdG8gYXBwbHkgY2xhc3NlcylcbiAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHtcbiAgICBjb25zdCBtYXRjaGVzOiBhbnkgPSBSZWFjdC5DaGlsZHJlbi50b0FycmF5KGNoaWxkcmVuKS5maWx0ZXIoKGNoaWxkKSA9PiB7XG4gICAgICBpZiAoIVJlYWN0LmlzVmFsaWRFbGVtZW50KGNoaWxkKSkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHZhbHVlPy5pbmNsdWRlcyhjaGlsZC5wcm9wcy52YWx1ZSk7XG4gICAgfSk7XG5cbiAgICBpZiAobWF0Y2hlcy5sZW5ndGggPT09IDApIHtcbiAgICAgIHNldEludGVybmFsU2VsZWN0aW9ucyhbXSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgc2V0SW50ZXJuYWxTZWxlY3Rpb25zKG1hdGNoZXMubWFwKChtOiBhbnkpID0+IG0ucHJvcHMpKTtcbiAgfSwgW2NoaWxkcmVuLCB2YWx1ZV0pO1xuXG4gIGNvbnN0IGhhbmRsZU9wdGlvblNlbGVjdGVkID0gKG9wdGlvblZhbHVlOiBzdHJpbmcsIG1ldGE6IGFueSkgPT4ge1xuICAgIGNvbnN0IGlzQWxyZWFkeVNlbGVjdGVkID0gaW50ZXJuYWxTZWxlY3Rpb25zPy5maW5kKFxuICAgICAgKHMpID0+IHMudmFsdWUgPT09IG9wdGlvblZhbHVlXG4gICAgKTtcblxuICAgIGlmIChpc0FscmVhZHlTZWxlY3RlZCkge1xuICAgICAgLy8gRmlsdGVyIG91dCB0aGUgb3B0aW9uIHRoZSB1c2VyIHNlbGVjdGVkIGZyb20gb3VyIGxpc3Qgb2YgaW50ZXJuYWwgc2VsZWN0aW9uc1xuICAgICAgLy8gKHNvIHRoYXQgaXQncyByZW1vdmVkKSwgYW5kIHRoZW4gcGFzcyB0aGUgdmFsdWVzIGFuZCBtZXRhIGFycmF5cyBiYWNrXG4gICAgICAvLyB0byB0aGUgY29uc3VtZXIuXG4gICAgICBjb25zdCBmaWx0ZXJlZFNlbGVjdGlvbnMgPVxuICAgICAgICBpbnRlcm5hbFNlbGVjdGlvbnM/LmZpbHRlcigocykgPT4gcy52YWx1ZSAhPT0gb3B0aW9uVmFsdWUpIHx8IFtdO1xuICAgICAgb25DaGFuZ2U/LihcbiAgICAgICAgWy4uLmZpbHRlcmVkU2VsZWN0aW9ucz8ubWFwKChzKSA9PiBzLnZhbHVlKV0sXG4gICAgICAgIFsuLi5maWx0ZXJlZFNlbGVjdGlvbnM/Lm1hcCgocykgPT4gcy5tZXRhKV1cbiAgICAgICk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gV2UgYXJlIGFkZGluZyBhIHNlbGVjdGVkIG9wdGlvbiwgc28gd2UgY29sbGVjdCBhbGwgb2YgdGhlIHZhbHVlc1xuICAgIC8vIGFuZCBtZXRhIGFycmF5cywgYWRkIGluIG91ciBuZXcgc2VsZWN0aW9uLCBhbmQgcmV0dXJuIHRoZSB1cGRhdGVkXG4gICAgLy8gbGlzdCB0byB0aGUgY29uc3VtZXJcbiAgICBjb25zdCB2YWx1ZU9wdGlvbnMgPSBpbnRlcm5hbFNlbGVjdGlvbnM/Lm1hcCgocykgPT4gcy52YWx1ZSkgfHwgW107XG4gICAgY29uc3QgbWV0YU9wdGlvbnMgPSBpbnRlcm5hbFNlbGVjdGlvbnM/Lm1hcCgocykgPT4gcy5tZXRhKSB8fCBbXTtcbiAgICBvbkNoYW5nZT8uKFsuLi52YWx1ZU9wdGlvbnMsIG9wdGlvblZhbHVlXSwgWy4uLm1ldGFPcHRpb25zLCBtZXRhXSk7XG4gIH07XG5cbiAgaWYgKCFsYWJlbCAmJiAhYXJpYUxhYmVsICYmIHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgJ0lmIGEgXCJsYWJlbFwiIGlzIG5vdCBwcm92aWRlZCB0byBDb21ib0JveCwgcGxlYXNlIHByb3ZpZGUgXCJhcmlhLWxhYmVsXCIuJ1xuICAgICk7XG4gIH1cblxuICByZXR1cm4gKFxuICAgIDxkaXYgY2xhc3NOYW1lPXtjbHN4KGNsYXNzZXMucm9vdCwgY2xhc3NOYW1lKX0+XG4gICAgICA8bGFiZWxcbiAgICAgICAgYXJpYS1oaWRkZW49XCJ0cnVlXCJcbiAgICAgICAgY2xhc3NOYW1lPXtjbHN4KFxuICAgICAgICAgIGNsYXNzZXMubGFiZWwsXG4gICAgICAgICAgY29sb3IgPT09ICdpbnZlcnNlJyAmJiBjbGFzc2VzLmxhYmVsSW52ZXJzZSxcbiAgICAgICAgICAhbGFiZWwgJiYgYXJpYUxhYmVsICYmIGNsYXNzZXMuc3JPbmx5XG4gICAgICAgICl9XG4gICAgICAgIGh0bWxGb3I9e3VuaXF1ZUlkfVxuICAgICAgPlxuICAgICAgICB7bGFiZWwgfHwgYXJpYUxhYmVsfVxuICAgICAgICB7c2Vjb25kYXJ5TGFiZWwgPyAoXG4gICAgICAgICAgPHNwYW5cbiAgICAgICAgICAgIGNsYXNzTmFtZT17Y2xzeChcbiAgICAgICAgICAgICAgY2xhc3Nlcy5sYWJlbFNlY29uZGFyeSxcbiAgICAgICAgICAgICAgY29sb3IgPT09ICdpbnZlcnNlJyAmJiBjbGFzc2VzLmxhYmVsSW52ZXJzZVxuICAgICAgICAgICAgKX1cbiAgICAgICAgICA+XG4gICAgICAgICAgICB7c2Vjb25kYXJ5TGFiZWx9XG4gICAgICAgICAgPC9zcGFuPlxuICAgICAgICApIDogbnVsbH1cbiAgICAgIDwvbGFiZWw+XG4gICAgICA8UG9wb3ZlckRpc2Nsb3N1cmVcbiAgICAgICAgY2xhc3NOYW1lPXtjbHN4KFxuICAgICAgICAgIGNsYXNzZXMuYnV0dG9uLFxuICAgICAgICAgIGNsYXNzZXMuY29tYm94Qm94T3ZlcmZsb3csXG4gICAgICAgICAgaGFzRXJyb3IgJiYgY2xhc3Nlcy5idXR0b25FcnJvcixcbiAgICAgICAgICBmdWxsV2lkdGggJiYgY2xhc3Nlcy5idXR0b25GdWxsV2lkdGgsXG4gICAgICAgICAge1xuICAgICAgICAgICAgW2NsYXNzZXMuYnV0dG9uSW52ZXJzZV06IGNvbG9yID09PSAnaW52ZXJzZScsXG4gICAgICAgICAgfVxuICAgICAgICApfVxuICAgICAgICByZWY9e2J1dHRvblJlZn1cbiAgICAgICAgYXJpYS1kZXNjcmliZWRieT17YnVpbGREZXNjcmliZWRCeSh7XG4gICAgICAgICAgaGFzRXJyb3IsXG4gICAgICAgICAgaGFzSGVscE1lc3NhZ2U6ICEhaGVscE1lc3NhZ2UsXG4gICAgICAgICAgdW5pcXVlSWQsXG4gICAgICAgIH0pfVxuICAgICAgICBpZD17dW5pcXVlSWR9XG4gICAgICAgIHsuLi5wb3BvdmVyfVxuICAgICAgICB7Li4ucm9vdFByb3BzfVxuICAgICAgPlxuICAgICAgICA8PlxuICAgICAgICAgIHtpbnRlcm5hbFNlbGVjdGlvbnM/Lmxlbmd0aCA9PT0gMCAmJiAoXG4gICAgICAgICAgICA8bW90aW9uLmRpdlxuICAgICAgICAgICAgICBpbml0aWFsPXt7IG9wYWNpdHk6IDAgfX1cbiAgICAgICAgICAgICAgYW5pbWF0ZT17e1xuICAgICAgICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgICAgICAgICAgdHJhbnNpdGlvbjogeyBkdXJhdGlvbjogMC4yLCBlYXNlOiAnZWFzZUluJyB9LFxuICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICA8VGV4dFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17Y2xzeChcbiAgICAgICAgICAgICAgICAgIGNsYXNzZXMuYnV0dG9uVGV4dCxcbiAgICAgICAgICAgICAgICAgIGNsYXNzZXMucGxhY2Vob2xkZXJUZXh0LFxuICAgICAgICAgICAgICAgICAgY2xhc3Nlcy5jb21ib0JveFBsYWNlaG9sZGVyXG4gICAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgICAgICBzaXplPVwic3ViYm9keVwiXG4gICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICB7cGxhY2Vob2xkZXJ9XG4gICAgICAgICAgICAgIDwvVGV4dD5cbiAgICAgICAgICAgIDwvbW90aW9uLmRpdj5cbiAgICAgICAgICApfVxuICAgICAgICAgIHtpbnRlcm5hbFNlbGVjdGlvbnMgJiZcbiAgICAgICAgICAgIGludGVybmFsU2VsZWN0aW9ucz8ubGVuZ3RoID4gMCAmJlxuICAgICAgICAgICAgIXNlbGVjdGVkT3B0aW9uRGlzcGxheSAmJiAoXG4gICAgICAgICAgICAgIDxUZXh0XG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lPXtjbHN4KGNsYXNzZXMuYnV0dG9uVGV4dCwgY2xhc3Nlcy5jaGlwTGlzdCl9XG4gICAgICAgICAgICAgICAgc2l6ZT1cInN1YmJvZHlcIlxuICAgICAgICAgICAgICAgIHN0eWxlPXtmdWxsV2lkdGggPyB7fSA6IHsgbWF4V2lkdGg6IHdpZHRoIC0gNDIgfX1cbiAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIHtpbnRlcm5hbFNlbGVjdGlvbnM/Lm1hcCgoc2VsZWN0ZWRPcHRpb24sIGluZGV4KSA9PiAoXG4gICAgICAgICAgICAgICAgICA8bW90aW9uLnNwYW5cbiAgICAgICAgICAgICAgICAgICAga2V5PXtpbmRleH1cbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPXtjbGFzc2VzLmNoaXB9XG4gICAgICAgICAgICAgICAgICAgIGluaXRpYWw9e1xuICAgICAgICAgICAgICAgICAgICAgIHNob3VsZFJlZHVjZU1vdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgPyB7IG9wYWNpdHk6IDAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgOiB7IG9wYWNpdHk6IDAsIHk6IC04IH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBhbmltYXRlPXtcbiAgICAgICAgICAgICAgICAgICAgICBzaG91bGRSZWR1Y2VNb3Rpb25cbiAgICAgICAgICAgICAgICAgICAgICAgID8geyBvcGFjaXR5OiAxIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNpdGlvbjogeyBkdXJhdGlvbjogMC4yLCBlYXNlOiAnZWFzZU91dCcgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5OiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAge3NlbGVjdGVkT3B0aW9uLnRpdGxlfVxuICAgICAgICAgICAgICAgICAgPC9tb3Rpb24uc3Bhbj5cbiAgICAgICAgICAgICAgICApKX1cbiAgICAgICAgICAgICAgPC9UZXh0PlxuICAgICAgICAgICAgKX1cbiAgICAgICAgICB7aW50ZXJuYWxTZWxlY3Rpb25zICYmXG4gICAgICAgICAgICBpbnRlcm5hbFNlbGVjdGlvbnM/Lmxlbmd0aCA+IDAgJiZcbiAgICAgICAgICAgIHNlbGVjdGVkT3B0aW9uRGlzcGxheSAmJiAoXG4gICAgICAgICAgICAgIDxUZXh0IGNsYXNzTmFtZT17Y2xhc3Nlcy5idXR0b25UZXh0fSBzaXplPVwic3ViYm9keVwiPlxuICAgICAgICAgICAgICAgIHtzZWxlY3RlZE9wdGlvbkRpc3BsYXkoaW50ZXJuYWxTZWxlY3Rpb25zKX1cbiAgICAgICAgICAgICAgPC9UZXh0PlxuICAgICAgICAgICAgKX1cbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT17Y2xhc3Nlcy5idXR0b25BcnJvd0NvbnRhaW5lcn0gcm9sZT1cInByZXNlbnRhdGlvblwiPlxuICAgICAgICAgICAgPENoZXZyb25Eb3duXG4gICAgICAgICAgICAgIGNsYXNzTmFtZT17Y2xzeChcbiAgICAgICAgICAgICAgICBjbGFzc2VzLmFycm93SWNvbixcbiAgICAgICAgICAgICAgICBwb3BvdmVyLnZpc2libGUgJiYgY2xhc3Nlcy5yb3RhdGVcbiAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgICAgYXJpYS1oaWRkZW5cbiAgICAgICAgICAgICAgcm9sZT1cImltZ1wiXG4gICAgICAgICAgICAgIHdpZHRoPXsxOH1cbiAgICAgICAgICAgICAgaGVpZ2h0PXsxOH1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvPlxuICAgICAgPC9Qb3BvdmVyRGlzY2xvc3VyZT5cbiAgICAgIHtoZWxwTWVzc2FnZSAmJiAoXG4gICAgICAgIDxGb3JtSGVscE1lc3NhZ2VcbiAgICAgICAgICBjbGFzc05hbWU9e2NsYXNzZXMubWVzc2FnZX1cbiAgICAgICAgICBjb2xvcj17Y29sb3J9XG4gICAgICAgICAgcm9vdEVsZW1lbnRJZD17dW5pcXVlSWR9XG4gICAgICAgICAgZGVzY3JpYmVkQnlJZD17aGVscEZvcih1bmlxdWVJZCl9XG4gICAgICAgID5cbiAgICAgICAgICB7aGVscE1lc3NhZ2V9XG4gICAgICAgIDwvRm9ybUhlbHBNZXNzYWdlPlxuICAgICAgKX1cbiAgICAgIHtoYXNFcnJvciAmJiAoXG4gICAgICAgIDxGb3JtRXJyb3JNZXNzYWdlXG4gICAgICAgICAgY2xhc3NOYW1lPXtjbGFzc2VzLm1lc3NhZ2V9XG4gICAgICAgICAgY29sb3I9e2NvbG9yfVxuICAgICAgICAgIHJvb3RFbGVtZW50SWQ9e3VuaXF1ZUlkfVxuICAgICAgICAgIGRlc2NyaWJlZEJ5SWQ9e2Vycm9yRm9yKHVuaXF1ZUlkKX1cbiAgICAgICAgPlxuICAgICAgICAgIHtlcnJvck1lc3NhZ2V9XG4gICAgICAgIDwvRm9ybUVycm9yTWVzc2FnZT5cbiAgICAgICl9XG4gICAgICB7LypcbiAgICAgICAgQSBmZXcgdGhpbmdzIGhlcmU6XG5cbiAgICAgICAgMSkgV2Ugd2FudCB0byBhbHdheXMgcG9ydGFsIG91ciBzZWxlY3QgbWVudSByZXN1bHRzIHNvIHdlIGRvbid0XG4gICAgICAgICAgIHJ1biBpbnRvIHdlaXJkIGxheW91dCBpc3N1ZXMgKHJlbmRlcmluZyBpbnNpZGUgUG9wb3ZlciBvciBNb2RhbClcbiAgICAgICAgMikgV2UgbmVlZCB0byB0cmFwIGZvY3VzIGluc2lkZSBvZiB0aGUgbWVudSB3aGVuIGl0IGlzIG9wZW4gLSA8Rm9jdXNMb2NrIC8+IGhhbmRsZXMgdGhpcyBmb3IgdXNcbiAgICAgICAgMykgV2UgbmVlZCBrZXlib2FyZCBzdXBwb3J0IHZpYSA8Um92ZXIgLz5cblxuICAgICAgICBSZWZlcmVuY2UgZm9yICMxICYgIzI6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWFraXQvcmVha2l0L2lzc3Vlcy81NjZcbiAgICAgICovfVxuICAgICAgPFBvcnRhbD5cbiAgICAgICAgPEZvY3VzTG9jaz5cbiAgICAgICAgICA8UmVha2l0UG9wb3ZlclxuICAgICAgICAgICAgYXJpYS1sYWJlbD17bGFiZWwgfHwgYXJpYUxhYmVsIHx8IHBvcG92ZXJBcmlhTGFiZWx9XG4gICAgICAgICAgICBjbGFzc05hbWU9e2NsYXNzZXMucG9wb3Zlcn1cbiAgICAgICAgICAgIHsuLi5wb3BvdmVyfVxuICAgICAgICAgICAgc3R5bGU9e3sgd2lkdGggfX1cbiAgICAgICAgICAgIGFzPXttb3Rpb24uZGl2fVxuICAgICAgICAgICAgYW5pbWF0ZT17cG9wb3Zlci52aXNpYmxlID8gJ29wZW4nIDogJ2Nsb3NlZCd9XG4gICAgICAgICAgICB2YXJpYW50cz17XG4gICAgICAgICAgICAgIHNob3VsZFJlZHVjZU1vdGlvbiA/IHBvcG92ZXJWYXJpYW50c1JlZHVjZWQgOiBwb3BvdmVyVmFyaWFudHNcbiAgICAgICAgICAgIH1cbiAgICAgICAgICA+XG4gICAgICAgICAgICA8bW90aW9uLnVsXG4gICAgICAgICAgICAgIGNsYXNzTmFtZT17Y2xhc3Nlcy51bH1cbiAgICAgICAgICAgICAgdmFyaWFudHM9e1xuICAgICAgICAgICAgICAgIHNob3VsZFJlZHVjZU1vdGlvblxuICAgICAgICAgICAgICAgICAgPyBsaXN0TW90aW9uVmFyaWFudHNSZWR1Y2VkXG4gICAgICAgICAgICAgICAgICA6IGxpc3RNb3Rpb25WYXJpYW50c1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHJvbGU9XCJsaXN0Ym94XCJcbiAgICAgICAgICAgICAgYXJpYS1tdWx0aXNlbGVjdGFibGU9e3RydWV9XG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIHtSZWFjdC5DaGlsZHJlbi5tYXAoY2hpbGRyZW4sIChjaGlsZCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICghUmVhY3QuaXNWYWxpZEVsZW1lbnQoY2hpbGQpKSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBjb25zdCBvcHRpb246IFJlYWN0LlJlYWN0RWxlbWVudDxTZWxlY3RPcHRpb25Qcm9wcz4gPSBjaGlsZDtcbiAgICAgICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICAgICAgPFJvdmVyXG4gICAgICAgICAgICAgICAgICAgIHsuLi5yb3Zlcn1cbiAgICAgICAgICAgICAgICAgICAgYXJpYS1zZWxlY3RlZD17dmFsdWU/LmluY2x1ZGVzKG9wdGlvbj8ucHJvcHM/LnZhbHVlKX1cbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPXtjbGFzc2VzLm9wdGlvbn1cbiAgICAgICAgICAgICAgICAgICAgYXM9e21vdGlvbi5saX1cbiAgICAgICAgICAgICAgICAgICAgZGlzYWJsZWQ9e2NoaWxkPy5wcm9wcz8uZGlzYWJsZWR9XG4gICAgICAgICAgICAgICAgICAgIHJvbGU9XCJvcHRpb25cIlxuICAgICAgICAgICAgICAgICAgICB2YWx1ZT17b3B0aW9uPy5wcm9wcz8udmFsdWV9XG4gICAgICAgICAgICAgICAgICAgIHZhcmlhbnRzPXtcbiAgICAgICAgICAgICAgICAgICAgICBzaG91bGRSZWR1Y2VNb3Rpb25cbiAgICAgICAgICAgICAgICAgICAgICAgID8gbGlzdEl0ZW1Nb3Rpb25WYXJpYW50c1JlZHVjZWRcbiAgICAgICAgICAgICAgICAgICAgICAgIDogbGlzdEl0ZW1Nb3Rpb25WYXJpYW50c1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+XG4gICAgICAgICAgICAgICAgICAgICAgaGFuZGxlT3B0aW9uU2VsZWN0ZWQoXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb24/LnByb3BzPy52YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbj8ucHJvcHM/Lm1ldGFcbiAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAge1JlYWN0LmNsb25lRWxlbWVudDxTZWxlY3RPcHRpb25Qcm9wcz4ob3B0aW9uLCB7XG4gICAgICAgICAgICAgICAgICAgICAgaXNDaGVja2VkOiB2YWx1ZT8uaW5jbHVkZXMob3B0aW9uPy5wcm9wcz8udmFsdWUpLFxuICAgICAgICAgICAgICAgICAgICAgIC4uLm9wdGlvbi5wcm9wcyxcbiAgICAgICAgICAgICAgICAgICAgfSl9XG4gICAgICAgICAgICAgICAgICA8L1JvdmVyPlxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIH0pfVxuICAgICAgICAgICAgPC9tb3Rpb24udWw+XG4gICAgICAgICAgPC9SZWFraXRQb3BvdmVyPlxuICAgICAgICA8L0ZvY3VzTG9jaz5cbiAgICAgIDwvUG9ydGFsPlxuICAgIDwvZGl2PlxuICApO1xufTtcbiJdfQ==