var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
import { ConditionalWrapper } from '../_private/ConditionalWrapper';
import { IconButton } from '../IconButton';
import { makeStyles } from '../../styles';
import { ModalActions } from './ModalActions';
import { motion, AnimatePresence, useReducedMotion, } from 'framer-motion';
import { Portal } from 'reakit/Portal';
import { RemoveScroll } from 'react-remove-scroll';
import { Text } from '../Text';
import { useForkedRef } from './helpers';
import { X } from '@lifeomic/chromicons';
import clsx from 'clsx';
import FocusLock from 'react-focus-lock';
import * as React from 'react';
import { composeEventHandlers } from '../../utils';
var ariaDescribedBy = 'modal-content';
var ariaLabelledBy = 'modal-header';
export var ModalStylesKey = 'ChromaModal';
export var OVERLAY_TEST_ID = 'chroma-overlay-testid';
export var useStyles = makeStyles(function (theme) { return ({
    overlay: {
        backgroundColor: 'rgba(0, 0, 0, 0.5)',
        bottom: 0,
        display: 'flex',
        flexDirection: 'column',
        justifyContent: 'center',
        left: 0,
        overflow: 'auto',
        position: 'fixed',
        right: 0,
        top: 0,
        zIndex: 1200,
        '@media screen and (max-width: 480px)': {
            justifyContent: 'flex-end',
        },
    },
    content: {
        background: theme.palette.common.white,
        borderRadius: theme.pxToRem(10),
        display: 'flex',
        flexDirection: 'column',
        margin: '10vh auto',
        outline: 'none',
        paddingTop: theme.spacing(0.25),
        paddingBottom: theme.spacing(0.25),
        width: theme.pxToRem(384),
        maxWidth: theme.pxToRem(600),
        overflow: 'hidden',
        '@media screen and (max-width: 480px)': {
            marginBottom: theme.spacing(0.75),
            marginLeft: theme.spacing(0.75),
            marginRight: theme.spacing(0.75),
            maxHeight: '95%',
            maxWidth: '480px',
            width: 'unset',
        },
        '& form': {
            display: 'flex',
            flexDirection: 'column',
            overflow: 'hidden',
        },
    },
    contentFullWidth: {
        width: 'calc(100% - 6rem)',
        '@media screen and (max-width: 480px)': {
            width: 'unset',
        },
    },
    contentSize0: {
        maxHeight: theme.pxToRem(256),
        '@media screen and (max-width: 480px)': {
            maxHeight: 'unset',
        },
    },
    contentSize1: {
        maxHeight: theme.pxToRem(480),
        '@media screen and (max-width: 480px)': {
            maxHeight: 'unset',
        },
    },
    contentFullScreen: {
        background: theme.palette.common.white,
        display: 'flex',
        flexDirection: 'column',
        height: '100%',
        width: '100%',
        zIndex: 1200, // Has to go above the Header z-index
    },
    verticalPadding: {
        paddingLeft: theme.spacing(2),
        paddingRight: theme.spacing(2),
    },
    modalHeader: {
        alignItems: 'center',
        borderBottom: "1px solid ".concat(theme.palette.divider),
        display: 'flex',
        justifyContent: 'space-between',
        '&:only-child': {
            borderBottom: 'none',
        },
    },
    modalHeaderFullScreen: {
        alignItems: 'center',
        backgroundColor: theme.palette.common.white,
        borderBottom: "1px solid ".concat(theme.palette.divider),
        display: 'flex',
        justifyContent: 'space-between',
        paddingBottom: theme.spacing(0.5),
        paddingLeft: theme.spacing(2.5),
        paddingRight: theme.spacing(2.5),
        paddingTop: theme.spacing(0.5),
    },
    modalChildrenContainer: {
        background: theme.palette.background.default,
        // Added padding on the bottom so that the spacing
        // between the title and top of the text ~equals spacing
        // between bottom of content and actions container
        padding: theme.spacing(2, 2, 2.5),
        overflowY: 'auto',
        WebkitOverflowScrolling: 'touch', // Add iOS momentum scrolling.
    },
    modalChildrenContainerFullScreen: {
        background: theme.palette.grey[50],
        height: '100%',
        overflowY: 'auto',
        padding: theme.spacing(4, 3.75, 4, 3.75),
        width: '100%',
        WebkitOverflowScrolling: 'touch', // Add iOS momentum scrolling.
    },
    modalActions: {
        // On mobile, we want to do the following:
        // 1) Vertically stack the buttons
        // 2) Reverse the order of the actions.  On mobile devices,
        //    the negative/cancel action is normally at the *bottom*,
        //    whereas our default behavior with standard modals is
        //    <cancel> <save>
        // 3) Target the buttons and set the widths to take 100%
        // 4) Target the height of buttons and make them taller,
        //    just so that users have a larger tap-target
        '@media screen and (max-width: 480px)': {
            display: 'flex',
            flexDirection: 'column-reverse',
            '& > button': {
                width: '100%',
                height: theme.pxToRem(48),
                // Since we are `column-reverse`, margin on the bottom is now
                // margin top
                marginTop: theme.spacing(1),
                '&:last-of-type': {
                    marginTop: 0,
                },
            },
        },
    },
}); }, { name: ModalStylesKey });
var ModalInner = React.forwardRef(function (_a, ref) {
    var allowPinchZoom = _a.allowPinchZoom, overlayClassName = _a.overlayClassName, children = _a.children, onClick = _a.onClick, onDismiss = _a.onDismiss, disableDismissOnClickOutside = _a.disableDismissOnClickOutside, onMouseDown = _a.onMouseDown, onKeyDown = _a.onKeyDown;
    var classes = useStyles({});
    var mouseDownTarget = React.useRef(null);
    var overlayNode = React.useRef(null);
    var thisRef = useForkedRef(overlayNode, ref);
    return (
    // Since we are using FocusLock, we can safely ignore the `autoFocus` ESLint complaint
    // eslint-disable-next-line jsx-a11y/no-autofocus
    React.createElement(FocusLock, { autoFocus: true, returnFocus: true },
        React.createElement(RemoveScroll, { allowPinchZoom: allowPinchZoom },
            React.createElement(motion.div, { "data-testid": OVERLAY_TEST_ID, className: clsx(classes.overlay, overlayClassName), onClick: composeEventHandlers([
                    onClick,
                    function (event) {
                        if (mouseDownTarget.current === event.target) {
                            event.stopPropagation();
                            onDismiss &&
                                !disableDismissOnClickOutside &&
                                onDismiss(event);
                        }
                    },
                ]), onMouseDown: composeEventHandlers([
                    onMouseDown,
                    function (event) {
                        mouseDownTarget.current = event.target;
                    },
                ]), onKeyDown: composeEventHandlers([
                    onKeyDown,
                    function (event) {
                        if (event.key === 'Escape') {
                            event.stopPropagation();
                            onDismiss && onDismiss(event);
                        }
                    },
                ]), ref: thisRef, positionTransition: true, initial: { opacity: 0 }, animate: {
                    opacity: 1,
                    transition: { delay: 0.15, duration: 0.2 },
                }, exit: { opacity: 0, transition: { duration: 0.15 } } }, children))));
});
var Overlay = React.forwardRef(function (_a, ref) {
    var allowPinchZoom = _a.allowPinchZoom, _b = _a.isOpen, isOpen = _b === void 0 ? true : _b, rootProps = __rest(_a, ["allowPinchZoom", "isOpen"]);
    var ownRef = React.useRef(null);
    var thisRef = ref || ownRef;
    return (React.createElement(React.Fragment, null, isOpen ? (React.createElement(Portal, null,
        React.createElement(ModalInner, __assign({ allowPinchZoom: allowPinchZoom, ref: thisRef }, rootProps)))) : null));
});
var Content = React.forwardRef(function (_a, ref) {
    var _b;
    var actions = _a.actions, className = _a.className, children = _a.children, contentClassName = _a.contentClassName, fullWidth = _a.fullWidth, justifyActions = _a.justifyActions, isFormContent = _a.isFormContent, onFormSubmit = _a.onFormSubmit, onClick = _a.onClick, onDismiss = _a.onDismiss, customHeader = _a.customHeader, size = _a.size, title = _a.title, _c = _a.poses, poses = _c === void 0 ? {} : _c, rootProps = __rest(_a, ["actions", "className", "children", "contentClassName", "fullWidth", "justifyActions", "isFormContent", "onFormSubmit", "onClick", "onDismiss", "customHeader", "size", "title", "poses"]);
    var classes = useStyles({});
    var shouldReduceMotion = useReducedMotion();
    var poseVariants = {
        init: poses.init || { y: 50, scale: 0.3 },
        open: poses.open || { y: 0, scale: 1 },
        exit: poses.exit || { scale: 0.5, transition: { duration: 0.15 } },
    };
    return (React.createElement(motion.div, __assign({ className: clsx(classes.content, fullWidth && classes.contentFullWidth, className), role: "dialog", "aria-modal": "true", "aria-describedby": ariaDescribedBy, "aria-labelledby": ariaLabelledBy, tabIndex: -1, onClick: composeEventHandlers([
            onClick,
            function (event) {
                event.stopPropagation();
            },
        ]), ref: ref, variants: poseVariants, initial: shouldReduceMotion ? {} : 'init', animate: shouldReduceMotion ? {} : 'open', exit: shouldReduceMotion ? {} : 'exit' }, rootProps),
        customHeader ? (customHeader) : (React.createElement("div", { id: ariaLabelledBy, className: clsx(classes.modalHeader, classes.verticalPadding) },
            !!title && (React.createElement(Text, { size: "subbody", weight: "bold" }, title)),
            React.createElement(IconButton, { "aria-label": "Close open modal", icon: X, size: 0, tabIndex: 0, onClick: onDismiss, paddingRight: 0 }))),
        React.createElement(ConditionalWrapper, { condition: Boolean(isFormContent && onFormSubmit), wrapper: function (children) { return (React.createElement("form", { onSubmit: onFormSubmit }, children)); } },
            children && (React.createElement("div", { id: ariaDescribedBy, className: clsx(classes.modalChildrenContainer, classes.verticalPadding, (_b = {},
                    _b[classes.contentSize0] = size === 0,
                    _b[classes.contentSize1] = size === 1,
                    _b), contentClassName) }, children)),
            !!actions && (React.createElement(ModalActions, { className: clsx(classes.modalActions, classes.verticalPadding), justify: justifyActions }, actions)))));
});
var FullScreenContent = React.forwardRef(function (_a, ref) {
    var children = _a.children, className = _a.className, contentClassName = _a.contentClassName, onClick = _a.onClick, onDismiss = _a.onDismiss, title = _a.title, customHeader = _a.customHeader, rootProps = __rest(_a, ["children", "className", "contentClassName", "onClick", "onDismiss", "title", "customHeader"]);
    var classes = useStyles({});
    return (React.createElement(motion.div, __assign({ className: clsx(classes.contentFullScreen, className), role: "dialog", "aria-modal": "true", "aria-describedby": ariaDescribedBy, "aria-labelledby": ariaLabelledBy, tabIndex: -1, onClick: composeEventHandlers([
            onClick,
            function (event) {
                event.stopPropagation();
            },
        ]), ref: ref, initial: { opacity: 0 }, animate: {
            opacity: 1,
            transition: { duration: 0.1, ease: [0.16, 1, 0.3, 1] }, // https://easings.net/#easeOutExpo
        }, exit: {
            opacity: 0,
            transition: { duration: 0.08, ease: [0.7, 0, 0.84, 0] },
        } }, rootProps),
        customHeader ? (customHeader) : (React.createElement("div", { id: ariaLabelledBy, className: classes.modalHeaderFullScreen },
            !!title && React.createElement(Text, { size: "subbody" }, title),
            React.createElement(IconButton, { "aria-label": "Close open modal", icon: X, size: 0, tabIndex: 0, onClick: onDismiss, paddingRight: 0 }))),
        React.createElement("div", { id: ariaDescribedBy, className: clsx(classes.modalChildrenContainerFullScreen, contentClassName) }, children)));
});
export var Modal = React.forwardRef(function (_a, ref) {
    var allowPinchZoom = _a.allowPinchZoom, isFullScreen = _a.isFullScreen, isOpen = _a.isOpen, onDismiss = _a.onDismiss, disableDismissOnClickOutside = _a.disableDismissOnClickOutside, _b = _a.size, size = _b === void 0 ? 0 : _b, overlayClassName = _a.overlayClassName, rootProps = __rest(_a, ["allowPinchZoom", "isFullScreen", "isOpen", "onDismiss", "disableDismissOnClickOutside", "size", "overlayClassName"]);
    var ownRef = React.useRef(null);
    // If a ref is forwarded, use it; otherwise, use ourselves as the ref
    var thisRef = ref || ownRef;
    return (React.createElement(AnimatePresence, null, isOpen ? (React.createElement(Overlay, { overlayClassName: overlayClassName, allowPinchZoom: allowPinchZoom, isOpen: isOpen, onDismiss: onDismiss, disableDismissOnClickOutside: disableDismissOnClickOutside }, isFullScreen ? (React.createElement(FullScreenContent, __assign({ ref: thisRef, size: size, onDismiss: onDismiss }, rootProps))) : (React.createElement(Content, __assign({ ref: thisRef, size: size, onDismiss: onDismiss }, rootProps))))) : null));
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTW9kYWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9Nb2RhbC9Nb2RhbC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBRXBFLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUMxQyxPQUFPLEVBQUUsWUFBWSxFQUFxQixNQUFNLGdCQUFnQixDQUFDO0FBQ2pFLE9BQU8sRUFDTCxNQUFNLEVBQ04sZUFBZSxFQUNmLGdCQUFnQixHQUVqQixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3ZDLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUNuRCxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sU0FBUyxDQUFDO0FBQy9CLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDekMsT0FBTyxFQUFFLENBQUMsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ3pDLE9BQU8sSUFBSSxNQUFNLE1BQU0sQ0FBQztBQUN4QixPQUFPLFNBQVMsTUFBTSxrQkFBa0IsQ0FBQztBQUN6QyxPQUFPLEtBQUssS0FBSyxNQUFNLE9BQU8sQ0FBQztBQUMvQixPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFFbkQsSUFBTSxlQUFlLEdBQUcsZUFBZSxDQUFDO0FBQ3hDLElBQU0sY0FBYyxHQUFHLGNBQWMsQ0FBQztBQUV0QyxNQUFNLENBQUMsSUFBTSxjQUFjLEdBQUcsYUFBYSxDQUFDO0FBRTVDLE1BQU0sQ0FBQyxJQUFNLGVBQWUsR0FBRyx1QkFBdUIsQ0FBQztBQUV2RCxNQUFNLENBQUMsSUFB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QUNyRSxJQUFNLE9BQU8sR0FBRyxHQUFHLElBQUksTUFBTSxDQUFDO0lBRTlCLE9BQU8sQ0FDTCxvQkFBQyxlQUFlLFFBQ2IsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUNSLG9CQUFDLE9BQU8sSUFDTixnQkFBZ0IsRUFBRSxnQkFBZ0IsRUFDbEMsY0FBYyxFQUFFLGNBQWMsRUFDOUIsTUFBTSxFQUFFLE1BQU0sRUFDZCxTQUFTLEVBQUUsU0FBUyxFQUNwQiw0QkFBNEIsRUFBRSw0QkFBNEIsSUFFekQsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUNkLG9CQUFDLGlCQUFpQixhQUNoQixHQUFHLEVBQUUsT0FBTyxFQUNaLElBQUksRUFBRSxJQUFJLEVBQ1YsU0FBUyxFQUFFLFNBQVMsSUFDaEIsU0FBUyxFQUNiLENBQ0gsQ0FBQyxDQUFDLENBQUMsQ0FDRixvQkFBQyxPQUFPLGFBQ04sR0FBRyxFQUFFLE9BQU8sRUFDWixJQUFJLEVBQUUsSUFBSSxFQUNWLFNBQVMsRUFBRSxTQUFTLElBQ2hCLFNBQVMsRUFDYixDQUNILENBQ08sQ0FDWCxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQ1EsQ0FDbkIsQ0FBQztBQUNKLENBQUMsQ0FDRixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29uZGl0aW9uYWxXcmFwcGVyIH0gZnJvbSAnLi4vX3ByaXZhdGUvQ29uZGl0aW9uYWxXcmFwcGVyJztcbmltcG9ydCB7IEdldENsYXNzZXMgfSBmcm9tICcuLi8uLi90eXBlVXRpbHMnO1xuaW1wb3J0IHsgSWNvbkJ1dHRvbiB9IGZyb20gJy4uL0ljb25CdXR0b24nO1xuaW1wb3J0IHsgbWFrZVN0eWxlcyB9IGZyb20gJy4uLy4uL3N0eWxlcyc7XG5pbXBvcnQgeyBNb2RhbEFjdGlvbnMsIE1vZGFsQWN0aW9uc1Byb3BzIH0gZnJvbSAnLi9Nb2RhbEFjdGlvbnMnO1xuaW1wb3J0IHtcbiAgbW90aW9uLFxuICBBbmltYXRlUHJlc2VuY2UsXG4gIHVzZVJlZHVjZWRNb3Rpb24sXG4gIFZhcmlhbnRzLFxufSBmcm9tICdmcmFtZXItbW90aW9uJztcbmltcG9ydCB7IFBvcnRhbCB9IGZyb20gJ3JlYWtpdC9Qb3J0YWwnO1xuaW1wb3J0IHsgUmVtb3ZlU2Nyb2xsIH0gZnJvbSAncmVhY3QtcmVtb3ZlLXNjcm9sbCc7XG5pbXBvcnQgeyBUZXh0IH0gZnJvbSAnLi4vVGV4dCc7XG5pbXBvcnQgeyB1c2VGb3JrZWRSZWYgfSBmcm9tICcuL2hlbHBlcnMnO1xuaW1wb3J0IHsgWCB9IGZyb20gJ0BsaWZlb21pYy9jaHJvbWljb25zJztcbmltcG9ydCBjbHN4IGZyb20gJ2Nsc3gnO1xuaW1wb3J0IEZvY3VzTG9jayBmcm9tICdyZWFjdC1mb2N1cy1sb2NrJztcbmltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IGNvbXBvc2VFdmVudEhhbmRsZXJzIH0gZnJvbSAnLi4vLi4vdXRpbHMnO1xuXG5jb25zdCBhcmlhRGVzY3JpYmVkQnkgPSAnbW9kYWwtY29udGVudCc7XG5jb25zdCBhcmlhTGFiZWxsZWRCeSA9ICdtb2RhbC1oZWFkZXInO1xuXG5leHBvcnQgY29uc3QgTW9kYWxTdHlsZXNLZXkgPSAnQ2hyb21hTW9kYWwnO1xuXG5leHBvcnQgY29uc3QgT1ZFUkxBWV9URVNUX0lEID0gJ2Nocm9tYS1vdmVybGF5LXRlc3RpZCc7XG5cbmV4cG9ydCBjb25zdCB1c2VTdHlsZXMgPSBtYWtlU3R5bGVzKFxuICAodGhlbWUpID0+ICh7XG4gICAgb3ZlcmxheToge1xuICAgICAgYmFja2dyb3VuZENvbG9yOiAncmdiYSgwLCAwLCAwLCAwLjUpJyxcbiAgICAgIGJvdHRvbTogMCxcbiAgICAgIGRpc3BsYXk6ICdmbGV4JyxcbiAgICAgIGZsZXhEaXJlY3Rpb246ICdjb2x1bW4nLFxuICAgICAganVzdGlmeUNvbnRlbnQ6ICdjZW50ZXInLFxuICAgICAgbGVmdDogMCxcbiAgICAgIG92ZXJmbG93OiAnYXV0bycsXG4gICAgICBwb3NpdGlvbjogJ2ZpeGVkJyxcbiAgICAgIHJpZ2h0OiAwLFxuICAgICAgdG9wOiAwLFxuICAgICAgekluZGV4OiAxMjAwLCAvLyBIYXMgdG8gZ28gYWJvdmUgdGhlIEhlYWRlciB6LWluZGV4XG4gICAgICAnQG1lZGlhIHNjcmVlbiBhbmQgKG1heC13aWR0aDogNDgwcHgpJzoge1xuICAgICAgICBqdXN0aWZ5Q29udGVudDogJ2ZsZXgtZW5kJyxcbiAgICAgIH0sXG4gICAgfSxcbiAgICBjb250ZW50OiB7XG4gICAgICBiYWNrZ3JvdW5kOiB0aGVtZS5wYWxldHRlLmNvbW1vbi53aGl0ZSxcbiAgICAgIGJvcmRlclJhZGl1czogdGhlbWUucHhUb1JlbSgxMCksXG4gICAgICBkaXNwbGF5OiAnZmxleCcsXG4gICAgICBmbGV4RGlyZWN0aW9uOiAnY29sdW1uJyxcbiAgICAgIG1hcmdpbjogJzEwdmggYXV0bycsXG4gICAgICBvdXRsaW5lOiAnbm9uZScsXG4gICAgICBwYWRkaW5nVG9wOiB0aGVtZS5zcGFjaW5nKDAuMjUpLFxuICAgICAgcGFkZGluZ0JvdHRvbTogdGhlbWUuc3BhY2luZygwLjI1KSxcbiAgICAgIHdpZHRoOiB0aGVtZS5weFRvUmVtKDM4NCksXG4gICAgICBtYXhXaWR0aDogdGhlbWUucHhUb1JlbSg2MDApLFxuICAgICAgb3ZlcmZsb3c6ICdoaWRkZW4nLFxuICAgICAgJ0BtZWRpYSBzY3JlZW4gYW5kIChtYXgtd2lkdGg6IDQ4MHB4KSc6IHtcbiAgICAgICAgbWFyZ2luQm90dG9tOiB0aGVtZS5zcGFjaW5nKDAuNzUpLFxuICAgICAgICBtYXJnaW5MZWZ0OiB0aGVtZS5zcGFjaW5nKDAuNzUpLFxuICAgICAgICBtYXJnaW5SaWdodDogdGhlbWUuc3BhY2luZygwLjc1KSxcbiAgICAgICAgbWF4SGVpZ2h0OiAnOTUlJyxcbiAgICAgICAgbWF4V2lkdGg6ICc0ODBweCcsXG4gICAgICAgIHdpZHRoOiAndW5zZXQnLFxuICAgICAgfSxcbiAgICAgICcmIGZvcm0nOiB7XG4gICAgICAgIGRpc3BsYXk6ICdmbGV4JyxcbiAgICAgICAgZmxleERpcmVjdGlvbjogJ2NvbHVtbicsXG4gICAgICAgIG92ZXJmbG93OiAnaGlkZGVuJyxcbiAgICAgIH0sXG4gICAgfSxcbiAgICBjb250ZW50RnVsbFdpZHRoOiB7XG4gICAgICB3aWR0aDogJ2NhbGMoMTAwJSAtIDZyZW0pJyxcbiAgICAgICdAbWVkaWEgc2NyZWVuIGFuZCAobWF4LXdpZHRoOiA0ODBweCknOiB7XG4gICAgICAgIHdpZHRoOiAndW5zZXQnLFxuICAgICAgfSxcbiAgICB9LFxuICAgIGNvbnRlbnRTaXplMDoge1xuICAgICAgbWF4SGVpZ2h0OiB0aGVtZS5weFRvUmVtKDI1NiksXG4gICAgICAnQG1lZGlhIHNjcmVlbiBhbmQgKG1heC13aWR0aDogNDgwcHgpJzoge1xuICAgICAgICBtYXhIZWlnaHQ6ICd1bnNldCcsXG4gICAgICB9LFxuICAgIH0sXG4gICAgY29udGVudFNpemUxOiB7XG4gICAgICBtYXhIZWlnaHQ6IHRoZW1lLnB4VG9SZW0oNDgwKSxcbiAgICAgICdAbWVkaWEgc2NyZWVuIGFuZCAobWF4LXdpZHRoOiA0ODBweCknOiB7XG4gICAgICAgIG1heEhlaWdodDogJ3Vuc2V0JyxcbiAgICAgIH0sXG4gICAgfSxcbiAgICBjb250ZW50RnVsbFNjcmVlbjoge1xuICAgICAgYmFja2dyb3VuZDogdGhlbWUucGFsZXR0ZS5jb21tb24ud2hpdGUsXG4gICAgICBkaXNwbGF5OiAnZmxleCcsXG4gICAgICBmbGV4RGlyZWN0aW9uOiAnY29sdW1uJyxcbiAgICAgIGhlaWdodDogJzEwMCUnLFxuICAgICAgd2lkdGg6ICcxMDAlJyxcbiAgICAgIHpJbmRleDogMTIwMCwgLy8gSGFzIHRvIGdvIGFib3ZlIHRoZSBIZWFkZXIgei1pbmRleFxuICAgIH0sXG4gICAgdmVydGljYWxQYWRkaW5nOiB7XG4gICAgICBwYWRkaW5nTGVmdDogdGhlbWUuc3BhY2luZygyKSxcbiAgICAgIHBhZGRpbmdSaWdodDogdGhlbWUuc3BhY2luZygyKSxcbiAgICB9LFxuICAgIG1vZGFsSGVhZGVyOiB7XG4gICAgICBhbGlnbkl0ZW1zOiAnY2VudGVyJyxcbiAgICAgIGJvcmRlckJvdHRvbTogYDFweCBzb2xpZCAke3RoZW1lLnBhbGV0dGUuZGl2aWRlcn1gLFxuICAgICAgZGlzcGxheTogJ2ZsZXgnLFxuICAgICAganVzdGlmeUNvbnRlbnQ6ICdzcGFjZS1iZXR3ZWVuJyxcbiAgICAgICcmOm9ubHktY2hpbGQnOiB7XG4gICAgICAgIGJvcmRlckJvdHRvbTogJ25vbmUnLFxuICAgICAgfSxcbiAgICB9LFxuICAgIG1vZGFsSGVhZGVyRnVsbFNjcmVlbjoge1xuICAgICAgYWxpZ25JdGVtczogJ2NlbnRlcicsXG4gICAgICBiYWNrZ3JvdW5kQ29sb3I6IHRoZW1lLnBhbGV0dGUuY29tbW9uLndoaXRlLFxuICAgICAgYm9yZGVyQm90dG9tOiBgMXB4IHNvbGlkICR7dGhlbWUucGFsZXR0ZS5kaXZpZGVyfWAsXG4gICAgICBkaXNwbGF5OiAnZmxleCcsXG4gICAgICBqdXN0aWZ5Q29udGVudDogJ3NwYWNlLWJldHdlZW4nLFxuICAgICAgcGFkZGluZ0JvdHRvbTogdGhlbWUuc3BhY2luZygwLjUpLFxuICAgICAgcGFkZGluZ0xlZnQ6IHRoZW1lLnNwYWNpbmcoMi41KSxcbiAgICAgIHBhZGRpbmdSaWdodDogdGhlbWUuc3BhY2luZygyLjUpLFxuICAgICAgcGFkZGluZ1RvcDogdGhlbWUuc3BhY2luZygwLjUpLFxuICAgIH0sXG4gICAgbW9kYWxDaGlsZHJlbkNvbnRhaW5lcjoge1xuICAgICAgYmFja2dyb3VuZDogdGhlbWUucGFsZXR0ZS5iYWNrZ3JvdW5kLmRlZmF1bHQsXG4gICAgICAvLyBBZGRlZCBwYWRkaW5nIG9uIHRoZSBib3R0b20gc28gdGhhdCB0aGUgc3BhY2luZ1xuICAgICAgLy8gYmV0d2VlbiB0aGUgdGl0bGUgYW5kIHRvcCBvZiB0aGUgdGV4dCB+ZXF1YWxzIHNwYWNpbmdcbiAgICAgIC8vIGJldHdlZW4gYm90dG9tIG9mIGNvbnRlbnQgYW5kIGFjdGlvbnMgY29udGFpbmVyXG4gICAgICBwYWRkaW5nOiB0aGVtZS5zcGFjaW5nKDIsIDIsIDIuNSksXG4gICAgICBvdmVyZmxvd1k6ICdhdXRvJyxcbiAgICAgIFdlYmtpdE92ZXJmbG93U2Nyb2xsaW5nOiAndG91Y2gnLCAvLyBBZGQgaU9TIG1vbWVudHVtIHNjcm9sbGluZy5cbiAgICB9LFxuICAgIG1vZGFsQ2hpbGRyZW5Db250YWluZXJGdWxsU2NyZWVuOiB7XG4gICAgICBiYWNrZ3JvdW5kOiB0aGVtZS5wYWxldHRlLmdyZXlbNTBdLFxuICAgICAgaGVpZ2h0OiAnMTAwJScsXG4gICAgICBvdmVyZmxvd1k6ICdhdXRvJyxcbiAgICAgIHBhZGRpbmc6IHRoZW1lLnNwYWNpbmcoNCwgMy43NSwgNCwgMy43NSksXG4gICAgICB3aWR0aDogJzEwMCUnLFxuICAgICAgV2Via2l0T3ZlcmZsb3dTY3JvbGxpbmc6ICd0b3VjaCcsIC8vIEFkZCBpT1MgbW9tZW50dW0gc2Nyb2xsaW5nLlxuICAgIH0sXG4gICAgbW9kYWxBY3Rpb25zOiB7XG4gICAgICAvLyBPbiBtb2JpbGUsIHdlIHdhbnQgdG8gZG8gdGhlIGZvbGxvd2luZzpcbiAgICAgIC8vIDEpIFZlcnRpY2FsbHkgc3RhY2sgdGhlIGJ1dHRvbnNcbiAgICAgIC8vIDIpIFJldmVyc2UgdGhlIG9yZGVyIG9mIHRoZSBhY3Rpb25zLiAgT24gbW9iaWxlIGRldmljZXMsXG4gICAgICAvLyAgICB0aGUgbmVnYXRpdmUvY2FuY2VsIGFjdGlvbiBpcyBub3JtYWxseSBhdCB0aGUgKmJvdHRvbSosXG4gICAgICAvLyAgICB3aGVyZWFzIG91ciBkZWZhdWx0IGJlaGF2aW9yIHdpdGggc3RhbmRhcmQgbW9kYWxzIGlzXG4gICAgICAvLyAgICA8Y2FuY2VsPiA8c2F2ZT5cbiAgICAgIC8vIDMpIFRhcmdldCB0aGUgYnV0dG9ucyBhbmQgc2V0IHRoZSB3aWR0aHMgdG8gdGFrZSAxMDAlXG4gICAgICAvLyA0KSBUYXJnZXQgdGhlIGhlaWdodCBvZiBidXR0b25zIGFuZCBtYWtlIHRoZW0gdGFsbGVyLFxuICAgICAgLy8gICAganVzdCBzbyB0aGF0IHVzZXJzIGhhdmUgYSBsYXJnZXIgdGFwLXRhcmdldFxuICAgICAgJ0BtZWRpYSBzY3JlZW4gYW5kIChtYXgtd2lkdGg6IDQ4MHB4KSc6IHtcbiAgICAgICAgZGlzcGxheTogJ2ZsZXgnLFxuICAgICAgICBmbGV4RGlyZWN0aW9uOiAnY29sdW1uLXJldmVyc2UnLFxuICAgICAgICAnJiA+IGJ1dHRvbic6IHtcbiAgICAgICAgICB3aWR0aDogJzEwMCUnLFxuICAgICAgICAgIGhlaWdodDogdGhlbWUucHhUb1JlbSg0OCksXG4gICAgICAgICAgLy8gU2luY2Ugd2UgYXJlIGBjb2x1bW4tcmV2ZXJzZWAsIG1hcmdpbiBvbiB0aGUgYm90dG9tIGlzIG5vd1xuICAgICAgICAgIC8vIG1hcmdpbiB0b3BcbiAgICAgICAgICBtYXJnaW5Ub3A6IHRoZW1lLnNwYWNpbmcoMSksXG4gICAgICAgICAgJyY6bGFzdC1vZi10eXBlJzoge1xuICAgICAgICAgICAgbWFyZ2luVG9wOiAwLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0sXG4gIH0pLFxuICB7IG5hbWU6IE1vZGFsU3R5bGVzS2V5IH1cbik7XG5cbmV4cG9ydCB0eXBlIE1vZGFsQ2xhc3NlcyA9IEdldENsYXNzZXM8dHlwZW9mIHVzZVN0eWxlcz47XG5cbmV4cG9ydCBpbnRlcmZhY2UgTW9kYWxQcm9wc1xuICBleHRlbmRzIFBpY2s8XG4gICAgUmVhY3QuQ29tcG9uZW50UHJvcHNXaXRob3V0UmVmPCdkaXYnPixcbiAgICAnY2xhc3NOYW1lJyB8ICdvbkNsaWNrJyB8ICdvbk1vdXNlRG93bicgfCAnb25LZXlEb3duJ1xuICA+IHtcbiAgYWN0aW9ucz86IFJlYWN0LlJlYWN0Tm9kZTtcbiAgYWxsb3dQaW5jaFpvb20/OiBib29sZWFuO1xuICBjaGlsZHJlbj86IFJlYWN0LlJlYWN0Tm9kZTtcbiAgY3VzdG9tSGVhZGVyPzogUmVhY3QuUmVhY3ROb2RlO1xuICBjb250ZW50Q2xhc3NOYW1lPzogc3RyaW5nO1xuICBvdmVybGF5Q2xhc3NOYW1lPzogc3RyaW5nO1xuICBmdWxsV2lkdGg/OiBib29sZWFuO1xuICBpc0Zvcm1Db250ZW50PzogYm9vbGVhbjtcbiAgaXNGdWxsU2NyZWVuPzogYm9vbGVhbjtcbiAgaXNPcGVuPzogYm9vbGVhbjtcbiAganVzdGlmeUFjdGlvbnM/OiBNb2RhbEFjdGlvbnNQcm9wc1snanVzdGlmeSddO1xuICBvbkRpc21pc3M/OiAocHJvcHM6IGFueSkgPT4gdm9pZDtcbiAgZGlzYWJsZURpc21pc3NPbkNsaWNrT3V0c2lkZT86IGJvb2xlYW47XG4gIG9uRm9ybVN1Ym1pdD86IChkYXRhOiBhbnkpID0+IHZvaWQ7XG4gIHBvc2VzPzogVmFyaWFudHM7XG4gIHNpemU/OiAwIHwgMTtcbiAgdGl0bGU/OiBzdHJpbmc7XG59XG5cbmNvbnN0IE1vZGFsSW5uZXIgPSBSZWFjdC5mb3J3YXJkUmVmPEhUTUxEaXZFbGVtZW50LCBNb2RhbFByb3BzPihcbiAgKFxuICAgIHtcbiAgICAgIGFsbG93UGluY2hab29tLFxuICAgICAgb3ZlcmxheUNsYXNzTmFtZSxcbiAgICAgIGNoaWxkcmVuLFxuICAgICAgb25DbGljayxcbiAgICAgIG9uRGlzbWlzcyxcbiAgICAgIGRpc2FibGVEaXNtaXNzT25DbGlja091dHNpZGUsXG4gICAgICBvbk1vdXNlRG93bixcbiAgICAgIG9uS2V5RG93bixcbiAgICB9LFxuICAgIHJlZlxuICApID0+IHtcbiAgICBjb25zdCBjbGFzc2VzID0gdXNlU3R5bGVzKHt9KTtcbiAgICBjb25zdCBtb3VzZURvd25UYXJnZXQgPSBSZWFjdC51c2VSZWY8YW55PihudWxsKTtcbiAgICBjb25zdCBvdmVybGF5Tm9kZSA9IFJlYWN0LnVzZVJlZihudWxsKTtcbiAgICBjb25zdCB0aGlzUmVmID0gdXNlRm9ya2VkUmVmKG92ZXJsYXlOb2RlLCByZWYpO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIC8vIFNpbmNlIHdlIGFyZSB1c2luZyBGb2N1c0xvY2ssIHdlIGNhbiBzYWZlbHkgaWdub3JlIHRoZSBgYXV0b0ZvY3VzYCBFU0xpbnQgY29tcGxhaW50XG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUganN4LWExMXkvbm8tYXV0b2ZvY3VzXG4gICAgICA8Rm9jdXNMb2NrIGF1dG9Gb2N1cyByZXR1cm5Gb2N1cz5cbiAgICAgICAgPFJlbW92ZVNjcm9sbCBhbGxvd1BpbmNoWm9vbT17YWxsb3dQaW5jaFpvb219PlxuICAgICAgICAgIDxtb3Rpb24uZGl2XG4gICAgICAgICAgICBkYXRhLXRlc3RpZD17T1ZFUkxBWV9URVNUX0lEfVxuICAgICAgICAgICAgY2xhc3NOYW1lPXtjbHN4KGNsYXNzZXMub3ZlcmxheSwgb3ZlcmxheUNsYXNzTmFtZSl9XG4gICAgICAgICAgICBvbkNsaWNrPXtjb21wb3NlRXZlbnRIYW5kbGVycyhbXG4gICAgICAgICAgICAgIG9uQ2xpY2ssXG4gICAgICAgICAgICAgIChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChtb3VzZURvd25UYXJnZXQuY3VycmVudCA9PT0gZXZlbnQudGFyZ2V0KSB7XG4gICAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgIG9uRGlzbWlzcyAmJlxuICAgICAgICAgICAgICAgICAgICAhZGlzYWJsZURpc21pc3NPbkNsaWNrT3V0c2lkZSAmJlxuICAgICAgICAgICAgICAgICAgICBvbkRpc21pc3MoZXZlbnQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF0pfVxuICAgICAgICAgICAgb25Nb3VzZURvd249e2NvbXBvc2VFdmVudEhhbmRsZXJzKFtcbiAgICAgICAgICAgICAgb25Nb3VzZURvd24sXG4gICAgICAgICAgICAgIChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIG1vdXNlRG93blRhcmdldC5jdXJyZW50ID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgXSl9XG4gICAgICAgICAgICBvbktleURvd249e2NvbXBvc2VFdmVudEhhbmRsZXJzKFtcbiAgICAgICAgICAgICAgb25LZXlEb3duLFxuICAgICAgICAgICAgICAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQua2V5ID09PSAnRXNjYXBlJykge1xuICAgICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgICBvbkRpc21pc3MgJiYgb25EaXNtaXNzKGV2ZW50KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBdKX1cbiAgICAgICAgICAgIHJlZj17dGhpc1JlZn1cbiAgICAgICAgICAgIHBvc2l0aW9uVHJhbnNpdGlvblxuICAgICAgICAgICAgaW5pdGlhbD17eyBvcGFjaXR5OiAwIH19XG4gICAgICAgICAgICBhbmltYXRlPXt7XG4gICAgICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgICAgICAgIHRyYW5zaXRpb246IHsgZGVsYXk6IDAuMTUsIGR1cmF0aW9uOiAwLjIgfSxcbiAgICAgICAgICAgIH19XG4gICAgICAgICAgICBleGl0PXt7IG9wYWNpdHk6IDAsIHRyYW5zaXRpb246IHsgZHVyYXRpb246IDAuMTUgfSB9fVxuICAgICAgICAgID5cbiAgICAgICAgICAgIHtjaGlsZHJlbn1cbiAgICAgICAgICA8L21vdGlvbi5kaXY+XG4gICAgICAgIDwvUmVtb3ZlU2Nyb2xsPlxuICAgICAgPC9Gb2N1c0xvY2s+XG4gICAgKTtcbiAgfVxuKTtcblxuY29uc3QgT3ZlcmxheSA9IFJlYWN0LmZvcndhcmRSZWY8SFRNTERpdkVsZW1lbnQsIE1vZGFsUHJvcHM+KFxuICAoeyBhbGxvd1BpbmNoWm9vbSwgaXNPcGVuID0gdHJ1ZSwgLi4ucm9vdFByb3BzIH0sIHJlZikgPT4ge1xuICAgIGNvbnN0IG93blJlZiA9IFJlYWN0LnVzZVJlZihudWxsKTtcbiAgICBjb25zdCB0aGlzUmVmID0gcmVmIHx8IG93blJlZjtcblxuICAgIHJldHVybiAoXG4gICAgICA8PlxuICAgICAgICB7aXNPcGVuID8gKFxuICAgICAgICAgIDxQb3J0YWw+XG4gICAgICAgICAgICA8TW9kYWxJbm5lclxuICAgICAgICAgICAgICBhbGxvd1BpbmNoWm9vbT17YWxsb3dQaW5jaFpvb219XG4gICAgICAgICAgICAgIHJlZj17dGhpc1JlZn1cbiAgICAgICAgICAgICAgey4uLnJvb3RQcm9wc31cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgPC9Qb3J0YWw+XG4gICAgICAgICkgOiBudWxsfVxuICAgICAgPC8+XG4gICAgKTtcbiAgfVxuKTtcblxuY29uc3QgQ29udGVudCA9IFJlYWN0LmZvcndhcmRSZWY8SFRNTERpdkVsZW1lbnQsIE1vZGFsUHJvcHM+KFxuICAoXG4gICAge1xuICAgICAgYWN0aW9ucyxcbiAgICAgIGNsYXNzTmFtZSxcbiAgICAgIGNoaWxkcmVuLFxuICAgICAgY29udGVudENsYXNzTmFtZSxcbiAgICAgIGZ1bGxXaWR0aCxcbiAgICAgIGp1c3RpZnlBY3Rpb25zLFxuICAgICAgaXNGb3JtQ29udGVudCxcbiAgICAgIG9uRm9ybVN1Ym1pdCxcbiAgICAgIG9uQ2xpY2ssXG4gICAgICBvbkRpc21pc3MsXG4gICAgICBjdXN0b21IZWFkZXIsXG4gICAgICBzaXplLFxuICAgICAgdGl0bGUsXG4gICAgICBwb3NlcyA9IHt9LFxuICAgICAgLi4ucm9vdFByb3BzXG4gICAgfSxcbiAgICByZWZcbiAgKSA9PiB7XG4gICAgY29uc3QgY2xhc3NlcyA9IHVzZVN0eWxlcyh7fSk7XG4gICAgY29uc3Qgc2hvdWxkUmVkdWNlTW90aW9uID0gdXNlUmVkdWNlZE1vdGlvbigpO1xuICAgIGNvbnN0IHBvc2VWYXJpYW50cyA9IHtcbiAgICAgIGluaXQ6IHBvc2VzLmluaXQgfHwgeyB5OiA1MCwgc2NhbGU6IDAuMyB9LFxuICAgICAgb3BlbjogcG9zZXMub3BlbiB8fCB7IHk6IDAsIHNjYWxlOiAxIH0sXG4gICAgICBleGl0OiBwb3Nlcy5leGl0IHx8IHsgc2NhbGU6IDAuNSwgdHJhbnNpdGlvbjogeyBkdXJhdGlvbjogMC4xNSB9IH0sXG4gICAgfTtcblxuICAgIHJldHVybiAoXG4gICAgICA8bW90aW9uLmRpdlxuICAgICAgICBjbGFzc05hbWU9e2Nsc3goXG4gICAgICAgICAgY2xhc3Nlcy5jb250ZW50LFxuICAgICAgICAgIGZ1bGxXaWR0aCAmJiBjbGFzc2VzLmNvbnRlbnRGdWxsV2lkdGgsXG4gICAgICAgICAgY2xhc3NOYW1lXG4gICAgICAgICl9XG4gICAgICAgIHJvbGU9XCJkaWFsb2dcIlxuICAgICAgICBhcmlhLW1vZGFsPVwidHJ1ZVwiXG4gICAgICAgIGFyaWEtZGVzY3JpYmVkYnk9e2FyaWFEZXNjcmliZWRCeX1cbiAgICAgICAgYXJpYS1sYWJlbGxlZGJ5PXthcmlhTGFiZWxsZWRCeX1cbiAgICAgICAgdGFiSW5kZXg9ey0xfVxuICAgICAgICBvbkNsaWNrPXtjb21wb3NlRXZlbnRIYW5kbGVycyhbXG4gICAgICAgICAgb25DbGljayxcbiAgICAgICAgICAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgIH0sXG4gICAgICAgIF0pfVxuICAgICAgICByZWY9e3JlZn1cbiAgICAgICAgdmFyaWFudHM9e3Bvc2VWYXJpYW50c31cbiAgICAgICAgaW5pdGlhbD17c2hvdWxkUmVkdWNlTW90aW9uID8ge30gOiAnaW5pdCd9XG4gICAgICAgIGFuaW1hdGU9e3Nob3VsZFJlZHVjZU1vdGlvbiA/IHt9IDogJ29wZW4nfVxuICAgICAgICBleGl0PXtzaG91bGRSZWR1Y2VNb3Rpb24gPyB7fSA6ICdleGl0J31cbiAgICAgICAgey4uLnJvb3RQcm9wc31cbiAgICAgID5cbiAgICAgICAge2N1c3RvbUhlYWRlciA/IChcbiAgICAgICAgICBjdXN0b21IZWFkZXJcbiAgICAgICAgKSA6IChcbiAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICBpZD17YXJpYUxhYmVsbGVkQnl9XG4gICAgICAgICAgICBjbGFzc05hbWU9e2Nsc3goY2xhc3Nlcy5tb2RhbEhlYWRlciwgY2xhc3Nlcy52ZXJ0aWNhbFBhZGRpbmcpfVxuICAgICAgICAgID5cbiAgICAgICAgICAgIHshIXRpdGxlICYmIChcbiAgICAgICAgICAgICAgPFRleHQgc2l6ZT1cInN1YmJvZHlcIiB3ZWlnaHQ9XCJib2xkXCI+XG4gICAgICAgICAgICAgICAge3RpdGxlfVxuICAgICAgICAgICAgICA8L1RleHQ+XG4gICAgICAgICAgICApfVxuICAgICAgICAgICAgPEljb25CdXR0b25cbiAgICAgICAgICAgICAgYXJpYS1sYWJlbD1cIkNsb3NlIG9wZW4gbW9kYWxcIlxuICAgICAgICAgICAgICBpY29uPXtYfVxuICAgICAgICAgICAgICBzaXplPXswfVxuICAgICAgICAgICAgICB0YWJJbmRleD17MH1cbiAgICAgICAgICAgICAgb25DbGljaz17b25EaXNtaXNzfVxuICAgICAgICAgICAgICBwYWRkaW5nUmlnaHQ9ezB9XG4gICAgICAgICAgICAvPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICApfVxuICAgICAgICA8Q29uZGl0aW9uYWxXcmFwcGVyXG4gICAgICAgICAgY29uZGl0aW9uPXtCb29sZWFuKGlzRm9ybUNvbnRlbnQgJiYgb25Gb3JtU3VibWl0KX1cbiAgICAgICAgICB3cmFwcGVyPXsoY2hpbGRyZW46IFJlYWN0LlJlYWN0Tm9kZSkgPT4gKFxuICAgICAgICAgICAgPGZvcm0gb25TdWJtaXQ9e29uRm9ybVN1Ym1pdH0+e2NoaWxkcmVufTwvZm9ybT5cbiAgICAgICAgICApfVxuICAgICAgICA+XG4gICAgICAgICAge2NoaWxkcmVuICYmIChcbiAgICAgICAgICAgIDxkaXZcbiAgICAgICAgICAgICAgaWQ9e2FyaWFEZXNjcmliZWRCeX1cbiAgICAgICAgICAgICAgY2xhc3NOYW1lPXtjbHN4KFxuICAgICAgICAgICAgICAgIGNsYXNzZXMubW9kYWxDaGlsZHJlbkNvbnRhaW5lcixcbiAgICAgICAgICAgICAgICBjbGFzc2VzLnZlcnRpY2FsUGFkZGluZyxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICBbY2xhc3Nlcy5jb250ZW50U2l6ZTBdOiBzaXplID09PSAwLFxuICAgICAgICAgICAgICAgICAgW2NsYXNzZXMuY29udGVudFNpemUxXTogc2l6ZSA9PT0gMSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGNvbnRlbnRDbGFzc05hbWVcbiAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAge2NoaWxkcmVufVxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgKX1cbiAgICAgICAgICB7ISFhY3Rpb25zICYmIChcbiAgICAgICAgICAgIDxNb2RhbEFjdGlvbnNcbiAgICAgICAgICAgICAgY2xhc3NOYW1lPXtjbHN4KGNsYXNzZXMubW9kYWxBY3Rpb25zLCBjbGFzc2VzLnZlcnRpY2FsUGFkZGluZyl9XG4gICAgICAgICAgICAgIGp1c3RpZnk9e2p1c3RpZnlBY3Rpb25zfVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICB7YWN0aW9uc31cbiAgICAgICAgICAgIDwvTW9kYWxBY3Rpb25zPlxuICAgICAgICAgICl9XG4gICAgICAgIDwvQ29uZGl0aW9uYWxXcmFwcGVyPlxuICAgICAgPC9tb3Rpb24uZGl2PlxuICAgICk7XG4gIH1cbik7XG5cbmNvbnN0IEZ1bGxTY3JlZW5Db250ZW50ID0gUmVhY3QuZm9yd2FyZFJlZjxIVE1MRGl2RWxlbWVudCwgTW9kYWxQcm9wcz4oXG4gIChcbiAgICB7XG4gICAgICBjaGlsZHJlbixcbiAgICAgIGNsYXNzTmFtZSxcbiAgICAgIGNvbnRlbnRDbGFzc05hbWUsXG4gICAgICBvbkNsaWNrLFxuICAgICAgb25EaXNtaXNzLFxuICAgICAgdGl0bGUsXG4gICAgICBjdXN0b21IZWFkZXIsXG4gICAgICAuLi5yb290UHJvcHNcbiAgICB9LFxuICAgIHJlZlxuICApID0+IHtcbiAgICBjb25zdCBjbGFzc2VzID0gdXNlU3R5bGVzKHt9KTtcblxuICAgIHJldHVybiAoXG4gICAgICA8bW90aW9uLmRpdlxuICAgICAgICBjbGFzc05hbWU9e2Nsc3goY2xhc3Nlcy5jb250ZW50RnVsbFNjcmVlbiwgY2xhc3NOYW1lKX1cbiAgICAgICAgcm9sZT1cImRpYWxvZ1wiXG4gICAgICAgIGFyaWEtbW9kYWw9XCJ0cnVlXCJcbiAgICAgICAgYXJpYS1kZXNjcmliZWRieT17YXJpYURlc2NyaWJlZEJ5fVxuICAgICAgICBhcmlhLWxhYmVsbGVkYnk9e2FyaWFMYWJlbGxlZEJ5fVxuICAgICAgICB0YWJJbmRleD17LTF9XG4gICAgICAgIG9uQ2xpY2s9e2NvbXBvc2VFdmVudEhhbmRsZXJzKFtcbiAgICAgICAgICBvbkNsaWNrLFxuICAgICAgICAgIChldmVudCkgPT4ge1xuICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgXSl9XG4gICAgICAgIHJlZj17cmVmfVxuICAgICAgICBpbml0aWFsPXt7IG9wYWNpdHk6IDAgfX1cbiAgICAgICAgYW5pbWF0ZT17e1xuICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgICAgdHJhbnNpdGlvbjogeyBkdXJhdGlvbjogMC4xLCBlYXNlOiBbMC4xNiwgMSwgMC4zLCAxXSB9LCAvLyBodHRwczovL2Vhc2luZ3MubmV0LyNlYXNlT3V0RXhwb1xuICAgICAgICB9fVxuICAgICAgICBleGl0PXt7XG4gICAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgICB0cmFuc2l0aW9uOiB7IGR1cmF0aW9uOiAwLjA4LCBlYXNlOiBbMC43LCAwLCAwLjg0LCAwXSB9LFxuICAgICAgICB9fSAvLyBodHRwczovL2Vhc2luZ3MubmV0LyNlYXNlSW5FeHBvXG4gICAgICAgIHsuLi5yb290UHJvcHN9XG4gICAgICA+XG4gICAgICAgIHtjdXN0b21IZWFkZXIgPyAoXG4gICAgICAgICAgY3VzdG9tSGVhZGVyXG4gICAgICAgICkgOiAoXG4gICAgICAgICAgPGRpdiBpZD17YXJpYUxhYmVsbGVkQnl9IGNsYXNzTmFtZT17Y2xhc3Nlcy5tb2RhbEhlYWRlckZ1bGxTY3JlZW59PlxuICAgICAgICAgICAgeyEhdGl0bGUgJiYgPFRleHQgc2l6ZT1cInN1YmJvZHlcIj57dGl0bGV9PC9UZXh0Pn1cbiAgICAgICAgICAgIDxJY29uQnV0dG9uXG4gICAgICAgICAgICAgIGFyaWEtbGFiZWw9XCJDbG9zZSBvcGVuIG1vZGFsXCJcbiAgICAgICAgICAgICAgaWNvbj17WH1cbiAgICAgICAgICAgICAgc2l6ZT17MH1cbiAgICAgICAgICAgICAgdGFiSW5kZXg9ezB9XG4gICAgICAgICAgICAgIG9uQ2xpY2s9e29uRGlzbWlzc31cbiAgICAgICAgICAgICAgcGFkZGluZ1JpZ2h0PXswfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgKX1cbiAgICAgICAgPGRpdlxuICAgICAgICAgIGlkPXthcmlhRGVzY3JpYmVkQnl9XG4gICAgICAgICAgY2xhc3NOYW1lPXtjbHN4KFxuICAgICAgICAgICAgY2xhc3Nlcy5tb2RhbENoaWxkcmVuQ29udGFpbmVyRnVsbFNjcmVlbixcbiAgICAgICAgICAgIGNvbnRlbnRDbGFzc05hbWVcbiAgICAgICAgICApfVxuICAgICAgICA+XG4gICAgICAgICAge2NoaWxkcmVufVxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvbW90aW9uLmRpdj5cbiAgICApO1xuICB9XG4pO1xuXG5leHBvcnQgY29uc3QgTW9kYWwgPSBSZWFjdC5mb3J3YXJkUmVmPEhUTUxEaXZFbGVtZW50LCBNb2RhbFByb3BzPihcbiAgKFxuICAgIHtcbiAgICAgIGFsbG93UGluY2hab29tLFxuICAgICAgaXNGdWxsU2NyZWVuLFxuICAgICAgaXNPcGVuLFxuICAgICAgb25EaXNtaXNzLFxuICAgICAgZGlzYWJsZURpc21pc3NPbkNsaWNrT3V0c2lkZSxcbiAgICAgIHNpemUgPSAwLFxuICAgICAgb3ZlcmxheUNsYXNzTmFtZSxcbiAgICAgIC4uLnJvb3RQcm9wc1xuICAgIH0sXG4gICAgcmVmXG4gICkgPT4ge1xuICAgIGNvbnN0IG93blJlZiA9IFJlYWN0LnVzZVJlZihudWxsKTtcblxuICAgIC8vIElmIGEgcmVmIGlzIGZvcndhcmRlZCwgdXNlIGl0OyBvdGhlcndpc2UsIHVzZSBvdXJzZWx2ZXMgYXMgdGhlIHJlZlxuICAgIGNvbnN0IHRoaXNSZWYgPSByZWYgfHwgb3duUmVmO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxBbmltYXRlUHJlc2VuY2U+XG4gICAgICAgIHtpc09wZW4gPyAoXG4gICAgICAgICAgPE92ZXJsYXlcbiAgICAgICAgICAgIG92ZXJsYXlDbGFzc05hbWU9e292ZXJsYXlDbGFzc05hbWV9XG4gICAgICAgICAgICBhbGxvd1BpbmNoWm9vbT17YWxsb3dQaW5jaFpvb219XG4gICAgICAgICAgICBpc09wZW49e2lzT3Blbn1cbiAgICAgICAgICAgIG9uRGlzbWlzcz17b25EaXNtaXNzfVxuICAgICAgICAgICAgZGlzYWJsZURpc21pc3NPbkNsaWNrT3V0c2lkZT17ZGlzYWJsZURpc21pc3NPbkNsaWNrT3V0c2lkZX1cbiAgICAgICAgICA+XG4gICAgICAgICAgICB7aXNGdWxsU2NyZWVuID8gKFxuICAgICAgICAgICAgICA8RnVsbFNjcmVlbkNvbnRlbnRcbiAgICAgICAgICAgICAgICByZWY9e3RoaXNSZWZ9XG4gICAgICAgICAgICAgICAgc2l6ZT17c2l6ZX1cbiAgICAgICAgICAgICAgICBvbkRpc21pc3M9e29uRGlzbWlzc31cbiAgICAgICAgICAgICAgICB7Li4ucm9vdFByb3BzfVxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgKSA6IChcbiAgICAgICAgICAgICAgPENvbnRlbnRcbiAgICAgICAgICAgICAgICByZWY9e3RoaXNSZWZ9XG4gICAgICAgICAgICAgICAgc2l6ZT17c2l6ZX1cbiAgICAgICAgICAgICAgICBvbkRpc21pc3M9e29uRGlzbWlzc31cbiAgICAgICAgICAgICAgICB7Li4ucm9vdFByb3BzfVxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgKX1cbiAgICAgICAgICA8L092ZXJsYXk+XG4gICAgICAgICkgOiBudWxsfVxuICAgICAgPC9BbmltYXRlUHJlc2VuY2U+XG4gICAgKTtcbiAgfVxuKTtcbiJdfQ==