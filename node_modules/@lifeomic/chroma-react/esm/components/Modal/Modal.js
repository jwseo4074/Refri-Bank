var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
import { ConditionalWrapper } from '../_private/ConditionalWrapper';
import { IconButton } from '../IconButton';
import { makeStyles } from '../../styles';
import { ModalActions } from './ModalActions';
import { motion, AnimatePresence, useReducedMotion, } from 'framer-motion';
import { Portal } from 'reakit/Portal';
import { RemoveScroll } from 'react-remove-scroll';
import { Text } from '../Text';
import { useForkedRef, wrapEvent } from './helpers';
import { X } from '@lifeomic/chromicons';
import clsx from 'clsx';
import FocusLock from 'react-focus-lock';
import * as React from 'react';
var ariaDescribedBy = 'modal-content';
var ariaLabelledBy = 'modal-header';
export var ModalStylesKey = 'ChromaModal';
export var OVERLAY_TEST_ID = 'chroma-overlay-testid';
export var useStyles = makeStyles(function (theme) { return ({
    overlay: {
        backgroundColor: 'rgba(0, 0, 0, 0.5)',
        bottom: 0,
        display: 'flex',
        flexDirection: 'column',
        justifyContent: 'center',
        left: 0,
        overflow: 'auto',
        position: 'fixed',
        right: 0,
        top: 0,
        zIndex: 1200,
        '@media screen and (max-width: 480px)': {
            justifyContent: 'flex-end',
        },
    },
    content: {
        background: theme.palette.common.white,
        borderRadius: theme.pxToRem(10),
        display: 'flex',
        flexDirection: 'column',
        margin: '10vh auto',
        outline: 'none',
        paddingTop: theme.spacing(0.25),
        paddingBottom: theme.spacing(0.25),
        width: theme.pxToRem(384),
        maxWidth: theme.pxToRem(600),
        overflow: 'hidden',
        '@media screen and (max-width: 480px)': {
            marginBottom: theme.spacing(0.75),
            marginLeft: theme.spacing(0.75),
            marginRight: theme.spacing(0.75),
            maxHeight: '95%',
            maxWidth: '480px',
            width: 'unset',
        },
        '& form': {
            display: 'flex',
            flexDirection: 'column',
            overflow: 'hidden',
        },
    },
    contentFullWidth: {
        width: 'calc(100% - 6rem)',
        '@media screen and (max-width: 480px)': {
            width: 'unset',
        },
    },
    contentSize0: {
        maxHeight: theme.pxToRem(256),
        '@media screen and (max-width: 480px)': {
            maxHeight: 'unset',
        },
    },
    contentSize1: {
        maxHeight: theme.pxToRem(480),
        '@media screen and (max-width: 480px)': {
            maxHeight: 'unset',
        },
    },
    contentFullScreen: {
        background: theme.palette.common.white,
        display: 'flex',
        flexDirection: 'column',
        height: '100%',
        width: '100%',
        zIndex: 1200,
    },
    verticalPadding: {
        paddingLeft: theme.spacing(2),
        paddingRight: theme.spacing(2),
    },
    modalHeader: {
        alignItems: 'center',
        borderBottom: "1px solid " + theme.palette.divider,
        display: 'flex',
        justifyContent: 'space-between',
        '&:only-child': {
            borderBottom: 'none',
        },
    },
    modalHeaderFullScreen: {
        alignItems: 'center',
        backgroundColor: theme.palette.common.white,
        borderBottom: "1px solid " + theme.palette.divider,
        display: 'flex',
        justifyContent: 'space-between',
        paddingBottom: theme.spacing(0.5),
        paddingLeft: theme.spacing(2.5),
        paddingRight: theme.spacing(2.5),
        paddingTop: theme.spacing(0.5),
    },
    modalChildrenContainer: {
        background: theme.palette.background.default,
        // Added padding on the bottom so that the spacing
        // between the title and top of the text ~equals spacing
        // between bottom of content and actions container
        padding: theme.spacing(2, 2, 2.5),
        overflowY: 'auto',
        WebkitOverflowScrolling: 'touch',
    },
    modalChildrenContainerFullScreen: {
        background: theme.palette.grey[50],
        height: '100%',
        overflowY: 'auto',
        padding: theme.spacing(4, 3.75, 4, 3.75),
        width: '100%',
        WebkitOverflowScrolling: 'touch',
    },
    modalActions: {
        // On mobile, we want to do the following:
        // 1) Vertically stack the buttons
        // 2) Reverse the order of the actions.  On mobile devices,
        //    the negative/cancel action is normally at the *bottom*,
        //    whereas our default behavior with standard modals is
        //    <cancel> <save>
        // 3) Target the buttons and set the widths to take 100%
        // 4) Target the height of buttons and make them taller,
        //    just so that users have a larger tap-target
        '@media screen and (max-width: 480px)': {
            display: 'flex',
            flexDirection: 'column-reverse',
            '& > button': {
                width: '100%',
                height: theme.pxToRem(48),
                // Since we are `column-reverse`, margin on the bottom is now
                // margin top
                marginTop: theme.spacing(1),
                '&:last-of-type': {
                    marginTop: 0,
                },
            },
        },
    },
}); }, { name: ModalStylesKey });
var ModalInner = React.forwardRef(function (_a, ref) {
    var allowPinchZoom = _a.allowPinchZoom, overlayClassName = _a.overlayClassName, children = _a.children, onClick = _a.onClick, onDismiss = _a.onDismiss, disableDismissOnClickOutside = _a.disableDismissOnClickOutside, onMouseDown = _a.onMouseDown, onKeyDown = _a.onKeyDown;
    var classes = useStyles({});
    var mouseDownTarget = React.useRef(null);
    var overlayNode = React.useRef(null);
    var thisRef = useForkedRef(overlayNode, ref);
    return (
    // Since we are using FocusLock, we can safely ignore the `autoFocus` ESLint complaint
    // eslint-disable-next-line jsx-a11y/no-autofocus
    React.createElement(FocusLock, { autoFocus: true, returnFocus: true },
        React.createElement(RemoveScroll, { allowPinchZoom: allowPinchZoom },
            React.createElement(motion.div, { "data-testid": OVERLAY_TEST_ID, className: clsx(classes.overlay, overlayClassName), onClick: wrapEvent(onClick, function (event) {
                    if (mouseDownTarget.current === event.target) {
                        event.stopPropagation();
                        onDismiss && !disableDismissOnClickOutside && onDismiss(event);
                    }
                }), onMouseDown: wrapEvent(onMouseDown, function (event) {
                    mouseDownTarget.current = event.target;
                }), onKeyDown: wrapEvent(onKeyDown, function (event) {
                    if (event.key === 'Escape') {
                        event.stopPropagation();
                        onDismiss && onDismiss(event);
                    }
                }), ref: thisRef, positionTransition: true, initial: { opacity: 0 }, animate: {
                    opacity: 1,
                    transition: { delay: 0.15, duration: 0.2 },
                }, exit: { opacity: 0, transition: { duration: 0.15 } } }, children))));
});
var Overlay = React.forwardRef(function (_a, ref) {
    var allowPinchZoom = _a.allowPinchZoom, _b = _a.isOpen, isOpen = _b === void 0 ? true : _b, rootProps = __rest(_a, ["allowPinchZoom", "isOpen"]);
    var ownRef = React.useRef(null);
    var thisRef = ref || ownRef;
    return (React.createElement(React.Fragment, null, isOpen ? (React.createElement(Portal, null,
        React.createElement(ModalInner, __assign({ allowPinchZoom: allowPinchZoom, ref: thisRef }, rootProps)))) : null));
});
var Content = React.forwardRef(function (_a, ref) {
    var _b;
    var actions = _a.actions, className = _a.className, children = _a.children, contentClassName = _a.contentClassName, fullWidth = _a.fullWidth, justifyActions = _a.justifyActions, isFormContent = _a.isFormContent, onFormSubmit = _a.onFormSubmit, onClick = _a.onClick, onDismiss = _a.onDismiss, customHeader = _a.customHeader, size = _a.size, title = _a.title, _c = _a.poses, poses = _c === void 0 ? {} : _c, rootProps = __rest(_a, ["actions", "className", "children", "contentClassName", "fullWidth", "justifyActions", "isFormContent", "onFormSubmit", "onClick", "onDismiss", "customHeader", "size", "title", "poses"]);
    var classes = useStyles({});
    var shouldReduceMotion = useReducedMotion();
    var poseVariants = {
        init: poses.init || { y: 50, scale: 0.3 },
        open: poses.open || { y: 0, scale: 1 },
        exit: poses.exit || { scale: 0.5, transition: { duration: 0.15 } },
    };
    return (React.createElement(motion.div, __assign({ className: clsx(classes.content, fullWidth && classes.contentFullWidth, className), role: "dialog", "aria-modal": "true", "aria-describedby": ariaDescribedBy, "aria-labelledby": ariaLabelledBy, tabIndex: -1, onClick: wrapEvent(onClick, function (event) {
            event.stopPropagation();
        }), ref: ref, variants: poseVariants, initial: shouldReduceMotion ? {} : 'init', animate: shouldReduceMotion ? {} : 'open', exit: shouldReduceMotion ? {} : 'exit' }, rootProps),
        customHeader ? (customHeader) : (React.createElement("div", { id: ariaLabelledBy, className: clsx(classes.modalHeader, classes.verticalPadding) },
            !!title && (React.createElement(Text, { size: "subbody", weight: "bold" }, title)),
            React.createElement(IconButton, { "aria-label": "Close open modal", icon: X, size: 0, tabIndex: 0, onClick: onDismiss, paddingRight: 0 }))),
        React.createElement(ConditionalWrapper, { condition: Boolean(isFormContent && onFormSubmit), wrapper: function (children) { return (React.createElement("form", { onSubmit: onFormSubmit }, children)); } },
            children && (React.createElement("div", { id: ariaDescribedBy, className: clsx(classes.modalChildrenContainer, classes.verticalPadding, (_b = {},
                    _b[classes.contentSize0] = size === 0,
                    _b[classes.contentSize1] = size === 1,
                    _b), contentClassName) }, children)),
            !!actions && (React.createElement(ModalActions, { className: clsx(classes.modalActions, classes.verticalPadding), justify: justifyActions }, actions)))));
});
var FullScreenContent = React.forwardRef(function (_a, ref) {
    var children = _a.children, className = _a.className, contentClassName = _a.contentClassName, onClick = _a.onClick, onDismiss = _a.onDismiss, title = _a.title, customHeader = _a.customHeader, rootProps = __rest(_a, ["children", "className", "contentClassName", "onClick", "onDismiss", "title", "customHeader"]);
    var classes = useStyles({});
    return (React.createElement(motion.div, __assign({ className: clsx(classes.contentFullScreen, className), role: "dialog", "aria-modal": "true", "aria-describedby": ariaDescribedBy, "aria-labelledby": ariaLabelledBy, tabIndex: -1, onClick: wrapEvent(onClick, function (event) {
            event.stopPropagation();
        }), ref: ref, initial: { opacity: 0 }, animate: {
            opacity: 1,
            transition: { duration: 0.1, ease: [0.16, 1, 0.3, 1] },
        }, exit: {
            opacity: 0,
            transition: { duration: 0.08, ease: [0.7, 0, 0.84, 0] },
        } }, rootProps),
        customHeader ? (customHeader) : (React.createElement("div", { id: ariaLabelledBy, className: classes.modalHeaderFullScreen },
            !!title && React.createElement(Text, { size: "subbody" }, title),
            React.createElement(IconButton, { "aria-label": "Close open modal", icon: X, size: 0, tabIndex: 0, onClick: onDismiss, paddingRight: 0 }))),
        React.createElement("div", { id: ariaDescribedBy, className: clsx(classes.modalChildrenContainerFullScreen, contentClassName) }, children)));
});
export var Modal = React.forwardRef(function (_a, ref) {
    var allowPinchZoom = _a.allowPinchZoom, isFullScreen = _a.isFullScreen, isOpen = _a.isOpen, onDismiss = _a.onDismiss, disableDismissOnClickOutside = _a.disableDismissOnClickOutside, _b = _a.size, size = _b === void 0 ? 0 : _b, overlayClassName = _a.overlayClassName, rootProps = __rest(_a, ["allowPinchZoom", "isFullScreen", "isOpen", "onDismiss", "disableDismissOnClickOutside", "size", "overlayClassName"]);
    var ownRef = React.useRef(null);
    // If a ref is forwarded, use it; otherwise, use ourselves as the ref
    var thisRef = ref || ownRef;
    return (React.createElement(AnimatePresence, null, isOpen ? (React.createElement(Overlay, { overlayClassName: overlayClassName, allowPinchZoom: allowPinchZoom, isOpen: isOpen, onDismiss: onDismiss, disableDismissOnClickOutside: disableDismissOnClickOutside }, isFullScreen ? (React.createElement(FullScreenContent, __assign({ ref: thisRef, size: size, onDismiss: onDismiss }, rootProps))) : (React.createElement(Content, __assign({ ref: thisRef, size: size, onDismiss: onDismiss }, rootProps))))) : null));
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTW9kYWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9Nb2RhbC9Nb2RhbC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBRXBFLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUMxQyxPQUFPLEVBQUUsWUFBWSxFQUFxQixNQUFNLGdCQUFnQixDQUFDO0FBQ2pFLE9BQU8sRUFDTCxNQUFNLEVBQ04sZUFBZSxFQUNmLGdCQUFnQixHQUVqQixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3ZDLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUNuRCxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sU0FBUyxDQUFDO0FBQy9CLE9BQU8sRUFBRSxZQUFZLEVBQUUsU0FBUyxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQ3BELE9BQU8sRUFBRSxDQUFDLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUN6QyxPQUFPLElBQUksTUFBTSxNQUFNLENBQUM7QUFDeEIsT0FBTyxTQUFTLE1BQU0sa0JBQWtCLENBQUM7QUFDekMsT0FBTyxLQUFLLEtBQUssTUFBTSxPQUFPLENBQUM7QUFFL0IsSUFBTSxlQUFlLEdBQUcsZUFBZSxDQUFDO0FBQ3hDLElBQU0sY0FBYyxHQUFHLGNBQWMsQ0FBQztBQUV0QyxNQUFNLENBQUMsSUFBTSxjQUFjLEdBQUcsYUFBYSxDQUFDO0FBRTVDLE1BQU0sQ0FBQyxJQUFNLGVBQWUsR0FBRyx1QkFBdUIsQ0FBQztBQUV2RCxNQUFNLENBQUMsSUFBTSxTQUFTLEdBQUcsVUFBVSxDQUNqQyxVQUFDLEtBQUss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LElBQ2hCLFNBQVMsRUFDYixDQUNILENBQ08sQ0FDWCxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQ1EsQ0FDbkIsQ0FBQztBQUNKLENBQUMsQ0FDRixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29uZGl0aW9uYWxXcmFwcGVyIH0gZnJvbSAnLi4vX3ByaXZhdGUvQ29uZGl0aW9uYWxXcmFwcGVyJztcbmltcG9ydCB7IEdldENsYXNzZXMgfSBmcm9tICcuLi8uLi90eXBlVXRpbHMnO1xuaW1wb3J0IHsgSWNvbkJ1dHRvbiB9IGZyb20gJy4uL0ljb25CdXR0b24nO1xuaW1wb3J0IHsgbWFrZVN0eWxlcyB9IGZyb20gJy4uLy4uL3N0eWxlcyc7XG5pbXBvcnQgeyBNb2RhbEFjdGlvbnMsIE1vZGFsQWN0aW9uc1Byb3BzIH0gZnJvbSAnLi9Nb2RhbEFjdGlvbnMnO1xuaW1wb3J0IHtcbiAgbW90aW9uLFxuICBBbmltYXRlUHJlc2VuY2UsXG4gIHVzZVJlZHVjZWRNb3Rpb24sXG4gIFZhcmlhbnRzLFxufSBmcm9tICdmcmFtZXItbW90aW9uJztcbmltcG9ydCB7IFBvcnRhbCB9IGZyb20gJ3JlYWtpdC9Qb3J0YWwnO1xuaW1wb3J0IHsgUmVtb3ZlU2Nyb2xsIH0gZnJvbSAncmVhY3QtcmVtb3ZlLXNjcm9sbCc7XG5pbXBvcnQgeyBUZXh0IH0gZnJvbSAnLi4vVGV4dCc7XG5pbXBvcnQgeyB1c2VGb3JrZWRSZWYsIHdyYXBFdmVudCB9IGZyb20gJy4vaGVscGVycyc7XG5pbXBvcnQgeyBYIH0gZnJvbSAnQGxpZmVvbWljL2Nocm9taWNvbnMnO1xuaW1wb3J0IGNsc3ggZnJvbSAnY2xzeCc7XG5pbXBvcnQgRm9jdXNMb2NrIGZyb20gJ3JlYWN0LWZvY3VzLWxvY2snO1xuaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xuXG5jb25zdCBhcmlhRGVzY3JpYmVkQnkgPSAnbW9kYWwtY29udGVudCc7XG5jb25zdCBhcmlhTGFiZWxsZWRCeSA9ICdtb2RhbC1oZWFkZXInO1xuXG5leHBvcnQgY29uc3QgTW9kYWxTdHlsZXNLZXkgPSAnQ2hyb21hTW9kYWwnO1xuXG5leHBvcnQgY29uc3QgT1ZFUkxBWV9URVNUX0lEID0gJ2Nocm9tYS1vdmVybGF5LXRlc3RpZCc7XG5cbmV4cG9ydCBjb25zdCB1c2VTdHlsZXMgPSBtYWtlU3R5bGVzKFxuICAodGhlbWUpID0+ICh7XG4gICAgb3ZlcmxheToge1xuICAgICAgYmFja2dyb3VuZENvbG9yOiAncmdiYSgwLCAwLCAwLCAwLjUpJyxcbiAgICAgIGJvdHRvbTogMCxcbiAgICAgIGRpc3BsYXk6ICdmbGV4JyxcbiAgICAgIGZsZXhEaXJlY3Rpb246ICdjb2x1bW4nLFxuICAgICAganVzdGlmeUNvbnRlbnQ6ICdjZW50ZXInLFxuICAgICAgbGVmdDogMCxcbiAgICAgIG92ZXJmbG93OiAnYXV0bycsXG4gICAgICBwb3NpdGlvbjogJ2ZpeGVkJyxcbiAgICAgIHJpZ2h0OiAwLFxuICAgICAgdG9wOiAwLFxuICAgICAgekluZGV4OiAxMjAwLCAvLyBIYXMgdG8gZ28gYWJvdmUgdGhlIEhlYWRlciB6LWluZGV4XG4gICAgICAnQG1lZGlhIHNjcmVlbiBhbmQgKG1heC13aWR0aDogNDgwcHgpJzoge1xuICAgICAgICBqdXN0aWZ5Q29udGVudDogJ2ZsZXgtZW5kJyxcbiAgICAgIH0sXG4gICAgfSxcbiAgICBjb250ZW50OiB7XG4gICAgICBiYWNrZ3JvdW5kOiB0aGVtZS5wYWxldHRlLmNvbW1vbi53aGl0ZSxcbiAgICAgIGJvcmRlclJhZGl1czogdGhlbWUucHhUb1JlbSgxMCksXG4gICAgICBkaXNwbGF5OiAnZmxleCcsXG4gICAgICBmbGV4RGlyZWN0aW9uOiAnY29sdW1uJyxcbiAgICAgIG1hcmdpbjogJzEwdmggYXV0bycsXG4gICAgICBvdXRsaW5lOiAnbm9uZScsXG4gICAgICBwYWRkaW5nVG9wOiB0aGVtZS5zcGFjaW5nKDAuMjUpLFxuICAgICAgcGFkZGluZ0JvdHRvbTogdGhlbWUuc3BhY2luZygwLjI1KSxcbiAgICAgIHdpZHRoOiB0aGVtZS5weFRvUmVtKDM4NCksXG4gICAgICBtYXhXaWR0aDogdGhlbWUucHhUb1JlbSg2MDApLFxuICAgICAgb3ZlcmZsb3c6ICdoaWRkZW4nLFxuICAgICAgJ0BtZWRpYSBzY3JlZW4gYW5kIChtYXgtd2lkdGg6IDQ4MHB4KSc6IHtcbiAgICAgICAgbWFyZ2luQm90dG9tOiB0aGVtZS5zcGFjaW5nKDAuNzUpLFxuICAgICAgICBtYXJnaW5MZWZ0OiB0aGVtZS5zcGFjaW5nKDAuNzUpLFxuICAgICAgICBtYXJnaW5SaWdodDogdGhlbWUuc3BhY2luZygwLjc1KSxcbiAgICAgICAgbWF4SGVpZ2h0OiAnOTUlJyxcbiAgICAgICAgbWF4V2lkdGg6ICc0ODBweCcsXG4gICAgICAgIHdpZHRoOiAndW5zZXQnLFxuICAgICAgfSxcbiAgICAgICcmIGZvcm0nOiB7XG4gICAgICAgIGRpc3BsYXk6ICdmbGV4JyxcbiAgICAgICAgZmxleERpcmVjdGlvbjogJ2NvbHVtbicsXG4gICAgICAgIG92ZXJmbG93OiAnaGlkZGVuJyxcbiAgICAgIH0sXG4gICAgfSxcbiAgICBjb250ZW50RnVsbFdpZHRoOiB7XG4gICAgICB3aWR0aDogJ2NhbGMoMTAwJSAtIDZyZW0pJyxcbiAgICAgICdAbWVkaWEgc2NyZWVuIGFuZCAobWF4LXdpZHRoOiA0ODBweCknOiB7XG4gICAgICAgIHdpZHRoOiAndW5zZXQnLFxuICAgICAgfSxcbiAgICB9LFxuICAgIGNvbnRlbnRTaXplMDoge1xuICAgICAgbWF4SGVpZ2h0OiB0aGVtZS5weFRvUmVtKDI1NiksXG4gICAgICAnQG1lZGlhIHNjcmVlbiBhbmQgKG1heC13aWR0aDogNDgwcHgpJzoge1xuICAgICAgICBtYXhIZWlnaHQ6ICd1bnNldCcsXG4gICAgICB9LFxuICAgIH0sXG4gICAgY29udGVudFNpemUxOiB7XG4gICAgICBtYXhIZWlnaHQ6IHRoZW1lLnB4VG9SZW0oNDgwKSxcbiAgICAgICdAbWVkaWEgc2NyZWVuIGFuZCAobWF4LXdpZHRoOiA0ODBweCknOiB7XG4gICAgICAgIG1heEhlaWdodDogJ3Vuc2V0JyxcbiAgICAgIH0sXG4gICAgfSxcbiAgICBjb250ZW50RnVsbFNjcmVlbjoge1xuICAgICAgYmFja2dyb3VuZDogdGhlbWUucGFsZXR0ZS5jb21tb24ud2hpdGUsXG4gICAgICBkaXNwbGF5OiAnZmxleCcsXG4gICAgICBmbGV4RGlyZWN0aW9uOiAnY29sdW1uJyxcbiAgICAgIGhlaWdodDogJzEwMCUnLFxuICAgICAgd2lkdGg6ICcxMDAlJyxcbiAgICAgIHpJbmRleDogMTIwMCwgLy8gSGFzIHRvIGdvIGFib3ZlIHRoZSBIZWFkZXIgei1pbmRleFxuICAgIH0sXG4gICAgdmVydGljYWxQYWRkaW5nOiB7XG4gICAgICBwYWRkaW5nTGVmdDogdGhlbWUuc3BhY2luZygyKSxcbiAgICAgIHBhZGRpbmdSaWdodDogdGhlbWUuc3BhY2luZygyKSxcbiAgICB9LFxuICAgIG1vZGFsSGVhZGVyOiB7XG4gICAgICBhbGlnbkl0ZW1zOiAnY2VudGVyJyxcbiAgICAgIGJvcmRlckJvdHRvbTogYDFweCBzb2xpZCAke3RoZW1lLnBhbGV0dGUuZGl2aWRlcn1gLFxuICAgICAgZGlzcGxheTogJ2ZsZXgnLFxuICAgICAganVzdGlmeUNvbnRlbnQ6ICdzcGFjZS1iZXR3ZWVuJyxcbiAgICAgICcmOm9ubHktY2hpbGQnOiB7XG4gICAgICAgIGJvcmRlckJvdHRvbTogJ25vbmUnLFxuICAgICAgfSxcbiAgICB9LFxuICAgIG1vZGFsSGVhZGVyRnVsbFNjcmVlbjoge1xuICAgICAgYWxpZ25JdGVtczogJ2NlbnRlcicsXG4gICAgICBiYWNrZ3JvdW5kQ29sb3I6IHRoZW1lLnBhbGV0dGUuY29tbW9uLndoaXRlLFxuICAgICAgYm9yZGVyQm90dG9tOiBgMXB4IHNvbGlkICR7dGhlbWUucGFsZXR0ZS5kaXZpZGVyfWAsXG4gICAgICBkaXNwbGF5OiAnZmxleCcsXG4gICAgICBqdXN0aWZ5Q29udGVudDogJ3NwYWNlLWJldHdlZW4nLFxuICAgICAgcGFkZGluZ0JvdHRvbTogdGhlbWUuc3BhY2luZygwLjUpLFxuICAgICAgcGFkZGluZ0xlZnQ6IHRoZW1lLnNwYWNpbmcoMi41KSxcbiAgICAgIHBhZGRpbmdSaWdodDogdGhlbWUuc3BhY2luZygyLjUpLFxuICAgICAgcGFkZGluZ1RvcDogdGhlbWUuc3BhY2luZygwLjUpLFxuICAgIH0sXG4gICAgbW9kYWxDaGlsZHJlbkNvbnRhaW5lcjoge1xuICAgICAgYmFja2dyb3VuZDogdGhlbWUucGFsZXR0ZS5iYWNrZ3JvdW5kLmRlZmF1bHQsXG4gICAgICAvLyBBZGRlZCBwYWRkaW5nIG9uIHRoZSBib3R0b20gc28gdGhhdCB0aGUgc3BhY2luZ1xuICAgICAgLy8gYmV0d2VlbiB0aGUgdGl0bGUgYW5kIHRvcCBvZiB0aGUgdGV4dCB+ZXF1YWxzIHNwYWNpbmdcbiAgICAgIC8vIGJldHdlZW4gYm90dG9tIG9mIGNvbnRlbnQgYW5kIGFjdGlvbnMgY29udGFpbmVyXG4gICAgICBwYWRkaW5nOiB0aGVtZS5zcGFjaW5nKDIsIDIsIDIuNSksXG4gICAgICBvdmVyZmxvd1k6ICdhdXRvJyxcbiAgICAgIFdlYmtpdE92ZXJmbG93U2Nyb2xsaW5nOiAndG91Y2gnLCAvLyBBZGQgaU9TIG1vbWVudHVtIHNjcm9sbGluZy5cbiAgICB9LFxuICAgIG1vZGFsQ2hpbGRyZW5Db250YWluZXJGdWxsU2NyZWVuOiB7XG4gICAgICBiYWNrZ3JvdW5kOiB0aGVtZS5wYWxldHRlLmdyZXlbNTBdLFxuICAgICAgaGVpZ2h0OiAnMTAwJScsXG4gICAgICBvdmVyZmxvd1k6ICdhdXRvJyxcbiAgICAgIHBhZGRpbmc6IHRoZW1lLnNwYWNpbmcoNCwgMy43NSwgNCwgMy43NSksXG4gICAgICB3aWR0aDogJzEwMCUnLFxuICAgICAgV2Via2l0T3ZlcmZsb3dTY3JvbGxpbmc6ICd0b3VjaCcsIC8vIEFkZCBpT1MgbW9tZW50dW0gc2Nyb2xsaW5nLlxuICAgIH0sXG4gICAgbW9kYWxBY3Rpb25zOiB7XG4gICAgICAvLyBPbiBtb2JpbGUsIHdlIHdhbnQgdG8gZG8gdGhlIGZvbGxvd2luZzpcbiAgICAgIC8vIDEpIFZlcnRpY2FsbHkgc3RhY2sgdGhlIGJ1dHRvbnNcbiAgICAgIC8vIDIpIFJldmVyc2UgdGhlIG9yZGVyIG9mIHRoZSBhY3Rpb25zLiAgT24gbW9iaWxlIGRldmljZXMsXG4gICAgICAvLyAgICB0aGUgbmVnYXRpdmUvY2FuY2VsIGFjdGlvbiBpcyBub3JtYWxseSBhdCB0aGUgKmJvdHRvbSosXG4gICAgICAvLyAgICB3aGVyZWFzIG91ciBkZWZhdWx0IGJlaGF2aW9yIHdpdGggc3RhbmRhcmQgbW9kYWxzIGlzXG4gICAgICAvLyAgICA8Y2FuY2VsPiA8c2F2ZT5cbiAgICAgIC8vIDMpIFRhcmdldCB0aGUgYnV0dG9ucyBhbmQgc2V0IHRoZSB3aWR0aHMgdG8gdGFrZSAxMDAlXG4gICAgICAvLyA0KSBUYXJnZXQgdGhlIGhlaWdodCBvZiBidXR0b25zIGFuZCBtYWtlIHRoZW0gdGFsbGVyLFxuICAgICAgLy8gICAganVzdCBzbyB0aGF0IHVzZXJzIGhhdmUgYSBsYXJnZXIgdGFwLXRhcmdldFxuICAgICAgJ0BtZWRpYSBzY3JlZW4gYW5kIChtYXgtd2lkdGg6IDQ4MHB4KSc6IHtcbiAgICAgICAgZGlzcGxheTogJ2ZsZXgnLFxuICAgICAgICBmbGV4RGlyZWN0aW9uOiAnY29sdW1uLXJldmVyc2UnLFxuICAgICAgICAnJiA+IGJ1dHRvbic6IHtcbiAgICAgICAgICB3aWR0aDogJzEwMCUnLFxuICAgICAgICAgIGhlaWdodDogdGhlbWUucHhUb1JlbSg0OCksXG4gICAgICAgICAgLy8gU2luY2Ugd2UgYXJlIGBjb2x1bW4tcmV2ZXJzZWAsIG1hcmdpbiBvbiB0aGUgYm90dG9tIGlzIG5vd1xuICAgICAgICAgIC8vIG1hcmdpbiB0b3BcbiAgICAgICAgICBtYXJnaW5Ub3A6IHRoZW1lLnNwYWNpbmcoMSksXG4gICAgICAgICAgJyY6bGFzdC1vZi10eXBlJzoge1xuICAgICAgICAgICAgbWFyZ2luVG9wOiAwLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0sXG4gIH0pLFxuICB7IG5hbWU6IE1vZGFsU3R5bGVzS2V5IH1cbik7XG5cbmV4cG9ydCB0eXBlIE1vZGFsQ2xhc3NlcyA9IEdldENsYXNzZXM8dHlwZW9mIHVzZVN0eWxlcz47XG5cbmV4cG9ydCBpbnRlcmZhY2UgTW9kYWxQcm9wc1xuICBleHRlbmRzIFBpY2s8XG4gICAgUmVhY3QuQ29tcG9uZW50UHJvcHNXaXRob3V0UmVmPCdkaXYnPixcbiAgICAnY2xhc3NOYW1lJyB8ICdvbkNsaWNrJyB8ICdvbk1vdXNlRG93bicgfCAnb25LZXlEb3duJ1xuICA+IHtcbiAgYWN0aW9ucz86IFJlYWN0LlJlYWN0Tm9kZTtcbiAgYWxsb3dQaW5jaFpvb20/OiBib29sZWFuO1xuICBjaGlsZHJlbj86IFJlYWN0LlJlYWN0Tm9kZTtcbiAgY3VzdG9tSGVhZGVyPzogUmVhY3QuUmVhY3ROb2RlO1xuICBjb250ZW50Q2xhc3NOYW1lPzogc3RyaW5nO1xuICBvdmVybGF5Q2xhc3NOYW1lPzogc3RyaW5nO1xuICBmdWxsV2lkdGg/OiBib29sZWFuO1xuICBpc0Zvcm1Db250ZW50PzogYm9vbGVhbjtcbiAgaXNGdWxsU2NyZWVuPzogYm9vbGVhbjtcbiAgaXNPcGVuPzogYm9vbGVhbjtcbiAganVzdGlmeUFjdGlvbnM/OiBNb2RhbEFjdGlvbnNQcm9wc1snanVzdGlmeSddO1xuICBvbkRpc21pc3M/OiAocHJvcHM6IGFueSkgPT4gdm9pZDtcbiAgZGlzYWJsZURpc21pc3NPbkNsaWNrT3V0c2lkZT86IGJvb2xlYW47XG4gIG9uRm9ybVN1Ym1pdD86IChkYXRhOiBhbnkpID0+IHZvaWQ7XG4gIHBvc2VzPzogVmFyaWFudHM7XG4gIHNpemU/OiAwIHwgMTtcbiAgdGl0bGU/OiBzdHJpbmc7XG59XG5cbmNvbnN0IE1vZGFsSW5uZXIgPSBSZWFjdC5mb3J3YXJkUmVmPEhUTUxEaXZFbGVtZW50LCBNb2RhbFByb3BzPihcbiAgKFxuICAgIHtcbiAgICAgIGFsbG93UGluY2hab29tLFxuICAgICAgb3ZlcmxheUNsYXNzTmFtZSxcbiAgICAgIGNoaWxkcmVuLFxuICAgICAgb25DbGljayxcbiAgICAgIG9uRGlzbWlzcyxcbiAgICAgIGRpc2FibGVEaXNtaXNzT25DbGlja091dHNpZGUsXG4gICAgICBvbk1vdXNlRG93bixcbiAgICAgIG9uS2V5RG93bixcbiAgICB9LFxuICAgIHJlZlxuICApID0+IHtcbiAgICBjb25zdCBjbGFzc2VzID0gdXNlU3R5bGVzKHt9KTtcbiAgICBjb25zdCBtb3VzZURvd25UYXJnZXQgPSBSZWFjdC51c2VSZWY8YW55PihudWxsKTtcbiAgICBjb25zdCBvdmVybGF5Tm9kZSA9IFJlYWN0LnVzZVJlZihudWxsKTtcbiAgICBjb25zdCB0aGlzUmVmID0gdXNlRm9ya2VkUmVmKG92ZXJsYXlOb2RlLCByZWYpO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIC8vIFNpbmNlIHdlIGFyZSB1c2luZyBGb2N1c0xvY2ssIHdlIGNhbiBzYWZlbHkgaWdub3JlIHRoZSBgYXV0b0ZvY3VzYCBFU0xpbnQgY29tcGxhaW50XG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUganN4LWExMXkvbm8tYXV0b2ZvY3VzXG4gICAgICA8Rm9jdXNMb2NrIGF1dG9Gb2N1cyByZXR1cm5Gb2N1cz5cbiAgICAgICAgPFJlbW92ZVNjcm9sbCBhbGxvd1BpbmNoWm9vbT17YWxsb3dQaW5jaFpvb219PlxuICAgICAgICAgIDxtb3Rpb24uZGl2XG4gICAgICAgICAgICBkYXRhLXRlc3RpZD17T1ZFUkxBWV9URVNUX0lEfVxuICAgICAgICAgICAgY2xhc3NOYW1lPXtjbHN4KGNsYXNzZXMub3ZlcmxheSwgb3ZlcmxheUNsYXNzTmFtZSl9XG4gICAgICAgICAgICBvbkNsaWNrPXt3cmFwRXZlbnQob25DbGljaywgKGV2ZW50OiBSZWFjdC5TeW50aGV0aWNFdmVudCkgPT4ge1xuICAgICAgICAgICAgICBpZiAobW91c2VEb3duVGFyZ2V0LmN1cnJlbnQgPT09IGV2ZW50LnRhcmdldCkge1xuICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIG9uRGlzbWlzcyAmJiAhZGlzYWJsZURpc21pc3NPbkNsaWNrT3V0c2lkZSAmJiBvbkRpc21pc3MoZXZlbnQpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KX1cbiAgICAgICAgICAgIG9uTW91c2VEb3duPXt3cmFwRXZlbnQob25Nb3VzZURvd24sIChldmVudDogUmVhY3QuTW91c2VFdmVudCkgPT4ge1xuICAgICAgICAgICAgICBtb3VzZURvd25UYXJnZXQuY3VycmVudCA9IGV2ZW50LnRhcmdldDtcbiAgICAgICAgICAgIH0pfVxuICAgICAgICAgICAgb25LZXlEb3duPXt3cmFwRXZlbnQob25LZXlEb3duLCAoZXZlbnQ6IFJlYWN0LktleWJvYXJkRXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgaWYgKGV2ZW50LmtleSA9PT0gJ0VzY2FwZScpIHtcbiAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICBvbkRpc21pc3MgJiYgb25EaXNtaXNzKGV2ZW50KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSl9XG4gICAgICAgICAgICByZWY9e3RoaXNSZWZ9XG4gICAgICAgICAgICBwb3NpdGlvblRyYW5zaXRpb25cbiAgICAgICAgICAgIGluaXRpYWw9e3sgb3BhY2l0eTogMCB9fVxuICAgICAgICAgICAgYW5pbWF0ZT17e1xuICAgICAgICAgICAgICBvcGFjaXR5OiAxLFxuICAgICAgICAgICAgICB0cmFuc2l0aW9uOiB7IGRlbGF5OiAwLjE1LCBkdXJhdGlvbjogMC4yIH0sXG4gICAgICAgICAgICB9fVxuICAgICAgICAgICAgZXhpdD17eyBvcGFjaXR5OiAwLCB0cmFuc2l0aW9uOiB7IGR1cmF0aW9uOiAwLjE1IH0gfX1cbiAgICAgICAgICA+XG4gICAgICAgICAgICB7Y2hpbGRyZW59XG4gICAgICAgICAgPC9tb3Rpb24uZGl2PlxuICAgICAgICA8L1JlbW92ZVNjcm9sbD5cbiAgICAgIDwvRm9jdXNMb2NrPlxuICAgICk7XG4gIH1cbik7XG5cbmNvbnN0IE92ZXJsYXkgPSBSZWFjdC5mb3J3YXJkUmVmPEhUTUxEaXZFbGVtZW50LCBNb2RhbFByb3BzPihcbiAgKHsgYWxsb3dQaW5jaFpvb20sIGlzT3BlbiA9IHRydWUsIC4uLnJvb3RQcm9wcyB9LCByZWYpID0+IHtcbiAgICBjb25zdCBvd25SZWYgPSBSZWFjdC51c2VSZWYobnVsbCk7XG4gICAgY29uc3QgdGhpc1JlZiA9IHJlZiB8fCBvd25SZWY7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPD5cbiAgICAgICAge2lzT3BlbiA/IChcbiAgICAgICAgICA8UG9ydGFsPlxuICAgICAgICAgICAgPE1vZGFsSW5uZXJcbiAgICAgICAgICAgICAgYWxsb3dQaW5jaFpvb209e2FsbG93UGluY2hab29tfVxuICAgICAgICAgICAgICByZWY9e3RoaXNSZWZ9XG4gICAgICAgICAgICAgIHsuLi5yb290UHJvcHN9XG4gICAgICAgICAgICAvPlxuICAgICAgICAgIDwvUG9ydGFsPlxuICAgICAgICApIDogbnVsbH1cbiAgICAgIDwvPlxuICAgICk7XG4gIH1cbik7XG5cbmNvbnN0IENvbnRlbnQgPSBSZWFjdC5mb3J3YXJkUmVmPEhUTUxEaXZFbGVtZW50LCBNb2RhbFByb3BzPihcbiAgKFxuICAgIHtcbiAgICAgIGFjdGlvbnMsXG4gICAgICBjbGFzc05hbWUsXG4gICAgICBjaGlsZHJlbixcbiAgICAgIGNvbnRlbnRDbGFzc05hbWUsXG4gICAgICBmdWxsV2lkdGgsXG4gICAgICBqdXN0aWZ5QWN0aW9ucyxcbiAgICAgIGlzRm9ybUNvbnRlbnQsXG4gICAgICBvbkZvcm1TdWJtaXQsXG4gICAgICBvbkNsaWNrLFxuICAgICAgb25EaXNtaXNzLFxuICAgICAgY3VzdG9tSGVhZGVyLFxuICAgICAgc2l6ZSxcbiAgICAgIHRpdGxlLFxuICAgICAgcG9zZXMgPSB7fSxcbiAgICAgIC4uLnJvb3RQcm9wc1xuICAgIH0sXG4gICAgcmVmXG4gICkgPT4ge1xuICAgIGNvbnN0IGNsYXNzZXMgPSB1c2VTdHlsZXMoe30pO1xuICAgIGNvbnN0IHNob3VsZFJlZHVjZU1vdGlvbiA9IHVzZVJlZHVjZWRNb3Rpb24oKTtcbiAgICBjb25zdCBwb3NlVmFyaWFudHMgPSB7XG4gICAgICBpbml0OiBwb3Nlcy5pbml0IHx8IHsgeTogNTAsIHNjYWxlOiAwLjMgfSxcbiAgICAgIG9wZW46IHBvc2VzLm9wZW4gfHwgeyB5OiAwLCBzY2FsZTogMSB9LFxuICAgICAgZXhpdDogcG9zZXMuZXhpdCB8fCB7IHNjYWxlOiAwLjUsIHRyYW5zaXRpb246IHsgZHVyYXRpb246IDAuMTUgfSB9LFxuICAgIH07XG5cbiAgICByZXR1cm4gKFxuICAgICAgPG1vdGlvbi5kaXZcbiAgICAgICAgY2xhc3NOYW1lPXtjbHN4KFxuICAgICAgICAgIGNsYXNzZXMuY29udGVudCxcbiAgICAgICAgICBmdWxsV2lkdGggJiYgY2xhc3Nlcy5jb250ZW50RnVsbFdpZHRoLFxuICAgICAgICAgIGNsYXNzTmFtZVxuICAgICAgICApfVxuICAgICAgICByb2xlPVwiZGlhbG9nXCJcbiAgICAgICAgYXJpYS1tb2RhbD1cInRydWVcIlxuICAgICAgICBhcmlhLWRlc2NyaWJlZGJ5PXthcmlhRGVzY3JpYmVkQnl9XG4gICAgICAgIGFyaWEtbGFiZWxsZWRieT17YXJpYUxhYmVsbGVkQnl9XG4gICAgICAgIHRhYkluZGV4PXstMX1cbiAgICAgICAgb25DbGljaz17d3JhcEV2ZW50KG9uQ2xpY2ssIChldmVudDogYW55KSA9PiB7XG4gICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIH0pfVxuICAgICAgICByZWY9e3JlZn1cbiAgICAgICAgdmFyaWFudHM9e3Bvc2VWYXJpYW50c31cbiAgICAgICAgaW5pdGlhbD17c2hvdWxkUmVkdWNlTW90aW9uID8ge30gOiAnaW5pdCd9XG4gICAgICAgIGFuaW1hdGU9e3Nob3VsZFJlZHVjZU1vdGlvbiA/IHt9IDogJ29wZW4nfVxuICAgICAgICBleGl0PXtzaG91bGRSZWR1Y2VNb3Rpb24gPyB7fSA6ICdleGl0J31cbiAgICAgICAgey4uLnJvb3RQcm9wc31cbiAgICAgID5cbiAgICAgICAge2N1c3RvbUhlYWRlciA/IChcbiAgICAgICAgICBjdXN0b21IZWFkZXJcbiAgICAgICAgKSA6IChcbiAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICBpZD17YXJpYUxhYmVsbGVkQnl9XG4gICAgICAgICAgICBjbGFzc05hbWU9e2Nsc3goY2xhc3Nlcy5tb2RhbEhlYWRlciwgY2xhc3Nlcy52ZXJ0aWNhbFBhZGRpbmcpfVxuICAgICAgICAgID5cbiAgICAgICAgICAgIHshIXRpdGxlICYmIChcbiAgICAgICAgICAgICAgPFRleHQgc2l6ZT1cInN1YmJvZHlcIiB3ZWlnaHQ9XCJib2xkXCI+XG4gICAgICAgICAgICAgICAge3RpdGxlfVxuICAgICAgICAgICAgICA8L1RleHQ+XG4gICAgICAgICAgICApfVxuICAgICAgICAgICAgPEljb25CdXR0b25cbiAgICAgICAgICAgICAgYXJpYS1sYWJlbD1cIkNsb3NlIG9wZW4gbW9kYWxcIlxuICAgICAgICAgICAgICBpY29uPXtYfVxuICAgICAgICAgICAgICBzaXplPXswfVxuICAgICAgICAgICAgICB0YWJJbmRleD17MH1cbiAgICAgICAgICAgICAgb25DbGljaz17b25EaXNtaXNzfVxuICAgICAgICAgICAgICBwYWRkaW5nUmlnaHQ9ezB9XG4gICAgICAgICAgICAvPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICApfVxuICAgICAgICA8Q29uZGl0aW9uYWxXcmFwcGVyXG4gICAgICAgICAgY29uZGl0aW9uPXtCb29sZWFuKGlzRm9ybUNvbnRlbnQgJiYgb25Gb3JtU3VibWl0KX1cbiAgICAgICAgICB3cmFwcGVyPXsoY2hpbGRyZW46IFJlYWN0LlJlYWN0Tm9kZSkgPT4gKFxuICAgICAgICAgICAgPGZvcm0gb25TdWJtaXQ9e29uRm9ybVN1Ym1pdH0+e2NoaWxkcmVufTwvZm9ybT5cbiAgICAgICAgICApfVxuICAgICAgICA+XG4gICAgICAgICAge2NoaWxkcmVuICYmIChcbiAgICAgICAgICAgIDxkaXZcbiAgICAgICAgICAgICAgaWQ9e2FyaWFEZXNjcmliZWRCeX1cbiAgICAgICAgICAgICAgY2xhc3NOYW1lPXtjbHN4KFxuICAgICAgICAgICAgICAgIGNsYXNzZXMubW9kYWxDaGlsZHJlbkNvbnRhaW5lcixcbiAgICAgICAgICAgICAgICBjbGFzc2VzLnZlcnRpY2FsUGFkZGluZyxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICBbY2xhc3Nlcy5jb250ZW50U2l6ZTBdOiBzaXplID09PSAwLFxuICAgICAgICAgICAgICAgICAgW2NsYXNzZXMuY29udGVudFNpemUxXTogc2l6ZSA9PT0gMSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGNvbnRlbnRDbGFzc05hbWVcbiAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAge2NoaWxkcmVufVxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgKX1cbiAgICAgICAgICB7ISFhY3Rpb25zICYmIChcbiAgICAgICAgICAgIDxNb2RhbEFjdGlvbnNcbiAgICAgICAgICAgICAgY2xhc3NOYW1lPXtjbHN4KGNsYXNzZXMubW9kYWxBY3Rpb25zLCBjbGFzc2VzLnZlcnRpY2FsUGFkZGluZyl9XG4gICAgICAgICAgICAgIGp1c3RpZnk9e2p1c3RpZnlBY3Rpb25zfVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICB7YWN0aW9uc31cbiAgICAgICAgICAgIDwvTW9kYWxBY3Rpb25zPlxuICAgICAgICAgICl9XG4gICAgICAgIDwvQ29uZGl0aW9uYWxXcmFwcGVyPlxuICAgICAgPC9tb3Rpb24uZGl2PlxuICAgICk7XG4gIH1cbik7XG5cbmNvbnN0IEZ1bGxTY3JlZW5Db250ZW50ID0gUmVhY3QuZm9yd2FyZFJlZjxIVE1MRGl2RWxlbWVudCwgTW9kYWxQcm9wcz4oXG4gIChcbiAgICB7XG4gICAgICBjaGlsZHJlbixcbiAgICAgIGNsYXNzTmFtZSxcbiAgICAgIGNvbnRlbnRDbGFzc05hbWUsXG4gICAgICBvbkNsaWNrLFxuICAgICAgb25EaXNtaXNzLFxuICAgICAgdGl0bGUsXG4gICAgICBjdXN0b21IZWFkZXIsXG4gICAgICAuLi5yb290UHJvcHNcbiAgICB9LFxuICAgIHJlZlxuICApID0+IHtcbiAgICBjb25zdCBjbGFzc2VzID0gdXNlU3R5bGVzKHt9KTtcblxuICAgIHJldHVybiAoXG4gICAgICA8bW90aW9uLmRpdlxuICAgICAgICBjbGFzc05hbWU9e2Nsc3goY2xhc3Nlcy5jb250ZW50RnVsbFNjcmVlbiwgY2xhc3NOYW1lKX1cbiAgICAgICAgcm9sZT1cImRpYWxvZ1wiXG4gICAgICAgIGFyaWEtbW9kYWw9XCJ0cnVlXCJcbiAgICAgICAgYXJpYS1kZXNjcmliZWRieT17YXJpYURlc2NyaWJlZEJ5fVxuICAgICAgICBhcmlhLWxhYmVsbGVkYnk9e2FyaWFMYWJlbGxlZEJ5fVxuICAgICAgICB0YWJJbmRleD17LTF9XG4gICAgICAgIG9uQ2xpY2s9e3dyYXBFdmVudChvbkNsaWNrLCAoZXZlbnQ6IGFueSkgPT4ge1xuICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB9KX1cbiAgICAgICAgcmVmPXtyZWZ9XG4gICAgICAgIGluaXRpYWw9e3sgb3BhY2l0eTogMCB9fVxuICAgICAgICBhbmltYXRlPXt7XG4gICAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgICB0cmFuc2l0aW9uOiB7IGR1cmF0aW9uOiAwLjEsIGVhc2U6IFswLjE2LCAxLCAwLjMsIDFdIH0sIC8vIGh0dHBzOi8vZWFzaW5ncy5uZXQvI2Vhc2VPdXRFeHBvXG4gICAgICAgIH19XG4gICAgICAgIGV4aXQ9e3tcbiAgICAgICAgICBvcGFjaXR5OiAwLFxuICAgICAgICAgIHRyYW5zaXRpb246IHsgZHVyYXRpb246IDAuMDgsIGVhc2U6IFswLjcsIDAsIDAuODQsIDBdIH0sXG4gICAgICAgIH19IC8vIGh0dHBzOi8vZWFzaW5ncy5uZXQvI2Vhc2VJbkV4cG9cbiAgICAgICAgey4uLnJvb3RQcm9wc31cbiAgICAgID5cbiAgICAgICAge2N1c3RvbUhlYWRlciA/IChcbiAgICAgICAgICBjdXN0b21IZWFkZXJcbiAgICAgICAgKSA6IChcbiAgICAgICAgICA8ZGl2IGlkPXthcmlhTGFiZWxsZWRCeX0gY2xhc3NOYW1lPXtjbGFzc2VzLm1vZGFsSGVhZGVyRnVsbFNjcmVlbn0+XG4gICAgICAgICAgICB7ISF0aXRsZSAmJiA8VGV4dCBzaXplPVwic3ViYm9keVwiPnt0aXRsZX08L1RleHQ+fVxuICAgICAgICAgICAgPEljb25CdXR0b25cbiAgICAgICAgICAgICAgYXJpYS1sYWJlbD1cIkNsb3NlIG9wZW4gbW9kYWxcIlxuICAgICAgICAgICAgICBpY29uPXtYfVxuICAgICAgICAgICAgICBzaXplPXswfVxuICAgICAgICAgICAgICB0YWJJbmRleD17MH1cbiAgICAgICAgICAgICAgb25DbGljaz17b25EaXNtaXNzfVxuICAgICAgICAgICAgICBwYWRkaW5nUmlnaHQ9ezB9XG4gICAgICAgICAgICAvPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICApfVxuICAgICAgICA8ZGl2XG4gICAgICAgICAgaWQ9e2FyaWFEZXNjcmliZWRCeX1cbiAgICAgICAgICBjbGFzc05hbWU9e2Nsc3goXG4gICAgICAgICAgICBjbGFzc2VzLm1vZGFsQ2hpbGRyZW5Db250YWluZXJGdWxsU2NyZWVuLFxuICAgICAgICAgICAgY29udGVudENsYXNzTmFtZVxuICAgICAgICAgICl9XG4gICAgICAgID5cbiAgICAgICAgICB7Y2hpbGRyZW59XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9tb3Rpb24uZGl2PlxuICAgICk7XG4gIH1cbik7XG5cbmV4cG9ydCBjb25zdCBNb2RhbCA9IFJlYWN0LmZvcndhcmRSZWY8SFRNTERpdkVsZW1lbnQsIE1vZGFsUHJvcHM+KFxuICAoXG4gICAge1xuICAgICAgYWxsb3dQaW5jaFpvb20sXG4gICAgICBpc0Z1bGxTY3JlZW4sXG4gICAgICBpc09wZW4sXG4gICAgICBvbkRpc21pc3MsXG4gICAgICBkaXNhYmxlRGlzbWlzc09uQ2xpY2tPdXRzaWRlLFxuICAgICAgc2l6ZSA9IDAsXG4gICAgICBvdmVybGF5Q2xhc3NOYW1lLFxuICAgICAgLi4ucm9vdFByb3BzXG4gICAgfSxcbiAgICByZWZcbiAgKSA9PiB7XG4gICAgY29uc3Qgb3duUmVmID0gUmVhY3QudXNlUmVmKG51bGwpO1xuXG4gICAgLy8gSWYgYSByZWYgaXMgZm9yd2FyZGVkLCB1c2UgaXQ7IG90aGVyd2lzZSwgdXNlIG91cnNlbHZlcyBhcyB0aGUgcmVmXG4gICAgY29uc3QgdGhpc1JlZiA9IHJlZiB8fCBvd25SZWY7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPEFuaW1hdGVQcmVzZW5jZT5cbiAgICAgICAge2lzT3BlbiA/IChcbiAgICAgICAgICA8T3ZlcmxheVxuICAgICAgICAgICAgb3ZlcmxheUNsYXNzTmFtZT17b3ZlcmxheUNsYXNzTmFtZX1cbiAgICAgICAgICAgIGFsbG93UGluY2hab29tPXthbGxvd1BpbmNoWm9vbX1cbiAgICAgICAgICAgIGlzT3Blbj17aXNPcGVufVxuICAgICAgICAgICAgb25EaXNtaXNzPXtvbkRpc21pc3N9XG4gICAgICAgICAgICBkaXNhYmxlRGlzbWlzc09uQ2xpY2tPdXRzaWRlPXtkaXNhYmxlRGlzbWlzc09uQ2xpY2tPdXRzaWRlfVxuICAgICAgICAgID5cbiAgICAgICAgICAgIHtpc0Z1bGxTY3JlZW4gPyAoXG4gICAgICAgICAgICAgIDxGdWxsU2NyZWVuQ29udGVudFxuICAgICAgICAgICAgICAgIHJlZj17dGhpc1JlZn1cbiAgICAgICAgICAgICAgICBzaXplPXtzaXplfVxuICAgICAgICAgICAgICAgIG9uRGlzbWlzcz17b25EaXNtaXNzfVxuICAgICAgICAgICAgICAgIHsuLi5yb290UHJvcHN9XG4gICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICApIDogKFxuICAgICAgICAgICAgICA8Q29udGVudFxuICAgICAgICAgICAgICAgIHJlZj17dGhpc1JlZn1cbiAgICAgICAgICAgICAgICBzaXplPXtzaXplfVxuICAgICAgICAgICAgICAgIG9uRGlzbWlzcz17b25EaXNtaXNzfVxuICAgICAgICAgICAgICAgIHsuLi5yb290UHJvcHN9XG4gICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICApfVxuICAgICAgICAgIDwvT3ZlcmxheT5cbiAgICAgICAgKSA6IG51bGx9XG4gICAgICA8L0FuaW1hdGVQcmVzZW5jZT5cbiAgICApO1xuICB9XG4pO1xuIl19