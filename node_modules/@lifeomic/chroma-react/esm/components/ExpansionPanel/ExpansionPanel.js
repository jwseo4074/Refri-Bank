var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
import clsx from 'clsx';
import * as React from 'react';
import { Plus } from '@lifeomic/chromicons';
import { makeStyles } from '../../styles';
import { generateUniqueId } from '../_private/UniqueId';
import { Text } from '../Text';
export var ExpansionPanelStylesKey = 'ChromaExpansionPanel';
export var useStyles = makeStyles(function (theme) { return ({
    root: {
        width: '100%',
        borderBottom: "1px solid " + theme.palette.divider,
    },
    rootOpen: {
        maxHeight: 'inherit',
    },
    button: {
        width: '100%',
        background: theme.palette.common.white,
        display: 'flex',
        justifyContent: 'space-between',
        alignItems: 'center',
        position: 'relative',
        textAlign: 'left',
        border: 'none',
        outline: 'none',
        paddingLeft: theme.spacing(2),
        paddingRight: theme.spacing(2),
        paddingTop: theme.spacing(1.25),
        paddingBottom: theme.spacing(1.25),
        cursor: 'pointer',
        '&:focus': {
            outline: 'none',
        },
        '&:hover > p, &:focus > p': {
            color: theme.palette.black.main,
            transform: 'translate3d(2px, 0, 0)',
        },
    },
    buttonShadow: {
        boxShadow: theme.boxShadows.table,
    },
    title: {
        color: theme.palette.text.secondary,
        letterSpacing: 'initial',
        transition: 'color 0.5s ease, transform 0.5s ease',
    },
    icon: {
        transition: 'transform 0.25s ease',
        color: theme.palette.primary.main,
    },
    rotate: {
        transform: 'rotate(45deg)',
    },
    content: {
        maxHeight: 0,
        overflow: 'hidden',
        transition: 'max-height 0.25s ease-in-out',
    },
    inner: {
        display: 'flex',
        flexDirection: 'column',
        background: theme.palette.common.white,
        padding: theme.spacing(2),
        width: '100%',
        height: '100%',
        visibility: 'visible',
    },
    directionRow: {
        flexDirection: 'row',
    },
    innerHidden: {
        visibility: 'hidden',
    },
}); }, { name: ExpansionPanelStylesKey });
export var ExpansionPanel = function (_a) {
    var _b;
    var _c;
    var ariaOwnsId = _a.ariaOwnsId, children = _a.children, className = _a.className, contentClassName = _a.contentClassName, innerContentClassName = _a.innerContentClassName, onToggle = _a.onToggle, _d = _a.isOpen, isOpen = _d === void 0 ? false : _d, _e = _a.contentDirection, contentDirection = _e === void 0 ? 'column' : _e, title = _a.title, rootProps = __rest(_a, ["ariaOwnsId", "children", "className", "contentClassName", "innerContentClassName", "onToggle", "isOpen", "contentDirection", "title"]);
    var classes = useStyles({});
    var _f = React.useState(isOpen), isExpanded = _f[0], setIsExpanded = _f[1];
    var ref = React.useRef(null);
    var _g = React.useState(0), contentHeight = _g[0], setContentHeight = _g[1];
    var ariaId = React.useState(function () { return ariaOwnsId || generateUniqueId('exppanel-'); })[0];
    // Watch for `isOpen` changes
    React.useEffect(function () {
        setIsExpanded(isOpen);
    }, [isOpen]);
    // TODO: Look into https://medium.com/@teh_builder/ref-objects-inside-useeffect-hooks-eb7c15198780
    //
    // Determine the size of our content so we can expand/collapse
    // accordingly.  If the children are dynamically generated, we should
    // re-evaluate our size in case additional content is added/removed
    React.useEffect(function () {
        if (ref && ref.current && children) {
            setContentHeight(ref.current.scrollHeight + 25);
        }
    }, [children, (_c = ref === null || ref === void 0 ? void 0 : ref.current) === null || _c === void 0 ? void 0 : _c.scrollHeight]);
    var handleClick = React.useCallback(function (e) {
        e.preventDefault();
        e.stopPropagation();
        var newState = !isExpanded;
        if (typeof onToggle === 'function') {
            onToggle(newState);
        }
        setIsExpanded(newState);
    }, [isExpanded, onToggle]);
    return (React.createElement("div", __assign({ className: clsx(classes.root, isExpanded && classes.rootOpen, className) }, rootProps),
        React.createElement("button", { "aria-expanded": isExpanded, "aria-owns": ariaId, className: clsx(classes.button, isExpanded && classes.buttonShadow), onClick: handleClick, tabIndex: 0 },
            React.createElement(Text, { className: classes.title, size: "subbody", weight: "bold" }, title),
            React.createElement(Plus, { className: clsx(classes.icon, isExpanded && classes.rotate), "aria-hidden": "true", width: 18, height: 18 })),
        React.createElement("div", { "aria-hidden": !isExpanded, id: ariaId, className: clsx(classes.content, contentClassName), style: { maxHeight: isExpanded ? contentHeight : 0 } },
            React.createElement("div", { ref: ref, className: clsx(classes.inner, innerContentClassName, (_b = {},
                    _b[classes.directionRow] = contentDirection === 'row',
                    _b), !isExpanded && classes.innerHidden) }, children))));
};
export default ExpansionPanel;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRXhwYW5zaW9uUGFuZWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9FeHBhbnNpb25QYW5lbC9FeHBhbnNpb25QYW5lbC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLE9BQU8sSUFBSSxNQUFNLE1BQU0sQ0FBQztBQUN4QixPQUFPLEtBQUssS0FBSyxNQUFNLE9BQU8sQ0FBQztBQUMvQixPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDNUMsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUUxQyxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUN4RCxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sU0FBUyxDQUFDO0FBRS9CLE1BQU0sQ0FBQyxJQUFNLHVCQUF1QixHQUFHLHNCQUFzQixDQUFDO0FBRTlELE1BQU0sQ0FBQyxJQUFNLFNBQVMsR0FBRyxVQUFVLENBQ2pDLFVBQUMsS0FBSyxJQUFLLE9BQUEsQ0FBQztJQUNWLElBQUksRUFBRTtRQUNKLEtBQUssRUFBRSxNQUFNO1FBQ2IsWUFBWSxFQUFFLGVBQWEsS0FBSyxDQUFDLE9BQU8sQ0FBQyxPQUFTO0tBQ25EO0lBQ0QsUUFBUSxFQUFFO1FBQ1IsU0FBUyxFQUFFLFNBQVM7S0FDckI7SUFDRCxNQUFNLEVBQUU7UUFDTixLQUFLLEVBQUUsTUFBTTtRQUNiLFVBQVUsRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxLQUFLO1FBQ3RDLE9BQU8sRUFBRSxNQUFNO1FBQ2YsY0FBYyxFQUFFLGVBQWU7UUFDL0IsVUFBVSxFQUFFLFFBQVE7UUFDcEIsUUFBUSxFQUFFLFVBQVU7UUFDcEIsU0FBUyxFQUFFLE1BQU07UUFDakIsTUFBTSxFQUFFLE1BQU07UUFDZCxPQUFPLEVBQUUsTUFBTTtRQUNmLFdBQVcsRUFBRSxLQUFL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QU0sRUFBRSxFQUFFLEdBQ1YsQ0FDSztRQUNULDRDQUNlLENBQUMsVUFBVSxFQUN4QixFQUFFLEVBQUUsTUFBTSxFQUNWLFNBQVMsRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxnQkFBZ0IsQ0FBQyxFQUNsRCxLQUFLLEVBQUUsRUFBRSxTQUFTLEVBQUUsVUFBVSxDQUFDLENBQUMsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRTtZQUVwRCw2QkFDRSxHQUFHLEVBQUUsR0FBRyxFQUNSLFNBQVMsRUFBRSxJQUFJLENBQ2IsT0FBTyxDQUFDLEtBQUssRUFDYixxQkFBcUI7b0JBRW5CLEdBQUMsT0FBTyxDQUFDLFlBQVksSUFBRyxnQkFBZ0IsS0FBSyxLQUFLO3lCQUVwRCxDQUFDLFVBQVUsSUFBSSxPQUFPLENBQUMsV0FBVyxDQUNuQyxJQUVBLFFBQVEsQ0FDTCxDQUNGLENBQ0YsQ0FDUCxDQUFDO0FBQ0osQ0FBQyxDQUFDO0FBRUYsZUFBZSxjQUFjLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgY2xzeCBmcm9tICdjbHN4JztcbmltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IFBsdXMgfSBmcm9tICdAbGlmZW9taWMvY2hyb21pY29ucyc7XG5pbXBvcnQgeyBtYWtlU3R5bGVzIH0gZnJvbSAnLi4vLi4vc3R5bGVzJztcbmltcG9ydCB7IEdldENsYXNzZXMgfSBmcm9tICcuLi8uLi90eXBlVXRpbHMnO1xuaW1wb3J0IHsgZ2VuZXJhdGVVbmlxdWVJZCB9IGZyb20gJy4uL19wcml2YXRlL1VuaXF1ZUlkJztcbmltcG9ydCB7IFRleHQgfSBmcm9tICcuLi9UZXh0JztcblxuZXhwb3J0IGNvbnN0IEV4cGFuc2lvblBhbmVsU3R5bGVzS2V5ID0gJ0Nocm9tYUV4cGFuc2lvblBhbmVsJztcblxuZXhwb3J0IGNvbnN0IHVzZVN0eWxlcyA9IG1ha2VTdHlsZXMoXG4gICh0aGVtZSkgPT4gKHtcbiAgICByb290OiB7XG4gICAgICB3aWR0aDogJzEwMCUnLFxuICAgICAgYm9yZGVyQm90dG9tOiBgMXB4IHNvbGlkICR7dGhlbWUucGFsZXR0ZS5kaXZpZGVyfWAsXG4gICAgfSxcbiAgICByb290T3Blbjoge1xuICAgICAgbWF4SGVpZ2h0OiAnaW5oZXJpdCcsXG4gICAgfSxcbiAgICBidXR0b246IHtcbiAgICAgIHdpZHRoOiAnMTAwJScsXG4gICAgICBiYWNrZ3JvdW5kOiB0aGVtZS5wYWxldHRlLmNvbW1vbi53aGl0ZSxcbiAgICAgIGRpc3BsYXk6ICdmbGV4JyxcbiAgICAgIGp1c3RpZnlDb250ZW50OiAnc3BhY2UtYmV0d2VlbicsXG4gICAgICBhbGlnbkl0ZW1zOiAnY2VudGVyJyxcbiAgICAgIHBvc2l0aW9uOiAncmVsYXRpdmUnLFxuICAgICAgdGV4dEFsaWduOiAnbGVmdCcsXG4gICAgICBib3JkZXI6ICdub25lJyxcbiAgICAgIG91dGxpbmU6ICdub25lJyxcbiAgICAgIHBhZGRpbmdMZWZ0OiB0aGVtZS5zcGFjaW5nKDIpLFxuICAgICAgcGFkZGluZ1JpZ2h0OiB0aGVtZS5zcGFjaW5nKDIpLFxuICAgICAgcGFkZGluZ1RvcDogdGhlbWUuc3BhY2luZygxLjI1KSxcbiAgICAgIHBhZGRpbmdCb3R0b206IHRoZW1lLnNwYWNpbmcoMS4yNSksXG4gICAgICBjdXJzb3I6ICdwb2ludGVyJyxcbiAgICAgICcmOmZvY3VzJzoge1xuICAgICAgICBvdXRsaW5lOiAnbm9uZScsXG4gICAgICB9LFxuICAgICAgJyY6aG92ZXIgPiBwLCAmOmZvY3VzID4gcCc6IHtcbiAgICAgICAgY29sb3I6IHRoZW1lLnBhbGV0dGUuYmxhY2subWFpbixcbiAgICAgICAgdHJhbnNmb3JtOiAndHJhbnNsYXRlM2QoMnB4LCAwLCAwKScsXG4gICAgICB9LFxuICAgIH0sXG4gICAgYnV0dG9uU2hhZG93OiB7XG4gICAgICBib3hTaGFkb3c6IHRoZW1lLmJveFNoYWRvd3MudGFibGUsXG4gICAgfSxcbiAgICB0aXRsZToge1xuICAgICAgY29sb3I6IHRoZW1lLnBhbGV0dGUudGV4dC5zZWNvbmRhcnksXG4gICAgICBsZXR0ZXJTcGFjaW5nOiAnaW5pdGlhbCcsXG4gICAgICB0cmFuc2l0aW9uOiAnY29sb3IgMC41cyBlYXNlLCB0cmFuc2Zvcm0gMC41cyBlYXNlJyxcbiAgICB9LFxuICAgIGljb246IHtcbiAgICAgIHRyYW5zaXRpb246ICd0cmFuc2Zvcm0gMC4yNXMgZWFzZScsXG4gICAgICBjb2xvcjogdGhlbWUucGFsZXR0ZS5wcmltYXJ5Lm1haW4sXG4gICAgfSxcbiAgICByb3RhdGU6IHtcbiAgICAgIHRyYW5zZm9ybTogJ3JvdGF0ZSg0NWRlZyknLFxuICAgIH0sXG4gICAgY29udGVudDoge1xuICAgICAgbWF4SGVpZ2h0OiAwLFxuICAgICAgb3ZlcmZsb3c6ICdoaWRkZW4nLFxuICAgICAgdHJhbnNpdGlvbjogJ21heC1oZWlnaHQgMC4yNXMgZWFzZS1pbi1vdXQnLFxuICAgIH0sXG4gICAgaW5uZXI6IHtcbiAgICAgIGRpc3BsYXk6ICdmbGV4JyxcbiAgICAgIGZsZXhEaXJlY3Rpb246ICdjb2x1bW4nLFxuICAgICAgYmFja2dyb3VuZDogdGhlbWUucGFsZXR0ZS5jb21tb24ud2hpdGUsXG4gICAgICBwYWRkaW5nOiB0aGVtZS5zcGFjaW5nKDIpLFxuICAgICAgd2lkdGg6ICcxMDAlJyxcbiAgICAgIGhlaWdodDogJzEwMCUnLFxuICAgICAgdmlzaWJpbGl0eTogJ3Zpc2libGUnLFxuICAgIH0sXG4gICAgZGlyZWN0aW9uUm93OiB7XG4gICAgICBmbGV4RGlyZWN0aW9uOiAncm93JyxcbiAgICB9LFxuICAgIGlubmVySGlkZGVuOiB7XG4gICAgICB2aXNpYmlsaXR5OiAnaGlkZGVuJyxcbiAgICB9LFxuICB9KSxcbiAgeyBuYW1lOiBFeHBhbnNpb25QYW5lbFN0eWxlc0tleSB9XG4pO1xuXG5leHBvcnQgdHlwZSBFeHBhbnNpb25QYW5lbENsYXNzZXMgPSBHZXRDbGFzc2VzPHR5cGVvZiB1c2VTdHlsZXM+O1xuXG5leHBvcnQgaW50ZXJmYWNlIEV4cGFuc2lvblBhbmVsUHJvcHNcbiAgZXh0ZW5kcyBSZWFjdC5EZXRhaWxlZEhUTUxQcm9wczxcbiAgICBSZWFjdC5IVE1MQXR0cmlidXRlczxIVE1MRGl2RWxlbWVudD4sXG4gICAgSFRNTERpdkVsZW1lbnRcbiAgPiB7XG4gIGFyaWFPd25zSWQ/OiBzdHJpbmc7XG4gIGNvbnRlbnRDbGFzc05hbWU/OiBzdHJpbmc7XG4gIGlubmVyQ29udGVudENsYXNzTmFtZT86IHN0cmluZztcbiAgdGl0bGU6IHN0cmluZztcbiAgb25Ub2dnbGU/OiAoaXNFeHBhbmRlZDogYm9vbGVhbikgPT4gdm9pZDtcbiAgaXNPcGVuPzogYm9vbGVhbjtcbiAgY29udGVudERpcmVjdGlvbj86ICdyb3cnIHwgJ2NvbHVtbic7XG59XG5cbmV4cG9ydCBjb25zdCBFeHBhbnNpb25QYW5lbDogUmVhY3QuRkM8RXhwYW5zaW9uUGFuZWxQcm9wcz4gPSAoe1xuICBhcmlhT3duc0lkLFxuICBjaGlsZHJlbixcbiAgY2xhc3NOYW1lLFxuICBjb250ZW50Q2xhc3NOYW1lLFxuICBpbm5lckNvbnRlbnRDbGFzc05hbWUsXG4gIG9uVG9nZ2xlLFxuICBpc09wZW4gPSBmYWxzZSxcbiAgY29udGVudERpcmVjdGlvbiA9ICdjb2x1bW4nLFxuICB0aXRsZSxcbiAgLi4ucm9vdFByb3BzXG59KSA9PiB7XG4gIGNvbnN0IGNsYXNzZXMgPSB1c2VTdHlsZXMoe30pO1xuICBjb25zdCBbaXNFeHBhbmRlZCwgc2V0SXNFeHBhbmRlZF0gPSBSZWFjdC51c2VTdGF0ZShpc09wZW4pO1xuXG4gIGNvbnN0IHJlZiA9IFJlYWN0LnVzZVJlZjxIVE1MRGl2RWxlbWVudD4obnVsbCk7XG4gIGNvbnN0IFtjb250ZW50SGVpZ2h0LCBzZXRDb250ZW50SGVpZ2h0XSA9IFJlYWN0LnVzZVN0YXRlPG51bWJlcj4oMCk7XG5cbiAgY29uc3QgW2FyaWFJZF0gPSBSZWFjdC51c2VTdGF0ZTxzdHJpbmc+KFxuICAgICgpID0+IGFyaWFPd25zSWQgfHwgZ2VuZXJhdGVVbmlxdWVJZCgnZXhwcGFuZWwtJylcbiAgKTtcblxuICAvLyBXYXRjaCBmb3IgYGlzT3BlbmAgY2hhbmdlc1xuICBSZWFjdC51c2VFZmZlY3QoKCkgPT4ge1xuICAgIHNldElzRXhwYW5kZWQoaXNPcGVuKTtcbiAgfSwgW2lzT3Blbl0pO1xuXG4gIC8vIFRPRE86IExvb2sgaW50byBodHRwczovL21lZGl1bS5jb20vQHRlaF9idWlsZGVyL3JlZi1vYmplY3RzLWluc2lkZS11c2VlZmZlY3QtaG9va3MtZWI3YzE1MTk4NzgwXG4gIC8vXG4gIC8vIERldGVybWluZSB0aGUgc2l6ZSBvZiBvdXIgY29udGVudCBzbyB3ZSBjYW4gZXhwYW5kL2NvbGxhcHNlXG4gIC8vIGFjY29yZGluZ2x5LiAgSWYgdGhlIGNoaWxkcmVuIGFyZSBkeW5hbWljYWxseSBnZW5lcmF0ZWQsIHdlIHNob3VsZFxuICAvLyByZS1ldmFsdWF0ZSBvdXIgc2l6ZSBpbiBjYXNlIGFkZGl0aW9uYWwgY29udGVudCBpcyBhZGRlZC9yZW1vdmVkXG4gIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKHJlZiAmJiByZWYuY3VycmVudCAmJiBjaGlsZHJlbikge1xuICAgICAgc2V0Q29udGVudEhlaWdodChyZWYuY3VycmVudC5zY3JvbGxIZWlnaHQgKyAyNSk7XG4gICAgfVxuICB9LCBbY2hpbGRyZW4sIHJlZj8uY3VycmVudD8uc2Nyb2xsSGVpZ2h0XSk7XG5cbiAgY29uc3QgaGFuZGxlQ2xpY2sgPSBSZWFjdC51c2VDYWxsYmFjayhcbiAgICAoZTogUmVhY3QuU3ludGhldGljRXZlbnQpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICAgIGNvbnN0IG5ld1N0YXRlID0gIWlzRXhwYW5kZWQ7XG4gICAgICBpZiAodHlwZW9mIG9uVG9nZ2xlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIG9uVG9nZ2xlKG5ld1N0YXRlKTtcbiAgICAgIH1cblxuICAgICAgc2V0SXNFeHBhbmRlZChuZXdTdGF0ZSk7XG4gICAgfSxcbiAgICBbaXNFeHBhbmRlZCwgb25Ub2dnbGVdXG4gICk7XG5cbiAgcmV0dXJuIChcbiAgICA8ZGl2XG4gICAgICBjbGFzc05hbWU9e2Nsc3goY2xhc3Nlcy5yb290LCBpc0V4cGFuZGVkICYmIGNsYXNzZXMucm9vdE9wZW4sIGNsYXNzTmFtZSl9XG4gICAgICB7Li4ucm9vdFByb3BzfVxuICAgID5cbiAgICAgIDxidXR0b25cbiAgICAgICAgYXJpYS1leHBhbmRlZD17aXNFeHBhbmRlZH1cbiAgICAgICAgYXJpYS1vd25zPXthcmlhSWR9XG4gICAgICAgIGNsYXNzTmFtZT17Y2xzeChjbGFzc2VzLmJ1dHRvbiwgaXNFeHBhbmRlZCAmJiBjbGFzc2VzLmJ1dHRvblNoYWRvdyl9XG4gICAgICAgIG9uQ2xpY2s9e2hhbmRsZUNsaWNrfVxuICAgICAgICB0YWJJbmRleD17MH1cbiAgICAgID5cbiAgICAgICAgPFRleHQgY2xhc3NOYW1lPXtjbGFzc2VzLnRpdGxlfSBzaXplPVwic3ViYm9keVwiIHdlaWdodD1cImJvbGRcIj5cbiAgICAgICAgICB7dGl0bGV9XG4gICAgICAgIDwvVGV4dD5cbiAgICAgICAgPFBsdXNcbiAgICAgICAgICBjbGFzc05hbWU9e2Nsc3goY2xhc3Nlcy5pY29uLCBpc0V4cGFuZGVkICYmIGNsYXNzZXMucm90YXRlKX1cbiAgICAgICAgICBhcmlhLWhpZGRlbj1cInRydWVcIlxuICAgICAgICAgIHdpZHRoPXsxOH1cbiAgICAgICAgICBoZWlnaHQ9ezE4fVxuICAgICAgICAvPlxuICAgICAgPC9idXR0b24+XG4gICAgICA8ZGl2XG4gICAgICAgIGFyaWEtaGlkZGVuPXshaXNFeHBhbmRlZH1cbiAgICAgICAgaWQ9e2FyaWFJZH1cbiAgICAgICAgY2xhc3NOYW1lPXtjbHN4KGNsYXNzZXMuY29udGVudCwgY29udGVudENsYXNzTmFtZSl9XG4gICAgICAgIHN0eWxlPXt7IG1heEhlaWdodDogaXNFeHBhbmRlZCA/IGNvbnRlbnRIZWlnaHQgOiAwIH19XG4gICAgICA+XG4gICAgICAgIDxkaXZcbiAgICAgICAgICByZWY9e3JlZn1cbiAgICAgICAgICBjbGFzc05hbWU9e2Nsc3goXG4gICAgICAgICAgICBjbGFzc2VzLmlubmVyLFxuICAgICAgICAgICAgaW5uZXJDb250ZW50Q2xhc3NOYW1lLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBbY2xhc3Nlcy5kaXJlY3Rpb25Sb3ddOiBjb250ZW50RGlyZWN0aW9uID09PSAncm93JyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAhaXNFeHBhbmRlZCAmJiBjbGFzc2VzLmlubmVySGlkZGVuXG4gICAgICAgICAgKX1cbiAgICAgICAgPlxuICAgICAgICAgIHtjaGlsZHJlbn1cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgKTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IEV4cGFuc2lvblBhbmVsO1xuIl19