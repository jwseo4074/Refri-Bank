var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
import { ConditionalWrapper } from '../_private/ConditionalWrapper';
import { makeStyles } from '../../styles';
import { MenuItem } from './MenuItem';
import { motion, useReducedMotion } from 'framer-motion';
import { Portal } from 'reakit/Portal';
import { Text } from '../Text';
import { Menu as ReakitMenu, MenuButton, MenuItem as ReakitMenuItem, useMenuState, } from 'reakit/Menu';
import clsx from 'clsx';
import * as React from 'react';
import 'focus-visible';
export var MenuStylesKey = 'ChromaMenu';
export var useStyles = makeStyles(function (theme) { return ({
    root: {
        backgroundColor: theme.palette.common.white,
        borderRadius: theme.pxToRem(10),
        boxShadow: theme.boxShadows.popover,
        maxHeight: theme.pxToRem(432),
        minWidth: theme.pxToRem(224),
        overflowY: 'auto',
        paddingBottom: theme.spacing(1),
        paddingTop: theme.spacing(1),
        zIndex: 40,
        '&:focus': {
            outline: 'none',
        },
        '&:focus.focus-visible': {
            boxShadow: theme.boxShadows.focusVisible,
        },
    },
    title: {
        paddingBottom: theme.spacing(2),
        paddingLeft: theme.spacing(2.5),
        paddingRight: theme.spacing(2.5),
    },
}); }, { name: MenuStylesKey });
var isMenuItemElement = function (el) { return el.type === MenuItem; };
export var Menu = function (_a) {
    var ariaLabel = _a["aria-label"], anchorElement = _a.anchorElement, children = _a.children, className = _a.className, gutter = _a.gutter, items = _a.items, _b = _a.placement, placement = _b === void 0 ? 'bottom' : _b, title = _a.title, _c = _a.usePortal, usePortal = _c === void 0 ? false : _c, rootProps = __rest(_a, ['aria-label', "anchorElement", "children", "className", "gutter", "items", "placement", "title", "usePortal"]);
    var classes = useStyles({});
    var shouldReduceMotion = useReducedMotion();
    var menu = useMenuState({ placement: placement, gutter: gutter });
    var handleStopPropagation = function (e) {
        return e.stopPropagation();
    };
    return (React.createElement(React.Fragment, null,
        React.createElement(MenuButton, __assign({}, menu, anchorElement.props, { onClick: handleStopPropagation }), function (disclosureProps) {
            return React.cloneElement(React.Children.only(anchorElement), disclosureProps);
        }),
        React.createElement(ConditionalWrapper, { condition: usePortal, wrapper: function (children) { return React.createElement(Portal, null, children); } },
            React.createElement(ReakitMenu, __assign({}, menu, { as: motion.div, "aria-label": ariaLabel, className: clsx(classes.root, className), animate: menu.visible
                    ? shouldReduceMotion
                        ? { opacity: 1 }
                        : {
                            opacity: 1,
                            transition: { duration: 0.3 },
                        }
                    : shouldReduceMotion
                        ? { opacity: 0 }
                        : {
                            opacity: 0,
                            transition: { duration: 0.1 },
                        } }, rootProps),
                !!title && (React.createElement(Text, { className: classes.title, weight: "bold", size: "subbody" }, title)),
                items &&
                    items.map(function (item, i) {
                        return isMenuItemElement(item) ? (React.createElement(ReakitMenuItem, __assign({}, menu, item.props, { key: "item-".concat(i), onClick: function (e) {
                                menu.hide();
                                item.props.onClick && item.props.onClick(e);
                            } }), function (itemProps) {
                            return React.cloneElement(React.Children.only(item), itemProps);
                        })) : (item);
                    })))));
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTWVudS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL01lbnUvTWVudS50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBRXBFLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFDMUMsT0FBTyxFQUFFLFFBQVEsRUFBaUIsTUFBTSxZQUFZLENBQUM7QUFDckQsT0FBTyxFQUFFLE1BQU0sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN6RCxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3ZDLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFDL0IsT0FBTyxFQUNMLElBQUksSUFBSSxVQUFVLEVBQ2xCLFVBQVUsRUFDVixRQUFRLElBQUksY0FBYyxFQUUxQixZQUFZLEdBQ2IsTUFBTSxhQUFhLENBQUM7QUFDckIsT0FBTyxJQUFJLE1BQU0sTUFBTSxDQUFDO0FBQ3hCLE9BQU8sS0FBSyxLQUFLLE1BQU0sT0FBTyxDQUFDO0FBQy9CLE9BQU8sZUFBZSxDQUFDO0FBR3ZCLE1BQU0sQ0FBQyxJQUFNLGFBQWEsR0FBRyxZQUFZLENBQUM7QUFFMUMsTUFBTSxDQUFDLElBQU0sU0FBUyxHQUFHLFVBQVUsQ0FDakMsVUFBQyxLQUFLLElBQUssT0FBQSxDQUFDO0lBQ1YsSUFBSSxFQUFFO1FBQ0osZUFBZSxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEtBQUs7UUFDM0MsWUFBWSxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDO1FBQy9CLFNBQVMsRUFBRSxLQUFLLENBQUMsVUFBVSxDQUFDLE9BQU87UUFDbkMsU0FBUyxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDO1FBQzdC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Q0FBQzs0QkFDRSxPQUFPLEVBQUUsQ0FBQzs0QkFDVixVQUFVLEVBQUUsRUFBRSxRQUFRLEVBQUUsR0FBRyxFQUFFO3lCQUM5QixJQUVILFNBQVM7Z0JBRVosQ0FBQyxDQUFDLEtBQUssSUFBSSxDQUNWLG9CQUFDLElBQUksSUFBQyxTQUFTLEVBQUUsT0FBTyxDQUFDLEtBQUssRUFBRSxNQUFNLEVBQUMsTUFBTSxFQUFDLElBQUksRUFBQyxTQUFTLElBQ3pELEtBQUssQ0FDRCxDQUNSO2dCQUNBLEtBQUs7b0JBQ0osS0FBSyxDQUFDLEdBQUcsQ0FBQyxVQUFDLElBQUksRUFBRSxDQUFDO3dCQUNoQixPQUFBLGlCQUFpQixDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUN4QixvQkFBQyxjQUFjLGVBQ1QsSUFBSSxFQUNKLElBQUksQ0FBQyxLQUFLLElBQ2QsR0FBRyxFQUFFLGVBQVEsQ0FBQyxDQUFFLEVBQ2hCLE9BQU8sRUFBRSxVQUFDLENBQU07Z0NBQ2QsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO2dDQUNaLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDOzRCQUM5QyxDQUFDLEtBRUEsVUFBQyxTQUFTOzRCQUNULE9BQUEsS0FBSyxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxTQUFTLENBQUM7d0JBQXhELENBQXdELENBRTNDLENBQ2xCLENBQUMsQ0FBQyxDQUFDLENBQ0YsSUFBSSxDQUNMO29CQWhCRCxDQWdCQyxDQUNGLENBQ1EsQ0FDTSxDQUNwQixDQUNKLENBQUM7QUFDSixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb25kaXRpb25hbFdyYXBwZXIgfSBmcm9tICcuLi9fcHJpdmF0ZS9Db25kaXRpb25hbFdyYXBwZXInO1xuaW1wb3J0IHsgR2V0Q2xhc3NlcyB9IGZyb20gJy4uLy4uL3R5cGVVdGlscyc7XG5pbXBvcnQgeyBtYWtlU3R5bGVzIH0gZnJvbSAnLi4vLi4vc3R5bGVzJztcbmltcG9ydCB7IE1lbnVJdGVtLCBNZW51SXRlbVByb3BzIH0gZnJvbSAnLi9NZW51SXRlbSc7XG5pbXBvcnQgeyBtb3Rpb24sIHVzZVJlZHVjZWRNb3Rpb24gfSBmcm9tICdmcmFtZXItbW90aW9uJztcbmltcG9ydCB7IFBvcnRhbCB9IGZyb20gJ3JlYWtpdC9Qb3J0YWwnO1xuaW1wb3J0IHsgVGV4dCB9IGZyb20gJy4uL1RleHQnO1xuaW1wb3J0IHtcbiAgTWVudSBhcyBSZWFraXRNZW51LFxuICBNZW51QnV0dG9uLFxuICBNZW51SXRlbSBhcyBSZWFraXRNZW51SXRlbSxcbiAgTWVudUluaXRpYWxTdGF0ZSxcbiAgdXNlTWVudVN0YXRlLFxufSBmcm9tICdyZWFraXQvTWVudSc7XG5pbXBvcnQgY2xzeCBmcm9tICdjbHN4JztcbmltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCAnZm9jdXMtdmlzaWJsZSc7XG5pbXBvcnQgeyBNZW51R3JvdXBIZWFkaW5nUHJvcHMgfSBmcm9tICcuL01lbnVHcm91cEhlYWRpbmcnO1xuXG5leHBvcnQgY29uc3QgTWVudVN0eWxlc0tleSA9ICdDaHJvbWFNZW51JztcblxuZXhwb3J0IGNvbnN0IHVzZVN0eWxlcyA9IG1ha2VTdHlsZXMoXG4gICh0aGVtZSkgPT4gKHtcbiAgICByb290OiB7XG4gICAgICBiYWNrZ3JvdW5kQ29sb3I6IHRoZW1lLnBhbGV0dGUuY29tbW9uLndoaXRlLFxuICAgICAgYm9yZGVyUmFkaXVzOiB0aGVtZS5weFRvUmVtKDEwKSxcbiAgICAgIGJveFNoYWRvdzogdGhlbWUuYm94U2hhZG93cy5wb3BvdmVyLFxuICAgICAgbWF4SGVpZ2h0OiB0aGVtZS5weFRvUmVtKDQzMiksXG4gICAgICBtaW5XaWR0aDogdGhlbWUucHhUb1JlbSgyMjQpLFxuICAgICAgb3ZlcmZsb3dZOiAnYXV0bycsXG4gICAgICBwYWRkaW5nQm90dG9tOiB0aGVtZS5zcGFjaW5nKDEpLFxuICAgICAgcGFkZGluZ1RvcDogdGhlbWUuc3BhY2luZygxKSxcbiAgICAgIHpJbmRleDogNDAsXG4gICAgICAnJjpmb2N1cyc6IHtcbiAgICAgICAgb3V0bGluZTogJ25vbmUnLFxuICAgICAgfSxcbiAgICAgICcmOmZvY3VzLmZvY3VzLXZpc2libGUnOiB7XG4gICAgICAgIGJveFNoYWRvdzogdGhlbWUuYm94U2hhZG93cy5mb2N1c1Zpc2libGUsXG4gICAgICB9LFxuICAgIH0sXG4gICAgdGl0bGU6IHtcbiAgICAgIHBhZGRpbmdCb3R0b206IHRoZW1lLnNwYWNpbmcoMiksXG4gICAgICBwYWRkaW5nTGVmdDogdGhlbWUuc3BhY2luZygyLjUpLFxuICAgICAgcGFkZGluZ1JpZ2h0OiB0aGVtZS5zcGFjaW5nKDIuNSksXG4gICAgfSxcbiAgfSksXG4gIHsgbmFtZTogTWVudVN0eWxlc0tleSB9XG4pO1xuXG5leHBvcnQgdHlwZSBNZW51Q2xhc3NlcyA9IEdldENsYXNzZXM8dHlwZW9mIHVzZVN0eWxlcz47XG5cbmV4cG9ydCBpbnRlcmZhY2UgTWVudVByb3BzXG4gIGV4dGVuZHMgUGljazxNZW51SW5pdGlhbFN0YXRlLCAncGxhY2VtZW50JyB8ICdndXR0ZXInPiB7XG4gIFsnYXJpYS1sYWJlbCddOiBzdHJpbmc7XG4gIGFuY2hvckVsZW1lbnQ/OiBhbnk7XG4gIGNoaWxkcmVuPzogUmVhY3QuUmVhY3ROb2RlO1xuICBjbGFzc05hbWU/OiBzdHJpbmc7XG4gIGl0ZW1zPzogQXJyYXk8XG4gICAgfCBSZWFjdC5SZWFjdEVsZW1lbnQ8TWVudUl0ZW1Qcm9wcz5cbiAgICB8IFJlYWN0LlJlYWN0RWxlbWVudDxNZW51R3JvdXBIZWFkaW5nUHJvcHM+XG4gID47XG4gIHRpdGxlPzogc3RyaW5nO1xuICB1c2VQb3J0YWw/OiBib29sZWFuO1xufVxuXG5jb25zdCBpc01lbnVJdGVtRWxlbWVudCA9IChcbiAgZWw6XG4gICAgfCBSZWFjdC5SZWFjdEVsZW1lbnQ8TWVudUl0ZW1Qcm9wcz5cbiAgICB8IFJlYWN0LlJlYWN0RWxlbWVudDxNZW51R3JvdXBIZWFkaW5nUHJvcHM+XG4pOiBlbCBpcyBSZWFjdC5SZWFjdEVsZW1lbnQ8TWVudUl0ZW1Qcm9wcz4gPT4gZWwudHlwZSA9PT0gTWVudUl0ZW07XG5cbmV4cG9ydCBjb25zdCBNZW51OiBSZWFjdC5GQzxNZW51UHJvcHM+ID0gKHtcbiAgJ2FyaWEtbGFiZWwnOiBhcmlhTGFiZWwsXG4gIGFuY2hvckVsZW1lbnQsXG4gIGNoaWxkcmVuLFxuICBjbGFzc05hbWUsXG4gIGd1dHRlcixcbiAgaXRlbXMsXG4gIHBsYWNlbWVudCA9ICdib3R0b20nLFxuICB0aXRsZSxcbiAgdXNlUG9ydGFsID0gZmFsc2UsXG4gIC4uLnJvb3RQcm9wc1xufSkgPT4ge1xuICBjb25zdCBjbGFzc2VzID0gdXNlU3R5bGVzKHt9KTtcblxuICBjb25zdCBzaG91bGRSZWR1Y2VNb3Rpb24gPSB1c2VSZWR1Y2VkTW90aW9uKCk7XG5cbiAgY29uc3QgbWVudSA9IHVzZU1lbnVTdGF0ZSh7IHBsYWNlbWVudCwgZ3V0dGVyIH0pO1xuXG4gIGNvbnN0IGhhbmRsZVN0b3BQcm9wYWdhdGlvbiA9IChlOiBSZWFjdC5TeW50aGV0aWNFdmVudCkgPT5cbiAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuXG4gIHJldHVybiAoXG4gICAgPD5cbiAgICAgIDxNZW51QnV0dG9uXG4gICAgICAgIHsuLi5tZW51fVxuICAgICAgICB7Li4uYW5jaG9yRWxlbWVudC5wcm9wc31cbiAgICAgICAgb25DbGljaz17aGFuZGxlU3RvcFByb3BhZ2F0aW9ufVxuICAgICAgPlxuICAgICAgICB7KGRpc2Nsb3N1cmVQcm9wcykgPT5cbiAgICAgICAgICBSZWFjdC5jbG9uZUVsZW1lbnQoXG4gICAgICAgICAgICBSZWFjdC5DaGlsZHJlbi5vbmx5KGFuY2hvckVsZW1lbnQpLFxuICAgICAgICAgICAgZGlzY2xvc3VyZVByb3BzXG4gICAgICAgICAgKVxuICAgICAgICB9XG4gICAgICA8L01lbnVCdXR0b24+XG4gICAgICA8Q29uZGl0aW9uYWxXcmFwcGVyXG4gICAgICAgIGNvbmRpdGlvbj17dXNlUG9ydGFsfVxuICAgICAgICB3cmFwcGVyPXsoY2hpbGRyZW46IFJlYWN0LlJlYWN0Tm9kZSkgPT4gPFBvcnRhbD57Y2hpbGRyZW59PC9Qb3J0YWw+fVxuICAgICAgPlxuICAgICAgICA8UmVha2l0TWVudVxuICAgICAgICAgIHsuLi5tZW51fVxuICAgICAgICAgIGFzPXttb3Rpb24uZGl2fVxuICAgICAgICAgIGFyaWEtbGFiZWw9e2FyaWFMYWJlbH1cbiAgICAgICAgICBjbGFzc05hbWU9e2Nsc3goY2xhc3Nlcy5yb290LCBjbGFzc05hbWUpfVxuICAgICAgICAgIGFuaW1hdGU9e1xuICAgICAgICAgICAgbWVudS52aXNpYmxlXG4gICAgICAgICAgICAgID8gc2hvdWxkUmVkdWNlTW90aW9uXG4gICAgICAgICAgICAgICAgPyB7IG9wYWNpdHk6IDEgfVxuICAgICAgICAgICAgICAgIDoge1xuICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAxLFxuICAgICAgICAgICAgICAgICAgICB0cmFuc2l0aW9uOiB7IGR1cmF0aW9uOiAwLjMgfSxcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgOiBzaG91bGRSZWR1Y2VNb3Rpb25cbiAgICAgICAgICAgICAgPyB7IG9wYWNpdHk6IDAgfVxuICAgICAgICAgICAgICA6IHtcbiAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDAsXG4gICAgICAgICAgICAgICAgICB0cmFuc2l0aW9uOiB7IGR1cmF0aW9uOiAwLjEgfSxcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHsuLi5yb290UHJvcHN9XG4gICAgICAgID5cbiAgICAgICAgICB7ISF0aXRsZSAmJiAoXG4gICAgICAgICAgICA8VGV4dCBjbGFzc05hbWU9e2NsYXNzZXMudGl0bGV9IHdlaWdodD1cImJvbGRcIiBzaXplPVwic3ViYm9keVwiPlxuICAgICAgICAgICAgICB7dGl0bGV9XG4gICAgICAgICAgICA8L1RleHQ+XG4gICAgICAgICAgKX1cbiAgICAgICAgICB7aXRlbXMgJiZcbiAgICAgICAgICAgIGl0ZW1zLm1hcCgoaXRlbSwgaSkgPT5cbiAgICAgICAgICAgICAgaXNNZW51SXRlbUVsZW1lbnQoaXRlbSkgPyAoXG4gICAgICAgICAgICAgICAgPFJlYWtpdE1lbnVJdGVtXG4gICAgICAgICAgICAgICAgICB7Li4ubWVudX1cbiAgICAgICAgICAgICAgICAgIHsuLi5pdGVtLnByb3BzfVxuICAgICAgICAgICAgICAgICAga2V5PXtgaXRlbS0ke2l9YH1cbiAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9eyhlOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgbWVudS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW0ucHJvcHMub25DbGljayAmJiBpdGVtLnByb3BzLm9uQ2xpY2soZSk7XG4gICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgIHsoaXRlbVByb3BzKSA9PlxuICAgICAgICAgICAgICAgICAgICBSZWFjdC5jbG9uZUVsZW1lbnQoUmVhY3QuQ2hpbGRyZW4ub25seShpdGVtKSwgaXRlbVByb3BzKVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIDwvUmVha2l0TWVudUl0ZW0+XG4gICAgICAgICAgICAgICkgOiAoXG4gICAgICAgICAgICAgICAgaXRlbVxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICApfVxuICAgICAgICA8L1JlYWtpdE1lbnU+XG4gICAgICA8L0NvbmRpdGlvbmFsV3JhcHBlcj5cbiAgICA8Lz5cbiAgKTtcbn07XG4iXX0=