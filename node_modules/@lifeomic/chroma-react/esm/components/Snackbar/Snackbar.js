var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
import { makeStyles } from '../../styles';
import { motion, AnimatePresence, useReducedMotion } from 'framer-motion';
import { Text } from '../Text';
import clsx from 'clsx';
import * as React from 'react';
import { IconButton } from '../IconButton';
import { X } from '@lifeomic/chromicons';
export var SnackbarStylesKey = 'ChromaSnackbar';
export var useStyles = makeStyles(function (theme) { return ({
    root: {
        color: theme.palette.text.secondary,
        paddingTop: theme.spacing(1),
        paddingBottom: theme.spacing(1),
        paddingLeft: theme.spacing(2),
        paddingRight: theme.spacing(2),
        backgroundColor: theme.palette.common.white,
        borderRadius: 'unset',
        position: 'fixed',
        display: 'flex',
        alignItems: 'center',
        boxShadow: theme.boxShadows.tooltip,
        top: 0,
        right: 0,
        zIndex: 1500,
        pointerEvents: 'auto',
        '@media screen and (max-width: 480px)': {
            top: 'unset',
            bottom: 0,
            width: '100%',
        },
    },
    infoModifier: {
        borderLeft: "10px solid " + theme.palette.blue.main,
    },
    errorModifier: {
        borderLeft: "10px solid " + theme.palette.red.main,
    },
    warningModifier: {
        borderLeft: "10px solid " + theme.palette.yellow.main,
    },
    successModifier: {
        borderLeft: "10px solid " + theme.palette.green.main,
    },
    icon: {
        width: theme.pxToRem(16),
        height: theme.pxToRem(16),
        marginRight: theme.spacing(1),
    },
    title: {
        color: theme.palette.black[600],
    },
    closeButton: {
        marginLeft: theme.spacing(2),
        borderLeft: "1px solid " + theme.palette.divider,
    },
}); }, { name: SnackbarStylesKey });
export var Snackbar = React.forwardRef(function (_a, ref) {
    var _b;
    var className = _a.className, _c = _a.duration, duration = _c === void 0 ? 6000 : _c, Icon = _a.icon, _d = _a.isOpen, isOpen = _d === void 0 ? false : _d, _e = _a.allowDismiss, allowDismiss = _e === void 0 ? false : _e, onClose = _a.onClose, _f = _a.role, role = _f === void 0 ? 'status' : _f, _g = _a.statusType, statusType = _g === void 0 ? 'info' : _g, title = _a.title, children = _a.children, rootProps = __rest(_a, ["className", "duration", "icon", "isOpen", "allowDismiss", "onClose", "role", "statusType", "title", "children"]);
    var classes = useStyles({});
    var shouldReduceMotion = useReducedMotion();
    var _h = React.useState(duration), snackbarTimeout = _h[0], setSnackbarTimeout = _h[1];
    // Event handlers
    var onMouseEnter = function () { return setSnackbarTimeout(null); };
    var onMouseLeave = function () { return setSnackbarTimeout(duration); };
    var closeSnackbar = React.useCallback(function () {
        onClose && onClose();
    }, [onClose]);
    // Use a ref to close our Snackbar after the timeout
    var callbackRef = React.useRef();
    React.useEffect(function () {
        if (!callbackRef.current) {
            callbackRef.current = closeSnackbar;
        }
    }, [closeSnackbar]);
    React.useEffect(function () {
        // Ignore setting up a timer for the Snackbar
        // if one is not isOpen.
        if (!isOpen) {
            return;
        }
        var tick = function () {
            if (callbackRef.current) {
                callbackRef.current();
            }
        };
        if (snackbarTimeout) {
            var id_1 = setTimeout(tick, snackbarTimeout);
            return function () { return clearTimeout(id_1); };
        }
    }, [snackbarTimeout, isOpen]);
    return (React.createElement(AnimatePresence, { initial: false }, isOpen ? (React.createElement(motion.div, __assign({ ref: ref, className: clsx(classes.root, (_b = {},
            _b[classes.infoModifier] = statusType === 'info',
            _b[classes.errorModifier] = statusType === 'error',
            _b[classes.warningModifier] = statusType === 'warning',
            _b[classes.successModifier] = statusType === 'success',
            _b), className), "aria-live": role === 'alert' ? 'assertive' : 'polite', role: role, onMouseEnter: onMouseEnter, onMouseLeave: onMouseLeave, positionTransition: true, initial: shouldReduceMotion ? { opacity: 0 } : { opacity: 0, y: -40 }, animate: shouldReduceMotion
            ? { opacity: 1 }
            : {
                opacity: 1,
                y: 0,
            }, exit: shouldReduceMotion
            ? { opacity: 0 }
            : {
                opacity: 0,
                y: 60,
                transition: { duration: 0.25, ease: 'easeIn' },
            } }, rootProps),
        !!Icon && React.createElement(Icon, { role: "img", "aria-hidden": true, className: classes.icon }),
        children ? (children) : (React.createElement(Text, { className: classes.title }, title)),
        allowDismiss && (React.createElement(React.Fragment, null,
            React.createElement(IconButton, { className: classes.closeButton, "aria-label": "Close Notification", size: 0, paddingTop: 0, paddingBottom: 0, paddingRight: 0, icon: X, onClick: closeSnackbar }))))) : null));
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU25hY2tiYXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9TbmFja2Jhci9TbmFja2Jhci50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUNBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFDMUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxlQUFlLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDMUUsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLFNBQVMsQ0FBQztBQUMvQixPQUFPLElBQUksTUFBTSxNQUFNLENBQUM7QUFDeEIsT0FBTyxLQUFLLEtBQUssTUFBTSxPQUFPLENBQUM7QUFDL0IsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsQ0FBQyxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFHekMsTUFBTSxDQUFDLElBQU0saUJBQWlCLEdBQUcsZ0JBQWdCLENBQUM7QUFFbEQsTUFBTSxDQUFDLElBQU0sU0FBUyxHQUFHLFVBQVUsQ0FDakMsVUFBQyxLQUFLLElBQUssT0FBQSxDQUFDO0lBQ1YsSUFBSSxFQUFFO1FBQ0osS0FBSyxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFNBQVM7UUFDbkMsVUFBVSxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1FBQzVCLGFBQWEsRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztRQUMvQixXQUFXLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7UUFDN0IsWUFBWSxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1FBQzlCLGVBQWUsRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxLQUFLO1FBQzNDLFlBQVksRUFBRSxPQUFPO1FBQ3JCLFFBQVEsRUFB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Q0FDVSxDQUNkLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FDUSxDQUNuQixDQUFDO0FBQ0osQ0FBQyxDQUNGLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBHZXRDbGFzc2VzIH0gZnJvbSAnLi4vLi4vdHlwZVV0aWxzJztcbmltcG9ydCB7IG1ha2VTdHlsZXMgfSBmcm9tICcuLi8uLi9zdHlsZXMnO1xuaW1wb3J0IHsgbW90aW9uLCBBbmltYXRlUHJlc2VuY2UsIHVzZVJlZHVjZWRNb3Rpb24gfSBmcm9tICdmcmFtZXItbW90aW9uJztcbmltcG9ydCB7IFRleHQgfSBmcm9tICcuLi9UZXh0JztcbmltcG9ydCBjbHN4IGZyb20gJ2Nsc3gnO1xuaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgSWNvbkJ1dHRvbiB9IGZyb20gJy4uL0ljb25CdXR0b24nO1xuaW1wb3J0IHsgWCB9IGZyb20gJ0BsaWZlb21pYy9jaHJvbWljb25zJztcbmltcG9ydCB7IE5vdGlmaWNhdGlvblN0YXR1c1R5cGUgfSBmcm9tICcuLi9fcHJpdmF0ZS9ub3RpZmljYXRpb25UeXBlcyc7XG5cbmV4cG9ydCBjb25zdCBTbmFja2JhclN0eWxlc0tleSA9ICdDaHJvbWFTbmFja2Jhcic7XG5cbmV4cG9ydCBjb25zdCB1c2VTdHlsZXMgPSBtYWtlU3R5bGVzKFxuICAodGhlbWUpID0+ICh7XG4gICAgcm9vdDoge1xuICAgICAgY29sb3I6IHRoZW1lLnBhbGV0dGUudGV4dC5zZWNvbmRhcnksXG4gICAgICBwYWRkaW5nVG9wOiB0aGVtZS5zcGFjaW5nKDEpLFxuICAgICAgcGFkZGluZ0JvdHRvbTogdGhlbWUuc3BhY2luZygxKSxcbiAgICAgIHBhZGRpbmdMZWZ0OiB0aGVtZS5zcGFjaW5nKDIpLFxuICAgICAgcGFkZGluZ1JpZ2h0OiB0aGVtZS5zcGFjaW5nKDIpLFxuICAgICAgYmFja2dyb3VuZENvbG9yOiB0aGVtZS5wYWxldHRlLmNvbW1vbi53aGl0ZSxcbiAgICAgIGJvcmRlclJhZGl1czogJ3Vuc2V0JyxcbiAgICAgIHBvc2l0aW9uOiAnZml4ZWQnLFxuICAgICAgZGlzcGxheTogJ2ZsZXgnLFxuICAgICAgYWxpZ25JdGVtczogJ2NlbnRlcicsXG4gICAgICBib3hTaGFkb3c6IHRoZW1lLmJveFNoYWRvd3MudG9vbHRpcCxcbiAgICAgIHRvcDogMCxcbiAgICAgIHJpZ2h0OiAwLFxuICAgICAgekluZGV4OiAxNTAwLFxuICAgICAgcG9pbnRlckV2ZW50czogJ2F1dG8nLFxuICAgICAgJ0BtZWRpYSBzY3JlZW4gYW5kIChtYXgtd2lkdGg6IDQ4MHB4KSc6IHtcbiAgICAgICAgdG9wOiAndW5zZXQnLFxuICAgICAgICBib3R0b206IDAsXG4gICAgICAgIHdpZHRoOiAnMTAwJScsXG4gICAgICB9LFxuICAgIH0sXG4gICAgaW5mb01vZGlmaWVyOiB7XG4gICAgICBib3JkZXJMZWZ0OiBgMTBweCBzb2xpZCAke3RoZW1lLnBhbGV0dGUuYmx1ZS5tYWlufWAsXG4gICAgfSxcbiAgICBlcnJvck1vZGlmaWVyOiB7XG4gICAgICBib3JkZXJMZWZ0OiBgMTBweCBzb2xpZCAke3RoZW1lLnBhbGV0dGUucmVkLm1haW59YCxcbiAgICB9LFxuICAgIHdhcm5pbmdNb2RpZmllcjoge1xuICAgICAgYm9yZGVyTGVmdDogYDEwcHggc29saWQgJHt0aGVtZS5wYWxldHRlLnllbGxvdy5tYWlufWAsXG4gICAgfSxcbiAgICBzdWNjZXNzTW9kaWZpZXI6IHtcbiAgICAgIGJvcmRlckxlZnQ6IGAxMHB4IHNvbGlkICR7dGhlbWUucGFsZXR0ZS5ncmVlbi5tYWlufWAsXG4gICAgfSxcbiAgICBpY29uOiB7XG4gICAgICB3aWR0aDogdGhlbWUucHhUb1JlbSgxNiksXG4gICAgICBoZWlnaHQ6IHRoZW1lLnB4VG9SZW0oMTYpLFxuICAgICAgbWFyZ2luUmlnaHQ6IHRoZW1lLnNwYWNpbmcoMSksXG4gICAgfSxcbiAgICB0aXRsZToge1xuICAgICAgY29sb3I6IHRoZW1lLnBhbGV0dGUuYmxhY2tbNjAwXSxcbiAgICB9LFxuICAgIGNsb3NlQnV0dG9uOiB7XG4gICAgICBtYXJnaW5MZWZ0OiB0aGVtZS5zcGFjaW5nKDIpLFxuICAgICAgYm9yZGVyTGVmdDogYDFweCBzb2xpZCAke3RoZW1lLnBhbGV0dGUuZGl2aWRlcn1gLFxuICAgIH0sXG4gIH0pLFxuICB7IG5hbWU6IFNuYWNrYmFyU3R5bGVzS2V5IH1cbik7XG5cbmV4cG9ydCB0eXBlIFNuYWNrYmFyQ2xhc3NlcyA9IEdldENsYXNzZXM8dHlwZW9mIHVzZVN0eWxlcz47XG5cbmV4cG9ydCBpbnRlcmZhY2UgU25hY2tiYXJQcm9wcyB7XG4gIGR1cmF0aW9uPzogbnVtYmVyO1xuICBjbGFzc05hbWU/OiBzdHJpbmc7XG4gIGljb24/OiBSZWFjdC5Db21wb25lbnRUeXBlPFJlYWN0LlNWR1Byb3BzPFNWR1NWR0VsZW1lbnQ+PjtcbiAgaXNPcGVuPzogYm9vbGVhbjtcbiAgYWxsb3dEaXNtaXNzPzogYm9vbGVhbjtcbiAgb25DbG9zZT86ICgpID0+IHZvaWQ7XG4gIHJvbGU/OiAnYWxlcnQnIHwgJ3N0YXR1cyc7XG4gIHN0YXR1c1R5cGU/OiBOb3RpZmljYXRpb25TdGF0dXNUeXBlO1xuICB0aXRsZT86IHN0cmluZztcbn1cblxuZXhwb3J0IGNvbnN0IFNuYWNrYmFyOiBSZWFjdC5GQzxTbmFja2JhclByb3BzPiA9IFJlYWN0LmZvcndhcmRSZWY8XG4gIEhUTUxEaXZFbGVtZW50LFxuICBTbmFja2JhclByb3BzXG4+KFxuICAoXG4gICAge1xuICAgICAgY2xhc3NOYW1lLFxuICAgICAgZHVyYXRpb24gPSA2MDAwLFxuICAgICAgaWNvbjogSWNvbixcbiAgICAgIGlzT3BlbiA9IGZhbHNlLFxuICAgICAgYWxsb3dEaXNtaXNzID0gZmFsc2UsXG4gICAgICBvbkNsb3NlLFxuICAgICAgcm9sZSA9ICdzdGF0dXMnLFxuICAgICAgc3RhdHVzVHlwZSA9ICdpbmZvJyxcbiAgICAgIHRpdGxlLFxuICAgICAgY2hpbGRyZW4sXG4gICAgICAuLi5yb290UHJvcHNcbiAgICB9LFxuICAgIHJlZlxuICApID0+IHtcbiAgICBjb25zdCBjbGFzc2VzID0gdXNlU3R5bGVzKHt9KTtcblxuICAgIGNvbnN0IHNob3VsZFJlZHVjZU1vdGlvbiA9IHVzZVJlZHVjZWRNb3Rpb24oKTtcblxuICAgIGNvbnN0IFtzbmFja2JhclRpbWVvdXQsIHNldFNuYWNrYmFyVGltZW91dF0gPSBSZWFjdC51c2VTdGF0ZTxudW1iZXIgfCBudWxsPihcbiAgICAgIGR1cmF0aW9uXG4gICAgKTtcblxuICAgIC8vIEV2ZW50IGhhbmRsZXJzXG4gICAgY29uc3Qgb25Nb3VzZUVudGVyID0gKCkgPT4gc2V0U25hY2tiYXJUaW1lb3V0KG51bGwpO1xuICAgIGNvbnN0IG9uTW91c2VMZWF2ZSA9ICgpID0+IHNldFNuYWNrYmFyVGltZW91dChkdXJhdGlvbik7XG4gICAgY29uc3QgY2xvc2VTbmFja2JhciA9IFJlYWN0LnVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICAgIG9uQ2xvc2UgJiYgb25DbG9zZSgpO1xuICAgIH0sIFtvbkNsb3NlXSk7XG5cbiAgICAvLyBVc2UgYSByZWYgdG8gY2xvc2Ugb3VyIFNuYWNrYmFyIGFmdGVyIHRoZSB0aW1lb3V0XG4gICAgY29uc3QgY2FsbGJhY2tSZWYgPSBSZWFjdC51c2VSZWY8KCkgPT4gdm9pZCB8IG51bGw+KCk7XG5cbiAgICBSZWFjdC51c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgaWYgKCFjYWxsYmFja1JlZi5jdXJyZW50KSB7XG4gICAgICAgIGNhbGxiYWNrUmVmLmN1cnJlbnQgPSBjbG9zZVNuYWNrYmFyO1xuICAgICAgfVxuICAgIH0sIFtjbG9zZVNuYWNrYmFyXSk7XG5cbiAgICBSZWFjdC51c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgLy8gSWdub3JlIHNldHRpbmcgdXAgYSB0aW1lciBmb3IgdGhlIFNuYWNrYmFyXG4gICAgICAvLyBpZiBvbmUgaXMgbm90IGlzT3Blbi5cbiAgICAgIGlmICghaXNPcGVuKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgY29uc3QgdGljayA9ICgpID0+IHtcbiAgICAgICAgaWYgKGNhbGxiYWNrUmVmLmN1cnJlbnQpIHtcbiAgICAgICAgICBjYWxsYmFja1JlZi5jdXJyZW50KCk7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIGlmIChzbmFja2JhclRpbWVvdXQpIHtcbiAgICAgICAgY29uc3QgaWQgPSBzZXRUaW1lb3V0KHRpY2ssIHNuYWNrYmFyVGltZW91dCk7XG4gICAgICAgIHJldHVybiAoKSA9PiBjbGVhclRpbWVvdXQoaWQpO1xuICAgICAgfVxuICAgIH0sIFtzbmFja2JhclRpbWVvdXQsIGlzT3Blbl0pO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxBbmltYXRlUHJlc2VuY2UgaW5pdGlhbD17ZmFsc2V9PlxuICAgICAgICB7aXNPcGVuID8gKFxuICAgICAgICAgIDxtb3Rpb24uZGl2XG4gICAgICAgICAgICByZWY9e3JlZn1cbiAgICAgICAgICAgIGNsYXNzTmFtZT17Y2xzeChcbiAgICAgICAgICAgICAgY2xhc3Nlcy5yb290LFxuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgW2NsYXNzZXMuaW5mb01vZGlmaWVyXTogc3RhdHVzVHlwZSA9PT0gJ2luZm8nLFxuICAgICAgICAgICAgICAgIFtjbGFzc2VzLmVycm9yTW9kaWZpZXJdOiBzdGF0dXNUeXBlID09PSAnZXJyb3InLFxuICAgICAgICAgICAgICAgIFtjbGFzc2VzLndhcm5pbmdNb2RpZmllcl06IHN0YXR1c1R5cGUgPT09ICd3YXJuaW5nJyxcbiAgICAgICAgICAgICAgICBbY2xhc3Nlcy5zdWNjZXNzTW9kaWZpZXJdOiBzdGF0dXNUeXBlID09PSAnc3VjY2VzcycsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIGNsYXNzTmFtZVxuICAgICAgICAgICAgKX1cbiAgICAgICAgICAgIGFyaWEtbGl2ZT17cm9sZSA9PT0gJ2FsZXJ0JyA/ICdhc3NlcnRpdmUnIDogJ3BvbGl0ZSd9XG4gICAgICAgICAgICByb2xlPXtyb2xlfVxuICAgICAgICAgICAgb25Nb3VzZUVudGVyPXtvbk1vdXNlRW50ZXJ9XG4gICAgICAgICAgICBvbk1vdXNlTGVhdmU9e29uTW91c2VMZWF2ZX1cbiAgICAgICAgICAgIHBvc2l0aW9uVHJhbnNpdGlvblxuICAgICAgICAgICAgaW5pdGlhbD17XG4gICAgICAgICAgICAgIHNob3VsZFJlZHVjZU1vdGlvbiA/IHsgb3BhY2l0eTogMCB9IDogeyBvcGFjaXR5OiAwLCB5OiAtNDAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYW5pbWF0ZT17XG4gICAgICAgICAgICAgIHNob3VsZFJlZHVjZU1vdGlvblxuICAgICAgICAgICAgICAgID8geyBvcGFjaXR5OiAxIH1cbiAgICAgICAgICAgICAgICA6IHtcbiAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgICAgICAgICAgICAgeTogMCxcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGV4aXQ9e1xuICAgICAgICAgICAgICBzaG91bGRSZWR1Y2VNb3Rpb25cbiAgICAgICAgICAgICAgICA/IHsgb3BhY2l0eTogMCB9XG4gICAgICAgICAgICAgICAgOiB7XG4gICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDAsXG4gICAgICAgICAgICAgICAgICAgIHk6IDYwLFxuICAgICAgICAgICAgICAgICAgICB0cmFuc2l0aW9uOiB7IGR1cmF0aW9uOiAwLjI1LCBlYXNlOiAnZWFzZUluJyB9LFxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgey4uLnJvb3RQcm9wc31cbiAgICAgICAgICA+XG4gICAgICAgICAgICB7ISFJY29uICYmIDxJY29uIHJvbGU9XCJpbWdcIiBhcmlhLWhpZGRlbiBjbGFzc05hbWU9e2NsYXNzZXMuaWNvbn0gLz59XG4gICAgICAgICAgICB7Y2hpbGRyZW4gPyAoXG4gICAgICAgICAgICAgIGNoaWxkcmVuXG4gICAgICAgICAgICApIDogKFxuICAgICAgICAgICAgICA8VGV4dCBjbGFzc05hbWU9e2NsYXNzZXMudGl0bGV9Pnt0aXRsZX08L1RleHQ+XG4gICAgICAgICAgICApfVxuICAgICAgICAgICAge2FsbG93RGlzbWlzcyAmJiAoXG4gICAgICAgICAgICAgIDw+XG4gICAgICAgICAgICAgICAgPEljb25CdXR0b25cbiAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17Y2xhc3Nlcy5jbG9zZUJ1dHRvbn1cbiAgICAgICAgICAgICAgICAgIGFyaWEtbGFiZWw9XCJDbG9zZSBOb3RpZmljYXRpb25cIlxuICAgICAgICAgICAgICAgICAgc2l6ZT17MH1cbiAgICAgICAgICAgICAgICAgIHBhZGRpbmdUb3A9ezB9XG4gICAgICAgICAgICAgICAgICBwYWRkaW5nQm90dG9tPXswfVxuICAgICAgICAgICAgICAgICAgcGFkZGluZ1JpZ2h0PXswfVxuICAgICAgICAgICAgICAgICAgaWNvbj17WH1cbiAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9e2Nsb3NlU25hY2tiYXJ9XG4gICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgPC8+XG4gICAgICAgICAgICApfVxuICAgICAgICAgIDwvbW90aW9uLmRpdj5cbiAgICAgICAgKSA6IG51bGx9XG4gICAgICA8L0FuaW1hdGVQcmVzZW5jZT5cbiAgICApO1xuICB9XG4pO1xuIl19