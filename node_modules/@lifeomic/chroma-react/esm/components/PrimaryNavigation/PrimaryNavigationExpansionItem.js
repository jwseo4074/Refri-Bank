var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
import clsx from 'clsx';
import * as React from 'react';
import { useLocation } from 'react-router-dom';
import { Plus } from '@lifeomic/chromicons';
import { makeStyles } from '../../styles/index';
import { sideBarWidthCollapsed, useLayoutManager } from '../LayoutManager';
import { Pill } from '../Pill';
import { Text } from '../Text';
import { Tooltip } from '../Tooltip';
import { BETA_INITIAL_TRANSITION, BETA_ANIMATE_TRANSITION, BETA_EXIT_TRANSITION, PLUS_INITIAL_TRANSITION, PLUS_ANIMATE_TRANSITION, PLUS_EXIT_TRANSITION, } from './_private/common';
import { NavOrExternalLink } from './_private/NavOrExternalLink';
import { motion } from 'framer-motion';
export var PrimaryNavigationExpansionItemStylesKey = 'ChromaPrimaryNavigationExpansionItem';
export var useStyles = makeStyles(function (theme) { return ({
    root: {
        listStyle: 'none',
        padding: 0,
        margin: 0,
        position: 'relative',
    },
    rootOpen: {
        backgroundColor: 'var(--link-active-bg)',
        maxHeight: 'inherit',
        paddingBottom: theme.spacing(1),
        fallbacks: {
            backgroundColor: theme.palette.action.active,
        },
    },
    sidebarCollapsed: {
        paddingBottom: 0,
    },
    link: {
        display: 'flex',
        alignItems: 'center',
        height: theme.pxToRem(47),
        color: 'inherit',
        textDecoration: 'none',
        transition: 'color 0.5s ease, opacity 0.5s ease',
        '&:hover': {
            color: 'var(--link-hover)',
            textDecoration: 'none',
            fallbacks: {
                color: 'inherit',
            },
        },
    },
    linkActive: {
        color: 'var(--link-active)',
        '&:hover': {
            color: 'var(--link-active)',
            opacity: 0.75,
        },
        fallbacks: {
            color: theme.palette.primary[300],
        },
    },
    icon: {
        width: sideBarWidthCollapsed,
        flexShrink: 0,
        display: 'flex',
        alignItems: 'center',
        maxWidth: 60,
        outline: 'none',
        justifyContent: 'center',
    },
    label: {
        alignSelf: 'center',
        color: 'inherit',
        flex: 1,
        letterSpacing: 0.15,
        lineHeight: 'unset',
        overflowX: 'hidden',
        paddingRight: theme.spacing(2.25),
        textOverflow: 'ellipsis',
        whiteSpace: 'nowrap',
    },
    labelBeta: {
        justifyContent: 'flex-start',
        maxWidth: 120,
        paddingRight: 0,
    },
    plusIcon: {
        color: 'inherit',
        justifySelf: 'flex-end',
        marginRight: theme.spacing(2),
        position: 'absolute',
        right: 0,
    },
    hidden: {
        display: 'none',
    },
    content: {
        maxHeight: 0,
        overflow: 'hidden',
        transition: 'max-height 0.25s ease-in-out',
    },
    inner: {
        display: 'flex',
        flexDirection: 'column',
        backgroundColor: 'inherit',
        width: '100%',
        height: '100%',
        visibility: 'visible',
    },
    innerHidden: {
        visibility: 'hidden',
    },
    innerUl: {
        margin: theme.spacing(-1, 0, 0),
        padding: 0,
        position: 'relative',
    },
    beta: {
        margin: theme.spacing(0.125, 1, 0),
        position: 'absolute',
        right: theme.spacing(4),
        transform: 'scale(0.75)',
    },
}); }, { name: PrimaryNavigationExpansionItemStylesKey });
var BASE_TRANSITION_VARIANTS = {
    hide: { opacity: 0, x: 16, transition: { ease: 'easeIn' } },
    show: { opacity: 1, x: 0, transition: { ease: 'easeOut' } },
};
export var PrimaryNavigationExpansionItem = React.forwardRef(function (_a, ref) {
    var _b;
    var rootParentPath = _a.rootParentPath, exact = _a.exact, icon = _a.icon, label = _a.label, beta = _a.beta, betaLabelText = _a.betaLabelText, to = _a.to, children = _a.children, className = _a.className, additionalClasses = _a.classes, rootProps = __rest(_a, ["rootParentPath", "exact", "icon", "label", "beta", "betaLabelText", "to", "children", "className", "classes"]);
    var classes = useStyles({ classes: additionalClasses });
    var isSidebarCollapsed = useLayoutManager().isSidebarCollapsed;
    var location = useLocation();
    var innerRef = React.useRef(null);
    var _c = React.useState(0), contentHeight = _c[0], setContentHeight = _c[1];
    var isExpanded = React.useMemo(function () { return location.pathname.startsWith(rootParentPath); }, [location, rootParentPath]);
    React.useEffect(function () {
        if (innerRef && innerRef.current && children) {
            setContentHeight(innerRef.current.scrollHeight);
        }
    }, [children, (_b = innerRef === null || innerRef === void 0 ? void 0 : innerRef.current) === null || _b === void 0 ? void 0 : _b.scrollHeight]);
    return (React.createElement(motion.li, __assign({ ref: ref, className: clsx(classes.root, isExpanded && classes.rootOpen, isSidebarCollapsed && classes.sidebarCollapsed, className) }, rootProps),
        React.createElement(NavOrExternalLink, { exact: exact, className: classes.link, activeClassName: classes.linkActive, to: to },
            isSidebarCollapsed ? (React.createElement(Tooltip, { title: label, placement: "right", gutter: -4 },
                React.createElement("div", { className: classes.icon }, icon))) : (React.createElement("div", { className: classes.icon }, icon)),
            React.createElement(motion.div, { variants: BASE_TRANSITION_VARIANTS },
                React.createElement(Text, { size: "subbody", className: clsx(classes.label, beta && classes.labelBeta, className) }, label)),
            beta && !isSidebarCollapsed && (React.createElement(Pill, { variant: "highlight", label: betaLabelText, className: classes.beta, initial: BETA_INITIAL_TRANSITION, animate: BETA_ANIMATE_TRANSITION, exit: BETA_EXIT_TRANSITION })),
            !isSidebarCollapsed && (React.createElement(motion.span, { className: clsx(classes.plusIcon, isExpanded && classes.hidden), initial: PLUS_INITIAL_TRANSITION, animate: PLUS_ANIMATE_TRANSITION, exit: PLUS_EXIT_TRANSITION, role: "presentation" },
                React.createElement(Plus, { "aria-hidden": "true", width: 18, height: 18 })))),
        React.createElement(motion.div, { "aria-hidden": !isExpanded, className: clsx(classes.content), style: { maxHeight: isExpanded ? contentHeight : 0 } },
            React.createElement("div", { ref: innerRef, className: clsx(classes.inner, !isExpanded && classes.innerHidden) },
                React.createElement(motion.ul, { className: classes.innerUl }, children)))));
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUHJpbWFyeU5hdmlnYXRpb25FeHBhbnNpb25JdGVtLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvUHJpbWFyeU5hdmlnYXRpb24vUHJpbWFyeU5hdmlnYXRpb25FeHBhbnNpb25JdGVtLnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsT0FBTyxJQUFJLE1BQU0sTUFBTSxDQUFDO0FBQ3hCLE9BQU8sS0FBSyxLQUFLLE1BQU0sT0FBTyxDQUFDO0FBQy9CLE9BQU8sRUFBZ0IsV0FBVyxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDN0QsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQzVDLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUVoRCxPQUFPLEVBQUUscUJBQXFCLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUMzRSxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sU0FBUyxDQUFDO0FBQy9CLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFDL0IsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLFlBQVksQ0FBQztBQUNyQyxPQUFPLEVBQ0wsdUJBQXVCLEVBQ3ZCLHVCQUF1QixFQUN2QixvQkFBb0IsRUFDcEIsdUJBQXVCLEVBQ3ZCLHVCQUF1QixFQUN2QixvQkFBb0IsR0FDckIsTUFBTSxtQkFBbUIsQ0FBQztBQUMzQixPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUNqRSxPQUFPLEVBQUUsTUFBTSxFQUF5QixNQUFNLGVBQWUsQ0FBQztBQUU5RCxNQUFNLENBQUMsSUFBTSx1Q0FBdUMsR0FDbEQsc0NBQXNDLENBQUM7QUFFekMsTUFBTSxDQUFDLElBQU0sU0FBUyxHQUFHLFVBQVUsQ0FDakMsVUFBQyxLQUFLLElBQUssT0FBQSxDQUFDO0lB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QyxDQUNmLENBQ2lCO1FBQ3BCLG9CQUFDLE1BQU0sQ0FBQyxHQUFHLG1CQUNJLENBQUMsVUFBVSxFQUN4QixTQUFTLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFDaEMsS0FBSyxFQUFFLEVBQUUsU0FBUyxFQUFFLFVBQVUsQ0FBQyxDQUFDLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUU7WUFFcEQsNkJBQ0UsR0FBRyxFQUFFLFFBQVEsRUFDYixTQUFTLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsQ0FBQyxVQUFVLElBQUksT0FBTyxDQUFDLFdBQVcsQ0FBQztnQkFFbEUsb0JBQUMsTUFBTSxDQUFDLEVBQUUsSUFBQyxTQUFTLEVBQUUsT0FBTyxDQUFDLE9BQU8sSUFBRyxRQUFRLENBQWEsQ0FDekQsQ0FDSyxDQUNILENBQ2IsQ0FBQztBQUNKLENBQUMsQ0FDRixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGNsc3ggZnJvbSAnY2xzeCc7XG5pbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBOYXZMaW5rUHJvcHMsIHVzZUxvY2F0aW9uIH0gZnJvbSAncmVhY3Qtcm91dGVyLWRvbSc7XG5pbXBvcnQgeyBQbHVzIH0gZnJvbSAnQGxpZmVvbWljL2Nocm9taWNvbnMnO1xuaW1wb3J0IHsgbWFrZVN0eWxlcyB9IGZyb20gJy4uLy4uL3N0eWxlcy9pbmRleCc7XG5pbXBvcnQgeyBHZXRDbGFzc2VzLCBTdGFuZGFyZFByb3BzIH0gZnJvbSAnLi4vLi4vdHlwZVV0aWxzJztcbmltcG9ydCB7IHNpZGVCYXJXaWR0aENvbGxhcHNlZCwgdXNlTGF5b3V0TWFuYWdlciB9IGZyb20gJy4uL0xheW91dE1hbmFnZXInO1xuaW1wb3J0IHsgUGlsbCB9IGZyb20gJy4uL1BpbGwnO1xuaW1wb3J0IHsgVGV4dCB9IGZyb20gJy4uL1RleHQnO1xuaW1wb3J0IHsgVG9vbHRpcCB9IGZyb20gJy4uL1Rvb2x0aXAnO1xuaW1wb3J0IHtcbiAgQkVUQV9JTklUSUFMX1RSQU5TSVRJT04sXG4gIEJFVEFfQU5JTUFURV9UUkFOU0lUSU9OLFxuICBCRVRBX0VYSVRfVFJBTlNJVElPTixcbiAgUExVU19JTklUSUFMX1RSQU5TSVRJT04sXG4gIFBMVVNfQU5JTUFURV9UUkFOU0lUSU9OLFxuICBQTFVTX0VYSVRfVFJBTlNJVElPTixcbn0gZnJvbSAnLi9fcHJpdmF0ZS9jb21tb24nO1xuaW1wb3J0IHsgTmF2T3JFeHRlcm5hbExpbmsgfSBmcm9tICcuL19wcml2YXRlL05hdk9yRXh0ZXJuYWxMaW5rJztcbmltcG9ydCB7IG1vdGlvbiwgTW90aW9uUHJvcHMsIFZhcmlhbnRzIH0gZnJvbSAnZnJhbWVyLW1vdGlvbic7XG5cbmV4cG9ydCBjb25zdCBQcmltYXJ5TmF2aWdhdGlvbkV4cGFuc2lvbkl0ZW1TdHlsZXNLZXkgPVxuICAnQ2hyb21hUHJpbWFyeU5hdmlnYXRpb25FeHBhbnNpb25JdGVtJztcblxuZXhwb3J0IGNvbnN0IHVzZVN0eWxlcyA9IG1ha2VTdHlsZXMoXG4gICh0aGVtZSkgPT4gKHtcbiAgICByb290OiB7XG4gICAgICBsaXN0U3R5bGU6ICdub25lJyxcbiAgICAgIHBhZGRpbmc6IDAsXG4gICAgICBtYXJnaW46IDAsXG4gICAgICBwb3NpdGlvbjogJ3JlbGF0aXZlJyxcbiAgICB9LFxuICAgIHJvb3RPcGVuOiB7XG4gICAgICBiYWNrZ3JvdW5kQ29sb3I6ICd2YXIoLS1saW5rLWFjdGl2ZS1iZyknLFxuICAgICAgbWF4SGVpZ2h0OiAnaW5oZXJpdCcsXG4gICAgICBwYWRkaW5nQm90dG9tOiB0aGVtZS5zcGFjaW5nKDEpLFxuICAgICAgZmFsbGJhY2tzOiB7XG4gICAgICAgIGJhY2tncm91bmRDb2xvcjogdGhlbWUucGFsZXR0ZS5hY3Rpb24uYWN0aXZlLFxuICAgICAgfSxcbiAgICB9LFxuICAgIHNpZGViYXJDb2xsYXBzZWQ6IHtcbiAgICAgIHBhZGRpbmdCb3R0b206IDAsXG4gICAgfSxcbiAgICBsaW5rOiB7XG4gICAgICBkaXNwbGF5OiAnZmxleCcsXG4gICAgICBhbGlnbkl0ZW1zOiAnY2VudGVyJyxcbiAgICAgIGhlaWdodDogdGhlbWUucHhUb1JlbSg0NyksXG4gICAgICBjb2xvcjogJ2luaGVyaXQnLFxuICAgICAgdGV4dERlY29yYXRpb246ICdub25lJyxcbiAgICAgIHRyYW5zaXRpb246ICdjb2xvciAwLjVzIGVhc2UsIG9wYWNpdHkgMC41cyBlYXNlJyxcbiAgICAgICcmOmhvdmVyJzoge1xuICAgICAgICBjb2xvcjogJ3ZhcigtLWxpbmstaG92ZXIpJyxcbiAgICAgICAgdGV4dERlY29yYXRpb246ICdub25lJyxcbiAgICAgICAgZmFsbGJhY2tzOiB7XG4gICAgICAgICAgY29sb3I6ICdpbmhlcml0JyxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgICBsaW5rQWN0aXZlOiB7XG4gICAgICBjb2xvcjogJ3ZhcigtLWxpbmstYWN0aXZlKScsXG4gICAgICAnJjpob3Zlcic6IHtcbiAgICAgICAgY29sb3I6ICd2YXIoLS1saW5rLWFjdGl2ZSknLFxuICAgICAgICBvcGFjaXR5OiAwLjc1LFxuICAgICAgfSxcbiAgICAgIGZhbGxiYWNrczoge1xuICAgICAgICBjb2xvcjogdGhlbWUucGFsZXR0ZS5wcmltYXJ5WzMwMF0sXG4gICAgICB9LFxuICAgIH0sXG4gICAgaWNvbjoge1xuICAgICAgd2lkdGg6IHNpZGVCYXJXaWR0aENvbGxhcHNlZCxcbiAgICAgIGZsZXhTaHJpbms6IDAsXG4gICAgICBkaXNwbGF5OiAnZmxleCcsXG4gICAgICBhbGlnbkl0ZW1zOiAnY2VudGVyJyxcbiAgICAgIG1heFdpZHRoOiA2MCxcbiAgICAgIG91dGxpbmU6ICdub25lJyxcbiAgICAgIGp1c3RpZnlDb250ZW50OiAnY2VudGVyJyxcbiAgICB9LFxuICAgIGxhYmVsOiB7XG4gICAgICBhbGlnblNlbGY6ICdjZW50ZXInLFxuICAgICAgY29sb3I6ICdpbmhlcml0JyxcbiAgICAgIGZsZXg6IDEsXG4gICAgICBsZXR0ZXJTcGFjaW5nOiAwLjE1LFxuICAgICAgbGluZUhlaWdodDogJ3Vuc2V0JyxcbiAgICAgIG92ZXJmbG93WDogJ2hpZGRlbicsXG4gICAgICBwYWRkaW5nUmlnaHQ6IHRoZW1lLnNwYWNpbmcoMi4yNSksXG4gICAgICB0ZXh0T3ZlcmZsb3c6ICdlbGxpcHNpcycsXG4gICAgICB3aGl0ZVNwYWNlOiAnbm93cmFwJyxcbiAgICB9LFxuICAgIGxhYmVsQmV0YToge1xuICAgICAganVzdGlmeUNvbnRlbnQ6ICdmbGV4LXN0YXJ0JyxcbiAgICAgIG1heFdpZHRoOiAxMjAsXG4gICAgICBwYWRkaW5nUmlnaHQ6IDAsXG4gICAgfSxcbiAgICBwbHVzSWNvbjoge1xuICAgICAgY29sb3I6ICdpbmhlcml0JyxcbiAgICAgIGp1c3RpZnlTZWxmOiAnZmxleC1lbmQnLFxuICAgICAgbWFyZ2luUmlnaHQ6IHRoZW1lLnNwYWNpbmcoMiksXG4gICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJyxcbiAgICAgIHJpZ2h0OiAwLFxuICAgIH0sXG4gICAgaGlkZGVuOiB7XG4gICAgICBkaXNwbGF5OiAnbm9uZScsXG4gICAgfSxcbiAgICBjb250ZW50OiB7XG4gICAgICBtYXhIZWlnaHQ6IDAsXG4gICAgICBvdmVyZmxvdzogJ2hpZGRlbicsXG4gICAgICB0cmFuc2l0aW9uOiAnbWF4LWhlaWdodCAwLjI1cyBlYXNlLWluLW91dCcsXG4gICAgfSxcbiAgICBpbm5lcjoge1xuICAgICAgZGlzcGxheTogJ2ZsZXgnLFxuICAgICAgZmxleERpcmVjdGlvbjogJ2NvbHVtbicsXG4gICAgICBiYWNrZ3JvdW5kQ29sb3I6ICdpbmhlcml0JyxcbiAgICAgIHdpZHRoOiAnMTAwJScsXG4gICAgICBoZWlnaHQ6ICcxMDAlJyxcbiAgICAgIHZpc2liaWxpdHk6ICd2aXNpYmxlJyxcbiAgICB9LFxuICAgIGlubmVySGlkZGVuOiB7XG4gICAgICB2aXNpYmlsaXR5OiAnaGlkZGVuJyxcbiAgICB9LFxuICAgIGlubmVyVWw6IHtcbiAgICAgIG1hcmdpbjogdGhlbWUuc3BhY2luZygtMSwgMCwgMCksXG4gICAgICBwYWRkaW5nOiAwLFxuICAgICAgcG9zaXRpb246ICdyZWxhdGl2ZScsXG4gICAgfSxcbiAgICBiZXRhOiB7XG4gICAgICBtYXJnaW46IHRoZW1lLnNwYWNpbmcoMC4xMjUsIDEsIDApLFxuICAgICAgcG9zaXRpb246ICdhYnNvbHV0ZScsXG4gICAgICByaWdodDogdGhlbWUuc3BhY2luZyg0KSxcbiAgICAgIHRyYW5zZm9ybTogJ3NjYWxlKDAuNzUpJyxcbiAgICB9LFxuICB9KSxcbiAgeyBuYW1lOiBQcmltYXJ5TmF2aWdhdGlvbkV4cGFuc2lvbkl0ZW1TdHlsZXNLZXkgfVxuKTtcblxuY29uc3QgQkFTRV9UUkFOU0lUSU9OX1ZBUklBTlRTOiBWYXJpYW50cyA9IHtcbiAgaGlkZTogeyBvcGFjaXR5OiAwLCB4OiAxNiwgdHJhbnNpdGlvbjogeyBlYXNlOiAnZWFzZUluJyB9IH0sXG4gIHNob3c6IHsgb3BhY2l0eTogMSwgeDogMCwgdHJhbnNpdGlvbjogeyBlYXNlOiAnZWFzZU91dCcgfSB9LFxufTtcblxuZXhwb3J0IHR5cGUgUHJpbWFyeU5hdmlnYXRpb25FeHBhbnNpb25JdGVtQ2xhc3NlcyA9IEdldENsYXNzZXM8XG4gIHR5cGVvZiB1c2VTdHlsZXNcbj47XG5cbmV4cG9ydCBpbnRlcmZhY2UgUHJpbWFyeU5hdmlnYXRpb25FeHBhbnNpb25JdGVtUHJvcHNcbiAgZXh0ZW5kcyBPbWl0PFxuICAgICAgU3RhbmRhcmRQcm9wczxIVE1MTElFbGVtZW50LCBQcmltYXJ5TmF2aWdhdGlvbkV4cGFuc2lvbkl0ZW1DbGFzc2VzPixcbiAgICAgICdvbkFuaW1hdGlvblN0YXJ0JyB8ICdvbkRyYWcnIHwgJ29uRHJhZ0VuZCcgfCAnb25EcmFnU3RhcnQnIHwgJ3N0eWxlJ1xuICAgID4sXG4gICAgUGljazxOYXZMaW5rUHJvcHMsICdleGFjdCcgfCAndG8nPixcbiAgICBNb3Rpb25Qcm9wcyB7XG4gIGNoaWxkcmVuPzogUmVhY3QuUmVhY3ROb2RlO1xuICByb290UGFyZW50UGF0aD86IHN0cmluZztcbiAgbGFiZWw/OiBzdHJpbmc7XG4gIGJldGE/OiBib29sZWFuO1xuICBiZXRhTGFiZWxUZXh0Pzogc3RyaW5nO1xuICBpY29uPzogUmVhY3QuUmVhY3ROb2RlO1xufVxuXG5leHBvcnQgY29uc3QgUHJpbWFyeU5hdmlnYXRpb25FeHBhbnNpb25JdGVtID0gUmVhY3QuZm9yd2FyZFJlZjxcbiAgSFRNTExJRWxlbWVudCxcbiAgUHJpbWFyeU5hdmlnYXRpb25FeHBhbnNpb25JdGVtUHJvcHNcbj4oXG4gIChcbiAgICB7XG4gICAgICByb290UGFyZW50UGF0aCxcbiAgICAgIGV4YWN0LFxuICAgICAgaWNvbixcbiAgICAgIGxhYmVsLFxuICAgICAgYmV0YSxcbiAgICAgIGJldGFMYWJlbFRleHQsXG4gICAgICB0byxcbiAgICAgIGNoaWxkcmVuLFxuICAgICAgY2xhc3NOYW1lLFxuICAgICAgY2xhc3NlczogYWRkaXRpb25hbENsYXNzZXMsXG4gICAgICAuLi5yb290UHJvcHNcbiAgICB9LFxuICAgIHJlZlxuICApID0+IHtcbiAgICBjb25zdCBjbGFzc2VzID0gdXNlU3R5bGVzKHsgY2xhc3NlczogYWRkaXRpb25hbENsYXNzZXMgfSk7XG4gICAgY29uc3QgeyBpc1NpZGViYXJDb2xsYXBzZWQgfSA9IHVzZUxheW91dE1hbmFnZXIoKTtcbiAgICBjb25zdCBsb2NhdGlvbiA9IHVzZUxvY2F0aW9uKCk7XG5cbiAgICBjb25zdCBpbm5lclJlZiA9IFJlYWN0LnVzZVJlZjxIVE1MRGl2RWxlbWVudD4obnVsbCk7XG4gICAgY29uc3QgW2NvbnRlbnRIZWlnaHQsIHNldENvbnRlbnRIZWlnaHRdID0gUmVhY3QudXNlU3RhdGU8bnVtYmVyPigwKTtcbiAgICBjb25zdCBpc0V4cGFuZGVkID0gUmVhY3QudXNlTWVtbyhcbiAgICAgICgpID0+IGxvY2F0aW9uLnBhdGhuYW1lLnN0YXJ0c1dpdGgocm9vdFBhcmVudFBhdGgpLFxuICAgICAgW2xvY2F0aW9uLCByb290UGFyZW50UGF0aF1cbiAgICApO1xuXG4gICAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHtcbiAgICAgIGlmIChpbm5lclJlZiAmJiBpbm5lclJlZi5jdXJyZW50ICYmIGNoaWxkcmVuKSB7XG4gICAgICAgIHNldENvbnRlbnRIZWlnaHQoaW5uZXJSZWYuY3VycmVudC5zY3JvbGxIZWlnaHQpO1xuICAgICAgfVxuICAgIH0sIFtjaGlsZHJlbiwgaW5uZXJSZWY/LmN1cnJlbnQ/LnNjcm9sbEhlaWdodF0pO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxtb3Rpb24ubGlcbiAgICAgICAgcmVmPXtyZWZ9XG4gICAgICAgIGNsYXNzTmFtZT17Y2xzeChcbiAgICAgICAgICBjbGFzc2VzLnJvb3QsXG4gICAgICAgICAgaXNFeHBhbmRlZCAmJiBjbGFzc2VzLnJvb3RPcGVuLFxuICAgICAgICAgIGlzU2lkZWJhckNvbGxhcHNlZCAmJiBjbGFzc2VzLnNpZGViYXJDb2xsYXBzZWQsXG4gICAgICAgICAgY2xhc3NOYW1lXG4gICAgICAgICl9XG4gICAgICAgIHsuLi5yb290UHJvcHN9XG4gICAgICA+XG4gICAgICAgIDxOYXZPckV4dGVybmFsTGlua1xuICAgICAgICAgIGV4YWN0PXtleGFjdH1cbiAgICAgICAgICBjbGFzc05hbWU9e2NsYXNzZXMubGlua31cbiAgICAgICAgICBhY3RpdmVDbGFzc05hbWU9e2NsYXNzZXMubGlua0FjdGl2ZX1cbiAgICAgICAgICB0bz17dG99XG4gICAgICAgID5cbiAgICAgICAgICB7aXNTaWRlYmFyQ29sbGFwc2VkID8gKFxuICAgICAgICAgICAgPFRvb2x0aXAgdGl0bGU9e2xhYmVsfSBwbGFjZW1lbnQ9XCJyaWdodFwiIGd1dHRlcj17LTR9PlxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT17Y2xhc3Nlcy5pY29ufT57aWNvbn08L2Rpdj5cbiAgICAgICAgICAgIDwvVG9vbHRpcD5cbiAgICAgICAgICApIDogKFxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9e2NsYXNzZXMuaWNvbn0+e2ljb259PC9kaXY+XG4gICAgICAgICAgKX1cbiAgICAgICAgICA8bW90aW9uLmRpdiB2YXJpYW50cz17QkFTRV9UUkFOU0lUSU9OX1ZBUklBTlRTfT5cbiAgICAgICAgICAgIDxUZXh0XG4gICAgICAgICAgICAgIHNpemU9XCJzdWJib2R5XCJcbiAgICAgICAgICAgICAgY2xhc3NOYW1lPXtjbHN4KFxuICAgICAgICAgICAgICAgIGNsYXNzZXMubGFiZWwsXG4gICAgICAgICAgICAgICAgYmV0YSAmJiBjbGFzc2VzLmxhYmVsQmV0YSxcbiAgICAgICAgICAgICAgICBjbGFzc05hbWVcbiAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAge2xhYmVsfVxuICAgICAgICAgICAgPC9UZXh0PlxuICAgICAgICAgIDwvbW90aW9uLmRpdj5cbiAgICAgICAgICB7YmV0YSAmJiAhaXNTaWRlYmFyQ29sbGFwc2VkICYmIChcbiAgICAgICAgICAgIDxQaWxsXG4gICAgICAgICAgICAgIHZhcmlhbnQ9XCJoaWdobGlnaHRcIlxuICAgICAgICAgICAgICBsYWJlbD17YmV0YUxhYmVsVGV4dH1cbiAgICAgICAgICAgICAgY2xhc3NOYW1lPXtjbGFzc2VzLmJldGF9XG4gICAgICAgICAgICAgIGluaXRpYWw9e0JFVEFfSU5JVElBTF9UUkFOU0lUSU9OfVxuICAgICAgICAgICAgICBhbmltYXRlPXtCRVRBX0FOSU1BVEVfVFJBTlNJVElPTn1cbiAgICAgICAgICAgICAgZXhpdD17QkVUQV9FWElUX1RSQU5TSVRJT059XG4gICAgICAgICAgICAvPlxuICAgICAgICAgICl9XG4gICAgICAgICAgeyFpc1NpZGViYXJDb2xsYXBzZWQgJiYgKFxuICAgICAgICAgICAgPG1vdGlvbi5zcGFuXG4gICAgICAgICAgICAgIGNsYXNzTmFtZT17Y2xzeChjbGFzc2VzLnBsdXNJY29uLCBpc0V4cGFuZGVkICYmIGNsYXNzZXMuaGlkZGVuKX1cbiAgICAgICAgICAgICAgaW5pdGlhbD17UExVU19JTklUSUFMX1RSQU5TSVRJT059XG4gICAgICAgICAgICAgIGFuaW1hdGU9e1BMVVNfQU5JTUFURV9UUkFOU0lUSU9OfVxuICAgICAgICAgICAgICBleGl0PXtQTFVTX0VYSVRfVFJBTlNJVElPTn1cbiAgICAgICAgICAgICAgcm9sZT1cInByZXNlbnRhdGlvblwiXG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIDxQbHVzIGFyaWEtaGlkZGVuPVwidHJ1ZVwiIHdpZHRoPXsxOH0gaGVpZ2h0PXsxOH0gLz5cbiAgICAgICAgICAgIDwvbW90aW9uLnNwYW4+XG4gICAgICAgICAgKX1cbiAgICAgICAgPC9OYXZPckV4dGVybmFsTGluaz5cbiAgICAgICAgPG1vdGlvbi5kaXZcbiAgICAgICAgICBhcmlhLWhpZGRlbj17IWlzRXhwYW5kZWR9XG4gICAgICAgICAgY2xhc3NOYW1lPXtjbHN4KGNsYXNzZXMuY29udGVudCl9XG4gICAgICAgICAgc3R5bGU9e3sgbWF4SGVpZ2h0OiBpc0V4cGFuZGVkID8gY29udGVudEhlaWdodCA6IDAgfX1cbiAgICAgICAgPlxuICAgICAgICAgIDxkaXZcbiAgICAgICAgICAgIHJlZj17aW5uZXJSZWZ9XG4gICAgICAgICAgICBjbGFzc05hbWU9e2Nsc3goY2xhc3Nlcy5pbm5lciwgIWlzRXhwYW5kZWQgJiYgY2xhc3Nlcy5pbm5lckhpZGRlbil9XG4gICAgICAgICAgPlxuICAgICAgICAgICAgPG1vdGlvbi51bCBjbGFzc05hbWU9e2NsYXNzZXMuaW5uZXJVbH0+e2NoaWxkcmVufTwvbW90aW9uLnVsPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L21vdGlvbi5kaXY+XG4gICAgICA8L21vdGlvbi5saT5cbiAgICApO1xuICB9XG4pO1xuIl19